# E. coli 
# I create 3 SLR LUR models for E. coli with differing levels of livestock exposure. In order to find the best model I firstly run at least 10 models with one more predictor added. I then  use the (modified) selection code (see below) which was originally developed for the ESCAPE project
# Packages
```{r}
library(car)
library(writexl)
library(olsrr)
library(writexl)
```
# Define the variables for LUR1, LUR2 and LUR3
```{r}
# Define the input variables
Measurements_livestockpreds_LUR1 <- read.csv("Input_files//Measurements_livestockpreds_LUR1.csv")
Measurements_livestockpreds_LUR2 <- read.csv("Input_files//Measurements_livestockpreds_LUR2.csv")
Measurements_livestockpreds_LUR3 <- read.csv("Input_files//Measurements_livestockpreds_LUR3.csv")

# Define the outcome variable
ecoli <- Measurements_livestockpreds_LUR1$ecoli_copiespm3.ln.diffmeth.mean

#  Now set the values of some variables that will be needed
# LUR1
nfirstvar_LUR1 <- 6 
nlastvar_LUR1 <- 13
# LUR2
nfirstvar_LUR_2 <- 6
nlastvar_LUR_2 <- 74
# LUR3 
nfirstvar_LUR_3 <- 6  
nlastvar_LUR_3 <- 138
```
#  E. coli LUR1 model - training model
```{r}
#  This is the dataframe with all the LUR1 variables 
Measurements_livestockpreds_LUR1 <- read.csv("Input_files//Measurements_livestockpreds_LUR1.csv")
Measurements_livestockpreds_LUR1 

#  Now set the values of some variables that will be needed
nfirstvar_LUR1 <- 6  #  given that the list of explanatory variables is at the end of the table: specify in which row the first explanatory variable is
nlastvar_LUR1 <- 13

#  Function building to run the models 
#  1 
models<-list()

modeln<-1
models[[modeln]]<-list()

R2<-1
betaaddedvar<-1
addedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR1:nlastvar_LUR1){
  if (is.numeric(Measurements_livestockpreds_LUR1[,i])==TRUE){
    modeltry<-lm(ecoli~Measurements_livestockpreds_LUR1[,i])                            
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    # find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR1[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
    addedvar<-rbind(addedvar,names(Measurements_livestockpreds_LUR1)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
models[[modeln]]$results

#  this are the candidates models with the highest R2, not a negative beta for the new, nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)
subset(models[[modeln]]$resultspos)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(Measurements_livestockpreds_LUR1)[models[[1]]$indexbestmodel])
models[[modeln]]$namesbestmodel

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(ecoli~Measurements_livestockpreds_LUR1[,models[[1]]$indexbestmodel]) 
models[[modeln]]$bestmodel

summary(models[[modeln]]$bestmodel)

#  2

#  Add 2nd variable (the only difference of the above part is that now modeln=2 the model statement has 2 variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-2

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR1:nlastvar_LUR1){
  if (is.numeric(Measurements_livestockpreds_LUR1[,i])==TRUE){
    modeltry<-lm(ecoli~Measurements_livestockpreds_LUR1[,models[[1]]$indexbestmodel]+ Measurements_livestockpreds_LUR1[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    #  the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  Measurements_livestockpreds_LUR1[,i] is the row that's being tried out now. the name of that row can be found in names(Measurements_livestockpreds_LUR1)[i]
    addedvar<-rbind(addedvar,names(Measurements_livestockpreds_LUR1)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  these are the candidate models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(Measurements_livestockpreds_LUR1)[models[[1]]$indexbestmodel], names(Measurements_livestockpreds_LUR1)[models[[2]]$indexbestmodel] )
models[[modeln]]$namesbestmodel

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(ecoli~Measurements_livestockpreds_LUR1[,models[[1]]$indexbestmodel]+Measurements_livestockpreds_LUR1[,models[[2]]$indexbestmodel]) 
models[[modeln]]$bestmodel

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel

models[[1]]$namesbestmodel
models[[2]]$namesbestmodel

models[[1]]$R2bestmodel
models[[2]]$R2bestmodel

#  At this point I always check whether the next model (with 2 variables) is more than 1% better than the one before and if not I end here
#  R2 of the second model is in fact lower than that of the first, therefore I opt for model 1 with 1 predictor
#  last step is to exclude Measurements_livestockpreds_LUR1 variables with p>0.1 one by one with the lowest p first, until All <0.1.

#  3

#  add third variable (the only difference of the above part is that now modeln=3 the model statement has 3 variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-3

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR1:nlastvar_LUR1){
  if (is.numeric(Measurements_livestockpreds_LUR1[,i])==TRUE){  
    modeltry<-lm(ecoli~Measurements_livestockpreds_LUR1[,models[[1]]$indexbestmodel]+Measurements_livestockpreds_LUR1[,models[[2]]$indexbestmodel]+ Measurements_livestockpreds_LUR1[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    #  the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(Measurements_livestockpreds_LUR1)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))


#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(Measurements_livestockpreds_LUR1)[models[[1]]$indexbestmodel], names(Measurements_livestockpreds_LUR1)[models[[2]]$indexbestmodel] , names(Measurements_livestockpreds_LUR1)[models[[3]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(ecoli~Measurements_livestockpreds_LUR1[,models[[1]]$indexbestmodel]+Measurements_livestockpreds_LUR1[,models[[2]]$indexbestmodel]+Measurements_livestockpreds_LUR1[,models[[3]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel

models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel

models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel

#  4
#  add forth variable (the only difference of the above part is that now model n=4 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly
modeln<-4

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR1:nlastvar_LUR1){
  if (is.numeric(Measurements_livestockpreds_LUR1[,i])==TRUE){
    modeltry<-lm(ecoli~Measurements_livestockpreds_LUR1[,models[[1]]$indexbestmodel]+Measurements_livestockpreds_LUR1[,models[[2]]$indexbestmodel]+Measurements_livestockpreds_LUR1[,models[[3]]$indexbestmodel]+ Measurements_livestockpreds_LUR1[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    #  the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(Measurements_livestockpreds_LUR1)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(Measurements_livestockpreds_LUR1)[models[[1]]$indexbestmodel], names(Measurements_livestockpreds_LUR1)[models[[2]]$indexbestmodel] , names(Measurements_livestockpreds_LUR1)[models[[3]]$indexbestmodel], names(Measurements_livestockpreds_LUR1)[models[[4]]$indexbestmodel])

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(ecoli~Measurements_livestockpreds_LUR1[,models[[1]]$indexbestmodel]+Measurements_livestockpreds_LUR1[,models[[2]]$indexbestmodel]+Measurements_livestockpreds_LUR1[,models[[3]]$indexbestmodel]+ Measurements_livestockpreds_LUR1[,models[[4]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel

#  CODE FOR PICKING OUT THE BEST MODEL # 
temp <- 0
besti <- 0
for (i in 1:10){ #  think this runs the loop 10 times - not fully sure though - but not to do with the number of models I don't think - as when I change to 3, I still get the model with 4 variables as best model
  print(models[[i]]$R2bestmodel)
  #       print(models[[i]]$summarybestmodel$coefficients=-1,4])
  #       if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
  #         temp <- models[[i]]$R2bestmodel
  #         besti <- i
  #         }
  if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
    temp <- models[[i]]$R2bestmodel
    besti <- i
  }else{
    finalBestModel <- models[[besti]]$bestmodel
    finalBestModelNames <- models[[besti]]$namesbestmodel
    Sites <- 1:dim(Measurements_livestockpreds_LUR1)[1] # full original model
    #  CVaR2<-escCV(Sites)[2] # Cross Validation
    maxCD<-max(cooks.distance(finalBestModel))
    if(length(finalBestModelNames)<2){ # vif fn doesnot work when only 1 variable...       # 
      maxVIF<-"NA"
    }else{
      maxVIF<-max(vif(finalBestModel))
    }
    print(paste("This is the best ecoli model: ",besti,
                "(AdjR2: ",format(models[[besti]]$R2bestmodel,digits=3), "; MaxCD: ",format(maxCD,digits=3),"; MaxVIF: ",
                format(maxVIF,digits=3),")", sep=''))
    print(finalBestModelNames)
    break
  }
}

#  The final best model includes the predictor(s): nAnyFarmWghtDist.3000m.sum.95Win.10to90scaled
#  This is the same model as that I identified manually above
ecoli_LUR1_algorithmmethod<- lm(ecoli_copiespm3.ln.diffmeth.mean ~ nAnyFarmWghtDist.3000m.sum.95Win.10to90scaled, data = Measurements_livestockpreds_LUR1)
summary(ecoli_LUR1_algorithmmethod)

# Calculate RMSE
predicted_ecoli_LUR1 <- predict(ecoli_LUR1_algorithmmethod, Measurements_livestockpreds_LUR1)
RMSE_ecoli_LUR1 <- sqrt(mean((Measurements_livestockpreds_LUR1$ecoli_copiespm3.ln.diffmeth.mean - predicted_ecoli_LUR1)^2))
RMSE_ecoli_LUR1

#  Save these predicted concentrations along with the measured concentrations as an excel file 
#  Create a dataframe 
ecoli_LUR1_preds_observed <- data.frame(Measurements_livestockpreds_LUR1$Loc_ID,Measurements_livestockpreds_LUR1$ecoli_copiespm3.ln.diffmeth.mean, predicted_ecoli_LUR1)
print(ecoli_LUR1_preds_observed)

#  Save as xls file 
write_xlsx(ecoli_LUR1_preds_observed,"Output_files//ecoli_LUR1_preds_observed.xlsx")

#   MODEL CHECKING #  
#  1)Check normality of residuals 
#  2)Check residuals for linearity, independence and homoscedasticity
#  3)Check multicollinearity (VIF)
#  4)Check influential points (Cook's Distance)

#  1) Normality of residuals
boxplot(residuals(ecoli_LUR1_algorithmmethod),main="boxplot of residuals - E. coli LUR1 (ln-transformed concentrations)",xlab="residuals")
qqnorm(residuals(ecoli_LUR1_algorithmmethod),main="QQ-plot of residuals - E. coli LUR1 (ln-transformed concentrations)",xlab="residuals")
hist(residuals(ecoli_LUR1_algorithmmethod),main="QQ-plot of residuals - E. coli LUR1 (ln-transformed concentrations)",xlab="residuals")
#  2)Check residuals for linearity, independence and homoscedasticity
plot(fitted(ecoli_LUR1_algorithmmethod),residuals(ecoli_LUR1_algorithmmethod))

#  3)Check multicollinearity (VIF)
#  NA as only 1 variable in this model!

#  4)Check influential points (Cook's Distance)
ols_plot_cooksd_bar(ecoli_LUR1_algorithmmethod, print_plot = TRUE)
maxCD_ecoli_LUR1 <- max(cooks.distance(ecoli_LUR1_algorithmmethod))
maxCD_ecoli_LUR1
#  won't remove any outliers - none with cook's distance  > 1 
```
# E. coli LUR1 model - LOOCV
```{r}
#  LOOCV - LUR1 model for E. coli   
#  Leave one out cross validation - the goal of cross validation is to get a generalized score of the model. The reason for this generalization is to, hopefully, improve the model’s effectiveness in predicting on future data inputs. It is a type of 'internal' cross validation
Measurements_livestockpreds_LUR1_LOOCV <- Measurements_livestockpreds_LUR1
set.seed(123)
Measurements_livestockpreds_LUR1_LOOCV$ecoli_LUR1_LOOCV_PRED <- unlist(lapply(1:nrow(Measurements_livestockpreds_LUR1_LOOCV),function(inx){
  train <- Measurements_livestockpreds_LUR1_LOOCV[-inx,,drop=FALSE]
  test <- Measurements_livestockpreds_LUR1_LOOCV[inx,,drop=FALSE]
  cvm <- lm(ecoli_copiespm3.ln.diffmeth.mean ~ nAnyFarmWghtDist.3000m.sum.95Win.10to90scaled, data=train)
  pred <- predict(cvm,newdata=test)
  return(pred)
}))

predicted_ecoli_LUR1_LOOCV <- Measurements_livestockpreds_LUR1_LOOCV$ecoli_LUR1_LOOCV_PRED

#  Save these predicted concentrations along with the measured concentrations as an excel file 
#  Create a dataframe 
ecoli_LUR1_LOOCV_preds_observed <- data.frame(Measurements_livestockpreds_LUR1_LOOCV$Loc_ID,Measurements_livestockpreds_LUR1_LOOCV$ecoli_copiespm3.ln.diffmeth.mean, Measurements_livestockpreds_LUR1_LOOCV$ecoli_LUR1_LOOCV_PRED)
print(ecoli_LUR1_LOOCV_preds_observed)

#  Save as xls file 
write_xlsx(ecoli_LUR1_LOOCV_preds_observed,"Output_files//ecoli_LUR1_LOOCV_preds_observed.xlsx")

# Compute the LOOCV model R2
ecoli_LUR1_LOOCV_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean ~ ecoli_LUR1_LOOCV_PRED, data=Measurements_livestockpreds_LUR1_LOOCV)
summary(ecoli_LUR1_LOOCV_lm)
#  E. coli LUR1 model LOOCV multiple R^2 = 0.3109

# Calculate RMSE
preds_ecoli_LUR1_LOOCV <- predict(ecoli_LUR1_LOOCV_lm, Measurements_livestockpreds_LUR1_LOOCV)
RMSE_ecoli_LUR1_LOOCV <- sqrt(mean((Measurements_livestockpreds_LUR1_LOOCV$ecoli_copiespm3.ln.diffmeth.mean - preds_ecoli_LUR1_LOOCV)^2))
RMSE_ecoli_LUR1_LOOCV

#  Plot LOOCV estimations vs. observed concentrations
plot(Measurements_livestockpreds_LUR1_LOOCV$ecoli_LUR1_LOOCV_PRED, Measurements_livestockpreds_LUR1_LOOCV$ecoli_copiespm3.ln.diffmeth.mean)
abline(lm(Measurements_livestockpreds_LUR1_LOOCV$ecoli_copiespm3.ln.diffmeth.mean ~ Measurements_livestockpreds_LUR1_LOOCV$ecoli_LUR1_LOOCV_PRED))
```
# E. coli LUR1 model - 10-fold CV
```{r}
options(stringsAsFactors = FALSE) # so that dataframes are not opened in new tabs

# This is the required dataset for LUR1 
Measurements_livestockpreds_LUR1 

#  10-fold hold-out validation is done to assess model robustness. This is done using a random selection of 90% of the measurement sites. 
#  Part 1. Each measurement site gets randomly allocated number out of range 1-10
#  Completely randomly pulling sites
ecoli_HV_LUR1_df <- Measurements_livestockpreds_LUR1[c(1,2,6:13)] #  new df created with only ecoli values 
#  Create valID variable 
ecoli_HV_LUR1_df$valID <- 0
#  Draw 10 samples, thus on average 6 sites per test set (i.e 6 sites are removed from each model and then the model is tested on these 6 sites )
set.seed(123)
VGOB1_FINAL_ecoli_LUR1 <- c()
for (s in 1:1){
  if (s==1) set <- ecoli_HV_LUR1_df
  draws <- c(1:nrow(set))
  chosen <- c()
  tempdraws <- draws
  for (d in 1:10){
    list <- sample(tempdraws, length(tempdraws)/(11-d), FALSE)
    set[list,]$valID <- d
    chosen <- c(chosen, list)
    tempdraws <- draws[-chosen]
  }

#  Combine datasets to 1
VGOB1_FINAL_ecoli_LUR1 <- set
}

summary(set)
rm(set)

#  View the df created
str(VGOB1_FINAL_ecoli_LUR1, list.len=ncol(VGOB1_FINAL_ecoli_LUR1))
names(VGOB1_FINAL_ecoli_LUR1)
summary(VGOB1_FINAL_ecoli_LUR1)

#  Part 2: Make 10 subsets of dataset based on randomly allocated number (so these are the training datasets) 
#  Then create 10 subsets, each excluding 1 set of 10 sites
VGOB1_subsetA_ecoli_LUR1 <- subset(VGOB1_FINAL_ecoli_LUR1, valID != 1)
VGOB1_subsetB_ecoli_LUR1 <- subset(VGOB1_FINAL_ecoli_LUR1, valID != 2)  
VGOB1_subsetC_ecoli_LUR1 <- subset(VGOB1_FINAL_ecoli_LUR1, valID != 3)
VGOB1_subsetD_ecoli_LUR1 <- subset(VGOB1_FINAL_ecoli_LUR1, valID != 4)
VGOB1_subsetE_ecoli_LUR1 <- subset(VGOB1_FINAL_ecoli_LUR1, valID != 5)
VGOB1_subsetF_ecoli_LUR1 <- subset(VGOB1_FINAL_ecoli_LUR1, valID != 6)
VGOB1_subsetG_ecoli_LUR1 <- subset(VGOB1_FINAL_ecoli_LUR1, valID != 7)
VGOB1_subsetH_ecoli_LUR1 <- subset(VGOB1_FINAL_ecoli_LUR1, valID != 8)
VGOB1_subsetI_ecoli_LUR1 <- subset(VGOB1_FINAL_ecoli_LUR1, valID != 9)
VGOB1_subsetJ_ecoli_LUR1 <- subset(VGOB1_FINAL_ecoli_LUR1, valID != 10)

#  Part 3: Build for each subset a LUR model (i.e. go through the whole LUR model script for each subset (so each training set). Start with subset A, until final LUR model. Then subset B, until final LUR model etc.) 

#### A ####
# LUR model building process for subset A
#  This is the dataframe with the relevant predictor vars for LUR1 models for subset A (55 sites)
VGOB1_subsetA_ecoli_LUR1 # n.b. this dataframe only includes microbial marker concentrations for ecoli unlike the dataframe Measurements_livestockpreds_LUR1 as previously used for the model building. 
str(VGOB1_subsetA_ecoli_LUR1)

#  Now set the values of some variables that will be needed
nfirstvar_LUR_1 <- 3  
nlastvar_LUR_1 <- 10

# Function building to run the models 
# 1 #  

models<-list()
modeln<-1
models[[modeln]]<-list()

R2<-1
betaaddedvar<-1
addedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
  if (is.numeric(VGOB1_subsetA_ecoli_LUR1[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetA_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetA_ecoli_LUR1[,i])                            
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  Measurements_livestockpreds_LUR1[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetA_ecoli_LUR1)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
models[[modeln]]$results

#  this are the candidates models with the highest R2, not a negative beta for the new, nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)
subset(models[[modeln]]$resultspos)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetA_ecoli_LUR1)[models[[1]]$indexbestmodel])
models[[modeln]]$namesbestmodel

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetA_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetA_ecoli_LUR1[,models[[1]]$indexbestmodel]) 
models[[modeln]]$bestmodel

summary(models[[modeln]]$bestmodel)



# 2 #  
# Add 2nd variable (the only difference of the above part is that now modeln=2 the model statement has 2 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-2

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
  if (is.numeric(VGOB1_subsetA_ecoli_LUR1[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetA_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetA_ecoli_LUR1[,models[[1]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR1[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR1[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetA_ecoli_LUR1)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  these are the candidate models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetA_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR1)[models[[2]]$indexbestmodel] )
models[[modeln]]$namesbestmodel

# this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

# this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetA_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~                               VGOB1_subsetA_ecoli_LUR1[,models[[1]]$indexbestmodel]+                           VGOB1_subsetA_ecoli_LUR1[,models[[2]]$indexbestmodel]) 

models[[modeln]]$bestmodel

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel

# R2 decreases from model 1 to model 2 


# 3 #  
# add third variable (the only difference of the above part is that now modeln=3 the model statement has 3 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-3

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
  if (is.numeric(VGOB1_subsetA_ecoli_LUR1[,i])==TRUE){  
    modeltry<-lm(VGOB1_subsetA_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetA_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR1[,models[[2]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR1[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetA_ecoli_LUR1)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetA_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR1)[models[[2]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR1)[models[[3]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetA_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetA_ecoli_LUR1[,models[[1]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR1[,models[[2]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR1[,models[[3]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel


# 4 #  
#  add forth variable (the only difference of the above part is that now model n=4 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly
modeln<-4

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1


for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
  if (is.numeric(VGOB1_subsetA_ecoli_LUR1[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetA_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetA_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR1[,models[[3]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR1[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    #  the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetA_ecoli_LUR1)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetA_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR1)[models[[2]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR1)[models[[4]]$indexbestmodel])

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetA_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetA_ecoli_LUR1[,models[[1]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR1[,models[[4]]$indexbestmodel]) 


models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel


# 5 #  
# add fifth variable (the only difference of the above part is that now modeln=5 the model statement more variables)
# and the call for the list of variable names in the model changed slightly
modeln<-5

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
  if (is.numeric(VGOB1_subsetA_ecoli_LUR1[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetA_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetA_ecoli_LUR1[,models[[1]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR1[,models[[2]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR1[,i]) 
  
R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetA_ecoli_LUR1)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetA_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR1)[models[[2]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR1)[models[[4]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR1)[models[[5]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetA_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetA_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR1[,models[[5]]$indexbestmodel]) 
models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel


# The next part of the code (n=6-8) does not work
# This is because one of the coefficients included in the model with 6 variables is negative, the code does not allow for this. I can stop here. 

# # 6 #
# # add sixth variable (the only difference of the above part is that now model n=6 the model statement more variables)
# #  and the call for the list of variable names in the model changed slightly
# 
# modeln<-6
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# for (i in nfirstvar_LUR_1 :nlastvar_LUR_1){
#   if (is.numeric(VGOB1_subsetA_ecoli_LUR1[,i])==TRUE){
#     modeltry<-lm(VGOB1_subsetA_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetA_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR1[,models[[3]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR1[,models[[4]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR1[,models[[5]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR1[,i])
#     R2<-rbind(R2,summary(modeltry)$adj.r.squared)
#     # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     # All[,i] is the row that's being tried out now. the name of that row can be found in  names(All)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetA_ecoli_LUR1)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# # this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# 
# ########## code stops working here!!!!
# 
# # here are the names
# models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetA_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR1)[models[[2]]$indexbestmodel] , names(VGOB1_subsetA_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR1)[models[[4]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR1)[models[[5]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR1)[models[[6]]$indexbestmodel])
# 
# #  this is the r2 or that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetA_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetA_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR1[,models[[5]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR1[,models[[6]]$indexbestmodel])
# 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[5]]$summarybestmodel
# models[[6]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[5]]$namesbestmodel
# models[[6]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# models[[5]]$R2bestmodel
# models[[6]]$R2bestmodel


# # 7 #  
# # add seventh variable (the only difference of the above part is that now model n=7 the model statement more variables)
# #  and the call for the list of variable names in the model changed slightly
# 
# modeln<-7
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# for (i in nfirstvar_LUR_1 :nlastvar_LUR_1){
#   if (is.numeric(VGOB1_subsetA_ecoli_LUR1[,i])==TRUE){
#     modeltry<-lm(VGOB1_subsetA_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetA_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR1[,models[[3]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR1[,models[[4]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR1[,models[[5]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR1[,models[[6]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR1[,i]) 
#     R2<-rbind(R2,summary(modeltry)$adj.r.squared)
#     # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     # Measurements_livestockpreds_LUR1[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetA_ecoli_LUR1)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# # this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# # here are the names
# models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetA_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR1)[models[[2]]$indexbestmodel] , names(VGOB1_subsetA_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR1)[models[[4]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR1)[models[[5]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR1)[models[[6]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR1)[models[[7]]$indexbestmodel])
# 
# #  this is the r2 or that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetA_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetA_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR1[,models[[5]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR1[,models[[6]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR1[,models[[7]]$indexbestmodel]) 
# 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[5]]$summarybestmodel
# models[[6]]$summarybestmodel
# models[[7]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[5]]$namesbestmodel
# models[[6]]$namesbestmodel
# models[[7]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# models[[5]]$R2bestmodel
# models[[6]]$R2bestmodel
# models[[7]]$R2bestmodel
# 
# # 8 #  
# # add eighth variable (the only difference of the above part is that now modeln=7 the model statement more variables)
# # and the call for the list of variable names in the model changed slightly
# 
# modeln<-8
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# for (i in nfirstvar_LUR_1 :nlastvar_LUR_1){
#   if (is.numeric(VGOB1_subsetA_ecoli_LUR1[,i])==TRUE){
#     modeltry<-lm(VGOB1_subsetA_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetA_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR1[,models[[3]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR1[,models[[4]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR1[,models[[5]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR1[,models[[6]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR1[,models[[7]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR1[,i]) 
#     R2<-rbind(R2,summary(modeltry)$adj.r.squared)
#     # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     # Measurements_livestockpreds_LUR1[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetA_ecoli_LUR1)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# # this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# # here are the names
# models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetA_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR1)[models[[2]]$indexbestmodel] , names(VGOB1_subsetA_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR1)[models[[4]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR1)[models[[5]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR1)[models[[6]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR1)[models[[7]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR1)[models[[8]]$indexbestmodel])
# 
# #  this is the r2 or that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetA_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetA_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR1[,models[[5]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR1[,models[[6]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR1[,models[[7]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR1[,models[[8]]$indexbestmodel]) 
# 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[5]]$summarybestmodel
# models[[6]]$summarybestmodel
# models[[7]]$summarybestmodel
# models[[8]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[5]]$namesbestmodel
# models[[6]]$namesbestmodel
# models[[7]]$namesbestmodel
# models[[8]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# models[[5]]$R2bestmodel
# models[[6]]$R2bestmodel
# models[[7]]$R2bestmodel
# models[[8]]$R2bestmodel

#   CODE FOR PICKING OUT THE BEST MODEL #   
temp <- 0
besti <- 0
for (i in 1:10){ #  think this runs the loop 10 times - not fully sure thought - but not to do with the number of models I don't think - as when I change to 3, I still get the model with 4 variables as best model
  print(models[[i]]$R2bestmodel)
  #       print(models[[i]]$summarybestmodel$coefficients=-1,4])
  #       if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
  #         temp <- models[[i]]$R2bestmodel
  #         besti <- i
  #         }
  if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
    temp <- models[[i]]$R2bestmodel
    besti <- i
  }else{
    finalBestModel_ecoli_LUR1_subsetA <- models[[besti]]$bestmodel
    finalBestModelNames_ecoli_LUR1_subsetA <- models[[besti]]$namesbestmodel
    Sites <- 1:dim(VGOB1_subsetA_ecoli_LUR1)[1] # full original model
    #  CVaR2<-escCV_ecoli_LUR1(Sites)[2] # Cross Validation
    maxCD<-max(cooks.distance(finalBestModel_ecoli_LUR1_subsetA))
    if(length(finalBestModelNames_ecoli_LUR1_subsetA)<2){ # vif fn doesnot work when only 1 variable...       # 
      maxVIF<-"NA"
    }else{
      maxVIF<-max(vif(finalBestModel_ecoli_LUR1_subsetA))
    }
    print(paste("This is the best ecoli model for subset A: ",besti,
                "(AdjR2: ",format(models[[besti]]$R2bestmodel,digits=3), "; MaxCD: ",format(maxCD,digits=3),"; MaxVIF: ",
                format(maxVIF,digits=3),")", sep=''))
    print(finalBestModelNames_ecoli_LUR1_subsetA)
    break
  }
}

#  Overview of the final best model using the algorithm selection process (taking into account VIF, R^2, and p-values)
finalBestModel_ecoli_LUR1_subsetA 
finalBestModelNames_ecoli_LUR1_subsetA
models[[besti]]$summarybestmodel
models[[besti]]$R2bestmodel

#### B ####
# LUR model building process for subset B
# This is the dataframe with the relevant predictor vars for LUR1 models for subset B (55 sites)
VGOB1_subsetB_ecoli_LUR1 # n.b. this dataframe only includes microbial marker concentrations for ecoli unlike the dataframe Measurements_livestockpreds_LUR1 as previously used for the model building. 

#  Now set the values of some variables that will be needed
nfirstvar_LUR_1 <- 3  
nlastvar_LUR_1 <- 10

# Function building to run the models 
# 1 #  

models<-list()
modeln<-1
models[[modeln]]<-list()

R2<-1
betaaddedvar<-1
addedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
  if (is.numeric(VGOB1_subsetB_ecoli_LUR1[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetB_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetB_ecoli_LUR1[,i])                            
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)]);
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]));
    #  Measurements_livestockpreds_LUR1[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetB_ecoli_LUR1)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
models[[modeln]]$results

#  this are the candidates models with the highest R2, not a negative beta for the new, nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)
subset(models[[modeln]]$resultspos)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetB_ecoli_LUR1)[models[[1]]$indexbestmodel])
models[[modeln]]$namesbestmodel

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetB_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetB_ecoli_LUR1[,models[[1]]$indexbestmodel]) 
models[[modeln]]$bestmodel

summary(models[[modeln]]$bestmodel)


# 2 #  
# Add 2nd variable (the only difference of the above part is that now modeln=2 the model statement has 2 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-2

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
  if (is.numeric(VGOB1_subsetB_ecoli_LUR1[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetB_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetB_ecoli_LUR1[,models[[1]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR1[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR1[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetB_ecoli_LUR1)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  these are the candidate models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetB_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR1)[models[[2]]$indexbestmodel] )
models[[modeln]]$namesbestmodel

# this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

# this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetB_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~                               VGOB1_subsetB_ecoli_LUR1[,models[[1]]$indexbestmodel]+                           VGOB1_subsetB_ecoli_LUR1[,models[[2]]$indexbestmodel]) 

models[[modeln]]$bestmodel

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel


# 3 #  
# add third variable (the only difference of the above part is that now modeln=3 the model statement has 3 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-3

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
  if (is.numeric(VGOB1_subsetB_ecoli_LUR1[,i])==TRUE){  
    modeltry<-lm(VGOB1_subsetB_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetB_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetB_ecoli_LUR1[,models[[2]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR1[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetB_ecoli_LUR1)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetB_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR1)[models[[2]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR1)[models[[3]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetB_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetB_ecoli_LUR1[,models[[1]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR1[,models[[2]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR1[,models[[3]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel


# The next part of the code (n=4-8) does not work
# This is because one of the coefficients included in the model with 6 variables is negative, the code does not allow for this. I can stop here. 

# # 4 #
# #  add forth variable (the only difference of the above part is that now model n=4 the model statement more variables)
# #  and the call for the list of variable names in the model changed slightly
# modeln<-4
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# 
# for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
#   if (is.numeric(VGOB1_subsetB_ecoli_LUR1[,i])==TRUE){
#     modeltry<-lm(VGOB1_subsetB_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetB_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetB_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetB_ecoli_LUR1[,models[[3]]$indexbestmodel]+VGOB1_subsetB_ecoli_LUR1[,i])
#     R2<-rbind(R2,summary(modeltry)$adj.r.squared)
#     #  the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     #  All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetB_ecoli_LUR1)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# #### code stops working here, but model 3 is better than model 2, not sure what the problem is
# #  this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# #  here are the names
# models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetB_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR1)[models[[2]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR1)[models[[4]]$indexbestmodel])
# 
# #  this is the r2 of that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetB_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetB_ecoli_LUR1[,models[[1]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR1[,models[[2]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR1[,models[[4]]$indexbestmodel])
# 
# 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# 
# 
# # 5 #
# # add fifth variable (the only difference of the above part is that now modeln=5 the model statement more variables)
# # and the call for the list of variable names in the model changed slightly
# modeln<-5
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
#   if (is.numeric(VGOB1_subsetB_ecoli_LUR1[,i])==TRUE){
#     modeltry<-lm(VGOB1_subsetB_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetB_ecoli_LUR1[,models[[1]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR1[,models[[2]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR1[,i])
# 
# R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])#
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetB_ecoli_LUR1)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# #  this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# # here are the names
# models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetB_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR1)[models[[2]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR1)[models[[4]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR1)[models[[5]]$indexbestmodel])
# 
# #  this is the r2 or that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetB_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetB_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetB_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetB_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR1[,models[[5]]$indexbestmodel])
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[5]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[5]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# models[[5]]$R2bestmodel
# 
# # 6 #
# # add sixth variable (the only difference of the above part is that now model n=6 the model statement more variables)
# #  and the call for the list of variable names in the model changed slightly
# 
# modeln<-6
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# for (i in nfirstvar_LUR_1 :nlastvar_LUR_1){
#   if (is.numeric(VGOB1_subsetB_ecoli_LUR1[,i])==TRUE){
#     modeltry<-lm(VGOB1_subsetB_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetB_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetB_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetB_ecoli_LUR1[,models[[3]]$indexbestmodel]+VGOB1_subsetB_ecoli_LUR1[,models[[4]]$indexbestmodel]+VGOB1_subsetB_ecoli_LUR1[,models[[5]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR1[,i])
#     R2<-rbind(R2,summary(modeltry)$adj.r.squared)
#     # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])#
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     # All[,i] is the row that's being tried out now. the name of that row can be found in  names(All)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetB_ecoli_LUR1)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# # this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# # here are the names
# models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetB_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR1)[models[[2]]$indexbestmodel] , names(VGOB1_subsetB_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR1)[models[[4]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR1)[models[[5]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR1)[models[[6]]$indexbestmodel])
# 
# #  this is the r2 or that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetB_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetB_ecoli_LUR1[,models[[1]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR1[,models[[2]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR1[,models[[5]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR1[,models[[6]]$indexbestmodel])
# 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[5]]$summarybestmodel
# models[[6]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[5]]$namesbestmodel
# models[[6]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# models[[5]]$R2bestmodel
# models[[6]]$R2bestmodel
# 
# 
# # 7 #
# # add seventh variable (the only difference of the above part is that now model n=7 the model statement more variables)
# #  and the call for the list of variable names in the model changed slightly
# 
# modeln<-7
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# for (i in nfirstvar_LUR_1 :nlastvar_LUR_1){
#   if (is.numeric(VGOB1_subsetB_ecoli_LUR1[,i])==TRUE){
#     modeltry<- lm(VGOB1_subsetB_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetB_ecoli_LUR1[,models[[1]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR1[,models[[2]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR1[,models[[5]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR1[,models[[6]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR1[,i])
#     R2<-rbind(R2,summary(modeltry)$adj.r.squared)
#     # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])#
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     # Measurements_livestockpreds_LUR1[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetB_ecoli_LUR1)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# # this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# # here are the names
# models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetB_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR1)[models[[2]]$indexbestmodel] , names(VGOB1_subsetB_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR1)[models[[4]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR1)[models[[5]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR1)[models[[6]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR1)[models[[7]]$indexbestmodel])
# 
# #  this is the r2 or that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetB_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetB_ecoli_LUR1[,models[[1]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR1[,models[[2]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR1[,models[[5]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR1[,models[[6]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR1[,models[[7]]$indexbestmodel])
# 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[5]]$summarybestmodel
# models[[6]]$summarybestmodel
# models[[7]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[5]]$namesbestmodel
# models[[6]]$namesbestmodel
# models[[7]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# models[[5]]$R2bestmodel
# models[[6]]$R2bestmodel
# models[[7]]$R2bestmodel
# 
# # 8 #
# # add eighth variable (the only difference of the above part is that now modeln=7 the model statement more variables)
# # and the call for the list of variable names in the model changed slightly
# 
# modeln<-8
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# for (i in nfirstvar_LUR_1 :nlastvar_LUR_1){
#   if (is.numeric(VGOB1_subsetB_ecoli_LUR1[,i])==TRUE){
#     modeltry<- lm(VGOB1_subsetB_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetB_ecoli_LUR1[,models[[1]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR1[,models[[2]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR1[,models[[5]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR1[,models[[6]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR1[,models[[7]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR1[,i])
#     R2<-rbind(R2,summary(modeltry)$adj.r.squared)
#     # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])#
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     # Measurements_livestockpreds_LUR1[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetB_ecoli_LUR1)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# # this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# # here are the names
# models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetB_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR1)[models[[2]]$indexbestmodel] , names(VGOB1_subsetB_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR1)[models[[4]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR1)[models[[5]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR1)[models[[6]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR1)[models[[7]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR1)[models[[8]]$indexbestmodel])
# 
# #  this is the r2 or that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetB_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetB_ecoli_LUR1[,models[[1]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR1[,models[[2]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR1[,models[[5]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR1[,models[[6]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR1[,models[[7]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR1[,models[[8]]$indexbestmodel])
# 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[5]]$summarybestmodel
# models[[6]]$summarybestmodel
# models[[7]]$summarybestmodel
# models[[8]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[5]]$namesbestmodel
# models[[6]]$namesbestmodel
# models[[7]]$namesbestmodel
# models[[8]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# models[[5]]$R2bestmodel
# models[[6]]$R2bestmodel
# models[[7]]$R2bestmodel
# models[[8]]$R2bestmodel


#   CODE FOR PICKING OUT THE BEST MODEL #
temp <- 0
besti <- 0
for (i in 1:10){ #  think this runs the loop 10 times - not fully sure thought - but not to do with the number of models I don't think - as when I change to 3, I still get the model with 4 variables as best model
  print(models[[i]]$R2bestmodel)
  #       print(models[[i]]$summarybestmodel$coefficients=-1,4])
  #       if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
  #         temp <- models[[i]]$R2bestmodel
  #         besti <- i
  #         }
  if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
    temp <- models[[i]]$R2bestmodel
    besti <- i
  }else{
    finalBestModel_ecoli_LUR1_subsetB <- models[[besti]]$bestmodel
    finalBestModelNames_ecoli_LUR1_subsetB <- models[[besti]]$namesbestmodel
    Sites <- 1:dim(VGOB1_subsetB_ecoli_LUR1)[1] # full original model
    #  CVaR2<-escCV_ecoli_LUR1(Sites)[2] # Cross Validation
    maxCD<-max(cooks.distance(finalBestModel_ecoli_LUR1_subsetB))
    if(length(finalBestModelNames_ecoli_LUR1_subsetB)<2){ # vif fn doesnot work when only 1 variable...       #
      maxVIF<-"NA"
    }else{
      maxVIF<-max(vif(finalBestModel_ecoli_LUR1_subsetB))
    }
    print(paste("This is the best ecoli model for subset B of 10-fold CV: ",besti,
                "(AdjR2: ",format(models[[besti]]$R2bestmodel,digits=3), "; MaxCD: ",format(maxCD,digits=3),"; MaxVIF: ",
                format(maxVIF,digits=3),")", sep=''))
    print(finalBestModelNames_ecoli_LUR1_subsetB)
    break
  }
}

#  Overview of the final best model using the algorithm selection process (taking into account VIF, R^2, and p-values)
finalBestModel_ecoli_LUR1_subsetB
finalBestModelNames_ecoli_LUR1_subsetB
models[[besti]]$summarybestmodel
models[[besti]]$R2bestmodel

#### C ####
# LUR model building process for subset C
#  This is the dataframe with the relevant predictor vars for LUR1 models for subset C (55 sites)
VGOB1_subsetC_ecoli_LUR1 # n.b. this dataframe only includes microbial marker concentrations for ecoli unlike the dataframe Measurements_livestockpreds_LUR1 as previously used for the model building. 

#  Now set the values of some variables that will be needed
nfirstvar_LUR_1 <- 3  
nlastvar_LUR_1 <- 10

# Function building to run the models 
# 1 #  

models<-list()
modeln<-1
models[[modeln]]<-list()

R2<-1
betaaddedvar<-1
addedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
  if (is.numeric(VGOB1_subsetC_ecoli_LUR1[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetC_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetC_ecoli_LUR1[,i])                            
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  Measurements_livestockpreds_LUR1[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetC_ecoli_LUR1)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
models[[modeln]]$results

#  this are the candidates models with the highest R2, not a negative beta for the new, nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)
subset(models[[modeln]]$resultspos)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetC_ecoli_LUR1)[models[[1]]$indexbestmodel])
models[[modeln]]$namesbestmodel

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetC_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetC_ecoli_LUR1[,models[[1]]$indexbestmodel]) 
models[[modeln]]$bestmodel

summary(models[[modeln]]$bestmodel)

#  The first model includes the predictor: nPigMultipFarmWghtDist.3000m.sum.Tr.1P9 - meaning the number of multiplier pig farms weighted to distance in a 3000m buffer

# 2 #  
# Add 2nd variable (the only difference of the above part is that now modeln=2 the model statement has 2 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-2

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
  if (is.numeric(VGOB1_subsetC_ecoli_LUR1[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetC_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetC_ecoli_LUR1[,models[[1]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR1[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR1[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetC_ecoli_LUR1)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  these are the candidate models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetC_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR1)[models[[2]]$indexbestmodel] )
models[[modeln]]$namesbestmodel

# this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

# this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetC_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~                               VGOB1_subsetC_ecoli_LUR1[,models[[1]]$indexbestmodel]+                           VGOB1_subsetC_ecoli_LUR1[,models[[2]]$indexbestmodel]) 

models[[modeln]]$bestmodel

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel

# The next part of the code (n=3-8) does not work
# This is because one of the coefficients included in the model with 6 variables is negative, the code does not allow for this. I can stop here. 

# # 3 #  
# # add third variable (the only difference of the above part is that now modeln=3 the model statement has 3 variables)
# # and the call for the list of variable names in the model changed slightly
# 
# modeln<-3
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
#   if (is.numeric(VGOB1_subsetC_ecoli_LUR1[,i])==TRUE){  
#     modeltry<-lm(VGOB1_subsetC_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetC_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR1[,models[[2]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR1[,i]) 
#     R2<-rbind(R2,summary(modeltry)$adj.r.squared)
#     # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetC_ecoli_LUR1)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# #  rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# #  this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# #  here are the names
# models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetC_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR1)[models[[2]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR1)[models[[3]]$indexbestmodel])
# 
# #  this is the r2 or that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetC_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetC_ecoli_LUR1[,models[[1]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR1[,models[[2]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR1[,models[[3]]$indexbestmodel]) 
# 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# 
# 
# # 4 #  
# #  add forth variable (the only difference of the above part is that now model n=4 the model statement more variables)
# #  and the call for the list of variable names in the model changed slightly
# modeln<-4
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# 
# for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
#   if (is.numeric(VGOB1_subsetC_ecoli_LUR1[,i])==TRUE){
#     modeltry<-lm(VGOB1_subsetC_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetC_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR1[,models[[3]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR1[,i]) 
#     R2<-rbind(R2,summary(modeltry)$adj.r.squared)
#     #  the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     #  All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetC_ecoli_LUR1)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# #  this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# #  here are the names
# models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetC_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR1)[models[[2]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR1)[models[[4]]$indexbestmodel])
# 
# #  this is the r2 of that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetC_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetC_ecoli_LUR1[,models[[1]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR1[,models[[4]]$indexbestmodel]) 
# 
# 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# 
# 
# # 5 #  
# # add fifth variable (the only difference of the above part is that now modeln=5 the model statement more variables)
# # and the call for the list of variable names in the model changed slightly
# modeln<-5
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
#   if (is.numeric(VGOB1_subsetC_ecoli_LUR1[,i])==TRUE){
#     modeltry<-lm(VGOB1_subsetC_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetC_ecoli_LUR1[,models[[1]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR1[,models[[2]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR1[,i]) 
#   
# R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetC_ecoli_LUR1)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# #  this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# # here are the names
# models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetC_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR1)[models[[2]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR1)[models[[4]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR1)[models[[5]]$indexbestmodel])
# 
# #  this is the r2 or that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetC_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetC_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR1[,models[[5]]$indexbestmodel]) 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[5]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[5]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# models[[5]]$R2bestmodel
# 
# # 6 #  
# # add sixth variable (the only difference of the above part is that now model n=6 the model statement more variables)
# #  and the call for the list of variable names in the model changed slightly
# 
# modeln<-6
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# for (i in nfirstvar_LUR_1 :nlastvar_LUR_1){
#   if (is.numeric(VGOB1_subsetC_ecoli_LUR1[,i])==TRUE){
#     modeltry<-lm(VGOB1_subsetC_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetC_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR1[,models[[3]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR1[,models[[4]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR1[,models[[5]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR1[,i]) 
#     R2<-rbind(R2,summary(modeltry)$adj.r.squared)
#     # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     # All[,i] is the row that's being tried out now. the name of that row can be found in  names(All)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetC_ecoli_LUR1)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# # this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# # here are the names
# models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetC_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR1)[models[[2]]$indexbestmodel] , names(VGOB1_subsetC_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR1)[models[[4]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR1)[models[[5]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR1)[models[[6]]$indexbestmodel])
# 
# #  this is the r2 or that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetC_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetC_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR1[,models[[5]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR1[,models[[6]]$indexbestmodel]) 
# 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[5]]$summarybestmodel
# models[[6]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[5]]$namesbestmodel
# models[[6]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# models[[5]]$R2bestmodel
# models[[6]]$R2bestmodel
# 
# 
# # 7 #  
# # add seventh variable (the only difference of the above part is that now model n=7 the model statement more variables)
# #  and the call for the list of variable names in the model changed slightly
# 
# modeln<-7
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# for (i in nfirstvar_LUR_1 :nlastvar_LUR_1){
#   if (is.numeric(VGOB1_subsetC_ecoli_LUR1[,i])==TRUE){
#     modeltry<-lm(VGOB1_subsetC_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetC_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR1[,models[[3]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR1[,models[[4]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR1[,models[[5]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR1[,models[[6]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR1[,i]) 
#     R2<-rbind(R2,summary(modeltry)$adj.r.squared)
#     # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     # Measurements_livestockpreds_LUR1[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetC_ecoli_LUR1)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# # this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# # here are the names
# models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetC_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR1)[models[[2]]$indexbestmodel] , names(VGOB1_subsetC_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR1)[models[[4]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR1)[models[[5]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR1)[models[[6]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR1)[models[[7]]$indexbestmodel])
# 
# #  this is the r2 or that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetC_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetC_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR1[,models[[5]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR1[,models[[6]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR1[,models[[7]]$indexbestmodel]) 
# 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[5]]$summarybestmodel
# models[[6]]$summarybestmodel
# models[[7]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[5]]$namesbestmodel
# models[[6]]$namesbestmodel
# models[[7]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# models[[5]]$R2bestmodel
# models[[6]]$R2bestmodel
# models[[7]]$R2bestmodel
# 
# # 8 #  
# # add eighth variable (the only difference of the above part is that now modeln=7 the model statement more variables)
# # and the call for the list of variable names in the model changed slightly
# 
# modeln<-8
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# for (i in nfirstvar_LUR_1 :nlastvar_LUR_1){
#   if (is.numeric(VGOB1_subsetC_ecoli_LUR1[,i])==TRUE){
#     modeltry<-lm(VGOB1_subsetC_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetC_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR1[,models[[3]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR1[,models[[4]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR1[,models[[5]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR1[,models[[6]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR1[,models[[7]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR1[,i]) 
#     R2<-rbind(R2,summary(modeltry)$adj.r.squared)
#     # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     # Measurements_livestockpreds_LUR1[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetC_ecoli_LUR1)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# # this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# # here are the names
# models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetC_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR1)[models[[2]]$indexbestmodel] , names(VGOB1_subsetC_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR1)[models[[4]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR1)[models[[5]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR1)[models[[6]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR1)[models[[7]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR1)[models[[8]]$indexbestmodel])
# 
# #  this is the r2 or that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetC_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetC_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR1[,models[[5]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR1[,models[[6]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR1[,models[[7]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR1[,models[[8]]$indexbestmodel]) 
# 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[5]]$summarybestmodel
# models[[6]]$summarybestmodel
# models[[7]]$summarybestmodel
# models[[8]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[5]]$namesbestmodel
# models[[6]]$namesbestmodel
# models[[7]]$namesbestmodel
# models[[8]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# models[[5]]$R2bestmodel
# models[[6]]$R2bestmodel
# models[[7]]$R2bestmodel
# models[[8]]$R2bestmodel

#   CODE FOR PICKING OUT THE BEST MODEL #   
temp <- 0
besti <- 0
for (i in 1:10){ #  think this runs the loop 10 times - not fully sure thought - but not to do with the number of models I don't think - as when I change to 3, I still get the model with 4 variables as best model
  print(models[[i]]$R2bestmodel)
  #       print(models[[i]]$summarybestmodel$coefficients=-1,4])
  #       if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
  #         temp <- models[[i]]$R2bestmodel
  #         besti <- i
  #         }
  if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
    temp <- models[[i]]$R2bestmodel
    besti <- i
  }else{
    finalBestModel_ecoli_LUR1_subsetC <- models[[besti]]$bestmodel
    finalBestModelNames_ecoli_LUR1_subsetC <- models[[besti]]$namesbestmodel
    Sites <- 1:dim(VGOB1_subsetC_ecoli_LUR1)[1] # full original model
    #  CVaR2<-escCV_ecoli_LUR1(Sites)[2] # Cross Validation
    maxCD<-max(cooks.distance(finalBestModel_ecoli_LUR1_subsetC))
    if(length(finalBestModelNames_ecoli_LUR1_subsetC)<2){ # vif fn doesnot work when only 1 variable...       # 
      maxVIF<-"NA"
    }else{
      maxVIF<-max(vif(finalBestModel_ecoli_LUR1_subsetC))
    }
    print(paste("This is the best ecoli model for subset C: ",besti,
                "(AdjR2: ",format(models[[besti]]$R2bestmodel,digits=3), "; MaxCD: ",format(maxCD,digits=3),"; MaxVIF: ",
                format(maxVIF,digits=3),")", sep=''))
    print(finalBestModelNames_ecoli_LUR1_subsetC)
    break
  }
}

#  Overview of the final best model using the algorithm selection process (taking into account VIF, R^2, and p-values)
finalBestModel_ecoli_LUR1_subsetC
finalBestModelNames_ecoli_LUR1_subsetC
models[[besti]]$summarybestmodel
models[[besti]]$R2bestmodel

#### D ####
# LUR model building process for subset D
#  This is the dataframe with the relevant predictor vars for LUR1 models for subset D (55 sites)
VGOB1_subsetD_ecoli_LUR1 # n.b. this dataframe only includes microbial marker concentrations for ecoli unlike the dataframe Measurements_livestockpreds_LUR1 as previously used for the model building. 

#  Now set the values of some variables that will be needed
nfirstvar_LUR_1 <- 3  
nlastvar_LUR_1 <- 10

# Function building to run the models 
# 1 #  

models<-list()
modeln<-1
models[[modeln]]<-list()

R2<-1
betaaddedvar<-1
addedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
  if (is.numeric(VGOB1_subsetD_ecoli_LUR1[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetD_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetD_ecoli_LUR1[,i])                            
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  Measurements_livestockpreds_LUR1[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetD_ecoli_LUR1)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
models[[modeln]]$results

#  this are the candidates models with the highest R2, not a negative beta for the new, nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)
subset(models[[modeln]]$resultspos)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetD_ecoli_LUR1)[models[[1]]$indexbestmodel])
models[[modeln]]$namesbestmodel

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetD_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetD_ecoli_LUR1[,models[[1]]$indexbestmodel]) 
models[[modeln]]$bestmodel

summary(models[[modeln]]$bestmodel)

#  The first model includes the predictor: nPigMultipFarmWghtDist.3000m.sum.Tr.1P9 - meaning the number of multiplier pig farms weighted to distance in a 3000m buffer

# 2 #  
# Add 2nd variable (the only difference of the above part is that now modeln=2 the model statement has 2 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-2

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
  if (is.numeric(VGOB1_subsetD_ecoli_LUR1[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetD_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetD_ecoli_LUR1[,models[[1]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR1[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR1[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetD_ecoli_LUR1)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  these are the candidate models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetD_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR1)[models[[2]]$indexbestmodel] )
models[[modeln]]$namesbestmodel

# this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

# this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetD_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~                               VGOB1_subsetD_ecoli_LUR1[,models[[1]]$indexbestmodel]+                           VGOB1_subsetD_ecoli_LUR1[,models[[2]]$indexbestmodel]) 

models[[modeln]]$bestmodel

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel


# 3 #  
# add third variable (the only difference of the above part is that now modeln=3 the model statement has 3 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-3

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
  if (is.numeric(VGOB1_subsetD_ecoli_LUR1[,i])==TRUE){  
    modeltry<-lm(VGOB1_subsetD_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetD_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR1[,models[[2]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR1[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetD_ecoli_LUR1)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetD_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR1)[models[[2]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR1)[models[[3]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetD_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetD_ecoli_LUR1[,models[[1]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR1[,models[[2]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR1[,models[[3]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel


# 4 #  
#  add forth variable (the only difference of the above part is that now model n=4 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly
modeln<-4

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1


for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
  if (is.numeric(VGOB1_subsetD_ecoli_LUR1[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetD_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetD_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR1[,models[[3]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR1[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    #  the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetD_ecoli_LUR1)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetD_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR1)[models[[2]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR1)[models[[4]]$indexbestmodel])

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetD_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetD_ecoli_LUR1[,models[[1]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR1[,models[[4]]$indexbestmodel]) 


models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel

# The next part of the code (n=5-8) does not work
# This is because one of the coefficients included in the model with 6 variables is negative, the code does not allow for this. I can stop here. 

# # 5 #  
# # add fifth variable (the only difference of the above part is that now modeln=5 the model statement more variables)
# # and the call for the list of variable names in the model changed slightly
# modeln<-5
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
#   if (is.numeric(VGOB1_subsetD_ecoli_LUR1[,i])==TRUE){
#     modeltry<-lm(VGOB1_subsetD_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetD_ecoli_LUR1[,models[[1]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR1[,models[[2]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR1[,i]) 
#   
# R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetD_ecoli_LUR1)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# #  this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# # here are the names
# models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetD_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR1)[models[[2]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR1)[models[[4]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR1)[models[[5]]$indexbestmodel])
# 
# #  this is the r2 or that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetD_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetD_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR1[,models[[5]]$indexbestmodel]) 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[5]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[5]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# models[[5]]$R2bestmodel
# 
# # 6 #  
# # add sixth variable (the only difference of the above part is that now model n=6 the model statement more variables)
# #  and the call for the list of variable names in the model changed slightly
# 
# modeln<-6
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# for (i in nfirstvar_LUR_1 :nlastvar_LUR_1){
#   if (is.numeric(VGOB1_subsetD_ecoli_LUR1[,i])==TRUE){
#     modeltry<-lm(VGOB1_subsetD_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetD_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR1[,models[[3]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR1[,models[[4]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR1[,models[[5]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR1[,i]) 
#     R2<-rbind(R2,summary(modeltry)$adj.r.squared)
#     # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     # All[,i] is the row that's being tried out now. the name of that row can be found in  names(All)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetD_ecoli_LUR1)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# # this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# # here are the names
# models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetD_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR1)[models[[2]]$indexbestmodel] , names(VGOB1_subsetD_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR1)[models[[4]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR1)[models[[5]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR1)[models[[6]]$indexbestmodel])
# 
# #  this is the r2 or that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetD_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetD_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR1[,models[[5]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR1[,models[[6]]$indexbestmodel]) 
# 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[5]]$summarybestmodel
# models[[6]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[5]]$namesbestmodel
# models[[6]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# models[[5]]$R2bestmodel
# models[[6]]$R2bestmodel
# 
# 
# # 7 #  
# # add seventh variable (the only difference of the above part is that now model n=7 the model statement more variables)
# #  and the call for the list of variable names in the model changed slightly
# 
# modeln<-7
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# for (i in nfirstvar_LUR_1 :nlastvar_LUR_1){
#   if (is.numeric(VGOB1_subsetD_ecoli_LUR1[,i])==TRUE){
#     modeltry<-lm(VGOB1_subsetD_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetD_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR1[,models[[3]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR1[,models[[4]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR1[,models[[5]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR1[,models[[6]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR1[,i]) 
#     R2<-rbind(R2,summary(modeltry)$adj.r.squared)
#     # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     # Measurements_livestockpreds_LUR1[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetD_ecoli_LUR1)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# # this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# # here are the names
# models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetD_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR1)[models[[2]]$indexbestmodel] , names(VGOB1_subsetD_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR1)[models[[4]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR1)[models[[5]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR1)[models[[6]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR1)[models[[7]]$indexbestmodel])
# 
# #  this is the r2 or that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetD_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetD_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR1[,models[[5]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR1[,models[[6]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR1[,models[[7]]$indexbestmodel]) 
# 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[5]]$summarybestmodel
# models[[6]]$summarybestmodel
# models[[7]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[5]]$namesbestmodel
# models[[6]]$namesbestmodel
# models[[7]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# models[[5]]$R2bestmodel
# models[[6]]$R2bestmodel
# models[[7]]$R2bestmodel
# 
# # 8 #  
# # add eighth variable (the only difference of the above part is that now modeln=7 the model statement more variables)
# # and the call for the list of variable names in the model changed slightly
# 
# modeln<-8
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# for (i in nfirstvar_LUR_1 :nlastvar_LUR_1){
#   if (is.numeric(VGOB1_subsetD_ecoli_LUR1[,i])==TRUE){
#     modeltry<-lm(VGOB1_subsetD_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetD_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR1[,models[[3]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR1[,models[[4]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR1[,models[[5]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR1[,models[[6]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR1[,models[[7]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR1[,i]) 
#     R2<-rbind(R2,summary(modeltry)$adj.r.squared)
#     # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     # Measurements_livestockpreds_LUR1[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetD_ecoli_LUR1)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# # this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# # here are the names
# models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetD_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR1)[models[[2]]$indexbestmodel] , names(VGOB1_subsetD_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR1)[models[[4]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR1)[models[[5]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR1)[models[[6]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR1)[models[[7]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR1)[models[[8]]$indexbestmodel])
# 
# #  this is the r2 or that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetD_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetD_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR1[,models[[5]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR1[,models[[6]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR1[,models[[7]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR1[,models[[8]]$indexbestmodel]) 
# 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[5]]$summarybestmodel
# models[[6]]$summarybestmodel
# models[[7]]$summarybestmodel
# models[[8]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[5]]$namesbestmodel
# models[[6]]$namesbestmodel
# models[[7]]$namesbestmodel
# models[[8]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# models[[5]]$R2bestmodel
# models[[6]]$R2bestmodel
# models[[7]]$R2bestmodel
# models[[8]]$R2bestmodel


#   CODE FOR PICKING OUT THE BEST MODEL #   
temp <- 0
besti <- 0
for (i in 1:10){ #  think this runs the loop 10 times - not fully sure thought - but not to do with the number of models I don't think - as when I change to 3, I still get the model with 4 variables as best model
  print(models[[i]]$R2bestmodel)
  #       print(models[[i]]$summarybestmodel$coefficients=-1,4])
  #       if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
  #         temp <- models[[i]]$R2bestmodel
  #         besti <- i
  #         }
  if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
    temp <- models[[i]]$R2bestmodel
    besti <- i
  }else{
    finalBestModel_ecoli_LUR1_subsetD <- models[[besti]]$bestmodel
    finalBestModelNames_ecoli_LUR1_subsetD <- models[[besti]]$namesbestmodel
    Sites <- 1:dim(VGOB1_subsetD_ecoli_LUR1)[1] # full original model
    #  CVaR2<-escCV_ecoli_LUR1(Sites)[2] # Cross Validation
    maxCD<-max(cooks.distance(finalBestModel_ecoli_LUR1_subsetD))
    if(length(finalBestModelNames_ecoli_LUR1_subsetD)<2){ # vif fn doesnot work when only 1 variable...       # 
      maxVIF<-"NA"
    }else{
      maxVIF<-max(vif(finalBestModel_ecoli_LUR1_subsetD))
    }
    print(paste("This is the best ecoli model for subset D: ",besti,
                "(AdjR2: ",format(models[[besti]]$R2bestmodel,digits=3), "; MaxCD: ",format(maxCD,digits=3),"; MaxVIF: ",
                format(maxVIF,digits=3),")", sep=''))
    print(finalBestModelNames_ecoli_LUR1_subsetD)
    break
  }
}

#  Overview of the final best model using the algorithm selection process (taking into account VIF, R^2, and p-values)
finalBestModel_ecoli_LUR1_subsetD
finalBestModelNames_ecoli_LUR1_subsetD
models[[besti]]$summarybestmodel
models[[besti]]$R2bestmodel


#### E ####
# LUR model building process for subset E
#  This is the dataframe with the relevant predictor vars for LUR1 models for subset E (55 sites)
VGOB1_subsetE_ecoli_LUR1 # n.b. this dataframe only includes microbial marker concentrations for ecoli unlike the dataframe Measurements_livestockpreds_LUR1 as previously used for the model building. 

#  Now set the values of some variables that will be needed
nfirstvar_LUR_1 <- 3  
nlastvar_LUR_1 <- 10

# Function building to run the models 
# 1 #  

models<-list()
modeln<-1
models[[modeln]]<-list()

R2<-1
betaaddedvar<-1
addedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
  if (is.numeric(VGOB1_subsetE_ecoli_LUR1[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetE_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetE_ecoli_LUR1[,i])                            
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  Measurements_livestockpreds_LUR1[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetE_ecoli_LUR1)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
models[[modeln]]$results

#  this are the candidates models with the highest R2, not a negative beta for the new, nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)
subset(models[[modeln]]$resultspos)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetE_ecoli_LUR1)[models[[1]]$indexbestmodel])
models[[modeln]]$namesbestmodel

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetE_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetE_ecoli_LUR1[,models[[1]]$indexbestmodel]) 
models[[modeln]]$bestmodel

summary(models[[modeln]]$bestmodel)

#  The first model includes the predictor: nPigMultipFarmWghtDist.3000m.sum.Tr.1P9 - meaning the number of multiplier pig farms weighted to distance in a 3000m buffer

# 2 #  
# Add 2nd variable (the only difference of the above part is that now modeln=2 the model statement has 2 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-2

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
  if (is.numeric(VGOB1_subsetE_ecoli_LUR1[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetE_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetE_ecoli_LUR1[,models[[1]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR1[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR1[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetE_ecoli_LUR1)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  these are the candidate models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetE_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR1)[models[[2]]$indexbestmodel] )
models[[modeln]]$namesbestmodel

# this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

# this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetE_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~                               VGOB1_subsetE_ecoli_LUR1[,models[[1]]$indexbestmodel]+                           VGOB1_subsetE_ecoli_LUR1[,models[[2]]$indexbestmodel]) 

models[[modeln]]$bestmodel

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel


# 3 #  
# add third variable (the only difference of the above part is that now modeln=3 the model statement has 3 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-3

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
  if (is.numeric(VGOB1_subsetE_ecoli_LUR1[,i])==TRUE){  
    modeltry<-lm(VGOB1_subsetE_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetE_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR1[,models[[2]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR1[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetE_ecoli_LUR1)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetE_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR1)[models[[2]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR1)[models[[3]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetE_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetE_ecoli_LUR1[,models[[1]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR1[,models[[2]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR1[,models[[3]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel

# The next part of the code (n=4-8) does not work
# This is because one of the coefficients included in the model with 6 variables is negative, the code does not allow for this. I can stop here. 

# # 4 #  
# #  add forth variable (the only difference of the above part is that now model n=4 the model statement more variables)
# #  and the call for the list of variable names in the model changed slightly
# modeln<-4
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# 
# for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
#   if (is.numeric(VGOB1_subsetE_ecoli_LUR1[,i])==TRUE){
#     modeltry<-lm(VGOB1_subsetE_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetE_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR1[,models[[3]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR1[,i]) 
#     R2<-rbind(R2,summary(modeltry)$adj.r.squared)
#     #  the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     #  All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetE_ecoli_LUR1)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# #  this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# #  here are the names
# models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetE_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR1)[models[[2]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR1)[models[[4]]$indexbestmodel])
# 
# #  this is the r2 of that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetE_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetE_ecoli_LUR1[,models[[1]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR1[,models[[4]]$indexbestmodel]) 
# 
# 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# 
# 
# # 5 #  
# # add fifth variable (the only difference of the above part is that now modeln=5 the model statement more variables)
# # and the call for the list of variable names in the model changed slightly
# modeln<-5
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
#   if (is.numeric(VGOB1_subsetE_ecoli_LUR1[,i])==TRUE){
#     modeltry<-lm(VGOB1_subsetE_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetE_ecoli_LUR1[,models[[1]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR1[,models[[2]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR1[,i]) 
#   
# R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetE_ecoli_LUR1)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# #  this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# # here are the names
# models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetE_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR1)[models[[2]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR1)[models[[4]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR1)[models[[5]]$indexbestmodel])
# 
# #  this is the r2 or that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetE_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetE_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR1[,models[[5]]$indexbestmodel]) 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[5]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[5]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# models[[5]]$R2bestmodel
# 
# # 6 #  
# # add sixth variable (the only difference of the above part is that now model n=6 the model statement more variables)
# #  and the call for the list of variable names in the model changed slightly
# 
# modeln<-6
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# for (i in nfirstvar_LUR_1 :nlastvar_LUR_1){
#   if (is.numeric(VGOB1_subsetE_ecoli_LUR1[,i])==TRUE){
#     modeltry<-lm(VGOB1_subsetE_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetE_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR1[,models[[3]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR1[,models[[4]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR1[,models[[5]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR1[,i]) 
#     R2<-rbind(R2,summary(modeltry)$adj.r.squared)
#     # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     # All[,i] is the row that's being tried out now. the name of that row can be found in  names(All)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetE_ecoli_LUR1)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# # this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# # here are the names
# models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetE_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR1)[models[[2]]$indexbestmodel] , names(VGOB1_subsetE_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR1)[models[[4]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR1)[models[[5]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR1)[models[[6]]$indexbestmodel])
# 
# #  this is the r2 or that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetE_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetE_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR1[,models[[5]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR1[,models[[6]]$indexbestmodel]) 
# 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[5]]$summarybestmodel
# models[[6]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[5]]$namesbestmodel
# models[[6]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# models[[5]]$R2bestmodel
# models[[6]]$R2bestmodel
# 
# 
# # 7 #  
# # add seventh variable (the only difference of the above part is that now model n=7 the model statement more variables)
# #  and the call for the list of variable names in the model changed slightly
# 
# modeln<-7
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# for (i in nfirstvar_LUR_1 :nlastvar_LUR_1){
#   if (is.numeric(VGOB1_subsetE_ecoli_LUR1[,i])==TRUE){
#     modeltry<-lm(VGOB1_subsetE_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetE_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR1[,models[[3]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR1[,models[[4]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR1[,models[[5]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR1[,models[[6]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR1[,i]) 
#     R2<-rbind(R2,summary(modeltry)$adj.r.squared)
#     # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     # Measurements_livestockpreds_LUR1[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetE_ecoli_LUR1)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# # this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# # here are the names
# models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetE_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR1)[models[[2]]$indexbestmodel] , names(VGOB1_subsetE_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR1)[models[[4]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR1)[models[[5]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR1)[models[[6]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR1)[models[[7]]$indexbestmodel])
# 
# #  this is the r2 or that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetE_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetE_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR1[,models[[5]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR1[,models[[6]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR1[,models[[7]]$indexbestmodel]) 
# 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[5]]$summarybestmodel
# models[[6]]$summarybestmodel
# models[[7]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[5]]$namesbestmodel
# models[[6]]$namesbestmodel
# models[[7]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# models[[5]]$R2bestmodel
# models[[6]]$R2bestmodel
# models[[7]]$R2bestmodel
# 
# # 8 #  
# # add eighth variable (the only difference of the above part is that now modeln=7 the model statement more variables)
# # and the call for the list of variable names in the model changed slightly
# 
# modeln<-8
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# for (i in nfirstvar_LUR_1 :nlastvar_LUR_1){
#   if (is.numeric(VGOB1_subsetE_ecoli_LUR1[,i])==TRUE){
#     modeltry<-lm(VGOB1_subsetE_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetE_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR1[,models[[3]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR1[,models[[4]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR1[,models[[5]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR1[,models[[6]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR1[,models[[7]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR1[,i]) 
#     R2<-rbind(R2,summary(modeltry)$adj.r.squared)
#     # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     # Measurements_livestockpreds_LUR1[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetE_ecoli_LUR1)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# # this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# # here are the names
# models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetE_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR1)[models[[2]]$indexbestmodel] , names(VGOB1_subsetE_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR1)[models[[4]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR1)[models[[5]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR1)[models[[6]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR1)[models[[7]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR1)[models[[8]]$indexbestmodel])
# 
# #  this is the r2 or that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetE_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetE_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR1[,models[[5]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR1[,models[[6]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR1[,models[[7]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR1[,models[[8]]$indexbestmodel]) 
# 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[5]]$summarybestmodel
# models[[6]]$summarybestmodel
# models[[7]]$summarybestmodel
# models[[8]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[5]]$namesbestmodel
# models[[6]]$namesbestmodel
# models[[7]]$namesbestmodel
# models[[8]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# models[[5]]$R2bestmodel
# models[[6]]$R2bestmodel
# models[[7]]$R2bestmodel
# models[[8]]$R2bestmodel


#   CODE FOR PICKING OUT THE BEST MODEL #   
temp <- 0
besti <- 0
for (i in 1:10){ #  think this runs the loop 10 times - not fully sure though - but not to do with the number of models I don't think - as when I change to 3, I still get the model with 4 variables as best model
  print(models[[i]]$R2bestmodel)
  #       print(models[[i]]$summarybestmodel$coefficients=-1,4])
  #       if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
  #         temp <- models[[i]]$R2bestmodel
  #         besti <- i
  #         }
  if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
    temp <- models[[i]]$R2bestmodel
    besti <- i
  }else{
    finalBestModel_ecoli_LUR1_subsetE <- models[[besti]]$bestmodel
    finalBestModelNames_ecoli_LUR1_subsetE <- models[[besti]]$namesbestmodel
    Sites <- 1:dim(VGOB1_subsetE_ecoli_LUR1)[1] # full original model
    #  CVaR2<-escCV_ecoli_LUR1(Sites)[2] # Cross Validation
    maxCD<-max(cooks.distance(finalBestModel_ecoli_LUR1_subsetE))
    if(length(finalBestModelNames_ecoli_LUR1_subsetE)<2){ # vif fn doesnot work when only 1 variable...       # 
      maxVIF<-"NA"
    }else{
      maxVIF<-max(vif(finalBestModel_ecoli_LUR1_subsetE))
    }
    print(paste("This is the best ecoli model for subset E: ",besti,
                "(AdjR2: ",format(models[[besti]]$R2bestmodel,digits=3), "; MaxCD: ",format(maxCD,digits=3),"; MaxVIF: ",
                format(maxVIF,digits=3),")", sep=''))
    print(finalBestModelNames_ecoli_LUR1_subsetE)
    break
  }
}

#  Overview of the final best model using the algorithm selection process (taking into account VIF, R^2, and p-values)
finalBestModel_ecoli_LUR1_subsetE
finalBestModelNames_ecoli_LUR1_subsetE
models[[besti]]$summarybestmodel
models[[besti]]$R2bestmodel

#### F ####
# LUR model building process for subset F
#  This is the dataframe with the relevant predictor vars for LUR1 models for subset F (55 sites)
VGOB1_subsetF_ecoli_LUR1 # n.b. this dataframe only includes microbial marker concentrations for ecoli unlike the dataframe Measurements_livestockpreds_LUR1 as previously used for the model building. 

#  Now set the values of some variables that will be needed
nfirstvar_LUR_1 <- 3  
nlastvar_LUR_1 <- 10

# Function building to run the models 
# 1 #  

models<-list()
modeln<-1
models[[modeln]]<-list()

R2<-1
betaaddedvar<-1
addedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
  if (is.numeric(VGOB1_subsetF_ecoli_LUR1[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetF_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetF_ecoli_LUR1[,i])                            
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  Measurements_livestockpreds_LUR1[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetF_ecoli_LUR1)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
models[[modeln]]$results

#  this are the candidates models with the highest R2, not a negative beta for the new, nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)
subset(models[[modeln]]$resultspos)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetF_ecoli_LUR1)[models[[1]]$indexbestmodel])
models[[modeln]]$namesbestmodel

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetF_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetF_ecoli_LUR1[,models[[1]]$indexbestmodel]) 
models[[modeln]]$bestmodel

summary(models[[modeln]]$bestmodel)

#  The first model includes the predictor: nPigMultipFarmWghtDist.3000m.sum.Tr.1P9 - meaning the number of multiplier pig farms weighted to distance in a 3000m buffer

# 2 #  
# Add 2nd variable (the only difference of the above part is that now modeln=2 the model statement has 2 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-2

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
  if (is.numeric(VGOB1_subsetF_ecoli_LUR1[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetF_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetF_ecoli_LUR1[,models[[1]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR1[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR1[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetF_ecoli_LUR1)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  these are the candidate models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetF_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR1)[models[[2]]$indexbestmodel] )
models[[modeln]]$namesbestmodel

# this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

# this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetF_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~                               VGOB1_subsetF_ecoli_LUR1[,models[[1]]$indexbestmodel]+                           VGOB1_subsetF_ecoli_LUR1[,models[[2]]$indexbestmodel]) 

models[[modeln]]$bestmodel

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel


# 3 #  
# add third variable (the only difference of the above part is that now modeln=3 the model statement has 3 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-3

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
  if (is.numeric(VGOB1_subsetF_ecoli_LUR1[,i])==TRUE){  
    modeltry<-lm(VGOB1_subsetF_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetF_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR1[,models[[2]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR1[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetF_ecoli_LUR1)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetF_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR1)[models[[2]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR1)[models[[3]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetF_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetF_ecoli_LUR1[,models[[1]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR1[,models[[2]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR1[,models[[3]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel

# The next part of the code (n=4-8) does not work
# This is because one of the coefficients included in the model with 6 variables is negative, the code does not allow for this. I can stop here. 

# # 4 #  
# #  add forth variable (the only difference of the above part is that now model n=4 the model statement more variables)
# #  and the call for the list of variable names in the model changed slightly
# modeln<-4
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# 
# for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
#   if (is.numeric(VGOB1_subsetF_ecoli_LUR1[,i])==TRUE){
#     modeltry<-lm(VGOB1_subsetF_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetF_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR1[,models[[3]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR1[,i]) 
#     R2<-rbind(R2,summary(modeltry)$adj.r.squared)
#     #  the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     #  All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetF_ecoli_LUR1)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# #  this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# #  here are the names
# models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetF_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR1)[models[[2]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR1)[models[[4]]$indexbestmodel])
# 
# #  this is the r2 of that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetF_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetF_ecoli_LUR1[,models[[1]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR1[,models[[4]]$indexbestmodel]) 
# 
# 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# 
# 
# # 5 #  
# # add fifth variable (the only difference of the above part is that now modeln=5 the model statement more variables)
# # and the call for the list of variable names in the model changed slightly
# modeln<-5
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
#   if (is.numeric(VGOB1_subsetF_ecoli_LUR1[,i])==TRUE){
#     modeltry<-lm(VGOB1_subsetF_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetF_ecoli_LUR1[,models[[1]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR1[,models[[2]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR1[,i]) 
#   
# R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetF_ecoli_LUR1)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# #  this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# # here are the names
# models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetF_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR1)[models[[2]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR1)[models[[4]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR1)[models[[5]]$indexbestmodel])
# 
# #  this is the r2 or that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetF_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetF_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR1[,models[[5]]$indexbestmodel]) 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[5]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[5]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# models[[5]]$R2bestmodel
# 
# # 6 #  
# # add sixth variable (the only difference of the above part is that now model n=6 the model statement more variables)
# #  and the call for the list of variable names in the model changed slightly
# 
# modeln<-6
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# for (i in nfirstvar_LUR_1 :nlastvar_LUR_1){
#   if (is.numeric(VGOB1_subsetF_ecoli_LUR1[,i])==TRUE){
#     modeltry<-lm(VGOB1_subsetF_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetF_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR1[,models[[3]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR1[,models[[4]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR1[,models[[5]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR1[,i]) 
#     R2<-rbind(R2,summary(modeltry)$adj.r.squared)
#     # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     # All[,i] is the row that's being tried out now. the name of that row can be found in  names(All)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetF_ecoli_LUR1)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# # this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# # here are the names
# models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetF_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR1)[models[[2]]$indexbestmodel] , names(VGOB1_subsetF_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR1)[models[[4]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR1)[models[[5]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR1)[models[[6]]$indexbestmodel])
# 
# #  this is the r2 or that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetF_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetF_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR1[,models[[5]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR1[,models[[6]]$indexbestmodel]) 
# 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[5]]$summarybestmodel
# models[[6]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[5]]$namesbestmodel
# models[[6]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# models[[5]]$R2bestmodel
# models[[6]]$R2bestmodel
# 
# 
# # 7 #  
# # add seventh variable (the only difference of the above part is that now model n=7 the model statement more variables)
# #  and the call for the list of variable names in the model changed slightly
# 
# modeln<-7
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# for (i in nfirstvar_LUR_1 :nlastvar_LUR_1){
#   if (is.numeric(VGOB1_subsetF_ecoli_LUR1[,i])==TRUE){
#     modeltry<-lm(VGOB1_subsetF_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetF_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR1[,models[[3]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR1[,models[[4]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR1[,models[[5]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR1[,models[[6]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR1[,i]) 
#     R2<-rbind(R2,summary(modeltry)$adj.r.squared)
#     # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     # Measurements_livestockpreds_LUR1[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetF_ecoli_LUR1)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# # this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# # here are the names
# models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetF_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR1)[models[[2]]$indexbestmodel] , names(VGOB1_subsetF_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR1)[models[[4]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR1)[models[[5]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR1)[models[[6]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR1)[models[[7]]$indexbestmodel])
# 
# #  this is the r2 or that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetF_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetF_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR1[,models[[5]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR1[,models[[6]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR1[,models[[7]]$indexbestmodel]) 
# 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[5]]$summarybestmodel
# models[[6]]$summarybestmodel
# models[[7]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[5]]$namesbestmodel
# models[[6]]$namesbestmodel
# models[[7]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# models[[5]]$R2bestmodel
# models[[6]]$R2bestmodel
# models[[7]]$R2bestmodel
# 
# # 8 #  
# # add eighth variable (the only difference of the above part is that now modeln=7 the model statement more variables)
# # and the call for the list of variable names in the model changed slightly
# 
# modeln<-8
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# for (i in nfirstvar_LUR_1 :nlastvar_LUR_1){
#   if (is.numeric(VGOB1_subsetF_ecoli_LUR1[,i])==TRUE){
#     modeltry<-lm(VGOB1_subsetF_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetF_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR1[,models[[3]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR1[,models[[4]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR1[,models[[5]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR1[,models[[6]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR1[,models[[7]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR1[,i]) 
#     R2<-rbind(R2,summary(modeltry)$adj.r.squared)
#     # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     # Measurements_livestockpreds_LUR1[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetF_ecoli_LUR1)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# # this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# # here are the names
# models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetF_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR1)[models[[2]]$indexbestmodel] , names(VGOB1_subsetF_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR1)[models[[4]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR1)[models[[5]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR1)[models[[6]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR1)[models[[7]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR1)[models[[8]]$indexbestmodel])
# 
# #  this is the r2 or that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetF_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetF_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR1[,models[[5]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR1[,models[[6]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR1[,models[[7]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR1[,models[[8]]$indexbestmodel]) 
# 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[5]]$summarybestmodel
# models[[6]]$summarybestmodel
# models[[7]]$summarybestmodel
# models[[8]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[5]]$namesbestmodel
# models[[6]]$namesbestmodel
# models[[7]]$namesbestmodel
# models[[8]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# models[[5]]$R2bestmodel
# models[[6]]$R2bestmodel
# models[[7]]$R2bestmodel
# models[[8]]$R2bestmodel


#   CODE FOR PICKING OUT THE BEST MODEL #   
temp <- 0
besti <- 0
for (i in 1:10){ #  think this runs the loop 10 times - not fully sure thought - but not to do with the number of models I don't think - as when I change to 3, I still get the model with 4 variables as best model
  print(models[[i]]$R2bestmodel)
  #       print(models[[i]]$summarybestmodel$coefficients=-1,4])
  #       if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
  #         temp <- models[[i]]$R2bestmodel
  #         besti <- i
  #         }
  if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
    temp <- models[[i]]$R2bestmodel
    besti <- i
  }else{
    finalBestModel_ecoli_LUR1_subsetF <- models[[besti]]$bestmodel
    finalBestModelNames_ecoli_LUR1_subsetF <- models[[besti]]$namesbestmodel
    Sites <- 1:dim(VGOB1_subsetF_ecoli_LUR1)[1] # full original model
    #  CVaR2<-escCV_ecoli_LUR1(Sites)[2] # Cross Validation
    maxCD<-max(cooks.distance(finalBestModel_ecoli_LUR1_subsetF))
    if(length(finalBestModelNames_ecoli_LUR1_subsetF)<2){ # vif fn doesnot work when only 1 variable...       # 
      maxVIF<-"NA"
    }else{
      maxVIF<-max(vif(finalBestModel_ecoli_LUR1_subsetF))
    }
    print(paste("This is the best ecoli model for subset F: ",besti,
                "(AdjR2: ",format(models[[besti]]$R2bestmodel,digits=3), "; MaxCD: ",format(maxCD,digits=3),"; MaxVIF: ",
                format(maxVIF,digits=3),")", sep=''))
    print(finalBestModelNames_ecoli_LUR1_subsetF)
    break
  }
}

#  Overview of the final best model using the algorithm selection process (taking into account VIF, R^2, and p-values)
finalBestModel_ecoli_LUR1_subsetF
finalBestModelNames_ecoli_LUR1_subsetF
models[[besti]]$summarybestmodel
models[[besti]]$R2bestmodel

#### G ####
# LUR model building process for subset G
#  This is the dataframe with the relevant predictor vars for LUR1 models for subset G (55 sites)
VGOB1_subsetG_ecoli_LUR1 # n.b. this dataframe only includes microbial marker concentrations for ecoli unlike the dataframe Measurements_livestockpreds_LUR1 as previously used for the model building. 

#  Now set the values of some variables that will be needed
nfirstvar_LUR_1 <- 3  
nlastvar_LUR_1 <- 10

# Function building to run the models 
# 1 #  

models<-list()
modeln<-1
models[[modeln]]<-list()

R2<-1
betaaddedvar<-1
addedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
  if (is.numeric(VGOB1_subsetG_ecoli_LUR1[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetG_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetG_ecoli_LUR1[,i])                            
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  Measurements_livestockpreds_LUR1[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetG_ecoli_LUR1)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
models[[modeln]]$results

#  this are the candidates models with the highest R2, not a negative beta for the new, nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)
subset(models[[modeln]]$resultspos)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetG_ecoli_LUR1)[models[[1]]$indexbestmodel])
models[[modeln]]$namesbestmodel

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetG_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetG_ecoli_LUR1[,models[[1]]$indexbestmodel]) 
models[[modeln]]$bestmodel

summary(models[[modeln]]$bestmodel)

#  The first model includes the predictor: nPigMultipFarmWghtDist.3000m.sum.Tr.1P9 - meaning the number of multiplier pig farms weighted to distance in a 3000m buffer

# 2 #  
# Add 2nd variable (the only difference of the above part is that now modeln=2 the model statement has 2 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-2

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
  if (is.numeric(VGOB1_subsetG_ecoli_LUR1[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetG_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetG_ecoli_LUR1[,models[[1]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR1[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR1[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetG_ecoli_LUR1)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  these are the candidate models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetG_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR1)[models[[2]]$indexbestmodel] )
models[[modeln]]$namesbestmodel

# this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

# this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetG_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~                               VGOB1_subsetG_ecoli_LUR1[,models[[1]]$indexbestmodel]+                           VGOB1_subsetG_ecoli_LUR1[,models[[2]]$indexbestmodel]) 

models[[modeln]]$bestmodel

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel


# 3 #  
# add third variable (the only difference of the above part is that now modeln=3 the model statement has 3 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-3

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
  if (is.numeric(VGOB1_subsetG_ecoli_LUR1[,i])==TRUE){  
    modeltry<-lm(VGOB1_subsetG_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetG_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR1[,models[[2]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR1[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetG_ecoli_LUR1)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetG_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR1)[models[[2]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR1)[models[[3]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetG_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetG_ecoli_LUR1[,models[[1]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR1[,models[[2]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR1[,models[[3]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel


# 4 #  
#  add forth variable (the only difference of the above part is that now model n=4 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly
modeln<-4

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1


for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
  if (is.numeric(VGOB1_subsetG_ecoli_LUR1[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetG_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetG_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR1[,models[[3]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR1[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    #  the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetG_ecoli_LUR1)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetG_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR1)[models[[2]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR1)[models[[4]]$indexbestmodel])

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetG_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetG_ecoli_LUR1[,models[[1]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR1[,models[[4]]$indexbestmodel]) 


models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel

# The next part of the code (n=5-8) does not work
# This is because one of the coefficients included in the model with 6 variables is negative, the code does not allow for this. I can stop here. 

# # 5 #  
# # add fifth variable (the only difference of the above part is that now modeln=5 the model statement more variables)
# # and the call for the list of variable names in the model changed slightly
# modeln<-5
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
#   if (is.numeric(VGOB1_subsetG_ecoli_LUR1[,i])==TRUE){
#     modeltry<-lm(VGOB1_subsetG_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetG_ecoli_LUR1[,models[[1]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR1[,models[[2]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR1[,i]) 
#   
# R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetG_ecoli_LUR1)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# #  this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# # here are the names
# models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetG_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR1)[models[[2]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR1)[models[[4]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR1)[models[[5]]$indexbestmodel])
# 
# #  this is the r2 or that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetG_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetG_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR1[,models[[5]]$indexbestmodel]) 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[5]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[5]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# models[[5]]$R2bestmodel
# 
# # 6 #  
# # add sixth variable (the only difference of the above part is that now model n=6 the model statement more variables)
# #  and the call for the list of variable names in the model changed slightly
# 
# modeln<-6
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# for (i in nfirstvar_LUR_1 :nlastvar_LUR_1){
#   if (is.numeric(VGOB1_subsetG_ecoli_LUR1[,i])==TRUE){
#     modeltry<-lm(VGOB1_subsetG_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetG_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR1[,models[[3]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR1[,models[[4]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR1[,models[[5]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR1[,i]) 
#     R2<-rbind(R2,summary(modeltry)$adj.r.squared)
#     # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     # All[,i] is the row that's being tried out now. the name of that row can be found in  names(All)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetG_ecoli_LUR1)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# # this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# # here are the names
# models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetG_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR1)[models[[2]]$indexbestmodel] , names(VGOB1_subsetG_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR1)[models[[4]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR1)[models[[5]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR1)[models[[6]]$indexbestmodel])
# 
# #  this is the r2 or that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetG_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetG_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR1[,models[[5]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR1[,models[[6]]$indexbestmodel]) 
# 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[5]]$summarybestmodel
# models[[6]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[5]]$namesbestmodel
# models[[6]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# models[[5]]$R2bestmodel
# models[[6]]$R2bestmodel
# 
# 
# # 7 #  
# # add seventh variable (the only difference of the above part is that now model n=7 the model statement more variables)
# #  and the call for the list of variable names in the model changed slightly
# 
# modeln<-7
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# for (i in nfirstvar_LUR_1 :nlastvar_LUR_1){
#   if (is.numeric(VGOB1_subsetG_ecoli_LUR1[,i])==TRUE){
#     modeltry<-lm(VGOB1_subsetG_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetG_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR1[,models[[3]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR1[,models[[4]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR1[,models[[5]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR1[,models[[6]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR1[,i]) 
#     R2<-rbind(R2,summary(modeltry)$adj.r.squared)
#     # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     # Measurements_livestockpreds_LUR1[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetG_ecoli_LUR1)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# # this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# # here are the names
# models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetG_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR1)[models[[2]]$indexbestmodel] , names(VGOB1_subsetG_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR1)[models[[4]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR1)[models[[5]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR1)[models[[6]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR1)[models[[7]]$indexbestmodel])
# 
# #  this is the r2 or that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetG_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetG_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR1[,models[[5]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR1[,models[[6]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR1[,models[[7]]$indexbestmodel]) 
# 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[5]]$summarybestmodel
# models[[6]]$summarybestmodel
# models[[7]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[5]]$namesbestmodel
# models[[6]]$namesbestmodel
# models[[7]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# models[[5]]$R2bestmodel
# models[[6]]$R2bestmodel
# models[[7]]$R2bestmodel
# 
# # 8 #  
# # add eighth variable (the only difference of the above part is that now modeln=7 the model statement more variables)
# # and the call for the list of variable names in the model changed slightly
# 
# modeln<-8
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# for (i in nfirstvar_LUR_1 :nlastvar_LUR_1){
#   if (is.numeric(VGOB1_subsetG_ecoli_LUR1[,i])==TRUE){
#     modeltry<-lm(VGOB1_subsetG_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetG_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR1[,models[[3]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR1[,models[[4]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR1[,models[[5]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR1[,models[[6]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR1[,models[[7]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR1[,i]) 
#     R2<-rbind(R2,summary(modeltry)$adj.r.squared)
#     # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     # Measurements_livestockpreds_LUR1[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetG_ecoli_LUR1)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# # this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# # here are the names
# models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetG_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR1)[models[[2]]$indexbestmodel] , names(VGOB1_subsetG_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR1)[models[[4]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR1)[models[[5]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR1)[models[[6]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR1)[models[[7]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR1)[models[[8]]$indexbestmodel])
# 
# #  this is the r2 or that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetG_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetG_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR1[,models[[5]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR1[,models[[6]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR1[,models[[7]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR1[,models[[8]]$indexbestmodel]) 
# 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[5]]$summarybestmodel
# models[[6]]$summarybestmodel
# models[[7]]$summarybestmodel
# models[[8]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[5]]$namesbestmodel
# models[[6]]$namesbestmodel
# models[[7]]$namesbestmodel
# models[[8]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# models[[5]]$R2bestmodel
# models[[6]]$R2bestmodel
# models[[7]]$R2bestmodel
# models[[8]]$R2bestmodel

#   CODE FOR PICKING OUT THE BEST MODEL #   
temp <- 0
besti <- 0
for (i in 1:10){ #  think this runs the loop 10 times - not fully sure thought - but not to do with the number of models I don't think - as when I change to 3, I still get the model with 4 variables as best model
  print(models[[i]]$R2bestmodel)
  #       print(models[[i]]$summarybestmodel$coefficients=-1,4])
  #       if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
  #         temp <- models[[i]]$R2bestmodel
  #         besti <- i
  #         }
  if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
    temp <- models[[i]]$R2bestmodel
    besti <- i
  }else{
    finalBestModel_ecoli_LUR1_subsetG <- models[[besti]]$bestmodel
    finalBestModelNames_ecoli_LUR1_subsetG <- models[[besti]]$namesbestmodel
    Sites <- 1:dim(VGOB1_subsetG_ecoli_LUR1)[1] # full original model
    #  CVaR2<-escCV_ecoli_LUR1(Sites)[2] # Cross Validation
    maxCD<-max(cooks.distance(finalBestModel_ecoli_LUR1_subsetG))
    if(length(finalBestModelNames_ecoli_LUR1_subsetG)<2){ # vif fn doesnot work when only 1 variable...       # 
      maxVIF<-"NA"
    }else{
      maxVIF<-max(vif(finalBestModel_ecoli_LUR1_subsetG))
    }
    print(paste("This is the best ecoli model for subset G: ",besti,
                "(AdjR2: ",format(models[[besti]]$R2bestmodel,digits=3), "; MaxCD: ",format(maxCD,digits=3),"; MaxVIF: ",
                format(maxVIF,digits=3),")", sep=''))
    print(finalBestModelNames_ecoli_LUR1_subsetG)
    break
  }
}

#  Overview of the final best model using the algorithm selection process (taking into account VIF, R^2, and p-values)
finalBestModel_ecoli_LUR1_subsetG
finalBestModelNames_ecoli_LUR1_subsetG
models[[besti]]$summarybestmodel
models[[besti]]$R2bestmodel

#### H ####
# LUR model building process for subset H
#  This is the dataframe with the relevant predictor vars for LUR1 models for subset H (55 sites)
VGOB1_subsetH_ecoli_LUR1 # n.b. this dataframe only includes microbial marker concentrations for ecoli unlike the dataframe Measurements_livestockpreds_LUR1 as previously used for the model building. 

#  Now set the values of some variables that will be needed
nfirstvar_LUR_1 <- 3  
nlastvar_LUR_1 <- 10

# Function building to run the models 
# 1 #  

models<-list()
modeln<-1
models[[modeln]]<-list()

R2<-1
betaaddedvar<-1
addedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
  if (is.numeric(VGOB1_subsetH_ecoli_LUR1[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetH_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetH_ecoli_LUR1[,i])                            
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  Measurements_livestockpreds_LUR1[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetH_ecoli_LUR1)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
models[[modeln]]$results

#  this are the candidates models with the highest R2, not a negative beta for the new, nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)
subset(models[[modeln]]$resultspos)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetH_ecoli_LUR1)[models[[1]]$indexbestmodel])
models[[modeln]]$namesbestmodel

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetH_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetH_ecoli_LUR1[,models[[1]]$indexbestmodel]) 
models[[modeln]]$bestmodel

summary(models[[modeln]]$bestmodel)

#  The first model includes the predictor: nPigMultipFarmWghtDist.3000m.sum.Tr.1P9 - meaning the number of multiplier pig farms weighted to distance in a 3000m buffer

# 2 #  
# Add 2nd variable (the only difference of the above part is that now modeln=2 the model statement has 2 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-2

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
  if (is.numeric(VGOB1_subsetH_ecoli_LUR1[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetH_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetH_ecoli_LUR1[,models[[1]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR1[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR1[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetH_ecoli_LUR1)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  these are the candidate models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetH_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR1)[models[[2]]$indexbestmodel] )
models[[modeln]]$namesbestmodel

# this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

# this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetH_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~                               VGOB1_subsetH_ecoli_LUR1[,models[[1]]$indexbestmodel]+                           VGOB1_subsetH_ecoli_LUR1[,models[[2]]$indexbestmodel]) 

models[[modeln]]$bestmodel

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel


# 3 #  
# add third variable (the only difference of the above part is that now modeln=3 the model statement has 3 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-3

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
  if (is.numeric(VGOB1_subsetH_ecoli_LUR1[,i])==TRUE){  
    modeltry<-lm(VGOB1_subsetH_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetH_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR1[,models[[2]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR1[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetH_ecoli_LUR1)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetH_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR1)[models[[2]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR1)[models[[3]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetH_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetH_ecoli_LUR1[,models[[1]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR1[,models[[2]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR1[,models[[3]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel


# 4 #  
#  add forth variable (the only difference of the above part is that now model n=4 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly
modeln<-4

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1


for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
  if (is.numeric(VGOB1_subsetH_ecoli_LUR1[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetH_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetH_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR1[,models[[3]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR1[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    #  the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetH_ecoli_LUR1)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetH_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR1)[models[[2]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR1)[models[[4]]$indexbestmodel])

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetH_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetH_ecoli_LUR1[,models[[1]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR1[,models[[4]]$indexbestmodel]) 


models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel


# 5 #  
# add fifth variable (the only difference of the above part is that now modeln=5 the model statement more variables)
# and the call for the list of variable names in the model changed slightly
modeln<-5

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
  if (is.numeric(VGOB1_subsetH_ecoli_LUR1[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetH_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetH_ecoli_LUR1[,models[[1]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR1[,models[[2]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR1[,i]) 
  
R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetH_ecoli_LUR1)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetH_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR1)[models[[2]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR1)[models[[4]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR1)[models[[5]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetH_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetH_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR1[,models[[5]]$indexbestmodel]) 
models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel

# The next part of the code (n=6-8) does not work
# This is because one of the coefficients included in the model with 6 variables is negative, the code does not allow for this. I can stop here. 

# # 6 #  
# # add sixth variable (the only difference of the above part is that now model n=6 the model statement more variables)
# #  and the call for the list of variable names in the model changed slightly
# 
# modeln<-6
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# for (i in nfirstvar_LUR_1 :nlastvar_LUR_1){
#   if (is.numeric(VGOB1_subsetH_ecoli_LUR1[,i])==TRUE){
#     modeltry<-lm(VGOB1_subsetH_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetH_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR1[,models[[3]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR1[,models[[4]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR1[,models[[5]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR1[,i]) 
#     R2<-rbind(R2,summary(modeltry)$adj.r.squared)
#     # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     # All[,i] is the row that's being tried out now. the name of that row can be found in  names(All)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetH_ecoli_LUR1)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# # this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# # here are the names
# models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetH_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR1)[models[[2]]$indexbestmodel] , names(VGOB1_subsetH_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR1)[models[[4]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR1)[models[[5]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR1)[models[[6]]$indexbestmodel])
# 
# #  this is the r2 or that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetH_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetH_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR1[,models[[5]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR1[,models[[6]]$indexbestmodel]) 
# 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[5]]$summarybestmodel
# models[[6]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[5]]$namesbestmodel
# models[[6]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# models[[5]]$R2bestmodel
# models[[6]]$R2bestmodel
# 
# 
# # 7 #  
# # add seventh variable (the only difference of the above part is that now model n=7 the model statement more variables)
# #  and the call for the list of variable names in the model changed slightly
# 
# modeln<-7
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# for (i in nfirstvar_LUR_1 :nlastvar_LUR_1){
#   if (is.numeric(VGOB1_subsetH_ecoli_LUR1[,i])==TRUE){
#     modeltry<-lm(VGOB1_subsetH_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetH_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR1[,models[[3]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR1[,models[[4]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR1[,models[[5]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR1[,models[[6]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR1[,i]) 
#     R2<-rbind(R2,summary(modeltry)$adj.r.squared)
#     # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     # Measurements_livestockpreds_LUR1[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetH_ecoli_LUR1)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# # this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# # here are the names
# models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetH_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR1)[models[[2]]$indexbestmodel] , names(VGOB1_subsetH_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR1)[models[[4]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR1)[models[[5]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR1)[models[[6]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR1)[models[[7]]$indexbestmodel])
# 
# #  this is the r2 or that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetH_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetH_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR1[,models[[5]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR1[,models[[6]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR1[,models[[7]]$indexbestmodel]) 
# 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[5]]$summarybestmodel
# models[[6]]$summarybestmodel
# models[[7]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[5]]$namesbestmodel
# models[[6]]$namesbestmodel
# models[[7]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# models[[5]]$R2bestmodel
# models[[6]]$R2bestmodel
# models[[7]]$R2bestmodel
# 
# # 8 #  
# # add eighth variable (the only difference of the above part is that now modeln=7 the model statement more variables)
# # and the call for the list of variable names in the model changed slightly
# 
# modeln<-8
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# for (i in nfirstvar_LUR_1 :nlastvar_LUR_1){
#   if (is.numeric(VGOB1_subsetH_ecoli_LUR1[,i])==TRUE){
#     modeltry<-lm(VGOB1_subsetH_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetH_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR1[,models[[3]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR1[,models[[4]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR1[,models[[5]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR1[,models[[6]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR1[,models[[7]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR1[,i]) 
#     R2<-rbind(R2,summary(modeltry)$adj.r.squared)
#     # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     # Measurements_livestockpreds_LUR1[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetH_ecoli_LUR1)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# # this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# # here are the names
# models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetH_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR1)[models[[2]]$indexbestmodel] , names(VGOB1_subsetH_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR1)[models[[4]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR1)[models[[5]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR1)[models[[6]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR1)[models[[7]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR1)[models[[8]]$indexbestmodel])
# 
# #  this is the r2 or that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetH_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetH_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR1[,models[[5]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR1[,models[[6]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR1[,models[[7]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR1[,models[[8]]$indexbestmodel]) 
# 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[5]]$summarybestmodel
# models[[6]]$summarybestmodel
# models[[7]]$summarybestmodel
# models[[8]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[5]]$namesbestmodel
# models[[6]]$namesbestmodel
# models[[7]]$namesbestmodel
# models[[8]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# models[[5]]$R2bestmodel
# models[[6]]$R2bestmodel
# models[[7]]$R2bestmodel
# models[[8]]$R2bestmodel


#   CODE FOR PICKING OUT THE BEST MODEL #   
temp <- 0
besti <- 0
for (i in 1:10){ #  think this runs the loop 10 times - not fully sure thought - but not to do with the number of models I don't think - as when I change to 3, I still get the model with 4 variables as best model
  print(models[[i]]$R2bestmodel)
  #       print(models[[i]]$summarybestmodel$coefficients=-1,4])
  #       if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
  #         temp <- models[[i]]$R2bestmodel
  #         besti <- i
  #         }
  if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
    temp <- models[[i]]$R2bestmodel
    besti <- i
  }else{
    finalBestModel_ecoli_LUR1_subsetH <- models[[besti]]$bestmodel
    finalBestModelNames_ecoli_LUR1_subsetH <- models[[besti]]$namesbestmodel
    Sites <- 1:dim(VGOB1_subsetH_ecoli_LUR1)[1] # full original model
    #  CVaR2<-escCV_ecoli_LUR1(Sites)[2] # Cross Validation
    maxCD<-max(cooks.distance(finalBestModel_ecoli_LUR1_subsetH))
    if(length(finalBestModelNames_ecoli_LUR1_subsetH)<2){ # vif fn does not work when only 1 variable...       # 
      maxVIF<-"NA"
    }else{
      maxVIF<-max(vif(finalBestModel_ecoli_LUR1_subsetH))
    }
    print(paste("This is the best ecoli model for subset H: ",besti,
                "(AdjR2: ",format(models[[besti]]$R2bestmodel,digits=3), "; MaxCD: ",format(maxCD,digits=3),"; MaxVIF: ",
                format(maxVIF,digits=3),")", sep=''))
    print(finalBestModelNames_ecoli_LUR1_subsetH)
    break
  }
}

#  Overview of the final best model using the algorithm selection process (taking into account VIF, R^2, and p-values)
finalBestModel_ecoli_LUR1_subsetH
finalBestModelNames_ecoli_LUR1_subsetH
models[[besti]]$summarybestmodel
models[[besti]]$R2bestmodel

#### I ####
# LUR model building process for subset I
#  This is the dataframe with the relevant predictor vars for LUR1 models for subset I (55 sites)
VGOB1_subsetI_ecoli_LUR1 # n.b. this dataframe only includes microbial marker concentrations for ecoli unlike the dataframe Measurements_livestockpreds_LUR1 as previously used for the model building. 

#  Now set the values of some variables that will be needed
nfirstvar_LUR_1 <- 3  
nlastvar_LUR_1 <- 10

# Function building to run the models 
# 1 #  

models<-list()
modeln<-1
models[[modeln]]<-list()

R2<-1
betaaddedvar<-1
addedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
  if (is.numeric(VGOB1_subsetI_ecoli_LUR1[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetI_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetI_ecoli_LUR1[,i])                            
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  Measurements_livestockpreds_LUR1[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetI_ecoli_LUR1)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
models[[modeln]]$results

#  this are the candidates models with the highest R2, not a negative beta for the new, nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)
subset(models[[modeln]]$resultspos)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetI_ecoli_LUR1)[models[[1]]$indexbestmodel])
models[[modeln]]$namesbestmodel

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetI_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetI_ecoli_LUR1[,models[[1]]$indexbestmodel]) 
models[[modeln]]$bestmodel

summary(models[[modeln]]$bestmodel)

#  The first model includes the predictor: nPigMultipFarmWghtDist.3000m.sum.Tr.1P9 - meaning the number of multiplier pig farms weighted to distance in a 3000m buffer

# 2 #  
# Add 2nd variable (the only difference of the above part is that now modeln=2 the model statement has 2 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-2

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
  if (is.numeric(VGOB1_subsetI_ecoli_LUR1[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetI_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetI_ecoli_LUR1[,models[[1]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR1[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR1[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetI_ecoli_LUR1)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  these are the candidate models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetI_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR1)[models[[2]]$indexbestmodel] )
models[[modeln]]$namesbestmodel

# this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

# this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetI_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~                               VGOB1_subsetI_ecoli_LUR1[,models[[1]]$indexbestmodel]+                           VGOB1_subsetI_ecoli_LUR1[,models[[2]]$indexbestmodel]) 

models[[modeln]]$bestmodel

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel


# 3 #  
# add third variable (the only difference of the above part is that now modeln=3 the model statement has 3 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-3

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
  if (is.numeric(VGOB1_subsetI_ecoli_LUR1[,i])==TRUE){  
    modeltry<-lm(VGOB1_subsetI_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetI_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR1[,models[[2]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR1[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetI_ecoli_LUR1)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetI_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR1)[models[[2]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR1)[models[[3]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetI_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetI_ecoli_LUR1[,models[[1]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR1[,models[[2]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR1[,models[[3]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel


# 4 #  
#  add forth variable (the only difference of the above part is that now model n=4 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly
modeln<-4

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1


for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
  if (is.numeric(VGOB1_subsetI_ecoli_LUR1[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetI_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetI_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR1[,models[[3]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR1[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    #  the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetI_ecoli_LUR1)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetI_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR1)[models[[2]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR1)[models[[4]]$indexbestmodel])

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetI_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetI_ecoli_LUR1[,models[[1]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR1[,models[[4]]$indexbestmodel]) 


models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel

# The next part of the code (n=5-8) does not work
# This is because one of the coefficients included in the model with 6 variables is negative, the code does not allow for this. I can stop here. 

# # 5 #  
# # add fifth variable (the only difference of the above part is that now modeln=5 the model statement more variables)
# # and the call for the list of variable names in the model changed slightly
# modeln<-5
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
#   if (is.numeric(VGOB1_subsetI_ecoli_LUR1[,i])==TRUE){
#     modeltry<-lm(VGOB1_subsetI_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetI_ecoli_LUR1[,models[[1]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR1[,models[[2]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR1[,i]) 
#   
# R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetI_ecoli_LUR1)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# #  this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# # here are the names
# models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetI_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR1)[models[[2]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR1)[models[[4]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR1)[models[[5]]$indexbestmodel])
# 
# #  this is the r2 or that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetI_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetI_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR1[,models[[5]]$indexbestmodel]) 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[5]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[5]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# models[[5]]$R2bestmodel
# 
# # 6 #  
# # add sixth variable (the only difference of the above part is that now model n=6 the model statement more variables)
# #  and the call for the list of variable names in the model changed slightly
# 
# modeln<-6
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# for (i in nfirstvar_LUR_1 :nlastvar_LUR_1){
#   if (is.numeric(VGOB1_subsetI_ecoli_LUR1[,i])==TRUE){
#     modeltry<-lm(VGOB1_subsetI_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetI_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR1[,models[[3]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR1[,models[[4]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR1[,models[[5]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR1[,i]) 
#     R2<-rbind(R2,summary(modeltry)$adj.r.squared)
#     # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     # All[,i] is the row that's being tried out now. the name of that row can be found in  names(All)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetI_ecoli_LUR1)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# # this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# # here are the names
# models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetI_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR1)[models[[2]]$indexbestmodel] , names(VGOB1_subsetI_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR1)[models[[4]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR1)[models[[5]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR1)[models[[6]]$indexbestmodel])
# 
# #  this is the r2 or that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetI_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetI_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR1[,models[[5]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR1[,models[[6]]$indexbestmodel]) 
# 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[5]]$summarybestmodel
# models[[6]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[5]]$namesbestmodel
# models[[6]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# models[[5]]$R2bestmodel
# models[[6]]$R2bestmodel
# 
# 
# # 7 #  
# # add seventh variable (the only difference of the above part is that now model n=7 the model statement more variables)
# #  and the call for the list of variable names in the model changed slightly
# 
# modeln<-7
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# for (i in nfirstvar_LUR_1 :nlastvar_LUR_1){
#   if (is.numeric(VGOB1_subsetI_ecoli_LUR1[,i])==TRUE){
#     modeltry<-lm(VGOB1_subsetI_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetI_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR1[,models[[3]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR1[,models[[4]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR1[,models[[5]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR1[,models[[6]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR1[,i]) 
#     R2<-rbind(R2,summary(modeltry)$adj.r.squared)
#     # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     # Measurements_livestockpreds_LUR1[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetI_ecoli_LUR1)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# # this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# # here are the names
# models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetI_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR1)[models[[2]]$indexbestmodel] , names(VGOB1_subsetI_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR1)[models[[4]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR1)[models[[5]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR1)[models[[6]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR1)[models[[7]]$indexbestmodel])
# 
# #  this is the r2 or that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetI_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetI_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR1[,models[[5]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR1[,models[[6]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR1[,models[[7]]$indexbestmodel]) 
# 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[5]]$summarybestmodel
# models[[6]]$summarybestmodel
# models[[7]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[5]]$namesbestmodel
# models[[6]]$namesbestmodel
# models[[7]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# models[[5]]$R2bestmodel
# models[[6]]$R2bestmodel
# models[[7]]$R2bestmodel
# 
# # 8 #  
# # add eighth variable (the only difference of the above part is that now modeln=7 the model statement more variables)
# # and the call for the list of variable names in the model changed slightly
# 
# modeln<-8
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# for (i in nfirstvar_LUR_1 :nlastvar_LUR_1){
#   if (is.numeric(VGOB1_subsetI_ecoli_LUR1[,i])==TRUE){
#     modeltry<-lm(VGOB1_subsetI_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetI_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR1[,models[[3]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR1[,models[[4]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR1[,models[[5]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR1[,models[[6]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR1[,models[[7]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR1[,i]) 
#     R2<-rbind(R2,summary(modeltry)$adj.r.squared)
#     # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     # Measurements_livestockpreds_LUR1[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetI_ecoli_LUR1)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# # this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# # here are the names
# models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetI_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR1)[models[[2]]$indexbestmodel] , names(VGOB1_subsetI_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR1)[models[[4]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR1)[models[[5]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR1)[models[[6]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR1)[models[[7]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR1)[models[[8]]$indexbestmodel])
# 
# #  this is the r2 or that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetI_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetI_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR1[,models[[5]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR1[,models[[6]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR1[,models[[7]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR1[,models[[8]]$indexbestmodel]) 
# 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[5]]$summarybestmodel
# models[[6]]$summarybestmodel
# models[[7]]$summarybestmodel
# models[[8]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[5]]$namesbestmodel
# models[[6]]$namesbestmodel
# models[[7]]$namesbestmodel
# models[[8]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# models[[5]]$R2bestmodel
# models[[6]]$R2bestmodel
# models[[7]]$R2bestmodel
# models[[8]]$R2bestmodel


#   CODE FOR PICKING OUT THE BEST MODEL #   
temp <- 0
besti <- 0
for (i in 1:10){ #  think this runs the loop 10 times - not fully sure thought - but not to do with the number of models I don't think - as when I change to 3, I still get the model with 4 variables as best model
  print(models[[i]]$R2bestmodel)
  #       print(models[[i]]$summarybestmodel$coefficients=-1,4])
  #       if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
  #         temp <- models[[i]]$R2bestmodel
  #         besti <- i
  #         }
  if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
    temp <- models[[i]]$R2bestmodel
    besti <- i
  }else{
    finalBestModel_ecoli_LUR1_subsetI <- models[[besti]]$bestmodel
    finalBestModelNames_ecoli_LUR1_subsetI <- models[[besti]]$namesbestmodel
    Sites <- 1:dim(VGOB1_subsetI_ecoli_LUR1)[1] # full original model
    #  CVaR2<-escCV_ecoli_LUR1(Sites)[2] # Cross Validation
    maxCD<-max(cooks.distance(finalBestModel_ecoli_LUR1_subsetI))
    if(length(finalBestModelNames_ecoli_LUR1_subsetI)<2){ # vif fn doesnot work when only 1 variable...       # 
      maxVIF<-"NA"
    }else{
      maxVIF<-max(vif(finalBestModel_ecoli_LUR1_subsetI))
    }
    print(paste("This is the best ecoli model for subset I: ",besti,
                "(AdjR2: ",format(models[[besti]]$R2bestmodel,digits=3), "; MaxCD: ",format(maxCD,digits=3),"; MaxVIF: ",
                format(maxVIF,digits=3),")", sep=''))
    print(finalBestModelNames_ecoli_LUR1_subsetI)
    break
  }
}

#  Overview of the final best model using the algorithm selection process (taking into account VIF, R^2, and p-values)
finalBestModel_ecoli_LUR1_subsetI
finalBestModelNames_ecoli_LUR1_subsetI
models[[besti]]$summarybestmodel
models[[besti]]$R2bestmodel

#### J ####
# LUR model building process for subset J
#  This is the dataframe with the relevant predictor vars for LUR1 models for subset J (55 sites)
VGOB1_subsetJ_ecoli_LUR1 # n.b. this dataframe only includes microbial marker concentrations for ecoli unlike the dataframe Measurements_livestockpreds_LUR1 as previously used for the model building. 

#  Now set the values of some variables that will be needed
nfirstvar_LUR_1 <- 3  
nlastvar_LUR_1 <- 10

# Function building to run the models 
# 1 #  

models<-list()
modeln<-1
models[[modeln]]<-list()

R2<-1
betaaddedvar<-1
addedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
  if (is.numeric(VGOB1_subsetJ_ecoli_LUR1[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetJ_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetJ_ecoli_LUR1[,i])                            
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  Measurements_livestockpreds_LUR1[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetJ_ecoli_LUR1)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
models[[modeln]]$results

#  this are the candidates models with the highest R2, not a negative beta for the new, nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)
subset(models[[modeln]]$resultspos)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetJ_ecoli_LUR1)[models[[1]]$indexbestmodel])
models[[modeln]]$namesbestmodel

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetJ_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetJ_ecoli_LUR1[,models[[1]]$indexbestmodel]) 
models[[modeln]]$bestmodel

summary(models[[modeln]]$bestmodel)

#  The first model includes the predictor: nPigMultipFarmWghtDist.3000m.sum.Tr.1P9 - meaning the number of multiplier pig farms weighted to distance in a 3000m buffer

# 2 #  
# Add 2nd variable (the only difference of the above part is that now modeln=2 the model statement has 2 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-2

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
  if (is.numeric(VGOB1_subsetJ_ecoli_LUR1[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetJ_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetJ_ecoli_LUR1[,models[[1]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR1[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR1[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetJ_ecoli_LUR1)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  these are the candidate models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetJ_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR1)[models[[2]]$indexbestmodel] )
models[[modeln]]$namesbestmodel

# this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

# this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetJ_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~                               VGOB1_subsetJ_ecoli_LUR1[,models[[1]]$indexbestmodel]+                           VGOB1_subsetJ_ecoli_LUR1[,models[[2]]$indexbestmodel]) 

models[[modeln]]$bestmodel

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel


# 3 #  
# add third variable (the only difference of the above part is that now modeln=3 the model statement has 3 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-3

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
  if (is.numeric(VGOB1_subsetJ_ecoli_LUR1[,i])==TRUE){  
    modeltry<-lm(VGOB1_subsetJ_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetJ_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR1[,models[[2]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR1[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetJ_ecoli_LUR1)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetJ_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR1)[models[[2]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR1)[models[[3]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetJ_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetJ_ecoli_LUR1[,models[[1]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR1[,models[[2]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR1[,models[[3]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel


# 4 #  
#  add forth variable (the only difference of the above part is that now model n=4 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly
modeln<-4

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1


for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
  if (is.numeric(VGOB1_subsetJ_ecoli_LUR1[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetJ_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetJ_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR1[,models[[3]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR1[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    #  the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetJ_ecoli_LUR1)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetJ_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR1)[models[[2]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR1)[models[[4]]$indexbestmodel])

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetJ_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetJ_ecoli_LUR1[,models[[1]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR1[,models[[4]]$indexbestmodel]) 


models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel

# The next part of the code (n=5-8) does not work
# This is because one of the coefficients included in the model with 6 variables is negative, the code does not allow for this. I can stop here. 

# # 5 #  
# # add fifth variable (the only difference of the above part is that now modeln=5 the model statement more variables)
# # and the call for the list of variable names in the model changed slightly
# modeln<-5
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# for (i in nfirstvar_LUR_1:nlastvar_LUR_1){
#   if (is.numeric(VGOB1_subsetJ_ecoli_LUR1[,i])==TRUE){
#     modeltry<-lm(VGOB1_subsetJ_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetJ_ecoli_LUR1[,models[[1]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR1[,models[[2]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR1[,i]) 
#   
# R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetJ_ecoli_LUR1)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# #  this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# # here are the names
# models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetJ_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR1)[models[[2]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR1)[models[[4]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR1)[models[[5]]$indexbestmodel])
# 
# #  this is the r2 or that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetJ_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetJ_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR1[,models[[5]]$indexbestmodel]) 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[5]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[5]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# models[[5]]$R2bestmodel
# 
# # 6 #  
# # add sixth variable (the only difference of the above part is that now model n=6 the model statement more variables)
# #  and the call for the list of variable names in the model changed slightly
# 
# modeln<-6
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# for (i in nfirstvar_LUR_1 :nlastvar_LUR_1){
#   if (is.numeric(VGOB1_subsetJ_ecoli_LUR1[,i])==TRUE){
#     modeltry<-lm(VGOB1_subsetJ_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetJ_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR1[,models[[3]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR1[,models[[4]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR1[,models[[5]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR1[,i]) 
#     R2<-rbind(R2,summary(modeltry)$adj.r.squared)
#     # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     # All[,i] is the row that's being tried out now. the name of that row can be found in  names(All)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetJ_ecoli_LUR1)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# # this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# # here are the names
# models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetJ_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR1)[models[[2]]$indexbestmodel] , names(VGOB1_subsetJ_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR1)[models[[4]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR1)[models[[5]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR1)[models[[6]]$indexbestmodel])
# 
# #  this is the r2 or that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetJ_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetJ_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR1[,models[[5]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR1[,models[[6]]$indexbestmodel]) 
# 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[5]]$summarybestmodel
# models[[6]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[5]]$namesbestmodel
# models[[6]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# models[[5]]$R2bestmodel
# models[[6]]$R2bestmodel
# 
# 
# # 7 #  
# # add seventh variable (the only difference of the above part is that now model n=7 the model statement more variables)
# #  and the call for the list of variable names in the model changed slightly
# 
# modeln<-7
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# for (i in nfirstvar_LUR_1 :nlastvar_LUR_1){
#   if (is.numeric(VGOB1_subsetJ_ecoli_LUR1[,i])==TRUE){
#     modeltry<-lm(VGOB1_subsetJ_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetJ_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR1[,models[[3]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR1[,models[[4]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR1[,models[[5]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR1[,models[[6]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR1[,i]) 
#     R2<-rbind(R2,summary(modeltry)$adj.r.squared)
#     # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     # Measurements_livestockpreds_LUR1[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetJ_ecoli_LUR1)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# # this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# # here are the names
# models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetJ_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR1)[models[[2]]$indexbestmodel] , names(VGOB1_subsetJ_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR1)[models[[4]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR1)[models[[5]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR1)[models[[6]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR1)[models[[7]]$indexbestmodel])
# 
# #  this is the r2 or that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetJ_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetJ_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR1[,models[[5]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR1[,models[[6]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR1[,models[[7]]$indexbestmodel]) 
# 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[5]]$summarybestmodel
# models[[6]]$summarybestmodel
# models[[7]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[5]]$namesbestmodel
# models[[6]]$namesbestmodel
# models[[7]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# models[[5]]$R2bestmodel
# models[[6]]$R2bestmodel
# models[[7]]$R2bestmodel
# 
# # 8 #  
# # add eighth variable (the only difference of the above part is that now modeln=7 the model statement more variables)
# # and the call for the list of variable names in the model changed slightly
# 
# modeln<-8
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# for (i in nfirstvar_LUR_1 :nlastvar_LUR_1){
#   if (is.numeric(VGOB1_subsetJ_ecoli_LUR1[,i])==TRUE){
#     modeltry<-lm(VGOB1_subsetJ_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetJ_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR1[,models[[3]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR1[,models[[4]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR1[,models[[5]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR1[,models[[6]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR1[,models[[7]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR1[,i]) 
#     R2<-rbind(R2,summary(modeltry)$adj.r.squared)
#     # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     # Measurements_livestockpreds_LUR1[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR1)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetJ_ecoli_LUR1)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# # this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# # here are the names
# models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetJ_ecoli_LUR1)[models[[1]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR1)[models[[2]]$indexbestmodel] , names(VGOB1_subsetJ_ecoli_LUR1)[models[[3]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR1)[models[[4]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR1)[models[[5]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR1)[models[[6]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR1)[models[[7]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR1)[models[[8]]$indexbestmodel])
# 
# #  this is the r2 or that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetJ_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetJ_ecoli_LUR1[,models[[1]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR1[,models[[2]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR1[,models[[3]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR1[,models[[4]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR1[,models[[5]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR1[,models[[6]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR1[,models[[7]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR1[,models[[8]]$indexbestmodel]) 
# 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[5]]$summarybestmodel
# models[[6]]$summarybestmodel
# models[[7]]$summarybestmodel
# models[[8]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[5]]$namesbestmodel
# models[[6]]$namesbestmodel
# models[[7]]$namesbestmodel
# models[[8]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# models[[5]]$R2bestmodel
# models[[6]]$R2bestmodel
# models[[7]]$R2bestmodel
# models[[8]]$R2bestmodel

#   CODE FOR PICKING OUT THE BEST MODEL #   
temp <- 0
besti <- 0
for (i in 1:10){ #  think this runs the loop 10 times - not fully sure thought - but not to do with the number of models I don't think - as when I change to 3, I still get the model with 4 variables as best model
  print(models[[i]]$R2bestmodel)
  #       print(models[[i]]$summarybestmodel$coefficients=-1,4])
  #       if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
  #         temp <- models[[i]]$R2bestmodel
  #         besti <- i
  #         }
  if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
    temp <- models[[i]]$R2bestmodel
    besti <- i
  }else{
    finalBestModel_ecoli_LUR1_subsetJ <- models[[besti]]$bestmodel
    finalBestModelNames_ecoli_LUR1_subsetJ <- models[[besti]]$namesbestmodel
    Sites <- 1:dim(VGOB1_subsetJ_ecoli_LUR1)[1] # full original model
    #  CVaR2<-escCV_ecoli_LUR1(Sites)[2] # Cross Validation
    maxCD<-max(cooks.distance(finalBestModel_ecoli_LUR1_subsetJ))
    if(length(finalBestModelNames_ecoli_LUR1_subsetJ)<2){ # vif fn doesnot work when only 1 variable...       # 
      maxVIF<-"NA"
    }else{
      maxVIF<-max(vif(finalBestModel_ecoli_LUR1_subsetJ))
    }
    print(paste("This is the best ecoli model for subset J: ",besti,
                "(AdjR2: ",format(models[[besti]]$R2bestmodel,digits=3), "; MaxCD: ",format(maxCD,digits=3),"; MaxVIF: ",
                format(maxVIF,digits=3),")", sep=''))
    print(finalBestModelNames_ecoli_LUR1_subsetJ)
    break
  }
}

#  Overview of the final best model using the algorithm selection process (taking into account VIF, R^2, and p-values)
finalBestModel_ecoli_LUR1_subsetJ
finalBestModelNames_ecoli_LUR1_subsetJ
models[[besti]]$summarybestmodel
models[[besti]]$R2bestmodel

#### Predicting hold out sites ####
# These are the models from the 10 subsets: 
finalBestModel_ecoli_LUR1_subsetA
finalBestModel_ecoli_LUR1_subsetB
finalBestModel_ecoli_LUR1_subsetC
finalBestModel_ecoli_LUR1_subsetD
finalBestModel_ecoli_LUR1_subsetE
finalBestModel_ecoli_LUR1_subsetF
finalBestModel_ecoli_LUR1_subsetG
finalBestModel_ecoli_LUR1_subsetH
finalBestModel_ecoli_LUR1_subsetI
finalBestModel_ecoli_LUR1_subsetJ

#  Selecting of test sets
#  valID 1 to 10
VGOB1_subsetvalID1_ecoli_LUR1 <- subset(VGOB1_FINAL_ecoli_LUR1, valID == 1)
VGOB1_subsetvalID2_ecoli_LUR1 <- subset(VGOB1_FINAL_ecoli_LUR1, valID == 2)
VGOB1_subsetvalID3_ecoli_LUR1 <- subset(VGOB1_FINAL_ecoli_LUR1, valID == 3)
VGOB1_subsetvalID4_ecoli_LUR1 <- subset(VGOB1_FINAL_ecoli_LUR1, valID == 4)
VGOB1_subsetvalID5_ecoli_LUR1 <- subset(VGOB1_FINAL_ecoli_LUR1, valID == 5)
VGOB1_subsetvalID6_ecoli_LUR1 <- subset(VGOB1_FINAL_ecoli_LUR1, valID == 6)
VGOB1_subsetvalID7_ecoli_LUR1 <- subset(VGOB1_FINAL_ecoli_LUR1, valID == 7)
VGOB1_subsetvalID8_ecoli_LUR1 <- subset(VGOB1_FINAL_ecoli_LUR1, valID == 8)
VGOB1_subsetvalID9_ecoli_LUR1 <- subset(VGOB1_FINAL_ecoli_LUR1, valID == 9)
VGOB1_subsetvalID10_ecoli_LUR1 <- subset(VGOB1_FINAL_ecoli_LUR1, valID == 10)

#  For every subset predict (based on LUR model for that subset, so the training sites) the concentrations at the sites left out (test sites) to enable comparisons observed vs predicted 

#  Set 1
finalBestModel_ecoli_LUR1_subsetA
finalBestModelNames_ecoli_LUR1_subsetA
summary(finalBestModel_ecoli_LUR1_subsetA)
# maxVIF_ecoli_LUR1_subsetA <- max(vif(finalBestModel_ecoli_LUR1_subsetA)) # only 1 predictor in model
maxCD_ecoli_LUR1_subsetA <- max(cooks.distance(finalBestModel_ecoli_LUR1_subsetA))
# write the model out
finalBestModel_ecoli_LUR1_subsetA_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~ nAnyFarmWghtDist.3000m.sum.95Win.10to90scaled, data = VGOB1_subsetA_ecoli_LUR1)
VGOB1_subsetvalID1_ecoli_LUR1$ecoli_PRED_HV <- predict(finalBestModel_ecoli_LUR1_subsetA_lm,VGOB1_subsetvalID1_ecoli_LUR1)
summary(VGOB1_subsetvalID1_ecoli_LUR1$ecoli_PRED_HV)
plot(VGOB1_subsetvalID1_ecoli_LUR1$ecoli_PRED_HV, VGOB1_subsetvalID1_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean, xlab="ecoli predicted (HV)", ylab="ecoli concentration observed")
VGOB1_subsetvalID1_ecoli_LUR1_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~ecoli_PRED_HV, data=VGOB1_subsetvalID1_ecoli_LUR1 )
summary(VGOB1_subsetvalID1_ecoli_LUR1_lm)

#  Set 2
finalBestModel_ecoli_LUR1_subsetB
finalBestModelNames_ecoli_LUR1_subsetB
summary(finalBestModel_ecoli_LUR1_subsetB)
# maxVIF_ecoli_LUR1_subsetB <- max(vif(finalBestModel_ecoli_LUR1_subsetB))# only 1 predictor in model
maxCD_ecoli_LUR1_subsetB <- max(cooks.distance(finalBestModel_ecoli_LUR1_subsetB))
# write the model out
finalBestModel_ecoli_LUR1_subsetB_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~ nAnyFarmWghtDist.3000m.sum.95Win.10to90scaled, data = VGOB1_subsetB_ecoli_LUR1)
VGOB1_subsetvalID2_ecoli_LUR1$ecoli_PRED_HV <- predict(finalBestModel_ecoli_LUR1_subsetB_lm,VGOB1_subsetvalID2_ecoli_LUR1)
summary(VGOB1_subsetvalID2_ecoli_LUR1$ecoli_PRED_HV)
plot(VGOB1_subsetvalID2_ecoli_LUR1$ecoli_PRED_HV, VGOB1_subsetvalID2_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean, xlab="ecoli predicted (HV)", ylab="ecoli concentration observed")
VGOB1_subsetvalID2_ecoli_LUR1_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~ecoli_PRED_HV, data=VGOB1_subsetvalID2_ecoli_LUR1)
summary(VGOB1_subsetvalID2_ecoli_LUR1_lm)

#  Set 3
finalBestModel_ecoli_LUR1_subsetC
finalBestModelNames_ecoli_LUR1_subsetC
summary(finalBestModel_ecoli_LUR1_subsetC)
#maxVIF_ecoli_LUR1_subsetC <-max(vif(finalBestModel_ecoli_LUR1_subsetC)) # only 1 predictor in model
maxCD_ecoli_LUR1_subsetC <- max(cooks.distance(finalBestModel_ecoli_LUR1_subsetC))
# write the model out
finalBestModel_ecoli_LUR1_subsetC_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~nAnyFarmWghtDist.3000m.sum.95Win.10to90scaled , data = VGOB1_subsetC_ecoli_LUR1)
VGOB1_subsetvalID3_ecoli_LUR1$ecoli_PRED_HV <- predict(finalBestModel_ecoli_LUR1_subsetC_lm,VGOB1_subsetvalID3_ecoli_LUR1)
summary(VGOB1_subsetvalID3_ecoli_LUR1$ecoli_PRED_HV)
plot(VGOB1_subsetvalID3_ecoli_LUR1$ecoli_PRED_HV, VGOB1_subsetvalID3_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean, xlab="ecoli predicted (HV)", ylab="ecoli concentration observed")
VGOB1_subsetvalID3_ecoli_LUR1_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~ecoli_PRED_HV, data=VGOB1_subsetvalID3_ecoli_LUR1 )
summary(VGOB1_subsetvalID3_ecoli_LUR1_lm)

#  Set 4
finalBestModel_ecoli_LUR1_subsetD
finalBestModelNames_ecoli_LUR1_subsetD
summary(finalBestModel_ecoli_LUR1_subsetD)
# maxVIF_ecoli_LUR1_subsetD <- max(vif(finalBestModel_ecoli_LUR1_subsetD))
maxCD_ecoli_LUR1_subsetD <- max(cooks.distance(finalBestModel_ecoli_LUR1_subsetD))
# write the model out
finalBestModel_ecoli_LUR1_subsetD_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~nAnyFarmWghtDist.3000m.sum.95Win.10to90scaled, data = VGOB1_subsetD_ecoli_LUR1)
VGOB1_subsetvalID4_ecoli_LUR1$ecoli_PRED_HV <- predict(finalBestModel_ecoli_LUR1_subsetD_lm,VGOB1_subsetvalID4_ecoli_LUR1)
summary(VGOB1_subsetvalID4_ecoli_LUR1$ecoli_PRED_HV)
plot(VGOB1_subsetvalID4_ecoli_LUR1$ecoli_PRED_HV, VGOB1_subsetvalID4_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean, xlab="ecoli predicted (HV)", ylab="ecoli concentration observed")
VGOB1_subsetvalID4_ecoli_LUR1_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~ecoli_PRED_HV, data=VGOB1_subsetvalID4_ecoli_LUR1 )
summary(VGOB1_subsetvalID4_ecoli_LUR1_lm)

#  Set 5
finalBestModel_ecoli_LUR1_subsetE
finalBestModelNames_ecoli_LUR1_subsetE
summary(finalBestModel_ecoli_LUR1_subsetE)
#maxVIF_ecoli_LUR1_subsetE <- max(vif(finalBestModel_ecoli_LUR1_subsetE))
maxCD_ecoli_LUR1_subsetE <- max(cooks.distance(finalBestModel_ecoli_LUR1_subsetE))
# write the model out
finalBestModel_ecoli_LUR1_subsetE_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~nAnyFarmWghtDist.3000m.sum.95Win.10to90scaled, data = VGOB1_subsetE_ecoli_LUR1)
VGOB1_subsetvalID5_ecoli_LUR1$ecoli_PRED_HV <- predict(finalBestModel_ecoli_LUR1_subsetE_lm,VGOB1_subsetvalID5_ecoli_LUR1)
summary(VGOB1_subsetvalID5_ecoli_LUR1$ecoli_PRED_HV)
plot(VGOB1_subsetvalID5_ecoli_LUR1$ecoli_PRED_HV, VGOB1_subsetvalID5_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean, xlab="ecoli predicted (HV)", ylab="ecoli concentration observed")
VGOB1_subsetvalID5_ecoli_LUR1_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~ecoli_PRED_HV, data=VGOB1_subsetvalID5_ecoli_LUR1)
summary(VGOB1_subsetvalID5_ecoli_LUR1_lm)

#  Set 6
finalBestModel_ecoli_LUR1_subsetF
finalBestModelNames_ecoli_LUR1_subsetF
summary(finalBestModel_ecoli_LUR1_subsetF)
# maxVIF_ecoli_LUR1_subsetF <- max(vif(finalBestModel_ecoli_LUR1_subsetF))
maxCD_ecoli_LUR1_subsetF <- max(cooks.distance(finalBestModel_ecoli_LUR1_subsetF))
# write the model out
finalBestModel_ecoli_LUR1_subsetF_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~nAnyFarmWghtDist.3000m.sum.95Win.10to90scaled, data = VGOB1_subsetF_ecoli_LUR1)
VGOB1_subsetvalID6_ecoli_LUR1$ecoli_PRED_HV <- predict(finalBestModel_ecoli_LUR1_subsetF_lm,VGOB1_subsetvalID1_ecoli_LUR1)
summary(VGOB1_subsetvalID6_ecoli_LUR1$ecoli_PRED_HV)
plot(VGOB1_subsetvalID6_ecoli_LUR1$ecoli_PRED_HV, VGOB1_subsetvalID6_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean, xlab="ecoli predicted (HV)", ylab="ecoli concentration observed")
VGOB1_subsetvalID6_ecoli_LUR1_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~ecoli_PRED_HV, data=VGOB1_subsetvalID6_ecoli_LUR1 )
summary(VGOB1_subsetvalID6_ecoli_LUR1_lm)

#  Set 7
finalBestModel_ecoli_LUR1_subsetG
finalBestModelNames_ecoli_LUR1_subsetG
summary(finalBestModel_ecoli_LUR1_subsetG)
#maxVIF_ecoli_LUR1_subsetG <- max(vif(finalBestModel_ecoli_LUR1_subsetG))
maxCD_ecoli_LUR1_subsetG <- max(cooks.distance(finalBestModel_ecoli_LUR1_subsetG))
# write the model out
finalBestModel_ecoli_LUR1_subsetG_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~nAnyFarmWghtDist.3000m.sum.95Win.10to90scaled, data = VGOB1_subsetG_ecoli_LUR1)
VGOB1_subsetvalID7_ecoli_LUR1$ecoli_PRED_HV <- predict(finalBestModel_ecoli_LUR1_subsetG_lm,VGOB1_subsetvalID7_ecoli_LUR1)
summary(VGOB1_subsetvalID7_ecoli_LUR1$ecoli_PRED_HV)
plot(VGOB1_subsetvalID7_ecoli_LUR1$ecoli_PRED_HV, VGOB1_subsetvalID7_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean, xlab="ecoli predicted (HV)", ylab="ecoli concentration observed")
VGOB1_subsetvalID7_ecoli_LUR1_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~ecoli_PRED_HV, data=VGOB1_subsetvalID7_ecoli_LUR1)
summary(VGOB1_subsetvalID7_ecoli_LUR1_lm)

#  Set 8
finalBestModel_ecoli_LUR1_subsetH
finalBestModelNames_ecoli_LUR1_subsetH
summary(finalBestModel_ecoli_LUR1_subsetH)
# maxVIF_ecoli_LUR1_subsetH <- max(vif(finalBestModel_ecoli_LUR1_subsetH))
maxCD_ecoli_LUR1_subsetH <- max(cooks.distance(finalBestModel_ecoli_LUR1_subsetH))
# write the model out
finalBestModel_ecoli_LUR1_subsetH_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~ nAnyFarmWghtDist.3000m.sum.95Win.10to90scaled, data = VGOB1_subsetH_ecoli_LUR1)
VGOB1_subsetvalID8_ecoli_LUR1$ecoli_PRED_HV <- predict(finalBestModel_ecoli_LUR1_subsetH_lm,VGOB1_subsetvalID8_ecoli_LUR1)
summary(VGOB1_subsetvalID8_ecoli_LUR1$ecoli_PRED_HV)
plot(VGOB1_subsetvalID8_ecoli_LUR1$ecoli_PRED_HV, VGOB1_subsetvalID8_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean, xlab="ecoli predicted (HV)", ylab="ecoli concentration observed")
VGOB1_subsetvalID8_ecoli_LUR1_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~ecoli_PRED_HV, data=VGOB1_subsetvalID8_ecoli_LUR1)
summary(VGOB1_subsetvalID8_ecoli_LUR1_lm)

#  Set 9
finalBestModel_ecoli_LUR1_subsetI
finalBestModelNames_ecoli_LUR1_subsetI
summary(finalBestModel_ecoli_LUR1_subsetI)
# maxVIF_ecoli_LUR1_subsetI <- max(vif(finalBestModel_ecoli_LUR1_subsetI))
maxCD_ecoli_LUR1_subsetI <- max(cooks.distance(finalBestModel_ecoli_LUR1_subsetI))
# write the model out
finalBestModel_ecoli_LUR1_subsetI_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~nAnyFarmWghtDist.3000m.sum.95Win.10to90scaled, data = VGOB1_subsetI_ecoli_LUR1)
VGOB1_subsetvalID9_ecoli_LUR1$ecoli_PRED_HV <- predict(finalBestModel_ecoli_LUR1_subsetI_lm,VGOB1_subsetvalID9_ecoli_LUR1)
summary(VGOB1_subsetvalID9_ecoli_LUR1$ecoli_PRED_HV)
plot(VGOB1_subsetvalID9_ecoli_LUR1$ecoli_PRED_HV, VGOB1_subsetvalID9_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean, xlab="ecoli predicted (HV)", ylab="ecoli concentration observed")
VGOB1_subsetvalID9_ecoli_LUR1_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~ecoli_PRED_HV, data=VGOB1_subsetvalID9_ecoli_LUR1 )
summary(VGOB1_subsetvalID9_ecoli_LUR1_lm)


#  Set 10
finalBestModel_ecoli_LUR1_subsetJ
finalBestModelNames_ecoli_LUR1_subsetJ
summary(finalBestModel_ecoli_LUR1_subsetJ)
# maxVIF_ecoli_LUR1_subsetJ <- max(vif(finalBestModel_ecoli_LUR1_subsetI))
maxCD_ecoli_LUR1_subsetJ <- max(cooks.distance(finalBestModel_ecoli_LUR1_subsetJ))
# write the model out
finalBestModel_ecoli_LUR1_subsetJ_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~nAnyFarmWghtDist.3000m.sum.95Win.10to90scaled , data = VGOB1_subsetJ_ecoli_LUR1)
VGOB1_subsetvalID10_ecoli_LUR1$ecoli_PRED_HV <- predict(finalBestModel_ecoli_LUR1_subsetJ_lm,VGOB1_subsetvalID10_ecoli_LUR1)
summary(VGOB1_subsetvalID10_ecoli_LUR1$ecoli_PRED_HV)
plot(VGOB1_subsetvalID10_ecoli_LUR1$ecoli_PRED_HV, VGOB1_subsetvalID10_ecoli_LUR1$ecoli_copiespm3.ln.diffmeth.mean, xlab="ecoli predicted (HV)", ylab="ecoli concentration observed")
VGOB1_subsetvalID10_ecoli_LUR1_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~ecoli_PRED_HV, data=VGOB1_subsetvalID10_ecoli_LUR1)
summary(VGOB1_subsetvalID10_ecoli_LUR1_lm)

# compute the residuals from each of the 10 models of the CV for later normality testing (model assumption)
VGOB1_subsetvalID1_ecoli_LUR1$residuals <- VGOB1_subsetvalID1_ecoli_LUR1_lm$residuals
VGOB1_subsetvalID2_ecoli_LUR1$residuals <- VGOB1_subsetvalID2_ecoli_LUR1_lm$residuals
VGOB1_subsetvalID3_ecoli_LUR1$residuals <- VGOB1_subsetvalID3_ecoli_LUR1_lm$residuals
VGOB1_subsetvalID4_ecoli_LUR1$residuals <- VGOB1_subsetvalID4_ecoli_LUR1_lm$residuals
VGOB1_subsetvalID5_ecoli_LUR1$residuals <- VGOB1_subsetvalID5_ecoli_LUR1_lm$residuals
VGOB1_subsetvalID6_ecoli_LUR1$residuals <- VGOB1_subsetvalID6_ecoli_LUR1_lm$residuals
VGOB1_subsetvalID7_ecoli_LUR1$residuals <- VGOB1_subsetvalID7_ecoli_LUR1_lm$residuals
VGOB1_subsetvalID8_ecoli_LUR1$residuals <- VGOB1_subsetvalID8_ecoli_LUR1_lm$residuals
VGOB1_subsetvalID9_ecoli_LUR1$residuals <- VGOB1_subsetvalID9_ecoli_LUR1_lm$residuals
VGOB1_subsetvalID10_ecoli_LUR1$residuals <- VGOB1_subsetvalID10_ecoli_LUR1_lm$residuals

#  Merging of all test sets to make overall comparisons of predicted vs observed
VGOB1_subsetvalID1to10_ecoli_LUR1_ecoli_10foldCV <- rbind(VGOB1_subsetvalID1_ecoli_LUR1, VGOB1_subsetvalID2_ecoli_LUR1, VGOB1_subsetvalID3_ecoli_LUR1, VGOB1_subsetvalID4_ecoli_LUR1, VGOB1_subsetvalID5_ecoli_LUR1, VGOB1_subsetvalID6_ecoli_LUR1, VGOB1_subsetvalID7_ecoli_LUR1, VGOB1_subsetvalID8_ecoli_LUR1, VGOB1_subsetvalID9_ecoli_LUR1, VGOB1_subsetvalID10_ecoli_LUR1)

#  Overall comparison of predicted vs observed
plot(VGOB1_subsetvalID1to10_ecoli_LUR1_ecoli_10foldCV$ecoli_PRED_HV, VGOB1_subsetvalID1to10_ecoli_LUR1_ecoli_10foldCV$ecoli_copiespm3.ln.diffmeth.mean, xlab="LUR1-predicted (10-fold CV) ecoli DNA concentration (ln copies/m^3)", ylab="Observed ecoli DNA concentration (ln copies/m^3)", cex.lab=0.85)
abline(lm(VGOB1_subsetvalID1to10_ecoli_LUR1_ecoli_10foldCV$ecoli_copiespm3.ln.diffmeth.mean ~ VGOB1_subsetvalID1to10_ecoli_LUR1_ecoli_10foldCV$ecoli_PRED_HV))

VGOB1_subsetvalID1to10_ecoli_LUR1_10foldCV_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean ~ ecoli_PRED_HV, data=VGOB1_subsetvalID1to10_ecoli_LUR1_ecoli_10foldCV)
summary(VGOB1_subsetvalID1to10_ecoli_LUR1_ecoli_10foldCV_lm)

# 10-fold CV multiple R2 for E. coli LUR1 = 0.1625

#  Calculate RMSE
RMSE_ecoli_LUR1_10foldCV <- sqrt(mean((VGOB1_subsetvalID1to10_ecoli_LUR1_ecoli_10foldCV$ecoli_copiespm3.ln.diffmeth.mean - VGOB1_subsetvalID1to10_ecoli_LUR1_ecoli_10foldCV$ecoli_PRED_HV)^2))
RMSE_ecoli_LUR1_10foldCV

#  Save these predicted concentrations along with the measured concentrations as an excel file 
#  Create a dataframe 
ecoli_SLR_10foldCVpreds_observed <- data.frame(VGOB1_subsetvalID1to10_ecoli_LUR1_ecoli_10foldCV$Loc_ID,VGOB1_subsetvalID1to10_ecoli_LUR1_ecoli_10foldCV$ecoli_copiespm3.ln.diffmeth.mean, VGOB1_subsetvalID1to10_ecoli_LUR1_ecoli_10foldCV$ecoli_PRED_HV)
print(ecoli_SLR_10foldCVpreds_observed)

#  Save as xls file 
write_xlsx(ecoli_SLR_10foldCVpreds_observed,"Output_files//ecoli_LUR1_10foldCV_observed_predicted.xlsx")

#   MODEL CHECKING #  
#  1)Check normality of residuals 
#  2)Check residuals for linearity, independence and homoscedasticity
#  3)Check multicollinearity (VIF)
#  4)Check influential points (Cook's Distance)

#  1) Normality of residuals
boxplot(residuals(VGOB1_subsetvalID1to10_ecoli_LUR1_ecoli_10foldCV),main="boxplot of residuals - E. coli LUR1 (ln-transformed concentrations)",xlab="residuals")
qqnorm(residuals(VGOB1_subsetvalID1to10_ecoli_LUR1_ecoli_10foldCV),main="QQ-plot of residuals - E. coli LUR1 (ln-transformed concentrations)",xlab="residuals")
hist(residuals(VGOB1_subsetvalID1to10_ecoli_LUR1_ecoli_10foldCV),main="boxplot of residuals - E. coli LUR1 (ln-transformed concentrations)",xlab="residuals")

#  2)Check residuals for linearity, independence and homoscedasticity
plot(VGOB1_subsetvalID1to10_ecoli_LUR1_ecoli_10foldCV$ecoli_PRED_HV,VGOB1_subsetvalID1to10_ecoli_LUR1_ecoli_10foldCV$residuals)

#  3)Check multicollinearity (VIF)
# NA - all models have only 1 predictor

#  4)Check influential points (Cook's Distance)
ecoli_LUR1_maxCD_subsetvalID1to10 <- c(maxCD_ecoli_LUR1_subsetA, maxCD_ecoli_LUR1_subsetB, maxCD_ecoli_LUR1_subsetC, maxCD_ecoli_LUR1_subsetD, maxCD_ecoli_LUR1_subsetE, maxCD_ecoli_LUR1_subsetF, maxCD_ecoli_LUR1_subsetG, maxCD_ecoli_LUR1_subsetH, maxCD_ecoli_LUR1_subsetI, maxCD_ecoli_LUR1_subsetJ)
max(ecoli_LUR1_maxCD_subsetvalID1to10)
```
#  E. coli LUR2 model - training model
```{r}
#  Function building to run the models 
models<-list()

modeln<-1
models[[modeln]]<-list()

R2<-1
betaaddedvar<-1
addedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(Measurements_livestockpreds_LUR2[,i])==TRUE){
    modeltry<-lm(ecoli~Measurements_livestockpreds_LUR2[,i])                            
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    # find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(Measurements_livestockpreds_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
models[[modeln]]$results

#  this are the candidates models with the highest R2, not a negative beta for the new, nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)
subset(models[[modeln]]$resultspos)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(Measurements_livestockpreds_LUR2)[models[[1]]$indexbestmodel])
models[[modeln]]$namesbestmodel

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(ecoli~Measurements_livestockpreds_LUR2[,models[[1]]$indexbestmodel]) 
models[[modeln]]$bestmodel

summary(models[[modeln]]$bestmodel)


#  2 # 
#  Add 2nd variable (the only difference of the above part is that now modeln=2 the model statement has 2 variables)
#  and the cAll for the list of variable names in the model changed slightly

modeln<-2

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(Measurements_livestockpreds_LUR2[,i])==TRUE){
    modeltry<-lm(ecoli~Measurements_livestockpreds_LUR2[,models[[1]]$indexbestmodel]+ Measurements_livestockpreds_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    # find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(Measurements_livestockpreds_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  these are the candidate models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(Measurements_livestockpreds_LUR2)[models[[1]]$indexbestmodel], names(Measurements_livestockpreds_LUR2)[models[[2]]$indexbestmodel] )
models[[modeln]]$namesbestmodel

# this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

# this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(ecoli~Measurements_livestockpreds_LUR2[,models[[1]]$indexbestmodel]+Measurements_livestockpreds_LUR2[,models[[2]]$indexbestmodel]) 
models[[modeln]]$bestmodel

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel

models[[1]]$namesbestmodel
models[[2]]$namesbestmodel

models[[1]]$R2bestmodel
models[[2]]$R2bestmodel

#  at this point I always check whether the next model (with 2 variables) is more than 1% better than the one before and if not I end here
#  R2 of the second model is quite a lot higher than the 1st model, so 2nd is better probably 
#  Also check vif and cook's distance 
vif(models[[2]]$bestmodel) #  no VIF values are > 3
ols_plot_cooksd_bar(models[[2]]$bestmodel, print_plot = TRUE) #  no cook's distances are >1

#  3 #  
#  add third variable (the only difference of the above part is that now modeln=3 the model statement has 3 variables)
#  and the cAll for the list of variable names in the model changed slightly

modeln<-3

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(Measurements_livestockpreds_LUR2[,i])==TRUE){  
    modeltry<-lm(ecoli~Measurements_livestockpreds_LUR2[,models[[1]]$indexbestmodel]+Measurements_livestockpreds_LUR2[,models[[2]]$indexbestmodel]+ Measurements_livestockpreds_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    #  the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)]) 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(Measurements_livestockpreds_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(Measurements_livestockpreds_LUR2)[models[[1]]$indexbestmodel], names(Measurements_livestockpreds_LUR2)[models[[2]]$indexbestmodel] , names(Measurements_livestockpreds_LUR2)[models[[3]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(ecoli~Measurements_livestockpreds_LUR2[,models[[1]]$indexbestmodel]+Measurements_livestockpreds_LUR2[,models[[2]]$indexbestmodel]+Measurements_livestockpreds_LUR2[,models[[3]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel

models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel

models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel

#  at this point I always check whether the next model is more than 1% better than the one before and if not I end here
#  Yes model 3 is >1% better than model 2 therefore I continue
#  Also check vif and cook's distance 
vif(models[[3]]$bestmodel) #  no VIF values are > 3
ols_plot_cooksd_bar(models[[3]]$bestmodel, print_plot = TRUE) #  no cook's distances are >1

#  4 # 
#  add forth variable (the only difference of the above part is that now model n=4 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly
modeln<-4

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(Measurements_livestockpreds_LUR2[,i])==TRUE){
    modeltry<-lm(ecoli~Measurements_livestockpreds_LUR2[,models[[1]]$indexbestmodel]+Measurements_livestockpreds_LUR2[,models[[2]]$indexbestmodel]+Measurements_livestockpreds_LUR2[,models[[3]]$indexbestmodel]+ Measurements_livestockpreds_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(Measurements_livestockpreds_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(Measurements_livestockpreds_LUR2)[models[[1]]$indexbestmodel], names(Measurements_livestockpreds_LUR2)[models[[2]]$indexbestmodel] , names(Measurements_livestockpreds_LUR2)[models[[3]]$indexbestmodel], names(Measurements_livestockpreds_LUR2)[models[[4]]$indexbestmodel])

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(ecoli~Measurements_livestockpreds_LUR2[,models[[1]]$indexbestmodel]+Measurements_livestockpreds_LUR2[,models[[2]]$indexbestmodel]+Measurements_livestockpreds_LUR2[,models[[3]]$indexbestmodel]+ Measurements_livestockpreds_LUR2[,models[[4]]$indexbestmodel]) 


models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel


#  at this point I always check whether the next model is more than 1% better than the one before and if not I end here
#  Yes model 4 is >1% better than model 3 therefore I continue
#  Also check vif and cook's distance 
vif(models[[4]]$bestmodel) #  no VIF values are > 3
ols_plot_cooksd_bar(models[[4]]$bestmodel, print_plot = TRUE) #  no cook's distances are >1

#  5 # 
#  add fifth variable (the only difference of the above part is that now modeln=5 the model statement more variables)
#  and the cAll for the list of variable names in the model changed slightly
modeln<-5

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(Measurements_livestockpreds_LUR2[,i])==TRUE){
    modeltry<-lm(ecoli~Measurements_livestockpreds_LUR2[,models[[1]]$indexbestmodel]+Measurements_livestockpreds_LUR2[,models[[2]]$indexbestmodel]+Measurements_livestockpreds_LUR2[,models[[3]]$indexbestmodel]+Measurements_livestockpreds_LUR2[,models[[4]]$indexbestmodel]+ Measurements_livestockpreds_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    # find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(Measurements_livestockpreds_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(Measurements_livestockpreds_LUR2)[models[[1]]$indexbestmodel], names(Measurements_livestockpreds_LUR2)[models[[2]]$indexbestmodel] , names(Measurements_livestockpreds_LUR2)[models[[3]]$indexbestmodel], names(Measurements_livestockpreds_LUR2)[models[[4]]$indexbestmodel], names(Measurements_livestockpreds_LUR2)[models[[5]]$indexbestmodel])


#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(ecoli~Measurements_livestockpreds_LUR2[,models[[1]]$indexbestmodel]+Measurements_livestockpreds_LUR2[,models[[2]]$indexbestmodel]+Measurements_livestockpreds_LUR2[,models[[3]]$indexbestmodel]+ Measurements_livestockpreds_LUR2[,models[[4]]$indexbestmodel]+ Measurements_livestockpreds_LUR2[,models[[5]]$indexbestmodel]) 


models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel

#  at this point I always check whether the next model is more than 1% better than the one before and if not I end here
#  Yes model 5 is >1% better than model 4 therefore I continue
#  Also check vif and cook's distance 
vif(models[[5]]$bestmodel) #  no VIF values are > 3, but one is 2.639457 (approaching 3!)
ols_plot_cooksd_bar(models[[5]]$bestmodel, print_plot = TRUE) #  no cook's distances are >1

#  6 # 
#  add sixth variable (the only difference of the above part is that now modeln=6 the modelstatement more variables)
#  and the cAll for the list of variable names in the model changed slightly

modeln<-6

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){
  if (is.numeric(Measurements_livestockpreds_LUR2[,i])==TRUE){
    modeltry<-lm(ecoli~Measurements_livestockpreds_LUR2[,models[[1]]$indexbestmodel]+Measurements_livestockpreds_LUR2[,models[[2]]$indexbestmodel]+Measurements_livestockpreds_LUR2[,models[[3]]$indexbestmodel]+Measurements_livestockpreds_LUR2[,models[[4]]$indexbestmodel]+Measurements_livestockpreds_LUR2[,models[[5]]$indexbestmodel]+ Measurements_livestockpreds_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
   # find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(All)[i]
    addedvar<-rbind(addedvar,names(Measurements_livestockpreds_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(Measurements_livestockpreds_LUR2)[models[[1]]$indexbestmodel], names(Measurements_livestockpreds_LUR2)[models[[2]]$indexbestmodel] , names(Measurements_livestockpreds_LUR2)[models[[3]]$indexbestmodel], names(Measurements_livestockpreds_LUR2)[models[[4]]$indexbestmodel], names(Measurements_livestockpreds_LUR2)[models[[5]]$indexbestmodel], names(Measurements_livestockpreds_LUR2)[models[[6]]$indexbestmodel])

#  # this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  # this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(ecoli~Measurements_livestockpreds_LUR2[,models[[1]]$indexbestmodel]+Measurements_livestockpreds_LUR2[,models[[2]]$indexbestmodel]+Measurements_livestockpreds_LUR2[,models[[3]]$indexbestmodel]+ Measurements_livestockpreds_LUR2[,models[[4]]$indexbestmodel]+ Measurements_livestockpreds_LUR2[,models[[5]]$indexbestmodel]+ Measurements_livestockpreds_LUR2[,models[[6]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel

#   7 #  # 
modeln<-7

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){
  if (is.numeric(Measurements_livestockpreds_LUR2[,i])==TRUE){
    modeltry<-lm(ecoli~Measurements_livestockpreds_LUR2[,models[[1]]$indexbestmodel]+Measurements_livestockpreds_LUR2[,models[[2]]$indexbestmodel]+Measurements_livestockpreds_LUR2[,models[[3]]$indexbestmodel]+Measurements_livestockpreds_LUR2[,models[[4]]$indexbestmodel]+Measurements_livestockpreds_LUR2[,models[[5]]$indexbestmodel]+Measurements_livestockpreds_LUR2[,models[[6]]$indexbestmodel]+ Measurements_livestockpreds_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(Measurements_livestockpreds_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#   this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(Measurements_livestockpreds_LUR2)[models[[1]]$indexbestmodel], names(Measurements_livestockpreds_LUR2)[models[[2]]$indexbestmodel] , names(Measurements_livestockpreds_LUR2)[models[[3]]$indexbestmodel], names(Measurements_livestockpreds_LUR2)[models[[4]]$indexbestmodel], names(Measurements_livestockpreds_LUR2)[models[[5]]$indexbestmodel], names(Measurements_livestockpreds_LUR2)[models[[6]]$indexbestmodel],
names(Measurements_livestockpreds_LUR2)[models[[7]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(ecoli~Measurements_livestockpreds_LUR2[,models[[1]]$indexbestmodel]+Measurements_livestockpreds_LUR2[,models[[2]]$indexbestmodel]+Measurements_livestockpreds_LUR2[,models[[3]]$indexbestmodel]+ Measurements_livestockpreds_LUR2[,models[[4]]$indexbestmodel]+ Measurements_livestockpreds_LUR2[,models[[5]]$indexbestmodel]+ Measurements_livestockpreds_LUR2[,models[[6]]$indexbestmodel]+
Measurements_livestockpreds_LUR2[,models[[7]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel

#  R^2 increases again by  3.69523% 
#  I continue! 

#   8 #  
#  add eighth variable (the only difference of the above part is that now modeln=8 the modelstatement more variables)
#  and the cAll for the list of variable names in the model changed slightly

modeln<-8

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){
  if (is.numeric(Measurements_livestockpreds_LUR2[,i])==TRUE){
    modeltry<-lm(ecoli~Measurements_livestockpreds_LUR2[,models[[1]]$indexbestmodel]+Measurements_livestockpreds_LUR2[,models[[2]]$indexbestmodel]+Measurements_livestockpreds_LUR2[,models[[3]]$indexbestmodel]+Measurements_livestockpreds_LUR2[,models[[4]]$indexbestmodel]+Measurements_livestockpreds_LUR2[,models[[5]]$indexbestmodel]+Measurements_livestockpreds_LUR2[,models[[6]]$indexbestmodel]+ Measurements_livestockpreds_LUR2[,models[[7]]$indexbestmodel]+ Measurements_livestockpreds_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(Measurements_livestockpreds_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#   this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(Measurements_livestockpreds_LUR2)[models[[1]]$indexbestmodel], names(Measurements_livestockpreds_LUR2)[models[[2]]$indexbestmodel] , names(Measurements_livestockpreds_LUR2)[models[[3]]$indexbestmodel], names(Measurements_livestockpreds_LUR2)[models[[4]]$indexbestmodel], names(Measurements_livestockpreds_LUR2)[models[[5]]$indexbestmodel], names(Measurements_livestockpreds_LUR2)[models[[6]]$indexbestmodel],
names(Measurements_livestockpreds_LUR2)[models[[7]]$indexbestmodel],
names(Measurements_livestockpreds_LUR2)[models[[8]]$indexbestmodel] )

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(ecoli~Measurements_livestockpreds_LUR2[,models[[1]]$indexbestmodel]+Measurements_livestockpreds_LUR2[,models[[2]]$indexbestmodel]+Measurements_livestockpreds_LUR2[,models[[3]]$indexbestmodel]+ Measurements_livestockpreds_LUR2[,models[[4]]$indexbestmodel]+ Measurements_livestockpreds_LUR2[,models[[5]]$indexbestmodel]+ Measurements_livestockpreds_LUR2[,models[[6]]$indexbestmodel]+
Measurements_livestockpreds_LUR2[,models[[7]]$indexbestmodel] +Measurements_livestockpreds_LUR2[,models[[8]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel

#   9 #  

modeln<-9

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){
  if (is.numeric(Measurements_livestockpreds_LUR2[,i])==TRUE){
    modeltry<-lm(ecoli~Measurements_livestockpreds_LUR2[,models[[1]]$indexbestmodel]+Measurements_livestockpreds_LUR2[,models[[2]]$indexbestmodel]+Measurements_livestockpreds_LUR2[,models[[3]]$indexbestmodel]+Measurements_livestockpreds_LUR2[,models[[4]]$indexbestmodel]+Measurements_livestockpreds_LUR2[,models[[5]]$indexbestmodel]+ Measurements_livestockpreds_LUR2[,models[[6]]$indexbestmodel]+ Measurements_livestockpreds_LUR2[,models[[7]]$indexbestmodel]+ Measurements_livestockpreds_LUR2[,models[[8]]$indexbestmodel]+ Measurements_livestockpreds_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(Measurements_livestockpreds_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#   this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(Measurements_livestockpreds_LUR2)[models[[1]]$indexbestmodel], names(Measurements_livestockpreds_LUR2)[models[[2]]$indexbestmodel] , names(Measurements_livestockpreds_LUR2)[models[[3]]$indexbestmodel], names(Measurements_livestockpreds_LUR2)[models[[4]]$indexbestmodel], names(Measurements_livestockpreds_LUR2)[models[[5]]$indexbestmodel], names(Measurements_livestockpreds_LUR2)[models[[6]]$indexbestmodel], names(Measurements_livestockpreds_LUR2)[models[[7]]$indexbestmodel], names(Measurements_livestockpreds_LUR2)[models[[8]]$indexbestmodel], names(Measurements_livestockpreds_LUR2)[models[[9]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(ecoli~Measurements_livestockpreds_LUR2[,models[[1]]$indexbestmodel]+Measurements_livestockpreds_LUR2[,models[[2]]$indexbestmodel]+Measurements_livestockpreds_LUR2[,models[[3]]$indexbestmodel]+ Measurements_livestockpreds_LUR2[,models[[4]]$indexbestmodel]+ Measurements_livestockpreds_LUR2[,models[[5]]$indexbestmodel]+ Measurements_livestockpreds_LUR2[,models[[6]]$indexbestmodel]+ Measurements_livestockpreds_LUR2[,models[[7]]$indexbestmodel]+ Measurements_livestockpreds_LUR2[,models[[8]]$indexbestmodel]+ Measurements_livestockpreds_LUR2[,models[[9]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[9]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[9]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel
models[[9]]$R2bestmodel


#  at this point I always check whether the next model is more than 1%better than the one before and if not I end here
#  last step is to exclude All var with p>0.1 one by one with the lowest p first, until All <0.1.

#   10 #  
modeln<-10

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){
  if (is.numeric(Measurements_livestockpreds_LUR2[,i])==TRUE){
    modeltry<-lm(ecoli~Measurements_livestockpreds_LUR2[,models[[1]]$indexbestmodel]+Measurements_livestockpreds_LUR2[,models[[2]]$indexbestmodel]+Measurements_livestockpreds_LUR2[,models[[3]]$indexbestmodel]+Measurements_livestockpreds_LUR2[,models[[4]]$indexbestmodel]+Measurements_livestockpreds_LUR2[,models[[5]]$indexbestmodel]+ Measurements_livestockpreds_LUR2[,models[[6]]$indexbestmodel]+ Measurements_livestockpreds_LUR2[,models[[7]]$indexbestmodel]+ Measurements_livestockpreds_LUR2[,models[[8]]$indexbestmodel]+ Measurements_livestockpreds_LUR2[,models[[9]]$indexbestmodel]+ Measurements_livestockpreds_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(All)[i]
    addedvar<-rbind(addedvar,names(Measurements_livestockpreds_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#   this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(Measurements_livestockpreds_LUR2)[models[[1]]$indexbestmodel], names(Measurements_livestockpreds_LUR2)[models[[2]]$indexbestmodel] , names(Measurements_livestockpreds_LUR2)[models[[3]]$indexbestmodel], names(Measurements_livestockpreds_LUR2)[models[[4]]$indexbestmodel], names(Measurements_livestockpreds_LUR2)[models[[5]]$indexbestmodel], names(Measurements_livestockpreds_LUR2)[models[[6]]$indexbestmodel], names(Measurements_livestockpreds_LUR2)[models[[7]]$indexbestmodel], names(Measurements_livestockpreds_LUR2)[models[[8]]$indexbestmodel], names(Measurements_livestockpreds_LUR2)[models[[9]]$indexbestmodel], names(Measurements_livestockpreds_LUR2)[models[[10]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(ecoli~Measurements_livestockpreds_LUR2[,models[[1]]$indexbestmodel]+Measurements_livestockpreds_LUR2[,models[[2]]$indexbestmodel]+Measurements_livestockpreds_LUR2[,models[[3]]$indexbestmodel]+ Measurements_livestockpreds_LUR2[,models[[4]]$indexbestmodel]+ Measurements_livestockpreds_LUR2[,models[[5]]$indexbestmodel]+ Measurements_livestockpreds_LUR2[,models[[6]]$indexbestmodel]+ Measurements_livestockpreds_LUR2[,models[[7]]$indexbestmodel]+ Measurements_livestockpreds_LUR2[,models[[8]]$indexbestmodel]+ Measurements_livestockpreds_LUR2[,models[[9]]$indexbestmodel]+ Measurements_livestockpreds_LUR2[,models[[10]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[9]]$summarybestmodel
models[[10]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[9]]$namesbestmodel
models[[10]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel
models[[9]]$R2bestmodel
models[[10]]$R2bestmodel

#  CODE FOR PICKING OUT THE BEST MODEL # 
temp <- 0
besti <- 0
for (i in 1:10){
  print(models[[i]]$R2bestmodel)
  #       print(models[[i]]$summarybestmodel$coefficients=-1,4])
  #       if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
  #         temp <- models[[i]]$R2bestmodel
  #         besti <- i
  #         }
  if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
    temp <- models[[i]]$R2bestmodel
    besti <- i
  }else{
    finalBestModel <- models[[besti]]$bestmodel
    finalBestModelNames <- models[[besti]]$namesbestmodel
    Sites <- 1:dim(Measurements_livestockpreds_LUR2)[1] # full original model
    #  CVaR2<-escCV_ecoli_LUR2(Sites)[2] # Cross Validation
    maxCD<-max(cooks.distance(finalBestModel))
    if(length(finalBestModelNames)<2){ # vif fn doesnot work when only 1 variable...       # 
      maxVIF<-"NA"
    }else{
      maxVIF<-max(vif(finalBestModel))
    }
    print(paste("This is the best ecoli model: ",besti,
                "(AdjR2: ",format(models[[besti]]$R2bestmodel,digits=3), "; MaxCD: ",format(maxCD,digits=3),"; MaxVIF: ",
                format(maxVIF,digits=3),")", sep=''))
    print(finalBestModelNames)
    break
  }
}

#  the final best model includes the predictors: npigsWghtDist.3000m.sum.Tr.1P9, npoultry.3000m.Tr.1P9, npigs.500m.Tr.1P9, nhorses.3000m.Tr.1P9
#  Overview of the final best model using the algorithm selection process (taking into account VIF, R^2, and p-values)
finalBestModel 
finalBestModelNames 
models[[besti]]$summarybestmodel
models[[besti]]$R2bestmodel

#  Same model written out with variables in name 
ecoli_LUR2_algorithmmethod <- lm(ecoli~npigsWghtDist.3000m.sum.95Win.10to90scaled+ npoultry.3000m.95Win.10to90scaled +npigs.500m.95Win.10to90scaled+ nhorses.3000m.95Win.10to90scaled, data= Measurements_livestockpreds_LUR2) 
summary(ecoli_LUR2_algorithmmethod)

# compute RMSE
ecoli_LUR2_preds <- predict(ecoli_LUR2_algorithmmethod, Measurements_livestockpreds_LUR2)
RMSE_ecoli_LUR2 <- sqrt(mean((Measurements_livestockpreds_LUR2$ecoli_copiespm3.ln.diffmeth.mean - ecoli_LUR2_preds)^2))
RMSE_ecoli_LUR2

#  Save these predicted concentrations along with the measured concentrations as an excel file 
#  Create a dataframe 
ecoli_LUR2_preds_observed <- data.frame(Measurements_livestockpreds_LUR2$Loc_ID,Measurements_livestockpreds_LUR2$ecoli_copiespm3.ln.diffmeth.mean, ecoli_LUR2_preds)
print(ecoli_LUR2_preds_observed)

#  Save as xls file 
write_xlsx(ecoli_LUR2_preds_observed,"Output_files//ecoli_LUR2_preds_observed.xlsx")


#  MODEL CHECKING # 
#  1)Check normality of residuals 
#  2)Check residuals for linearity, independence and homoscedasticity
#  3)Check multicollinearity (VIF)
#  4)Check influential points (Cook's Distance)

#  1) Normality of residuals
boxplot(residuals(ecoli_LUR2_algorithmmethod),main="boxplot of residuals - ecoli LUR model 2",xlab="LUR2 model residuals")
qqnorm(residuals(ecoli_LUR2_algorithmmethod),main="QQ-plot of residuals - ecoli LUR model 2",xlab="LUR2 model residuals")
hist(residuals(ecoli_LUR2_algorithmmethod),main="QQ-plot of residuals - ecoli LUR model 2",xlab="LUR2 model residuals")

#  2)Check residuals for linearity, independence and homoscedasticity
plot(fitted(ecoli_LUR2_algorithmmethod),residuals(ecoli_LUR2_algorithmmethod))

#  3)Check multicollinearity (VIF)
maxvif_ecoli_LUR2 <- max(vif(ecoli_LUR2_algorithmmethod))
maxvif_ecoli_LUR2

#  4)Check influential points (Cook's Distance)
ols_plot_cooksd_bar(ecoli_LUR2_algorithmmethod, print_plot = TRUE)
maxCD_ecoli_LUR2<-max(cooks.distance(ecoli_LUR2_algorithmmethod))
maxCD_ecoli_LUR2
#  won't remove any outliers - none with cook's d > 1 
```
# E. coli LUR2 model - LOOCV
```{r}
#  LOOCV - LUR2 model for E. coli
#  Leave one out cross validation - the goal of cross validation is to get a generalized score of the model. The reason for this generalization is to, hopefully, improve the model’s effectiveness in predicting on future data inputs.
#  It is a type of 'internal' cross validation
Measurements_livestockpreds_LUR2_LOOCV <- Measurements_livestockpreds_LUR2

set.seed(123)
Measurements_livestockpreds_LUR2_LOOCV$ecoli_LUR2_LOOCV_PRED <- unlist(lapply(1:nrow(Measurements_livestockpreds_LUR2_LOOCV),function(inx){
  train <- Measurements_livestockpreds_LUR2_LOOCV[-inx,,drop=FALSE]
  test <- Measurements_livestockpreds_LUR2_LOOCV[inx,,drop=FALSE]
  cvm <- lm(ecoli_copiespm3.ln.diffmeth.mean ~ npigsWghtDist.3000m.sum.95Win.10to90scaled+ npoultry.3000m.95Win.10to90scaled +npigs.500m.95Win.10to90scaled+ nhorses.3000m.95Win.10to90scaled, data=train)
  pred <- predict(cvm,newdata=test)
  return(pred)
}))

predicted_ecoli_LUR2_LOOCV <- Measurements_livestockpreds_LUR2_LOOCV$ecoli_LUR2_LOOCV_PRED

#  Save these predicted concentrations along with the measured concentrations as an excel file 
#  Create a dataframe 
ecoli_LUR2_LOOCV_preds_observed <- data.frame(Measurements_livestockpreds_LUR2_LOOCV$Loc_ID,Measurements_livestockpreds_LUR2_LOOCV$ecoli_copiespm3.ln.diffmeth.mean, Measurements_livestockpreds_LUR2_LOOCV$ecoli_LUR2_LOOCV_PRED)
print(ecoli_LUR2_LOOCV_preds_observed)

#  Save as xls file 
write_xlsx(ecoli_LUR2_LOOCV_preds_observed,"Output_files//ecoli_LUR2_LOOCV_preds_observed.xlsx")

# Compute the LOOCV model R2
ecoli_LUR2_LOOCV_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean ~ ecoli_LUR2_LOOCV_PRED, data=Measurements_livestockpreds_LUR2_LOOCV)
summary(ecoli_LUR2_LOOCV_lm)
#  E. coli LUR2 model LOOCV multiple R^2 = 0.508

# Calculate RMSE
preds_ecoli_LUR2_LOOCV <- predict(ecoli_LUR2_LOOCV_lm, Measurements_livestockpreds_LUR2_LOOCV)
RMSE_ecoli_LUR2_LOOCV <- sqrt(mean((Measurements_livestockpreds_LUR2_LOOCV$ecoli_copiespm3.ln.diffmeth.mean - preds_ecoli_LUR2_LOOCV)^2))
RMSE_ecoli_LUR2_LOOCV

#  Plot LOOCV estimations vs. observed concentrations
plot(Measurements_livestockpreds_LUR2_LOOCV$ecoli_LUR2_LOOCV_PRED, Measurements_livestockpreds_LUR2_LOOCV$ecoli_copiespm3.ln.diffmeth.mean)
abline(lm(Measurements_livestockpreds_LUR2_LOOCV$ecoli_copiespm3.ln.diffmeth.mean ~ Measurements_livestockpreds_LUR2_LOOCV$ecoli_LUR2_LOOCV_PRED))
```
# E. coli LUR2 model - 10-fold CV
```{r}
options(stringsAsFactors = FALSE) # so that dataframes are not opened in new tabs

# This is the required dataset
Measurements_livestockpreds_LUR2 

#  10-fold hold-out validation is done to assess model robustness. This is done using a random selection of 90% of the measurement sites. 
#  Part 1. Each measurement site gets randomly allocated number out of range 1-10
#  Completely randomly pulling sites
ecoli_HV_LUR2_df <- Measurements_livestockpreds_LUR2[c(1,2,6:74)] #  new df created with only ecoli values 
#  Create valID variable 
ecoli_HV_LUR2_df$valID <- 0
#  Draw 10 samples, thus on average 6 sites per test set (i.e 6 sites are removed from each model and then the model is tested on these 6 sites )
set.seed(123)
VGOB1_FINAL_ecoli_LUR2 <- c()
for (s in 1:1){
  if (s==1) set <- ecoli_HV_LUR2_df
  draws <- c(1:nrow(set))
  chosen <- c()
  tempdraws <- draws
  for (d in 1:10){
    list <- sample(tempdraws, length(tempdraws)/(11-d), FALSE)
    set[list,]$valID <- d
    chosen <- c(chosen, list)
    tempdraws <- draws[-chosen]
  }

#  Combine datasets to 1
VGOB1_FINAL_ecoli_LUR2 <- set
}

summary(set)
rm(set)

#  View the df created
str(VGOB1_FINAL_ecoli_LUR2, list.len=ncol(VGOB1_FINAL_ecoli_LUR2))
names(VGOB1_FINAL_ecoli_LUR2)
summary(VGOB1_FINAL_ecoli_LUR2)

#  Part 2: Make 10 subsets of dataset based on randomly allocated number (so these are the training datasets) 
#  Then create 10 subsets, each excluding 1 set of 10 sites
VGOB1_subsetA_ecoli_LUR2 <- subset(VGOB1_FINAL_ecoli_LUR2, valID != 1)
VGOB1_subsetB_ecoli_LUR2 <- subset(VGOB1_FINAL_ecoli_LUR2, valID != 2)  
VGOB1_subsetC_ecoli_LUR2 <- subset(VGOB1_FINAL_ecoli_LUR2, valID != 3)
VGOB1_subsetD_ecoli_LUR2 <- subset(VGOB1_FINAL_ecoli_LUR2, valID != 4)
VGOB1_subsetE_ecoli_LUR2 <- subset(VGOB1_FINAL_ecoli_LUR2, valID != 5)
VGOB1_subsetF_ecoli_LUR2 <- subset(VGOB1_FINAL_ecoli_LUR2, valID != 6)
VGOB1_subsetG_ecoli_LUR2 <- subset(VGOB1_FINAL_ecoli_LUR2, valID != 7)
VGOB1_subsetH_ecoli_LUR2 <- subset(VGOB1_FINAL_ecoli_LUR2, valID != 8)
VGOB1_subsetI_ecoli_LUR2 <- subset(VGOB1_FINAL_ecoli_LUR2, valID != 9)
VGOB1_subsetJ_ecoli_LUR2 <- subset(VGOB1_FINAL_ecoli_LUR2, valID != 10)

#  Part 3: Build for each subset a LUR model (i.e. go through the whole LUR model script for each subset (so each training set). Start with subset A, until final LUR model. Then subset B, until final LUR model etc.) 

#### A ####
# LUR model building process for subset A
#  This is the dataframe with the relevant predictor vars for LUR2 models for subset A (55 sites)
VGOB1_subsetA_ecoli_LUR2 # n.b. this dataframe only includes microbial marker concentrations for ecoli unlike the dataframe Measurements_livestockpreds_LUR2 as previously used for the model building. 

#  Now set the values of some variables that will be needed
nfirstvar_LUR_2 <- 3  
nlastvar_LUR_2 <- 71

# Function building to run the models 
# 1 #  

models<-list()
modeln<-1
models[[modeln]]<-list()

R2<-1
betaaddedvar<-1
addedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetA_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetA_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetA_ecoli_LUR2[,i])                            
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetA_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
models[[modeln]]$results

#  this are the candidates models with the highest R2, not a negative beta for the new, nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)
subset(models[[modeln]]$resultspos)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetA_ecoli_LUR2)[models[[1]]$indexbestmodel])
models[[modeln]]$namesbestmodel

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetA_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetA_ecoli_LUR2[,models[[1]]$indexbestmodel]) 
models[[modeln]]$bestmodel

summary(models[[modeln]]$bestmodel)

#  The first model includes the predictor: nPigMultipFarmWghtDist.3000m.sum.Tr.1P9 - meaning the number of multiplier pig farms weighted to distance in a 3000m buffer

# 2 #  
# Add 2nd variable (the only difference of the above part is that now modeln=2 the model statement has 2 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-2

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetA_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetA_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetA_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetA_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  these are the candidate models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetA_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR2)[models[[2]]$indexbestmodel] )
models[[modeln]]$namesbestmodel

# this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

# this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetA_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~                               VGOB1_subsetA_ecoli_LUR2[,models[[1]]$indexbestmodel]+                           VGOB1_subsetA_ecoli_LUR2[,models[[2]]$indexbestmodel]) 

models[[modeln]]$bestmodel

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel


# 3 #  
# add third variable (the only difference of the above part is that now modeln=3 the model statement has 3 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-3

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetA_ecoli_LUR2[,i])==TRUE){  
    modeltry<-lm(VGOB1_subsetA_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetA_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR2[,models[[2]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetA_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetA_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR2)[models[[2]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR2)[models[[3]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetA_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetA_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,models[[2]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,models[[3]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel


# 4 #  
#  add forth variable (the only difference of the above part is that now model n=4 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly
modeln<-4

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1


for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetA_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetA_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetA_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    #  the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetA_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetA_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR2)[models[[2]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR2)[models[[4]]$indexbestmodel])

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetA_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetA_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,models[[4]]$indexbestmodel]) 


models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel


# 5 #  
# add fifth variable (the only difference of the above part is that now modeln=5 the model statement more variables)
# and the call for the list of variable names in the model changed slightly
modeln<-5

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetA_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetA_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetA_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,models[[2]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,i]) 
  
R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetA_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetA_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR2)[models[[2]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR2)[models[[5]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetA_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetA_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,models[[5]]$indexbestmodel]) 
models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel

# 6 #  
# add sixth variable (the only difference of the above part is that now model n=6 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-6

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetA_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetA_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetA_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR2[,models[[4]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(All)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetA_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetA_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetA_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR2)[models[[6]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetA_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetA_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,models[[6]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel


# 7 #  
# add seventh variable (the only difference of the above part is that now model n=7 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-7

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetA_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetA_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetA_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR2[,models[[4]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR2[,models[[5]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetA_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetA_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetA_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR2)[models[[6]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR2)[models[[7]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetA_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetA_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,models[[7]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel

# 8 #  
# add eighth variable (the only difference of the above part is that now modeln=7 the model statement more variables)
# and the call for the list of variable names in the model changed slightly

modeln<-8

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetA_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetA_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetA_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR2[,models[[4]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR2[,models[[5]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetA_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetA_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetA_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR2)[models[[6]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR2)[models[[7]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR2)[models[[8]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetA_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetA_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,models[[8]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel

# The next part of the code (n=9-10) does not work
# This is because one of the coefficients included in the model with 6 variables is negative, the code does not allow for this. I can stop here. 

# # 9 #  
# # add ninth variable (the only difference of the above part is that now modeln=9 the model statement more variables)
# # and the call for the list of variable names in the model changed slightly
# 
# modeln<-9
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){
#   if (is.numeric(VGOB1_subsetA_ecoli_LUR2[,i])==TRUE){
#       modeltry<-lm(VGOB1_subsetA_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetA_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR2[,models[[4]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR2[,models[[5]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,models[[8]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,i]) 
#         R2<-rbind(R2,summary(modeltry)$adj.r.squared)
#     # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetA_ecoli_LUR2)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# # this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# # here are the names
# models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetA_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetA_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR2)[models[[6]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR2)[models[[7]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR2)[models[[8]]$indexbestmodel],  names(VGOB1_subsetA_ecoli_LUR2)[models[[9]]$indexbestmodel])
# 
# #  this is the r2 or that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetA_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetA_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,models[[8]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,models[[9]]$indexbestmodel]) 
# 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[5]]$summarybestmodel
# models[[6]]$summarybestmodel
# models[[7]]$summarybestmodel
# models[[8]]$summarybestmodel
# models[[9]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[5]]$namesbestmodel
# models[[6]]$namesbestmodel
# models[[7]]$namesbestmodel
# models[[8]]$namesbestmodel
# models[[9]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# models[[5]]$R2bestmodel
# models[[6]]$R2bestmodel
# models[[7]]$R2bestmodel
# models[[8]]$R2bestmodel
# models[[9]]$R2bestmodel
# 
# # 10 #  
# #  add tenth variable (the only difference of the above part is that now model n=10 the model statement more variables)
# #  and the call for the list of variable names in the model changed slightly
# 
# modeln<-10
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){if (is.numeric(VGOB1_subsetA_ecoli_LUR2[,i])==TRUE){ modeltry<-lm(VGOB1_subsetA_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetA_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR2[,models[[2]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,models[[8]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,models[[9]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,i]) 
# 
# R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetA_ecoli_LUR2)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# # this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# # here are the names
# models[[modeln]]$namesbestmodel<-c( names(VGOB1_subsetA_ecoli_LUR2)[models[[1]]$indexbestmodel],                   names(VGOB1_subsetA_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetA_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR2)[models[[6]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR2)[models[[7]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR2)[models[[8]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR2)[models[[9]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR2)[models[[10]]$indexbestmodel])
# 
# #  this is the r2 or that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetA_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~                                VGOB1_subsetA_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,models[[2]]$indexbestmodel]+                           VGOB1_subsetA_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,models[[8]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,models[[9]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR2[,models[[10]]$indexbestmodel]) 
# 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[5]]$summarybestmodel
# models[[6]]$summarybestmodel
# models[[7]]$summarybestmodel
# models[[8]]$summarybestmodel
# models[[9]]$summarybestmodel
# models[[10]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[5]]$namesbestmodel
# models[[6]]$namesbestmodel
# models[[7]]$namesbestmodel
# models[[8]]$namesbestmodel
# models[[9]]$namesbestmodel
# models[[10]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# models[[5]]$R2bestmodel
# models[[6]]$R2bestmodel
# models[[7]]$R2bestmodel
# models[[8]]$R2bestmodel
# models[[9]]$R2bestmodel
# models[[10]]$R2bestmodel

#   CODE FOR PICKING OUT THE BEST MODEL #   
temp <- 0
besti <- 0
for (i in 1:10){ #  think this runs the loop 10 times - not fully sure thought - but not to do with the number of models I don't think - as when I change to 3, I still get the model with 4 variables as best model
  print(models[[i]]$R2bestmodel)
  #       print(models[[i]]$summarybestmodel$coefficients=-1,4])
  #       if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
  #         temp <- models[[i]]$R2bestmodel
  #         besti <- i
  #         }
  if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
    temp <- models[[i]]$R2bestmodel
    besti <- i
  }else{
    finalBestModel_ecoli_LUR2_subsetA <- models[[besti]]$bestmodel
    finalBestModelNames_ecoli_LUR2_subsetA <- models[[besti]]$namesbestmodel
    Sites <- 1:dim(VGOB1_subsetA_ecoli_LUR2)[1] # full original model
    #  CVaR2<-escCV_ecoli_LUR2(Sites)[2] # Cross Validation
    maxCD<-max(cooks.distance(finalBestModel_ecoli_LUR2_subsetA))
    if(length(finalBestModelNames_ecoli_LUR2_subsetA)<2){ # vif fn doesnot work when only 1 variable...       # 
      maxVIF<-"NA"
    }else{
      maxVIF<-max(vif(finalBestModel_ecoli_LUR2_subsetA))
    }
    print(paste("This is the best ecoli model for subset A: ",besti,
                "(AdjR2: ",format(models[[besti]]$R2bestmodel,digits=3), "; MaxCD: ",format(maxCD,digits=3),"; MaxVIF: ",
                format(maxVIF,digits=3),")", sep=''))
    print(finalBestModelNames_ecoli_LUR2_subsetA)
    break
  }
}

#  Overview of the final best model using the algorithm selection process (taking into account VIF, R^2, and p-values)
finalBestModel_ecoli_LUR2_subsetA 
finalBestModelNames_ecoli_LUR2_subsetA
models[[besti]]$summarybestmodel
models[[besti]]$R2bestmodel

#### B ####
# LUR model building process for subset B
# This is the dataframe with the relevant predictor vars for LUR2 models for subset B (55 sites)
VGOB1_subsetB_ecoli_LUR2 # n.b. this dataframe only includes microbial marker concentrations for ecoli unlike the dataframe Measurements_livestockpreds_LUR2 as previously used for the model building. 

#  Now set the values of some variables that will be needed
nfirstvar_LUR_2 <- 3  
nlastvar_LUR_2 <- 71

# Function building to run the models 
# 1 #  

models<-list()
modeln<-1
models[[modeln]]<-list()

R2<-1
betaaddedvar<-1
addedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetB_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetB_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetB_ecoli_LUR2[,i])                            
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetB_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
models[[modeln]]$results

#  this are the candidates models with the highest R2, not a negative beta for the new, nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)
subset(models[[modeln]]$resultspos)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetB_ecoli_LUR2)[models[[1]]$indexbestmodel])
models[[modeln]]$namesbestmodel

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetB_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetB_ecoli_LUR2[,models[[1]]$indexbestmodel]) 
models[[modeln]]$bestmodel

summary(models[[modeln]]$bestmodel)

#  The first model includes the predictor: nPigMultipFarmWghtDist.3000m.sum.Tr.1P9 - meaning the number of multiplier pig farms weighted to distance in a 3000m buffer

# 2 #  
# Add 2nd variable (the only difference of the above part is that now modeln=2 the model statement has 2 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-2

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetB_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetB_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetB_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetB_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  these are the candidate models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetB_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR2)[models[[2]]$indexbestmodel] )
models[[modeln]]$namesbestmodel

# this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

# this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetB_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~                               VGOB1_subsetB_ecoli_LUR2[,models[[1]]$indexbestmodel]+                           VGOB1_subsetB_ecoli_LUR2[,models[[2]]$indexbestmodel]) 

models[[modeln]]$bestmodel

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel


# 3 #  
# add third variable (the only difference of the above part is that now modeln=3 the model statement has 3 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-3

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetB_ecoli_LUR2[,i])==TRUE){  
    modeltry<-lm(VGOB1_subsetB_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetB_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetB_ecoli_LUR2[,models[[2]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetB_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetB_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR2)[models[[2]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR2)[models[[3]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetB_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetB_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[2]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[3]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel


# 4 #  
#  add forth variable (the only difference of the above part is that now model n=4 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly
modeln<-4

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1


for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetB_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetB_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetB_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetB_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetB_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetB_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    #  the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetB_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetB_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR2)[models[[2]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR2)[models[[4]]$indexbestmodel])

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetB_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetB_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[2]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[4]]$indexbestmodel]) 


models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel


# 5 #  
# add fifth variable (the only difference of the above part is that now modeln=5 the model statement more variables)
# and the call for the list of variable names in the model changed slightly
modeln<-5

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetB_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetB_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetB_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[2]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,i]) 
  
R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetB_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetB_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR2)[models[[2]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR2)[models[[5]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetB_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetB_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetB_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetB_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[5]]$indexbestmodel]) 
models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel

# 6 #  
# add sixth variable (the only difference of the above part is that now model n=6 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-6

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetB_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetB_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetB_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetB_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetB_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetB_ecoli_LUR2[,models[[4]]$indexbestmodel]+VGOB1_subsetB_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(All)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetB_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetB_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetB_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR2)[models[[6]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetB_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetB_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[2]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[6]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel


# 7 #  
# add seventh variable (the only difference of the above part is that now model n=7 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-7

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetB_ecoli_LUR2[,i])==TRUE){
    modeltry<- lm(VGOB1_subsetB_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetB_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[2]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetB_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetB_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetB_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR2)[models[[6]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR2)[models[[7]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetB_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetB_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[2]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[7]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel

# 8 #  
# add eighth variable (the only difference of the above part is that now modeln=7 the model statement more variables)
# and the call for the list of variable names in the model changed slightly

modeln<-8

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetB_ecoli_LUR2[,i])==TRUE){
    modeltry<- lm(VGOB1_subsetB_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetB_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[2]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetB_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetB_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetB_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR2)[models[[6]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR2)[models[[7]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR2)[models[[8]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetB_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetB_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[2]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[8]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel

# 9 #  
# add ninth variable (the only difference of the above part is that now modeln=9 the model statement more variables)
# and the call for the list of variable names in the model changed slightly

modeln<-9

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetB_ecoli_LUR2[,i])==TRUE){
      modeltry<-lm(VGOB1_subsetB_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetB_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[2]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[8]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,i]) 
        R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetB_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetB_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetB_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR2)[models[[6]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR2)[models[[7]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR2)[models[[8]]$indexbestmodel],  names(VGOB1_subsetB_ecoli_LUR2)[models[[9]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetB_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetB_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[2]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[8]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[9]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[9]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[9]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel
models[[9]]$R2bestmodel

# 10 #  
#  add tenth variable (the only difference of the above part is that now model n=10 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-10

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){if (is.numeric(VGOB1_subsetB_ecoli_LUR2[,i])==TRUE){ modeltry<-lm(VGOB1_subsetB_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetB_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[2]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[8]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[9]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,i]) 

R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetB_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetB_ecoli_LUR2)[models[[1]]$indexbestmodel],    names(VGOB1_subsetB_ecoli_LUR2)[models[[2]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR2)[models[[6]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR2)[models[[7]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR2)[models[[8]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR2)[models[[9]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR2)[models[[10]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetB_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~        VGOB1_subsetB_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[2]]$indexbestmodel]+  VGOB1_subsetB_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[8]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[9]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR2[,models[[10]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[9]]$summarybestmodel
models[[10]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[9]]$namesbestmodel
models[[10]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel
models[[9]]$R2bestmodel
models[[10]]$R2bestmodel

#   CODE FOR PICKING OUT THE BEST MODEL #   
temp <- 0
besti <- 0
for (i in 1:10){ #  think this runs the loop 10 times - not fully sure thought - but not to do with the number of models I don't think - as when I change to 3, I still get the model with 4 variables as best model
  print(models[[i]]$R2bestmodel)
  #       print(models[[i]]$summarybestmodel$coefficients=-1,4])
  #       if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
  #         temp <- models[[i]]$R2bestmodel
  #         besti <- i
  #         }
  if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
    temp <- models[[i]]$R2bestmodel
    besti <- i
  }else{
    finalBestModel_ecoli_LUR2_subsetB <- models[[besti]]$bestmodel
    finalBestModelNames_ecoli_LUR2_subsetB <- models[[besti]]$namesbestmodel
    Sites <- 1:dim(VGOB1_subsetB_ecoli_LUR2)[1] # full original model
    #  CVaR2<-escCV_ecoli_LUR2(Sites)[2] # Cross Validation
    maxCD<-max(cooks.distance(finalBestModel_ecoli_LUR2_subsetB))
    if(length(finalBestModelNames_ecoli_LUR2_subsetB)<2){ # vif fn doesnot work when only 1 variable...       # 
      maxVIF<-"NA"
    }else{
      maxVIF<-max(vif(finalBestModel_ecoli_LUR2_subsetB))
    }
    print(paste("This is the best ecoli model for subset B of 10-fold CV: ",besti,
                "(AdjR2: ",format(models[[besti]]$R2bestmodel,digits=3), "; MaxCD: ",format(maxCD,digits=3),"; MaxVIF: ",
                format(maxVIF,digits=3),")", sep=''))
    print(finalBestModelNames_ecoli_LUR2_subsetB)
    break
  }
}

#  Overview of the final best model using the algorithm selection process (taking into account VIF, R^2, and p-values)
finalBestModel_ecoli_LUR2_subsetB 
finalBestModelNames_ecoli_LUR2_subsetB 
models[[besti]]$summarybestmodel
models[[besti]]$R2bestmodel

#### C ####
# LUR model building process for subset C
#  This is the dataframe with the relevant predictor vars for LUR2 models for subset C (55 sites)
VGOB1_subsetC_ecoli_LUR2 # n.b. this dataframe only includes microbial marker concentrations for ecoli unlike the dataframe Measurements_livestockpreds_LUR2 as previously used for the model building. 

#  Now set the values of some variables that will be needed
nfirstvar_LUR_2 <- 3  
nlastvar_LUR_2 <- 71

# Function building to run the models 
# 1 #  

models<-list()
modeln<-1
models[[modeln]]<-list()

R2<-1
betaaddedvar<-1
addedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetC_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetC_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetC_ecoli_LUR2[,i])                            
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetC_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
models[[modeln]]$results

#  this are the candidates models with the highest R2, not a negative beta for the new, nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)
subset(models[[modeln]]$resultspos)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetC_ecoli_LUR2)[models[[1]]$indexbestmodel])
models[[modeln]]$namesbestmodel

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetC_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetC_ecoli_LUR2[,models[[1]]$indexbestmodel]) 
models[[modeln]]$bestmodel

summary(models[[modeln]]$bestmodel)

#  The first model includes the predictor: nPigMultipFarmWghtDist.3000m.sum.Tr.1P9 - meaning the number of multiplier pig farms weighted to distance in a 3000m buffer

# 2 #  
# Add 2nd variable (the only difference of the above part is that now modeln=2 the model statement has 2 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-2

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetC_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetC_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetC_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetC_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  these are the candidate models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetC_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR2)[models[[2]]$indexbestmodel] )
models[[modeln]]$namesbestmodel

# this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

# this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetC_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~                               VGOB1_subsetC_ecoli_LUR2[,models[[1]]$indexbestmodel]+                           VGOB1_subsetC_ecoli_LUR2[,models[[2]]$indexbestmodel]) 

models[[modeln]]$bestmodel

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel


# 3 #  
# add third variable (the only difference of the above part is that now modeln=3 the model statement has 3 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-3

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetC_ecoli_LUR2[,i])==TRUE){  
    modeltry<-lm(VGOB1_subsetC_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetC_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR2[,models[[2]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetC_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetC_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR2)[models[[2]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR2)[models[[3]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetC_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetC_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,models[[2]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,models[[3]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel


# 4 #  
#  add forth variable (the only difference of the above part is that now model n=4 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly
modeln<-4

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1


for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetC_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetC_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetC_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    #  the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetC_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetC_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR2)[models[[2]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR2)[models[[4]]$indexbestmodel])

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetC_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetC_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,models[[4]]$indexbestmodel]) 


models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel


# 5 #  
# add fifth variable (the only difference of the above part is that now modeln=5 the model statement more variables)
# and the call for the list of variable names in the model changed slightly
modeln<-5

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetC_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetC_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetC_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,models[[2]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,i]) 
  
R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetC_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetC_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR2)[models[[2]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR2)[models[[5]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetC_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetC_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,models[[5]]$indexbestmodel]) 
models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel

# 6 #  
# add sixth variable (the only difference of the above part is that now model n=6 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-6

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetC_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetC_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetC_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR2[,models[[4]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(All)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetC_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetC_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetC_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR2)[models[[6]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetC_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetC_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,models[[6]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel


# 7 #  
# add seventh variable (the only difference of the above part is that now model n=7 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-7

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetC_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetC_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetC_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR2[,models[[4]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR2[,models[[5]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetC_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetC_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetC_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR2)[models[[6]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR2)[models[[7]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetC_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetC_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,models[[7]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel

# 8 #  
# add eighth variable (the only difference of the above part is that now modeln=7 the model statement more variables)
# and the call for the list of variable names in the model changed slightly

modeln<-8

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetC_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetC_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetC_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR2[,models[[4]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR2[,models[[5]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetC_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetC_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetC_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR2)[models[[6]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR2)[models[[7]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR2)[models[[8]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetC_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetC_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,models[[8]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel

# 9 #  
# add ninth variable (the only difference of the above part is that now modeln=9 the model statement more variables)
# and the call for the list of variable names in the model changed slightly

modeln<-9

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetC_ecoli_LUR2[,i])==TRUE){
      modeltry<-lm(VGOB1_subsetC_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetC_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR2[,models[[4]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR2[,models[[5]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,models[[8]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,i]) 
        R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetC_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetC_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetC_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR2)[models[[6]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR2)[models[[7]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR2)[models[[8]]$indexbestmodel],  names(VGOB1_subsetC_ecoli_LUR2)[models[[9]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetC_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetC_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,models[[8]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,models[[9]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[9]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[9]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel
models[[9]]$R2bestmodel

# 10 #  
#  add tenth variable (the only difference of the above part is that now model n=10 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-10

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){if (is.numeric(VGOB1_subsetC_ecoli_LUR2[,i])==TRUE){ modeltry<-lm(VGOB1_subsetC_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetC_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR2[,models[[2]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,models[[8]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,models[[9]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,i]) 

R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetC_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c( names(VGOB1_subsetC_ecoli_LUR2)[models[[1]]$indexbestmodel],                   names(VGOB1_subsetC_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetC_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR2)[models[[6]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR2)[models[[7]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR2)[models[[8]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR2)[models[[9]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR2)[models[[10]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetC_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~                                VGOB1_subsetC_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,models[[2]]$indexbestmodel]+                           VGOB1_subsetC_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,models[[8]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,models[[9]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR2[,models[[10]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[9]]$summarybestmodel
models[[10]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[9]]$namesbestmodel
models[[10]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel
models[[9]]$R2bestmodel
models[[10]]$R2bestmodel

#  at this point I always check whether the next model is more than 1% better than the one before and if not I end here

#   CODE FOR PICKING OUT THE BEST MODEL #   
temp <- 0
besti <- 0
for (i in 1:10){ #  think this runs the loop 10 times - not fully sure thought - but not to do with the number of models I don't think - as when I change to 3, I still get the model with 4 variables as best model
  print(models[[i]]$R2bestmodel)
  #       print(models[[i]]$summarybestmodel$coefficients=-1,4])
  #       if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
  #         temp <- models[[i]]$R2bestmodel
  #         besti <- i
  #         }
  if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
    temp <- models[[i]]$R2bestmodel
    besti <- i
  }else{
    finalBestModel_ecoli_LUR2_subsetC <- models[[besti]]$bestmodel
    finalBestModelNames_ecoli_LUR2_subsetC <- models[[besti]]$namesbestmodel
    Sites <- 1:dim(VGOB1_subsetC_ecoli_LUR2)[1] # full original model
    #  CVaR2<-escCV_ecoli_LUR2(Sites)[2] # Cross Validation
    maxCD<-max(cooks.distance(finalBestModel_ecoli_LUR2_subsetC))
    if(length(finalBestModelNames_ecoli_LUR2_subsetC)<2){ # vif fn doesnot work when only 1 variable...       # 
      maxVIF<-"NA"
    }else{
      maxVIF<-max(vif(finalBestModel_ecoli_LUR2_subsetC))
    }
    print(paste("This is the best ecoli model for subset C: ",besti,
                "(AdjR2: ",format(models[[besti]]$R2bestmodel,digits=3), "; MaxCD: ",format(maxCD,digits=3),"; MaxVIF: ",
                format(maxVIF,digits=3),")", sep=''))
    print(finalBestModelNames_ecoli_LUR2_subsetC)
    break
  }
}

#  Overview of the final best model using the algorithm selection process (taking into account VIF, R^2, and p-values)
finalBestModel_ecoli_LUR2_subsetC
finalBestModelNames_ecoli_LUR2_subsetC
models[[besti]]$summarybestmodel
models[[besti]]$R2bestmodel

#### D ####
# LUR model building process for subset D
#  This is the dataframe with the relevant predictor vars for LUR2 models for subset D (55 sites)
VGOB1_subsetD_ecoli_LUR2 # n.b. this dataframe only includes microbial marker concentrations for ecoli unlike the dataframe Measurements_livestockpreds_LUR2 as previously used for the model building. 

#  Now set the values of some variables that will be needed
nfirstvar_LUR_2 <- 3  
nlastvar_LUR_2 <- 71

# Function building to run the models 
# 1 #  

models<-list()
modeln<-1
models[[modeln]]<-list()

R2<-1
betaaddedvar<-1
addedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetD_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetD_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetD_ecoli_LUR2[,i])                            
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetD_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
models[[modeln]]$results

#  this are the candidates models with the highest R2, not a negative beta for the new, nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)
subset(models[[modeln]]$resultspos)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetD_ecoli_LUR2)[models[[1]]$indexbestmodel])
models[[modeln]]$namesbestmodel

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetD_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetD_ecoli_LUR2[,models[[1]]$indexbestmodel]) 
models[[modeln]]$bestmodel

summary(models[[modeln]]$bestmodel)

#  The first model includes the predictor: nPigMultipFarmWghtDist.3000m.sum.Tr.1P9 - meaning the number of multiplier pig farms weighted to distance in a 3000m buffer

# 2 #  
# Add 2nd variable (the only difference of the above part is that now modeln=2 the model statement has 2 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-2

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetD_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetD_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetD_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetD_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  these are the candidate models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetD_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR2)[models[[2]]$indexbestmodel] )
models[[modeln]]$namesbestmodel

# this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

# this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetD_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~                               VGOB1_subsetD_ecoli_LUR2[,models[[1]]$indexbestmodel]+                           VGOB1_subsetD_ecoli_LUR2[,models[[2]]$indexbestmodel]) 

models[[modeln]]$bestmodel

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel


# 3 #  
# add third variable (the only difference of the above part is that now modeln=3 the model statement has 3 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-3

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetD_ecoli_LUR2[,i])==TRUE){  
    modeltry<-lm(VGOB1_subsetD_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetD_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR2[,models[[2]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetD_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetD_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR2)[models[[2]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR2)[models[[3]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetD_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetD_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,models[[2]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,models[[3]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel


# 4 #  
#  add forth variable (the only difference of the above part is that now model n=4 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly
modeln<-4

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1


for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetD_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetD_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetD_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    #  the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetD_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetD_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR2)[models[[2]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR2)[models[[4]]$indexbestmodel])

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetD_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetD_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,models[[4]]$indexbestmodel]) 


models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel


# 5 #  
# add fifth variable (the only difference of the above part is that now modeln=5 the model statement more variables)
# and the call for the list of variable names in the model changed slightly
modeln<-5

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetD_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetD_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetD_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,models[[2]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,i]) 
  
R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetD_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetD_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR2)[models[[2]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR2)[models[[5]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetD_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetD_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,models[[5]]$indexbestmodel]) 
models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel

# 6 #  
# add sixth variable (the only difference of the above part is that now model n=6 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-6

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetD_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetD_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetD_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR2[,models[[4]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(All)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetD_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetD_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetD_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR2)[models[[6]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetD_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetD_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,models[[6]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel


# 7 #  
# add seventh variable (the only difference of the above part is that now model n=7 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-7

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetD_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetD_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetD_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR2[,models[[4]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR2[,models[[5]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetD_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetD_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetD_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR2)[models[[6]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR2)[models[[7]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetD_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetD_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,models[[7]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel

# 8 #  
# add eighth variable (the only difference of the above part is that now modeln=7 the model statement more variables)
# and the call for the list of variable names in the model changed slightly

modeln<-8

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetD_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetD_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetD_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR2[,models[[4]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR2[,models[[5]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetD_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetD_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetD_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR2)[models[[6]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR2)[models[[7]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR2)[models[[8]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetD_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetD_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,models[[8]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel

# 9 #  
# add ninth variable (the only difference of the above part is that now modeln=9 the model statement more variables)
# and the call for the list of variable names in the model changed slightly

modeln<-9

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetD_ecoli_LUR2[,i])==TRUE){
      modeltry<-lm(VGOB1_subsetD_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetD_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR2[,models[[4]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR2[,models[[5]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,models[[8]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,i]) 
        R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetD_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetD_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetD_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR2)[models[[6]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR2)[models[[7]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR2)[models[[8]]$indexbestmodel],  names(VGOB1_subsetD_ecoli_LUR2)[models[[9]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetD_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetD_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,models[[8]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,models[[9]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[9]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[9]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel
models[[9]]$R2bestmodel

# 10 #  
#  add tenth variable (the only difference of the above part is that now model n=10 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-10

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){if (is.numeric(VGOB1_subsetD_ecoli_LUR2[,i])==TRUE){ modeltry<-lm(VGOB1_subsetD_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetD_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR2[,models[[2]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,models[[8]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,models[[9]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,i]) 

R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetD_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c( names(VGOB1_subsetD_ecoli_LUR2)[models[[1]]$indexbestmodel],                   names(VGOB1_subsetD_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetD_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR2)[models[[6]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR2)[models[[7]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR2)[models[[8]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR2)[models[[9]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR2)[models[[10]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetD_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~                                VGOB1_subsetD_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,models[[2]]$indexbestmodel]+                           VGOB1_subsetD_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,models[[8]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,models[[9]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR2[,models[[10]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[9]]$summarybestmodel
models[[10]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[9]]$namesbestmodel
models[[10]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel
models[[9]]$R2bestmodel
models[[10]]$R2bestmodel

#  at this point I always check whether the next model is more than 1% better than the one before and if not I end here

#   CODE FOR PICKING OUT THE BEST MODEL #   
temp <- 0
besti <- 0
for (i in 1:10){ #  think this runs the loop 10 times - not fully sure thought - but not to do with the number of models I don't think - as when I change to 3, I still get the model with 4 variables as best model
  print(models[[i]]$R2bestmodel)
  #       print(models[[i]]$summarybestmodel$coefficients=-1,4])
  #       if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
  #         temp <- models[[i]]$R2bestmodel
  #         besti <- i
  #         }
  if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
    temp <- models[[i]]$R2bestmodel
    besti <- i
  }else{
    finalBestModel_ecoli_LUR2_subsetD <- models[[besti]]$bestmodel
    finalBestModelNames_ecoli_LUR2_subsetD <- models[[besti]]$namesbestmodel
    Sites <- 1:dim(VGOB1_subsetD_ecoli_LUR2)[1] # full original model
    #  CVaR2<-escCV_ecoli_LUR2(Sites)[2] # Cross Validation
    maxCD<-max(cooks.distance(finalBestModel_ecoli_LUR2_subsetD))
    if(length(finalBestModelNames_ecoli_LUR2_subsetD)<2){ # vif fn doesnot work when only 1 variable...       # 
      maxVIF<-"NA"
    }else{
      maxVIF<-max(vif(finalBestModel_ecoli_LUR2_subsetD))
    }
    print(paste("This is the best ecoli model for subset D: ",besti,
                "(AdjR2: ",format(models[[besti]]$R2bestmodel,digits=3), "; MaxCD: ",format(maxCD,digits=3),"; MaxVIF: ",
                format(maxVIF,digits=3),")", sep=''))
    print(finalBestModelNames_ecoli_LUR2_subsetD)
    break
  }
}

#  Overview of the final best model using the algorithm selection process (taking into account VIF, R^2, and p-values)
finalBestModel_ecoli_LUR2_subsetD
finalBestModelNames_ecoli_LUR2_subsetD
models[[besti]]$summarybestmodel
models[[besti]]$R2bestmodel


#### E ####
# LUR model building process for subset E
#  This is the dataframe with the relevant predictor vars for LUR2 models for subset E (55 sites)
VGOB1_subsetE_ecoli_LUR2 # n.b. this dataframe only includes microbial marker concentrations for ecoli unlike the dataframe Measurements_livestockpreds_LUR2 as previously used for the model building. 

#  Now set the values of some variables that will be needed
nfirstvar_LUR_2 <- 3  
nlastvar_LUR_2 <- 71

# Function building to run the models 
# 1 #  

models<-list()
modeln<-1
models[[modeln]]<-list()

R2<-1
betaaddedvar<-1
addedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetE_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetE_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetE_ecoli_LUR2[,i])                            
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetE_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
models[[modeln]]$results

#  this are the candidates models with the highest R2, not a negative beta for the new, nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)
subset(models[[modeln]]$resultspos)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetE_ecoli_LUR2)[models[[1]]$indexbestmodel])
models[[modeln]]$namesbestmodel

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetE_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetE_ecoli_LUR2[,models[[1]]$indexbestmodel]) 
models[[modeln]]$bestmodel

summary(models[[modeln]]$bestmodel)

#  The first model includes the predictor: nPigMultipFarmWghtDist.3000m.sum.Tr.1P9 - meaning the number of multiplier pig farms weighted to distance in a 3000m buffer

# 2 #  
# Add 2nd variable (the only difference of the above part is that now modeln=2 the model statement has 2 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-2

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetE_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetE_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetE_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetE_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  these are the candidate models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetE_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR2)[models[[2]]$indexbestmodel] )
models[[modeln]]$namesbestmodel

# this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

# this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetE_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~                               VGOB1_subsetE_ecoli_LUR2[,models[[1]]$indexbestmodel]+                           VGOB1_subsetE_ecoli_LUR2[,models[[2]]$indexbestmodel]) 

models[[modeln]]$bestmodel

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel


# 3 #  
# add third variable (the only difference of the above part is that now modeln=3 the model statement has 3 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-3

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetE_ecoli_LUR2[,i])==TRUE){  
    modeltry<-lm(VGOB1_subsetE_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetE_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR2[,models[[2]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetE_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetE_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR2)[models[[2]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR2)[models[[3]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetE_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetE_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,models[[2]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,models[[3]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel


# 4 #  
#  add forth variable (the only difference of the above part is that now model n=4 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly
modeln<-4

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1


for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetE_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetE_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetE_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    #  the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetE_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetE_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR2)[models[[2]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR2)[models[[4]]$indexbestmodel])

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetE_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetE_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,models[[4]]$indexbestmodel]) 


models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel


# 5 #  
# add fifth variable (the only difference of the above part is that now modeln=5 the model statement more variables)
# and the call for the list of variable names in the model changed slightly
modeln<-5

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetE_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetE_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetE_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,models[[2]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,i]) 
  
R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetE_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetE_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR2)[models[[2]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR2)[models[[5]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetE_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetE_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,models[[5]]$indexbestmodel]) 
models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel

# 6 #  
# add sixth variable (the only difference of the above part is that now model n=6 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-6

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetE_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetE_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetE_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR2[,models[[4]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(All)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetE_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetE_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetE_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR2)[models[[6]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetE_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetE_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,models[[6]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel


# 7 #  
# add seventh variable (the only difference of the above part is that now model n=7 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-7

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetE_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetE_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetE_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR2[,models[[4]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR2[,models[[5]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetE_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetE_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetE_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR2)[models[[6]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR2)[models[[7]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetE_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetE_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,models[[7]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel

# 8 #  
# add eighth variable (the only difference of the above part is that now modeln=7 the model statement more variables)
# and the call for the list of variable names in the model changed slightly

modeln<-8

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetE_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetE_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetE_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR2[,models[[4]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR2[,models[[5]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetE_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetE_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetE_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR2)[models[[6]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR2)[models[[7]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR2)[models[[8]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetE_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetE_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,models[[8]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel

# The next part of the code (n=9-10) does not work
# This is because one of the coefficients included in the model with 6 variables is negative, the code does not allow for this. I can stop here. 

# # 9 #  
# # add ninth variable (the only difference of the above part is that now modeln=9 the model statement more variables)
# # and the call for the list of variable names in the model changed slightly
# 
# modeln<-9
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){
#   if (is.numeric(VGOB1_subsetE_ecoli_LUR2[,i])==TRUE){
#       modeltry<-lm(VGOB1_subsetE_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetE_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR2[,models[[4]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR2[,models[[5]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,models[[8]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,i]) 
#         R2<-rbind(R2,summary(modeltry)$adj.r.squared)
#     # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetE_ecoli_LUR2)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# # this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# # here are the names
# models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetE_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetE_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR2)[models[[6]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR2)[models[[7]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR2)[models[[8]]$indexbestmodel],  names(VGOB1_subsetE_ecoli_LUR2)[models[[9]]$indexbestmodel])
# 
# #  this is the r2 or that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetE_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetE_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,models[[8]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,models[[9]]$indexbestmodel]) 
# 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[5]]$summarybestmodel
# models[[6]]$summarybestmodel
# models[[7]]$summarybestmodel
# models[[8]]$summarybestmodel
# models[[9]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[5]]$namesbestmodel
# models[[6]]$namesbestmodel
# models[[7]]$namesbestmodel
# models[[8]]$namesbestmodel
# models[[9]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# models[[5]]$R2bestmodel
# models[[6]]$R2bestmodel
# models[[7]]$R2bestmodel
# models[[8]]$R2bestmodel
# models[[9]]$R2bestmodel
# 
# # 10 #  
# #  add tenth variable (the only difference of the above part is that now model n=10 the model statement more variables)
# #  and the call for the list of variable names in the model changed slightly
# 
# modeln<-10
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){if (is.numeric(VGOB1_subsetE_ecoli_LUR2[,i])==TRUE){ modeltry<-lm(VGOB1_subsetE_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetE_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR2[,models[[2]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,models[[8]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,models[[9]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,i]) 
# 
# R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetE_ecoli_LUR2)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# # this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# # here are the names
# models[[modeln]]$namesbestmodel<-c( names(VGOB1_subsetE_ecoli_LUR2)[models[[1]]$indexbestmodel],                   names(VGOB1_subsetE_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetE_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR2)[models[[6]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR2)[models[[7]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR2)[models[[8]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR2)[models[[9]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR2)[models[[10]]$indexbestmodel])
# 
# #  this is the r2 or that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetE_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~                                VGOB1_subsetE_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,models[[2]]$indexbestmodel]+                           VGOB1_subsetE_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,models[[8]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,models[[9]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR2[,models[[10]]$indexbestmodel]) 
# 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[5]]$summarybestmodel
# models[[6]]$summarybestmodel
# models[[7]]$summarybestmodel
# models[[8]]$summarybestmodel
# models[[9]]$summarybestmodel
# models[[10]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[5]]$namesbestmodel
# models[[6]]$namesbestmodel
# models[[7]]$namesbestmodel
# models[[8]]$namesbestmodel
# models[[9]]$namesbestmodel
# models[[10]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# models[[5]]$R2bestmodel
# models[[6]]$R2bestmodel
# models[[7]]$R2bestmodel
# models[[8]]$R2bestmodel
# models[[9]]$R2bestmodel
# models[[10]]$R2bestmodel

#   CODE FOR PICKING OUT THE BEST MODEL #   
temp <- 0
besti <- 0
for (i in 1:10){ #  think this runs the loop 10 times - not fully sure thought - but not to do with the number of models I don't think - as when I change to 3, I still get the model with 4 variables as best model
  print(models[[i]]$R2bestmodel)
  #       print(models[[i]]$summarybestmodel$coefficients=-1,4])
  #       if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
  #         temp <- models[[i]]$R2bestmodel
  #         besti <- i
  #         }
  if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
    temp <- models[[i]]$R2bestmodel
    besti <- i
  }else{
    finalBestModel_ecoli_LUR2_subsetE <- models[[besti]]$bestmodel
    finalBestModelNames_ecoli_LUR2_subsetE <- models[[besti]]$namesbestmodel
    Sites <- 1:dim(VGOB1_subsetE_ecoli_LUR2)[1] # full original model
    #  CVaR2<-escCV_ecoli_LUR2(Sites)[2] # Cross Validation
    maxCD<-max(cooks.distance(finalBestModel_ecoli_LUR2_subsetE))
    if(length(finalBestModelNames_ecoli_LUR2_subsetE)<2){ # vif fn doesnot work when only 1 variable...       # 
      maxVIF<-"NA"
    }else{
      maxVIF<-max(vif(finalBestModel_ecoli_LUR2_subsetE))
    }
    print(paste("This is the best ecoli model for subset E: ",besti,
                "(AdjR2: ",format(models[[besti]]$R2bestmodel,digits=3), "; MaxCD: ",format(maxCD,digits=3),"; MaxVIF: ",
                format(maxVIF,digits=3),")", sep=''))
    print(finalBestModelNames_ecoli_LUR2_subsetE)
    break
  }
}

#  Overview of the final best model using the algorithm selection process (taking into account VIF, R^2, and p-values)
finalBestModel_ecoli_LUR2_subsetE
finalBestModelNames_ecoli_LUR2_subsetE
models[[besti]]$summarybestmodel
models[[besti]]$R2bestmodel

#### F ####
# LUR model building process for subset F
#  This is the dataframe with the relevant predictor vars for LUR2 models for subset F (55 sites)
VGOB1_subsetF_ecoli_LUR2 # n.b. this dataframe only includes microbial marker concentrations for ecoli unlike the dataframe Measurements_livestockpreds_LUR2 as previously used for the model building. 

#  Now set the values of some variables that will be needed
nfirstvar_LUR_2 <- 3  
nlastvar_LUR_2 <- 71

# Function building to run the models 
# 1 #  

models<-list()
modeln<-1
models[[modeln]]<-list()

R2<-1
betaaddedvar<-1
addedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetF_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetF_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetF_ecoli_LUR2[,i])                            
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetF_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
models[[modeln]]$results

#  this are the candidates models with the highest R2, not a negative beta for the new, nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)
subset(models[[modeln]]$resultspos)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetF_ecoli_LUR2)[models[[1]]$indexbestmodel])
models[[modeln]]$namesbestmodel

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetF_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetF_ecoli_LUR2[,models[[1]]$indexbestmodel]) 
models[[modeln]]$bestmodel

summary(models[[modeln]]$bestmodel)

#  The first model includes the predictor: nPigMultipFarmWghtDist.3000m.sum.Tr.1P9 - meaning the number of multiplier pig farms weighted to distance in a 3000m buffer

# 2 #  
# Add 2nd variable (the only difference of the above part is that now modeln=2 the model statement has 2 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-2

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetF_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetF_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetF_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetF_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  these are the candidate models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetF_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR2)[models[[2]]$indexbestmodel] )
models[[modeln]]$namesbestmodel

# this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

# this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetF_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~                               VGOB1_subsetF_ecoli_LUR2[,models[[1]]$indexbestmodel]+                           VGOB1_subsetF_ecoli_LUR2[,models[[2]]$indexbestmodel]) 

models[[modeln]]$bestmodel

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel


# 3 #  
# add third variable (the only difference of the above part is that now modeln=3 the model statement has 3 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-3

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetF_ecoli_LUR2[,i])==TRUE){  
    modeltry<-lm(VGOB1_subsetF_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetF_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR2[,models[[2]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetF_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetF_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR2)[models[[2]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR2)[models[[3]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetF_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetF_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,models[[2]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,models[[3]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel


# 4 #  
#  add forth variable (the only difference of the above part is that now model n=4 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly
modeln<-4

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1


for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetF_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetF_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetF_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    #  the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetF_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetF_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR2)[models[[2]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR2)[models[[4]]$indexbestmodel])

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetF_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetF_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,models[[4]]$indexbestmodel]) 


models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel


# 5 #  
# add fifth variable (the only difference of the above part is that now modeln=5 the model statement more variables)
# and the call for the list of variable names in the model changed slightly
modeln<-5

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetF_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetF_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetF_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,models[[2]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,i]) 
  
R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetF_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetF_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR2)[models[[2]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR2)[models[[5]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetF_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetF_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,models[[5]]$indexbestmodel]) 
models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel

# 6 #  
# add sixth variable (the only difference of the above part is that now model n=6 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-6

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetF_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetF_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetF_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR2[,models[[4]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(All)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetF_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetF_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetF_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR2)[models[[6]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetF_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetF_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,models[[6]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel


# 7 #  
# add seventh variable (the only difference of the above part is that now model n=7 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-7

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetF_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetF_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetF_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR2[,models[[4]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR2[,models[[5]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetF_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetF_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetF_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR2)[models[[6]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR2)[models[[7]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetF_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetF_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,models[[7]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel

# 8 #  
# add eighth variable (the only difference of the above part is that now modeln=7 the model statement more variables)
# and the call for the list of variable names in the model changed slightly

modeln<-8

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetF_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetF_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetF_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR2[,models[[4]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR2[,models[[5]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetF_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetF_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetF_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR2)[models[[6]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR2)[models[[7]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR2)[models[[8]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetF_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetF_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,models[[8]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel

# 9 #  
# add ninth variable (the only difference of the above part is that now modeln=9 the model statement more variables)
# and the call for the list of variable names in the model changed slightly

modeln<-9

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetF_ecoli_LUR2[,i])==TRUE){
      modeltry<-lm(VGOB1_subsetF_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetF_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR2[,models[[4]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR2[,models[[5]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,models[[8]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,i]) 
        R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetF_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetF_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetF_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR2)[models[[6]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR2)[models[[7]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR2)[models[[8]]$indexbestmodel],  names(VGOB1_subsetF_ecoli_LUR2)[models[[9]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetF_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetF_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,models[[8]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,models[[9]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[9]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[9]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel
models[[9]]$R2bestmodel

# The next part of the code (n=10) does not work
# This is because one of the coefficients included in the model with 6 variables is negative, the code does not allow for this. I can stop here. 

# # 10 #  
# #  add tenth variable (the only difference of the above part is that now model n=10 the model statement more variables)
# #  and the call for the list of variable names in the model changed slightly
# 
# modeln<-10
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){if (is.numeric(VGOB1_subsetF_ecoli_LUR2[,i])==TRUE){ modeltry<-lm(VGOB1_subsetF_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetF_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR2[,models[[2]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,models[[8]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,models[[9]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,i]) 
# 
# R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetF_ecoli_LUR2)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# # this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# # here are the names
# models[[modeln]]$namesbestmodel<-c( names(VGOB1_subsetF_ecoli_LUR2)[models[[1]]$indexbestmodel],                   names(VGOB1_subsetF_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetF_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR2)[models[[6]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR2)[models[[7]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR2)[models[[8]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR2)[models[[9]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR2)[models[[10]]$indexbestmodel])
# 
# #  this is the r2 or that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetF_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~                                VGOB1_subsetF_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,models[[2]]$indexbestmodel]+                           VGOB1_subsetF_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,models[[8]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,models[[9]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR2[,models[[10]]$indexbestmodel]) 
# 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[5]]$summarybestmodel
# models[[6]]$summarybestmodel
# models[[7]]$summarybestmodel
# models[[8]]$summarybestmodel
# models[[9]]$summarybestmodel
# models[[10]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[5]]$namesbestmodel
# models[[6]]$namesbestmodel
# models[[7]]$namesbestmodel
# models[[8]]$namesbestmodel
# models[[9]]$namesbestmodel
# models[[10]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# models[[5]]$R2bestmodel
# models[[6]]$R2bestmodel
# models[[7]]$R2bestmodel
# models[[8]]$R2bestmodel
# models[[9]]$R2bestmodel
# models[[10]]$R2bestmodel

#   CODE FOR PICKING OUT THE BEST MODEL #   
temp <- 0
besti <- 0
for (i in 1:10){ #  think this runs the loop 10 times - not fully sure thought - but not to do with the number of models I don't think - as when I change to 3, I still get the model with 4 variables as best model
  print(models[[i]]$R2bestmodel)
  #       print(models[[i]]$summarybestmodel$coefficients=-1,4])
  #       if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
  #         temp <- models[[i]]$R2bestmodel
  #         besti <- i
  #         }
  if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
    temp <- models[[i]]$R2bestmodel
    besti <- i
  }else{
    finalBestModel_ecoli_LUR2_subsetF <- models[[besti]]$bestmodel
    finalBestModelNames_ecoli_LUR2_subsetF <- models[[besti]]$namesbestmodel
    Sites <- 1:dim(VGOB1_subsetF_ecoli_LUR2)[1] # full original model
    #  CVaR2<-escCV_ecoli_LUR2(Sites)[2] # Cross Validation
    maxCD<-max(cooks.distance(finalBestModel_ecoli_LUR2_subsetF))
    if(length(finalBestModelNames_ecoli_LUR2_subsetF)<2){ # vif fn doesnot work when only 1 variable...       # 
      maxVIF<-"NA"
    }else{
      maxVIF<-max(vif(finalBestModel_ecoli_LUR2_subsetF))
    }
    print(paste("This is the best ecoli model for subset F: ",besti,
                "(AdjR2: ",format(models[[besti]]$R2bestmodel,digits=3), "; MaxCD: ",format(maxCD,digits=3),"; MaxVIF: ",
                format(maxVIF,digits=3),")", sep=''))
    print(finalBestModelNames_ecoli_LUR2_subsetF)
    break
  }
}

#  Overview of the final best model using the algorithm selection process (taking into account VIF, R^2, and p-values)
finalBestModel_ecoli_LUR2_subsetF
finalBestModelNames_ecoli_LUR2_subsetF
models[[besti]]$summarybestmodel
models[[besti]]$R2bestmodel

#### G ####
# LUR model building process for subset G
#  This is the dataframe with the relevant predictor vars for LUR2 models for subset G (55 sites)
VGOB1_subsetG_ecoli_LUR2 # n.b. this dataframe only includes microbial marker concentrations for ecoli unlike the dataframe Measurements_livestockpreds_LUR2 as previously used for the model building. 

#  Now set the values of some variables that will be needed
nfirstvar_LUR_2 <- 3  
nlastvar_LUR_2 <- 71

# Function building to run the models 
# 1 #  

models<-list()
modeln<-1
models[[modeln]]<-list()

R2<-1
betaaddedvar<-1
addedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetG_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetG_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetG_ecoli_LUR2[,i])                            
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetG_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
models[[modeln]]$results

#  this are the candidates models with the highest R2, not a negative beta for the new, nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)
subset(models[[modeln]]$resultspos)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetG_ecoli_LUR2)[models[[1]]$indexbestmodel])
models[[modeln]]$namesbestmodel

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetG_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetG_ecoli_LUR2[,models[[1]]$indexbestmodel]) 
models[[modeln]]$bestmodel

summary(models[[modeln]]$bestmodel)

#  The first model includes the predictor: nPigMultipFarmWghtDist.3000m.sum.Tr.1P9 - meaning the number of multiplier pig farms weighted to distance in a 3000m buffer

# 2 #  
# Add 2nd variable (the only difference of the above part is that now modeln=2 the model statement has 2 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-2

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetG_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetG_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetG_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetG_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  these are the candidate models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetG_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR2)[models[[2]]$indexbestmodel] )
models[[modeln]]$namesbestmodel

# this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

# this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetG_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~                               VGOB1_subsetG_ecoli_LUR2[,models[[1]]$indexbestmodel]+                           VGOB1_subsetG_ecoli_LUR2[,models[[2]]$indexbestmodel]) 

models[[modeln]]$bestmodel

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel


# 3 #  
# add third variable (the only difference of the above part is that now modeln=3 the model statement has 3 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-3

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetG_ecoli_LUR2[,i])==TRUE){  
    modeltry<-lm(VGOB1_subsetG_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetG_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR2[,models[[2]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetG_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetG_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR2)[models[[2]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR2)[models[[3]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetG_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetG_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,models[[2]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,models[[3]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel


# 4 #  
#  add forth variable (the only difference of the above part is that now model n=4 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly
modeln<-4

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1


for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetG_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetG_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetG_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    #  the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetG_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetG_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR2)[models[[2]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR2)[models[[4]]$indexbestmodel])

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetG_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetG_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,models[[4]]$indexbestmodel]) 


models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel


# 5 #  
# add fifth variable (the only difference of the above part is that now modeln=5 the model statement more variables)
# and the call for the list of variable names in the model changed slightly
modeln<-5

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetG_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetG_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetG_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,models[[2]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,i]) 
  
R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetG_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetG_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR2)[models[[2]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR2)[models[[5]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetG_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetG_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,models[[5]]$indexbestmodel]) 
models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel

# 6 #  
# add sixth variable (the only difference of the above part is that now model n=6 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-6

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetG_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetG_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetG_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR2[,models[[4]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(All)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetG_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetG_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetG_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR2)[models[[6]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetG_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetG_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,models[[6]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel


# 7 #  
# add seventh variable (the only difference of the above part is that now model n=7 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-7

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetG_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetG_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetG_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR2[,models[[4]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR2[,models[[5]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetG_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetG_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetG_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR2)[models[[6]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR2)[models[[7]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetG_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetG_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,models[[7]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel

# 8 #  
# add eighth variable (the only difference of the above part is that now modeln=7 the model statement more variables)
# and the call for the list of variable names in the model changed slightly

modeln<-8

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetG_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetG_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetG_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR2[,models[[4]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR2[,models[[5]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetG_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetG_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetG_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR2)[models[[6]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR2)[models[[7]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR2)[models[[8]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetG_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetG_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,models[[8]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel

# The next part of the code (n=9-10) does not work
# This is because one of the coefficients included in the model with 6 variables is negative, the code does not allow for this. I can stop here. 
# 
# # 9 #  
# # add ninth variable (the only difference of the above part is that now modeln=9 the model statement more variables)
# # and the call for the list of variable names in the model changed slightly
# 
# modeln<-9
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){
#   if (is.numeric(VGOB1_subsetG_ecoli_LUR2[,i])==TRUE){
#       modeltry<-lm(VGOB1_subsetG_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetG_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR2[,models[[4]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR2[,models[[5]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,models[[8]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,i]) 
#         R2<-rbind(R2,summary(modeltry)$adj.r.squared)
#     # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetG_ecoli_LUR2)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# # this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# # here are the names
# models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetG_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetG_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR2)[models[[6]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR2)[models[[7]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR2)[models[[8]]$indexbestmodel],  names(VGOB1_subsetG_ecoli_LUR2)[models[[9]]$indexbestmodel])
# 
# #  this is the r2 or that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetG_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetG_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,models[[8]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,models[[9]]$indexbestmodel]) 
# 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[5]]$summarybestmodel
# models[[6]]$summarybestmodel
# models[[7]]$summarybestmodel
# models[[8]]$summarybestmodel
# models[[9]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[5]]$namesbestmodel
# models[[6]]$namesbestmodel
# models[[7]]$namesbestmodel
# models[[8]]$namesbestmodel
# models[[9]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# models[[5]]$R2bestmodel
# models[[6]]$R2bestmodel
# models[[7]]$R2bestmodel
# models[[8]]$R2bestmodel
# models[[9]]$R2bestmodel
# 
# # 10 #  
# #  add tenth variable (the only difference of the above part is that now model n=10 the model statement more variables)
# #  and the call for the list of variable names in the model changed slightly
# 
# modeln<-10
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){if (is.numeric(VGOB1_subsetG_ecoli_LUR2[,i])==TRUE){ modeltry<-lm(VGOB1_subsetG_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetG_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR2[,models[[2]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,models[[8]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,models[[9]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,i]) 
# 
# R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetG_ecoli_LUR2)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# # this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# # here are the names
# models[[modeln]]$namesbestmodel<-c( names(VGOB1_subsetG_ecoli_LUR2)[models[[1]]$indexbestmodel],                   names(VGOB1_subsetG_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetG_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR2)[models[[6]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR2)[models[[7]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR2)[models[[8]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR2)[models[[9]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR2)[models[[10]]$indexbestmodel])
# 
# #  this is the r2 or that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetG_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~                                VGOB1_subsetG_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,models[[2]]$indexbestmodel]+                           VGOB1_subsetG_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,models[[8]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,models[[9]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR2[,models[[10]]$indexbestmodel]) 
# 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[5]]$summarybestmodel
# models[[6]]$summarybestmodel
# models[[7]]$summarybestmodel
# models[[8]]$summarybestmodel
# models[[9]]$summarybestmodel
# models[[10]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[5]]$namesbestmodel
# models[[6]]$namesbestmodel
# models[[7]]$namesbestmodel
# models[[8]]$namesbestmodel
# models[[9]]$namesbestmodel
# models[[10]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# models[[5]]$R2bestmodel
# models[[6]]$R2bestmodel
# models[[7]]$R2bestmodel
# models[[8]]$R2bestmodel
# models[[9]]$R2bestmodel
# models[[10]]$R2bestmodel

#   CODE FOR PICKING OUT THE BEST MODEL #   
temp <- 0
besti <- 0
for (i in 1:10){ #  think this runs the loop 10 times - not fully sure thought - but not to do with the number of models I don't think - as when I change to 3, I still get the model with 4 variables as best model
  print(models[[i]]$R2bestmodel)
  #       print(models[[i]]$summarybestmodel$coefficients=-1,4])
  #       if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
  #         temp <- models[[i]]$R2bestmodel
  #         besti <- i
  #         }
  if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
    temp <- models[[i]]$R2bestmodel
    besti <- i
  }else{
    finalBestModel_ecoli_LUR2_subsetG <- models[[besti]]$bestmodel
    finalBestModelNames_ecoli_LUR2_subsetG <- models[[besti]]$namesbestmodel
    Sites <- 1:dim(VGOB1_subsetG_ecoli_LUR2)[1] # full original model
    #  CVaR2<-escCV_ecoli_LUR2(Sites)[2] # Cross Validation
    maxCD<-max(cooks.distance(finalBestModel_ecoli_LUR2_subsetG))
    if(length(finalBestModelNames_ecoli_LUR2_subsetG)<2){ # vif fn doesnot work when only 1 variable...       # 
      maxVIF<-"NA"
    }else{
      maxVIF<-max(vif(finalBestModel_ecoli_LUR2_subsetG))
    }
    print(paste("This is the best ecoli model for subset G: ",besti,
                "(AdjR2: ",format(models[[besti]]$R2bestmodel,digits=3), "; MaxCD: ",format(maxCD,digits=3),"; MaxVIF: ",
                format(maxVIF,digits=3),")", sep=''))
    print(finalBestModelNames_ecoli_LUR2_subsetG)
    break
  }
}

#  Overview of the final best model using the algorithm selection process (taking into account VIF, R^2, and p-values)
finalBestModel_ecoli_LUR2_subsetG
finalBestModelNames_ecoli_LUR2_subsetG
models[[besti]]$summarybestmodel
models[[besti]]$R2bestmodel

#### H ####
# LUR model building process for subset H
#  This is the dataframe with the relevant predictor vars for LUR2 models for subset H (55 sites)
VGOB1_subsetH_ecoli_LUR2 # n.b. this dataframe only includes microbial marker concentrations for ecoli unlike the dataframe Measurements_livestockpreds_LUR2 as previously used for the model building. 

#  Now set the values of some variables that will be needed
nfirstvar_LUR_2 <- 3  
nlastvar_LUR_2 <- 71

# Function building to run the models 
# 1 #  

models<-list()
modeln<-1
models[[modeln]]<-list()

R2<-1
betaaddedvar<-1
addedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetH_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetH_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetH_ecoli_LUR2[,i])                            
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetH_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
models[[modeln]]$results

#  this are the candidates models with the highest R2, not a negative beta for the new, nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)
subset(models[[modeln]]$resultspos)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetH_ecoli_LUR2)[models[[1]]$indexbestmodel])
models[[modeln]]$namesbestmodel

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetH_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetH_ecoli_LUR2[,models[[1]]$indexbestmodel]) 
models[[modeln]]$bestmodel

summary(models[[modeln]]$bestmodel)

#  The first model includes the predictor: nPigMultipFarmWghtDist.3000m.sum.Tr.1P9 - meaning the number of multiplier pig farms weighted to distance in a 3000m buffer

# 2 #  
# Add 2nd variable (the only difference of the above part is that now modeln=2 the model statement has 2 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-2

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetH_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetH_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetH_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetH_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  these are the candidate models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetH_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR2)[models[[2]]$indexbestmodel] )
models[[modeln]]$namesbestmodel

# this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

# this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetH_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~                               VGOB1_subsetH_ecoli_LUR2[,models[[1]]$indexbestmodel]+                           VGOB1_subsetH_ecoli_LUR2[,models[[2]]$indexbestmodel]) 

models[[modeln]]$bestmodel

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel


# 3 #  
# add third variable (the only difference of the above part is that now modeln=3 the model statement has 3 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-3

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetH_ecoli_LUR2[,i])==TRUE){  
    modeltry<-lm(VGOB1_subsetH_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetH_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR2[,models[[2]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetH_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetH_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR2)[models[[2]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR2)[models[[3]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetH_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetH_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,models[[2]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,models[[3]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel


# 4 #  
#  add forth variable (the only difference of the above part is that now model n=4 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly
modeln<-4

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1


for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetH_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetH_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetH_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    #  the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetH_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetH_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR2)[models[[2]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR2)[models[[4]]$indexbestmodel])

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetH_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetH_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,models[[4]]$indexbestmodel]) 


models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel


# 5 #  
# add fifth variable (the only difference of the above part is that now modeln=5 the model statement more variables)
# and the call for the list of variable names in the model changed slightly
modeln<-5

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetH_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetH_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetH_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,models[[2]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,i]) 
  
R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetH_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetH_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR2)[models[[2]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR2)[models[[5]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetH_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetH_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,models[[5]]$indexbestmodel]) 
models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel

# 6 #  
# add sixth variable (the only difference of the above part is that now model n=6 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-6

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetH_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetH_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetH_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR2[,models[[4]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(All)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetH_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetH_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetH_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR2)[models[[6]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetH_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetH_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,models[[6]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel


# 7 #  
# add seventh variable (the only difference of the above part is that now model n=7 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-7

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetH_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetH_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetH_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR2[,models[[4]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR2[,models[[5]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetH_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetH_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetH_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR2)[models[[6]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR2)[models[[7]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetH_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetH_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,models[[7]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel

# 8 #  
# add eighth variable (the only difference of the above part is that now modeln=7 the model statement more variables)
# and the call for the list of variable names in the model changed slightly

modeln<-8

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetH_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetH_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetH_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR2[,models[[4]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR2[,models[[5]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetH_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetH_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetH_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR2)[models[[6]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR2)[models[[7]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR2)[models[[8]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetH_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetH_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,models[[8]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel

# 9 #  
# add ninth variable (the only difference of the above part is that now modeln=9 the model statement more variables)
# and the call for the list of variable names in the model changed slightly

modeln<-9

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetH_ecoli_LUR2[,i])==TRUE){
      modeltry<-lm(VGOB1_subsetH_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetH_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR2[,models[[4]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR2[,models[[5]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,models[[8]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,i]) 
        R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetH_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetH_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetH_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR2)[models[[6]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR2)[models[[7]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR2)[models[[8]]$indexbestmodel],  names(VGOB1_subsetH_ecoli_LUR2)[models[[9]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetH_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetH_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,models[[8]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,models[[9]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[9]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[9]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel
models[[9]]$R2bestmodel

# 10 #  
#  add tenth variable (the only difference of the above part is that now model n=10 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-10

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){if (is.numeric(VGOB1_subsetH_ecoli_LUR2[,i])==TRUE){ modeltry<-lm(VGOB1_subsetH_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetH_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR2[,models[[2]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,models[[8]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,models[[9]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,i]) 

R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetH_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c( names(VGOB1_subsetH_ecoli_LUR2)[models[[1]]$indexbestmodel],                   names(VGOB1_subsetH_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetH_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR2)[models[[6]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR2)[models[[7]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR2)[models[[8]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR2)[models[[9]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR2)[models[[10]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetH_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~                                VGOB1_subsetH_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,models[[2]]$indexbestmodel]+                           VGOB1_subsetH_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,models[[8]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,models[[9]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR2[,models[[10]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[9]]$summarybestmodel
models[[10]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[9]]$namesbestmodel
models[[10]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel
models[[9]]$R2bestmodel
models[[10]]$R2bestmodel

#   CODE FOR PICKING OUT THE BEST MODEL #   
temp <- 0
besti <- 0
for (i in 1:10){ #  think this runs the loop 10 times - not fully sure thought - but not to do with the number of models I don't think - as when I change to 3, I still get the model with 4 variables as best model
  print(models[[i]]$R2bestmodel)
  #       print(models[[i]]$summarybestmodel$coefficients=-1,4])
  #       if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
  #         temp <- models[[i]]$R2bestmodel
  #         besti <- i
  #         }
  if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
    temp <- models[[i]]$R2bestmodel
    besti <- i
  }else{
    finalBestModel_ecoli_LUR2_subsetH <- models[[besti]]$bestmodel
    finalBestModelNames_ecoli_LUR2_subsetH <- models[[besti]]$namesbestmodel
    Sites <- 1:dim(VGOB1_subsetH_ecoli_LUR2)[1] # full original model
    #  CVaR2<-escCV_ecoli_LUR2(Sites)[2] # Cross Validation
    maxCD<-max(cooks.distance(finalBestModel_ecoli_LUR2_subsetH))
    if(length(finalBestModelNames_ecoli_LUR2_subsetH)<2){ # vif fn doesnot work when only 1 variable...       # 
      maxVIF<-"NA"
    }else{
      maxVIF<-max(vif(finalBestModel_ecoli_LUR2_subsetH))
    }
    print(paste("This is the best ecoli model for subset H: ",besti,
                "(AdjR2: ",format(models[[besti]]$R2bestmodel,digits=3), "; MaxCD: ",format(maxCD,digits=3),"; MaxVIF: ",
                format(maxVIF,digits=3),")", sep=''))
    print(finalBestModelNames_ecoli_LUR2_subsetH)
    break
  }
}

#  Overview of the final best model using the algorithm selection process (taking into account VIF, R^2, and p-values)
finalBestModel_ecoli_LUR2_subsetH
finalBestModelNames_ecoli_LUR2_subsetH
models[[besti]]$summarybestmodel
models[[besti]]$R2bestmodel


#### I ####
# LUR model building process for subset I
#  This is the dataframe with the relevant predictor vars for LUR2 models for subset I (55 sites)
VGOB1_subsetI_ecoli_LUR2 # n.b. this dataframe only includes microbial marker concentrations for ecoli unlike the dataframe Measurements_livestockpreds_LUR2 as previously used for the model building. 

#  Now set the values of some variables that will be needed
nfirstvar_LUR_2 <- 3  
nlastvar_LUR_2 <- 71

# Function building to run the models 
# 1 #  

models<-list()
modeln<-1
models[[modeln]]<-list()

R2<-1
betaaddedvar<-1
addedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetI_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetI_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetI_ecoli_LUR2[,i])                            
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetI_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
models[[modeln]]$results

#  this are the candidates models with the highest R2, not a negative beta for the new, nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)
subset(models[[modeln]]$resultspos)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetI_ecoli_LUR2)[models[[1]]$indexbestmodel])
models[[modeln]]$namesbestmodel

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetI_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetI_ecoli_LUR2[,models[[1]]$indexbestmodel]) 
models[[modeln]]$bestmodel

summary(models[[modeln]]$bestmodel)

#  The first model includes the predictor: nPigMultipFarmWghtDist.3000m.sum.Tr.1P9 - meaning the number of multiplier pig farms weighted to distance in a 3000m buffer

# 2 #  
# Add 2nd variable (the only difference of the above part is that now modeln=2 the model statement has 2 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-2

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetI_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetI_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetI_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetI_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  these are the candidate models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetI_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR2)[models[[2]]$indexbestmodel] )
models[[modeln]]$namesbestmodel

# this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

# this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetI_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~                               VGOB1_subsetI_ecoli_LUR2[,models[[1]]$indexbestmodel]+                           VGOB1_subsetI_ecoli_LUR2[,models[[2]]$indexbestmodel]) 

models[[modeln]]$bestmodel

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel


# 3 #  
# add third variable (the only difference of the above part is that now modeln=3 the model statement has 3 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-3

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetI_ecoli_LUR2[,i])==TRUE){  
    modeltry<-lm(VGOB1_subsetI_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetI_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR2[,models[[2]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetI_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetI_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR2)[models[[2]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR2)[models[[3]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetI_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetI_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,models[[2]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,models[[3]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel


# 4 #  
#  add forth variable (the only difference of the above part is that now model n=4 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly
modeln<-4

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1


for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetI_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetI_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetI_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    #  the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetI_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetI_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR2)[models[[2]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR2)[models[[4]]$indexbestmodel])

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetI_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetI_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,models[[4]]$indexbestmodel]) 


models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel


# 5 #  
# add fifth variable (the only difference of the above part is that now modeln=5 the model statement more variables)
# and the call for the list of variable names in the model changed slightly
modeln<-5

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetI_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetI_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetI_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,models[[2]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,i]) 
  
R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetI_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetI_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR2)[models[[2]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR2)[models[[5]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetI_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetI_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,models[[5]]$indexbestmodel]) 
models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel

# 6 #  
# add sixth variable (the only difference of the above part is that now model n=6 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-6

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetI_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetI_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetI_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR2[,models[[4]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(All)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetI_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetI_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetI_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR2)[models[[6]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetI_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetI_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,models[[6]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel


# 7 #  
# add seventh variable (the only difference of the above part is that now model n=7 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-7

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetI_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetI_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetI_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR2[,models[[4]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR2[,models[[5]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetI_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetI_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetI_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR2)[models[[6]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR2)[models[[7]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetI_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetI_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,models[[7]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel

# 8 #  
# add eighth variable (the only difference of the above part is that now modeln=7 the model statement more variables)
# and the call for the list of variable names in the model changed slightly

modeln<-8

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetI_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetI_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetI_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR2[,models[[4]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR2[,models[[5]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetI_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetI_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetI_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR2)[models[[6]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR2)[models[[7]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR2)[models[[8]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetI_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetI_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,models[[8]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel

# 9 #  
# add ninth variable (the only difference of the above part is that now modeln=9 the model statement more variables)
# and the call for the list of variable names in the model changed slightly

modeln<-9

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetI_ecoli_LUR2[,i])==TRUE){
      modeltry<-lm(VGOB1_subsetI_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetI_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR2[,models[[4]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR2[,models[[5]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,models[[8]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,i]) 
        R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetI_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetI_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetI_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR2)[models[[6]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR2)[models[[7]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR2)[models[[8]]$indexbestmodel],  names(VGOB1_subsetI_ecoli_LUR2)[models[[9]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetI_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetI_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,models[[8]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,models[[9]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[9]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[9]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel
models[[9]]$R2bestmodel

# The next part of the code (n=10) does not work
# This is because one of the coefficients included in the model with 6 variables is negative, the code does not allow for this. I can stop here. 

# # 10 #  
# #  add tenth variable (the only difference of the above part is that now model n=10 the model statement more variables)
# #  and the call for the list of variable names in the model changed slightly
# 
# modeln<-10
# 
# models[[modeln]]<-list()
# 
# R2<-1
# addedvar<-1
# betaaddedvar<-1
# minbetas<-1
# j<-1
# 
# for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){if (is.numeric(VGOB1_subsetI_ecoli_LUR2[,i])==TRUE){ modeltry<-lm(VGOB1_subsetI_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetI_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR2[,models[[2]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,models[[8]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,models[[9]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,i]) 
# 
# R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
#     betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
#     #  find out if there is a negative beta at All. The intercept does not count [-1]!
#     minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
#     # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
#     addedvar<-rbind(addedvar,names(VGOB1_subsetI_ecoli_LUR2)[i])
#     j<-rbind(j, i)
#     models[[modeln]][[i]]<-summary(modeltry)
#   }
# }
# 
# models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
# 
# #  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
# models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
# 
# # rank the R2's of these models
# models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
# 
# #  this is the index of the row with the highest R2 and  no negative betas in this subset
# models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
# 
# subset(models[[modeln]]$resultspos, rank==1)
# 
# # this is the model
# models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
# 
# # here are the names
# models[[modeln]]$namesbestmodel<-c( names(VGOB1_subsetI_ecoli_LUR2)[models[[1]]$indexbestmodel],                   names(VGOB1_subsetI_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetI_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR2)[models[[6]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR2)[models[[7]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR2)[models[[8]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR2)[models[[9]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR2)[models[[10]]$indexbestmodel])
# 
# #  this is the r2 or that model
# models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
# 
# #  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
# models[[modeln]]$bestmodel <- lm(VGOB1_subsetI_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~                                VGOB1_subsetI_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,models[[2]]$indexbestmodel]+                           VGOB1_subsetI_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,models[[8]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,models[[9]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR2[,models[[10]]$indexbestmodel]) 
# 
# models[[1]]$summarybestmodel
# models[[2]]$summarybestmodel
# models[[3]]$summarybestmodel
# models[[4]]$summarybestmodel
# models[[5]]$summarybestmodel
# models[[6]]$summarybestmodel
# models[[7]]$summarybestmodel
# models[[8]]$summarybestmodel
# models[[9]]$summarybestmodel
# models[[10]]$summarybestmodel
# models[[1]]$namesbestmodel
# models[[2]]$namesbestmodel
# models[[3]]$namesbestmodel
# models[[4]]$namesbestmodel
# models[[5]]$namesbestmodel
# models[[6]]$namesbestmodel
# models[[7]]$namesbestmodel
# models[[8]]$namesbestmodel
# models[[9]]$namesbestmodel
# models[[10]]$namesbestmodel
# models[[1]]$R2bestmodel
# models[[2]]$R2bestmodel
# models[[3]]$R2bestmodel
# models[[4]]$R2bestmodel
# models[[5]]$R2bestmodel
# models[[6]]$R2bestmodel
# models[[7]]$R2bestmodel
# models[[8]]$R2bestmodel
# models[[9]]$R2bestmodel
# models[[10]]$R2bestmodel

#   CODE FOR PICKING OUT THE BEST MODEL #   
temp <- 0
besti <- 0
for (i in 1:10){ #  think this runs the loop 10 times - not fully sure thought - but not to do with the number of models I don't think - as when I change to 3, I still get the model with 4 variables as best model
  print(models[[i]]$R2bestmodel)
  #       print(models[[i]]$summarybestmodel$coefficients=-1,4])
  #       if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
  #         temp <- models[[i]]$R2bestmodel
  #         besti <- i
  #         }
  if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
    temp <- models[[i]]$R2bestmodel
    besti <- i
  }else{
    finalBestModel_ecoli_LUR2_subsetI <- models[[besti]]$bestmodel
    finalBestModelNames_ecoli_LUR2_subsetI <- models[[besti]]$namesbestmodel
    Sites <- 1:dim(VGOB1_subsetI_ecoli_LUR2)[1] # full original model
    #  CVaR2<-escCV_ecoli_LUR2(Sites)[2] # Cross Validation
    maxCD<-max(cooks.distance(finalBestModel_ecoli_LUR2_subsetI))
    if(length(finalBestModelNames_ecoli_LUR2_subsetI)<2){ # vif fn doesnot work when only 1 variable...       # 
      maxVIF<-"NA"
    }else{
      maxVIF<-max(vif(finalBestModel_ecoli_LUR2_subsetI))
    }
    print(paste("This is the best ecoli model for subset I: ",besti,
                "(AdjR2: ",format(models[[besti]]$R2bestmodel,digits=3), "; MaxCD: ",format(maxCD,digits=3),"; MaxVIF: ",
                format(maxVIF,digits=3),")", sep=''))
    print(finalBestModelNames_ecoli_LUR2_subsetI)
    break
  }
}

#  Overview of the final best model using the algorithm selection process (taking into account VIF, R^2, and p-values)
finalBestModel_ecoli_LUR2_subsetI
finalBestModelNames_ecoli_LUR2_subsetI
models[[besti]]$summarybestmodel
models[[besti]]$R2bestmodel

#### J ####
# LUR model building process for subset J
#  This is the dataframe with the relevant predictor vars for LUR2 models for subset J (55 sites)
VGOB1_subsetJ_ecoli_LUR2 # n.b. this dataframe only includes microbial marker concentrations for ecoli unlike the dataframe Measurements_livestockpreds_LUR2 as previously used for the model building. 

#  Now set the values of some variables that will be needed
nfirstvar_LUR_2 <- 3  
nlastvar_LUR_2 <- 71

# Function building to run the models 
# 1 #  

models<-list()
modeln<-1
models[[modeln]]<-list()

R2<-1
betaaddedvar<-1
addedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetJ_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetJ_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetJ_ecoli_LUR2[,i])                            
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetJ_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
models[[modeln]]$results

#  this are the candidates models with the highest R2, not a negative beta for the new, nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)
subset(models[[modeln]]$resultspos)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetJ_ecoli_LUR2)[models[[1]]$indexbestmodel])
models[[modeln]]$namesbestmodel

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetJ_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetJ_ecoli_LUR2[,models[[1]]$indexbestmodel]) 
models[[modeln]]$bestmodel

summary(models[[modeln]]$bestmodel)

#  The first model includes the predictor: nPigMultipFarmWghtDist.3000m.sum.Tr.1P9 - meaning the number of multiplier pig farms weighted to distance in a 3000m buffer

# 2 #  
# Add 2nd variable (the only difference of the above part is that now modeln=2 the model statement has 2 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-2

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetJ_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetJ_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetJ_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetJ_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  these are the candidate models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetJ_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR2)[models[[2]]$indexbestmodel] )
models[[modeln]]$namesbestmodel

# this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

# this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetJ_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~                               VGOB1_subsetJ_ecoli_LUR2[,models[[1]]$indexbestmodel]+                           VGOB1_subsetJ_ecoli_LUR2[,models[[2]]$indexbestmodel]) 

models[[modeln]]$bestmodel

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel


# 3 #  
# add third variable (the only difference of the above part is that now modeln=3 the model statement has 3 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-3

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetJ_ecoli_LUR2[,i])==TRUE){  
    modeltry<-lm(VGOB1_subsetJ_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetJ_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR2[,models[[2]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetJ_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetJ_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR2)[models[[2]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR2)[models[[3]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetJ_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetJ_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,models[[2]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,models[[3]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel


# 4 #  
#  add forth variable (the only difference of the above part is that now model n=4 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly
modeln<-4

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1


for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetJ_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetJ_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetJ_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    #  the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetJ_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetJ_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR2)[models[[2]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR2)[models[[4]]$indexbestmodel])

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetJ_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetJ_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,models[[4]]$indexbestmodel]) 


models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel


# 5 #  
# add fifth variable (the only difference of the above part is that now modeln=5 the model statement more variables)
# and the call for the list of variable names in the model changed slightly
modeln<-5

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2:nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetJ_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetJ_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetJ_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,models[[2]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,i]) 
  
R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetJ_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetJ_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR2)[models[[2]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR2)[models[[5]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetJ_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetJ_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,models[[5]]$indexbestmodel]) 
models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel

# 6 #  
# add sixth variable (the only difference of the above part is that now model n=6 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-6

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetJ_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetJ_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetJ_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR2[,models[[4]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(All)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetJ_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetJ_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetJ_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR2)[models[[6]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetJ_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetJ_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,models[[6]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel


# 7 #  
# add seventh variable (the only difference of the above part is that now model n=7 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-7

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetJ_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetJ_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetJ_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR2[,models[[4]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR2[,models[[5]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetJ_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetJ_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetJ_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR2)[models[[6]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR2)[models[[7]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetJ_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetJ_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,models[[7]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel

# 8 #  
# add eighth variable (the only difference of the above part is that now modeln=7 the model statement more variables)
# and the call for the list of variable names in the model changed slightly

modeln<-8

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetJ_ecoli_LUR2[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetJ_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetJ_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR2[,models[[4]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR2[,models[[5]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetJ_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetJ_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetJ_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR2)[models[[6]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR2)[models[[7]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR2)[models[[8]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetJ_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetJ_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,models[[8]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel

# 9 #  
# add ninth variable (the only difference of the above part is that now modeln=9 the model statement more variables)
# and the call for the list of variable names in the model changed slightly

modeln<-9

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){
  if (is.numeric(VGOB1_subsetJ_ecoli_LUR2[,i])==TRUE){
      modeltry<-lm(VGOB1_subsetJ_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetJ_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR2[,models[[4]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR2[,models[[5]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,models[[8]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,i]) 
        R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetJ_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetJ_ecoli_LUR2)[models[[1]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetJ_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR2)[models[[6]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR2)[models[[7]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR2)[models[[8]]$indexbestmodel],  names(VGOB1_subsetJ_ecoli_LUR2)[models[[9]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetJ_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetJ_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR2[,models[[2]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,models[[8]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,models[[9]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[9]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[9]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel
models[[9]]$R2bestmodel

# 10 #  
#  add tenth variable (the only difference of the above part is that now model n=10 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-10

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_2 :nlastvar_LUR_2){if (is.numeric(VGOB1_subsetJ_ecoli_LUR2[,i])==TRUE){ modeltry<-lm(VGOB1_subsetJ_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetJ_ecoli_LUR2[,models[[1]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR2[,models[[2]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,models[[3]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,models[[8]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,models[[9]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,i]) 

R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR2[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR2)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetJ_ecoli_LUR2)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c( names(VGOB1_subsetJ_ecoli_LUR2)[models[[1]]$indexbestmodel],                   names(VGOB1_subsetJ_ecoli_LUR2)[models[[2]]$indexbestmodel] , names(VGOB1_subsetJ_ecoli_LUR2)[models[[3]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR2)[models[[4]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR2)[models[[5]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR2)[models[[6]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR2)[models[[7]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR2)[models[[8]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR2)[models[[9]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR2)[models[[10]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetJ_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean~                                VGOB1_subsetJ_ecoli_LUR2[,models[[1]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,models[[2]]$indexbestmodel]+                           VGOB1_subsetJ_ecoli_LUR2[,models[[3]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,models[[4]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,models[[5]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,models[[6]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,models[[7]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,models[[8]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,models[[9]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR2[,models[[10]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[9]]$summarybestmodel
models[[10]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[9]]$namesbestmodel
models[[10]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel
models[[9]]$R2bestmodel
models[[10]]$R2bestmodel

#   CODE FOR PICKING OUT THE BEST MODEL #   
temp <- 0
besti <- 0
for (i in 1:10){ #  think this runs the loop 10 times - not fully sure thought - but not to do with the number of models I don't think - as when I change to 3, I still get the model with 4 variables as best model
  print(models[[i]]$R2bestmodel)
  #       print(models[[i]]$summarybestmodel$coefficients=-1,4])
  #       if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
  #         temp <- models[[i]]$R2bestmodel
  #         besti <- i
  #         }
  if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
    temp <- models[[i]]$R2bestmodel
    besti <- i
  }else{
    finalBestModel_ecoli_LUR2_subsetJ <- models[[besti]]$bestmodel
    finalBestModelNames_ecoli_LUR2_subsetJ <- models[[besti]]$namesbestmodel
    Sites <- 1:dim(VGOB1_subsetJ_ecoli_LUR2)[1] # full original model
    #  CVaR2<-escCV_ecoli_LUR2(Sites)[2] # Cross Validation
    maxCD<-max(cooks.distance(finalBestModel_ecoli_LUR2_subsetJ))
    if(length(finalBestModelNames_ecoli_LUR2_subsetJ)<2){ # vif fn doesnot work when only 1 variable...       # 
      maxVIF<-"NA"
    }else{
      maxVIF<-max(vif(finalBestModel_ecoli_LUR2_subsetJ))
    }
    print(paste("This is the best ecoli model for subset J: ",besti,
                "(AdjR2: ",format(models[[besti]]$R2bestmodel,digits=3), "; MaxCD: ",format(maxCD,digits=3),"; MaxVIF: ",
                format(maxVIF,digits=3),")", sep=''))
    print(finalBestModelNames_ecoli_LUR2_subsetJ)
    break
  }
}

#  Overview of the final best model using the algorithm selection process (taking into account VIF, R^2, and p-values)
finalBestModel_ecoli_LUR2_subsetJ
finalBestModelNames_ecoli_LUR2_subsetJ
models[[besti]]$summarybestmodel
models[[besti]]$R2bestmodel

#### Predicting hold out sites ####
# These are the models from the 10 subsets: 
finalBestModel_ecoli_LUR2_subsetA
finalBestModel_ecoli_LUR2_subsetB
finalBestModel_ecoli_LUR2_subsetC
finalBestModel_ecoli_LUR2_subsetD
finalBestModel_ecoli_LUR2_subsetE
finalBestModel_ecoli_LUR2_subsetF
finalBestModel_ecoli_LUR2_subsetG
finalBestModel_ecoli_LUR2_subsetH
finalBestModel_ecoli_LUR2_subsetI
finalBestModel_ecoli_LUR2_subsetJ

#  Selecting of test sets
#  valID 1 to 10
VGOB1_subsetvalID1_ecoli_LUR2 <- subset(VGOB1_FINAL_ecoli_LUR2, valID == 1)
VGOB1_subsetvalID2_ecoli_LUR2 <- subset(VGOB1_FINAL_ecoli_LUR2, valID == 2)
VGOB1_subsetvalID3_ecoli_LUR2 <- subset(VGOB1_FINAL_ecoli_LUR2, valID == 3)
VGOB1_subsetvalID4_ecoli_LUR2 <- subset(VGOB1_FINAL_ecoli_LUR2, valID == 4)
VGOB1_subsetvalID5_ecoli_LUR2 <- subset(VGOB1_FINAL_ecoli_LUR2, valID == 5)
VGOB1_subsetvalID6_ecoli_LUR2 <- subset(VGOB1_FINAL_ecoli_LUR2, valID == 6)
VGOB1_subsetvalID7_ecoli_LUR2 <- subset(VGOB1_FINAL_ecoli_LUR2, valID == 7)
VGOB1_subsetvalID8_ecoli_LUR2 <- subset(VGOB1_FINAL_ecoli_LUR2, valID == 8)
VGOB1_subsetvalID9_ecoli_LUR2 <- subset(VGOB1_FINAL_ecoli_LUR2, valID == 9)
VGOB1_subsetvalID10_ecoli_LUR2 <- subset(VGOB1_FINAL_ecoli_LUR2, valID == 10)

#  For every subset predict (based on LUR model for that subset, so the training sites) the concentrations at the sites left out (test sites) to enable comparisons observed vs predicted 

#  Set 1
finalBestModel_ecoli_LUR2_subsetA
finalBestModelNames_ecoli_LUR2_subsetA
summary(finalBestModel_ecoli_LUR2_subsetA)
maxVIF_ecoli_LUR2_subsetA <- max(vif(finalBestModel_ecoli_LUR2_subsetA))
maxCD_ecoli_LUR2_subsetA <- max(cooks.distance(finalBestModel_ecoli_LUR2_subsetA))
# write the model out
finalBestModel_ecoli_LUR2_subsetA_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~ npigsWghtDist.3000m.sum.95Win.10to90scaled+ MindistCows5.INV.95Win.10to90scaled+ npoultry.3000m.95Win.10to90scaled + npigs.500m.95Win.10to90scaled +nhorses.3000m.95Win.10to90scaled , data = VGOB1_subsetA_ecoli_LUR2)
VGOB1_subsetvalID1_ecoli_LUR2$ecoli_PRED_HV <- predict(finalBestModel_ecoli_LUR2_subsetA_lm,VGOB1_subsetvalID1_ecoli_LUR2)
summary(VGOB1_subsetvalID1_ecoli_LUR2$ecoli_PRED_HV)
plot(VGOB1_subsetvalID1_ecoli_LUR2$ecoli_PRED_HV, VGOB1_subsetvalID1_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean, xlab="ecoli predicted (HV)", ylab="ecoli concentration observed")
VGOB1_subsetvalID1_ecoli_LUR2_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~ecoli_PRED_HV, data=VGOB1_subsetvalID1_ecoli_LUR2 )
summary(VGOB1_subsetvalID1_ecoli_LUR2_lm)

#  Set 2
finalBestModel_ecoli_LUR2_subsetB
finalBestModelNames_ecoli_LUR2_subsetB
summary(finalBestModel_ecoli_LUR2_subsetB)
maxVIF_ecoli_LUR2_subsetB <- max(vif(finalBestModel_ecoli_LUR2_subsetB))
maxCD_ecoli_LUR2_subsetB <- max(cooks.distance(finalBestModel_ecoli_LUR2_subsetB))
# write the model out
finalBestModel_ecoli_LUR2_subsetB_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~npigsWghtDist.3000m.sum.95Win.10to90scaled+npoultry.1000m.95Win.10to90scaled+ nhorses.3000m.95Win.10to90scaled , data = VGOB1_subsetB_ecoli_LUR2)
VGOB1_subsetvalID2_ecoli_LUR2$ecoli_PRED_HV <- predict(finalBestModel_ecoli_LUR2_subsetB_lm,VGOB1_subsetvalID2_ecoli_LUR2)
summary(VGOB1_subsetvalID2_ecoli_LUR2$ecoli_PRED_HV)
plot(VGOB1_subsetvalID2_ecoli_LUR2$ecoli_PRED_HV, VGOB1_subsetvalID2_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean, xlab="ecoli predicted (HV)", ylab="ecoli concentration observed")
VGOB1_subsetvalID2_ecoli_LUR2_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~ecoli_PRED_HV, data=VGOB1_subsetvalID2_ecoli_LUR2)
summary(VGOB1_subsetvalID2_ecoli_LUR2_lm)

#  Set 3
finalBestModel_ecoli_LUR2_subsetC
finalBestModelNames_ecoli_LUR2_subsetC
summary(finalBestModel_ecoli_LUR2_subsetC)
maxVIF_ecoli_LUR2_subsetC <-max(vif(finalBestModel_ecoli_LUR2_subsetC))
maxCD_ecoli_LUR2_subsetC <- max(cooks.distance(finalBestModel_ecoli_LUR2_subsetC))
# write the model out
finalBestModel_ecoli_LUR2_subsetC_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~ npigsWghtDist.3000m.sum.95Win.10to90scaled+npoultry.3000m.95Win.10to90scaled+npigs.500m.95Win.10to90scaled+nhorses.3000m.95Win.10to90scaled , data = VGOB1_subsetC_ecoli_LUR2)
VGOB1_subsetvalID3_ecoli_LUR2$ecoli_PRED_HV <- predict(finalBestModel_ecoli_LUR2_subsetC_lm,VGOB1_subsetvalID3_ecoli_LUR2)
summary(VGOB1_subsetvalID3_ecoli_LUR2$ecoli_PRED_HV)
plot(VGOB1_subsetvalID3_ecoli_LUR2$ecoli_PRED_HV, VGOB1_subsetvalID3_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean, xlab="ecoli predicted (HV)", ylab="ecoli concentration observed")
VGOB1_subsetvalID3_ecoli_LUR2_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~ecoli_PRED_HV, data=VGOB1_subsetvalID3_ecoli_LUR2 )
summary(VGOB1_subsetvalID3_ecoli_LUR2_lm)

#  Set 4
finalBestModel_ecoli_LUR2_subsetD
finalBestModelNames_ecoli_LUR2_subsetD
summary(finalBestModel_ecoli_LUR2_subsetD)
maxVIF_ecoli_LUR2_subsetD <- max(vif(finalBestModel_ecoli_LUR2_subsetD))
maxCD_ecoli_LUR2_subsetD <- max(cooks.distance(finalBestModel_ecoli_LUR2_subsetD))
# write the model out
finalBestModel_ecoli_LUR2_subsetD_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~npigsWghtDist.3000m.sum.95Win.10to90scaled+nhorses.3000m.95Win.10to90scaled+npoultry.3000m.95Win.10to90scaled+MindistCows5.INV.95Win.10to90scaled , data = VGOB1_subsetD_ecoli_LUR2)
VGOB1_subsetvalID4_ecoli_LUR2$ecoli_PRED_HV <- predict(finalBestModel_ecoli_LUR2_subsetD_lm,VGOB1_subsetvalID4_ecoli_LUR2)
summary(VGOB1_subsetvalID4_ecoli_LUR2$ecoli_PRED_HV)
plot(VGOB1_subsetvalID4_ecoli_LUR2$ecoli_PRED_HV, VGOB1_subsetvalID4_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean, xlab="ecoli predicted (HV)", ylab="ecoli concentration observed")
VGOB1_subsetvalID4_ecoli_LUR2_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~ecoli_PRED_HV, data=VGOB1_subsetvalID4_ecoli_LUR2 )
summary(VGOB1_subsetvalID4_ecoli_LUR2_lm)

#  Set 5
finalBestModel_ecoli_LUR2_subsetE
finalBestModelNames_ecoli_LUR2_subsetE
summary(finalBestModel_ecoli_LUR2_subsetE)
maxVIF_ecoli_LUR2_subsetE <- max(vif(finalBestModel_ecoli_LUR2_subsetE))
maxCD_ecoli_LUR2_subsetE <- max(cooks.distance(finalBestModel_ecoli_LUR2_subsetE))
# write the model out
finalBestModel_ecoli_LUR2_subsetE_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~ npigsWghtDist.3000m.sum.95Win.10to90scaled+npoultry.3000m.95Win.10to90scaled+ npigs.500m.95Win.10to90scaled+ nhorses.3000m.95Win.10to90scaled , data = VGOB1_subsetE_ecoli_LUR2)
VGOB1_subsetvalID5_ecoli_LUR2$ecoli_PRED_HV <- predict(finalBestModel_ecoli_LUR2_subsetE_lm,VGOB1_subsetvalID5_ecoli_LUR2)
summary(VGOB1_subsetvalID5_ecoli_LUR2$ecoli_PRED_HV)
plot(VGOB1_subsetvalID5_ecoli_LUR2$ecoli_PRED_HV, VGOB1_subsetvalID5_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean, xlab="ecoli predicted (HV)", ylab="ecoli concentration observed")
VGOB1_subsetvalID5_ecoli_LUR2_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~ecoli_PRED_HV, data=VGOB1_subsetvalID5_ecoli_LUR2)
summary(VGOB1_subsetvalID5_ecoli_LUR2_lm)

#  Set 6
finalBestModel_ecoli_LUR2_subsetF
finalBestModelNames_ecoli_LUR2_subsetF
summary(finalBestModel_ecoli_LUR2_subsetF)
maxVIF_ecoli_LUR2_subsetF <- max(vif(finalBestModel_ecoli_LUR2_subsetF))
maxCD_ecoli_LUR2_subsetF <- max(cooks.distance(finalBestModel_ecoli_LUR2_subsetF))
# write the model out
finalBestModel_ecoli_LUR2_subsetF_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~npigsWghtDist.3000m.sum.95Win.10to90scaled + nhorses.3000m.95Win.10to90scaled+ npoultry.3000m.95Win.10to90scaled + npigs.500m.95Win.10to90scaled, data = VGOB1_subsetF_ecoli_LUR2)
VGOB1_subsetvalID6_ecoli_LUR2$ecoli_PRED_HV <- predict(finalBestModel_ecoli_LUR2_subsetF_lm,VGOB1_subsetvalID6_ecoli_LUR2)
summary(VGOB1_subsetvalID6_ecoli_LUR2$ecoli_PRED_HV)
plot(VGOB1_subsetvalID6_ecoli_LUR2$ecoli_PRED_HV, VGOB1_subsetvalID6_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean, xlab="ecoli predicted (HV)", ylab="ecoli concentration observed")
VGOB1_subsetvalID6_ecoli_LUR2_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~ecoli_PRED_HV, data=VGOB1_subsetvalID6_ecoli_LUR2 )
summary(VGOB1_subsetvalID6_ecoli_LUR2_lm)

#  Set 7
finalBestModel_ecoli_LUR2_subsetG
finalBestModelNames_ecoli_LUR2_subsetG
summary(finalBestModel_ecoli_LUR2_subsetG)
maxVIF_ecoli_LUR2_subsetG <- max(vif(finalBestModel_ecoli_LUR2_subsetG))
maxCD_ecoli_LUR2_subsetG <- max(cooks.distance(finalBestModel_ecoli_LUR2_subsetG))
# write the model out
finalBestModel_ecoli_LUR2_subsetG_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~ npigsWghtDist.3000m.sum.95Win.10to90scaled+ npoultry.3000m.95Win.10to90scaled, data = VGOB1_subsetG_ecoli_LUR2)
VGOB1_subsetvalID7_ecoli_LUR2$ecoli_PRED_HV <- predict(finalBestModel_ecoli_LUR2_subsetG_lm,VGOB1_subsetvalID7_ecoli_LUR2)
summary(VGOB1_subsetvalID7_ecoli_LUR2$ecoli_PRED_HV)
plot(VGOB1_subsetvalID7_ecoli_LUR2$ecoli_PRED_HV, VGOB1_subsetvalID7_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean, xlab="ecoli predicted (HV)", ylab="ecoli concentration observed")
VGOB1_subsetvalID7_ecoli_LUR2_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~ecoli_PRED_HV, data=VGOB1_subsetvalID7_ecoli_LUR2)
summary(VGOB1_subsetvalID7_ecoli_LUR2_lm)

#  Set 8
finalBestModel_ecoli_LUR2_subsetH
finalBestModelNames_ecoli_LUR2_subsetH
summary(finalBestModel_ecoli_LUR2_subsetH)
maxVIF_ecoli_LUR2_subsetH <- max(vif(finalBestModel_ecoli_LUR2_subsetH))
maxCD_ecoli_LUR2_subsetH <- max(cooks.distance(finalBestModel_ecoli_LUR2_subsetH))
# write the model out
finalBestModel_ecoli_LUR2_subsetH_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~ npigsWghtDist.3000m.sum.95Win.10to90scaled + npoultry.3000m.95Win.10to90scaled + npigs.500m.95Win.10to90scaled + nhorses.3000m.95Win.10to90scaled, data = VGOB1_subsetH_ecoli_LUR2)
lm(finalBestModel_ecoli_LUR2_subsetH)
VGOB1_subsetvalID8_ecoli_LUR2$ecoli_PRED_HV <- predict(finalBestModel_ecoli_LUR2_subsetH_lm,VGOB1_subsetvalID8_ecoli_LUR2)
summary(VGOB1_subsetvalID8_ecoli_LUR2$ecoli_PRED_HV)
plot(VGOB1_subsetvalID8_ecoli_LUR2$ecoli_PRED_HV, VGOB1_subsetvalID8_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean, xlab="ecoli predicted (HV)", ylab="ecoli concentration observed")
VGOB1_subsetvalID8_ecoli_LUR2_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~ecoli_PRED_HV, data=VGOB1_subsetvalID8_ecoli_LUR2)
summary(VGOB1_subsetvalID8_ecoli_LUR2_lm)

#  Set 9
finalBestModel_ecoli_LUR2_subsetI
finalBestModelNames_ecoli_LUR2_subsetI
summary(finalBestModel_ecoli_LUR2_subsetI)
maxVIF_ecoli_LUR2_subsetI <- max(vif(finalBestModel_ecoli_LUR2_subsetI))
maxCD_ecoli_LUR2_subsetI <- max(cooks.distance(finalBestModel_ecoli_LUR2_subsetI))
# write the model out
finalBestModel_ecoli_LUR2_subsetI_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~npigsWghtDist.3000m.sum.95Win.10to90scaled+npoultry.3000m.95Win.10to90scaled+nhorses.3000m.95Win.10to90scaled+ npigs.500m.95Win.10to90scaled, data = VGOB1_subsetI_ecoli_LUR2)
VGOB1_subsetvalID9_ecoli_LUR2$ecoli_PRED_HV <- predict(finalBestModel_ecoli_LUR2_subsetI_lm,VGOB1_subsetvalID9_ecoli_LUR2)
summary(VGOB1_subsetvalID9_ecoli_LUR2$ecoli_PRED_HV)
plot(VGOB1_subsetvalID9_ecoli_LUR2$ecoli_PRED_HV, VGOB1_subsetvalID9_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean, xlab="ecoli predicted (HV)", ylab="ecoli concentration observed")
VGOB1_subsetvalID9_ecoli_LUR2_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~ecoli_PRED_HV, data=VGOB1_subsetvalID9_ecoli_LUR2 )
summary(VGOB1_subsetvalID9_ecoli_LUR2_lm)

#  Set 10
finalBestModel_ecoli_LUR2_subsetJ
finalBestModelNames_ecoli_LUR2_subsetJ
summary(finalBestModel_ecoli_LUR2_subsetJ)
maxVIF_ecoli_LUR2_subsetJ <- max(vif(finalBestModel_ecoli_LUR2_subsetJ))
maxCD_ecoli_LUR2_subsetJ <- max(cooks.distance(finalBestModel_ecoli_LUR2_subsetJ))
# write the model out
finalBestModel_ecoli_LUR2_subsetJ_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~ npigsWghtDist.3000m.sum.95Win.10to90scaled + HorseFarm.3000m.95Win.10to90scaled + npoultryWghtDist.1000m.sum.95Win.10to90scaled+ MindistCows5.INV.95Win.10to90scaled, data = VGOB1_subsetJ_ecoli_LUR2)
finalBestModel_ecoli_LUR2_subsetJ_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~ npigsWghtDist.3000m.sum.95Win.10to90scaled + HorseFarm.3000m.95Win.10to90scaled + npoultryWghtDist.1000m.sum.95Win.10to90scaled+ MindistCows5.INV.95Win.10to90scaled, data = VGOB1_subsetJ_ecoli_LUR2)

VGOB1_subsetvalID10_ecoli_LUR2$ecoli_PRED_HV <- predict(finalBestModel_ecoli_LUR2_subsetJ_lm,VGOB1_subsetvalID10_ecoli_LUR2)
summary(VGOB1_subsetvalID10_ecoli_LUR2$ecoli_PRED_HV)
plot(VGOB1_subsetvalID10_ecoli_LUR2$ecoli_PRED_HV, VGOB1_subsetvalID10_ecoli_LUR2$ecoli_copiespm3.ln.diffmeth.mean, xlab="ecoli predicted (HV)", ylab="ecoli concentration observed")
VGOB1_subsetvalID10_ecoli_LUR2_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~ecoli_PRED_HV, data=VGOB1_subsetvalID10_ecoli_LUR2)
summary(VGOB1_subsetvalID10_ecoli_LUR2_lm)

# compute the residuals from each of the 10 models of the CV for later normality testing (model assumption)
VGOB1_subsetvalID1_ecoli_LUR2$residuals <- VGOB1_subsetvalID1_ecoli_LUR2_lm$residuals
VGOB1_subsetvalID2_ecoli_LUR2$residuals <- VGOB1_subsetvalID2_ecoli_LUR2_lm$residuals
VGOB1_subsetvalID3_ecoli_LUR2$residuals <- VGOB1_subsetvalID3_ecoli_LUR2_lm$residuals
VGOB1_subsetvalID4_ecoli_LUR2$residuals <- VGOB1_subsetvalID4_ecoli_LUR2_lm$residuals
VGOB1_subsetvalID5_ecoli_LUR2$residuals <- VGOB1_subsetvalID5_ecoli_LUR2_lm$residuals
VGOB1_subsetvalID6_ecoli_LUR2$residuals <- VGOB1_subsetvalID6_ecoli_LUR2_lm$residuals
VGOB1_subsetvalID7_ecoli_LUR2$residuals <- VGOB1_subsetvalID7_ecoli_LUR2_lm$residuals
VGOB1_subsetvalID8_ecoli_LUR2$residuals <- VGOB1_subsetvalID8_ecoli_LUR2_lm$residuals
VGOB1_subsetvalID9_ecoli_LUR2$residuals <- VGOB1_subsetvalID9_ecoli_LUR2_lm$residuals
VGOB1_subsetvalID10_ecoli_LUR2$residuals <- VGOB1_subsetvalID10_ecoli_LUR2_lm$residuals

#  Merging of all test sets to make overall comparisons of predicted vs observed
VGOB1_subsetvalID1to10_ecoli_LUR2_10foldCV <- rbind(VGOB1_subsetvalID1_ecoli_LUR2, VGOB1_subsetvalID2_ecoli_LUR2, VGOB1_subsetvalID3_ecoli_LUR2, VGOB1_subsetvalID4_ecoli_LUR2, VGOB1_subsetvalID5_ecoli_LUR2, VGOB1_subsetvalID6_ecoli_LUR2, VGOB1_subsetvalID7_ecoli_LUR2, VGOB1_subsetvalID8_ecoli_LUR2, VGOB1_subsetvalID9_ecoli_LUR2, VGOB1_subsetvalID10_ecoli_LUR2)

#  Overall comparison of predicted vs observed
plot(VGOB1_subsetvalID1to10_ecoli_LUR2_10foldCV$ecoli_PRED_HV, VGOB1_subsetvalID1to10_ecoli_LUR2_10foldCV$ecoli_copiespm3.ln.diffmeth.mean, xlab="LUR2-predicted ecoli DNA concentration (ln copies/m^3)", ylab="Observed ecoli DNA concentration (ln copies/m^3)", cex.lab=0.85)
abline(lm(VGOB1_subsetvalID1to10_ecoli_LUR2_10foldCV$ecoli_copiespm3.ln.diffmeth.mean ~ VGOB1_subsetvalID1to10_ecoli_LUR2_10foldCV$ecoli_PRED_HV))

VGOB1_subsetvalID1to10_ecoli_LUR2_10foldCV_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean ~ ecoli_PRED_HV, data=VGOB1_subsetvalID1to10_ecoli_LUR2_10foldCV)
summary(VGOB1_subsetvalID1to10_ecoli_LUR2_10foldCV_lm)

# 10-fold CV multiple R2 for E. coli LUR2 = 0.3701

#  Calculate RMSE
RMSE_ecoli_LUR2_10foldCV <- sqrt(mean((VGOB1_subsetvalID1to10_ecoli_LUR2_10foldCV$ecoli_copiespm3.ln.diffmeth.mean - VGOB1_subsetvalID1to10_ecoli_LUR2_10foldCV$ecoli_PRED_HV)^2))
RMSE_ecoli_LUR2_10foldCV

#  Save these predicted concentrations as an excel file along with the actual measured concentrations of ecoli at each of the measurement sites 
#  These are the predicted concentrations for the sites that were left out of the model training procedure in 10-fold cross validation 
ecoli_LUR2_10foldCV_preds <- VGOB1_subsetvalID1to10_ecoli_LUR2_10foldCV$ecoli_PRED_HV 
#  These are the actual measured concentrations at the 61 measurement sites - these are in the same order as the above sites in order to match the predicted concentrations (i.e. not in order 1-61)
VGOB1_subsetvalID1to10_ecoli_LUR2_10foldCV$ecoli_copiespm3.ln.diffmeth.mean

VGOB1_subsetvalID1to10_ecoli_LUR2_10foldCV$Loc_ID

#  Create a dataframe 
ecoli_SLR_10foldCVpreds_observed <- data.frame(VGOB1_subsetvalID1to10_ecoli_LUR2_10foldCV$Loc_ID,VGOB1_subsetvalID1to10_ecoli_LUR2_10foldCV$ecoli_copiespm3.ln.diffmeth.mean, VGOB1_subsetvalID1to10_ecoli_LUR2_10foldCV$ecoli_PRED_HV)
print(ecoli_SLR_10foldCVpreds_observed)

#  Save as xls file 
write_xlsx(ecoli_SLR_10foldCVpreds_observed,"Output_files\\ecoli_LUR2_10foldCV_observed_predicted.xlsx")


#   MODEL CHECKING #  
#  1)Check normality of residuals 
#  2)Check residuals for linearity, independence and homoscedasticity
#  3)Check multicollinearity (VIF)
#  4)Check influential points (Cook's Distance)

#  1) Normality of residuals
boxplot(residuals(VGOB1_subsetvalID1to10_ecoli_LUR2_10foldCV),main="boxplot of residuals - E. coli LUR2 (ln-transformed concentrations)",xlab="residuals")
qqnorm(residuals(VGOB1_subsetvalID1to10_ecoli_LUR2_10foldCV),main="QQ-plot of residuals - E. coli LUR2 (ln-transformed concentrations)",xlab="residuals")
hist(residuals(VGOB1_subsetvalID1to10_ecoli_LUR2_10foldCV),main="boxplot of residuals - E. coli LUR2 (ln-transformed concentrations)",xlab="residuals")

#  2)Check residuals for linearity, independence and homoscedasticity
plot(VGOB1_subsetvalID1to10_ecoli_LUR2_10foldCV$ecoli_PRED_HV,VGOB1_subsetvalID1to10_ecoli_LUR2_10foldCV$residuals)

#  3)Check multicollinearity (VIF)
# Write out the max VIF and cook's distance figures for each of the 10 folds, and create a dataframe 
ecoli_LUR2_maxVIF_subsetvalID1to10 <- c(maxVIF_ecoli_LUR2_subsetA, maxVIF_ecoli_LUR2_subsetB, maxVIF_ecoli_LUR2_subsetC, maxVIF_ecoli_LUR2_subsetD, maxVIF_ecoli_LUR2_subsetE, maxVIF_ecoli_LUR2_subsetF, maxVIF_ecoli_LUR2_subsetG, maxVIF_ecoli_LUR2_subsetH, maxVIF_ecoli_LUR2_subsetI, maxVIF_ecoli_LUR2_subsetJ)
max(ecoli_LUR2_maxVIF_subsetvalID1to10)

#  4)Check influential points (Cook's Distance)
ecoli_LUR2_maxCD_maxCD_subsetvalID1to10 <- c(maxCD_ecoli_LUR2_subsetA, maxCD_ecoli_LUR2_subsetB, maxCD_ecoli_LUR2_subsetC, maxCD_ecoli_LUR2_subsetD, maxCD_ecoli_LUR2_subsetE, maxCD_ecoli_LUR2_subsetF, maxCD_ecoli_LUR2_subsetG, maxCD_ecoli_LUR2_subsetH, maxCD_ecoli_LUR2_subsetI, maxCD_ecoli_LUR2_subsetJ)
```
#  E. coli LUR3 model - training model
```{r}
#  Function building to run the models 
#   1 #  
models<-list()
modeln<-1
models[[modeln]]<-list()

R2<-1
betaaddedvar<-1
addedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(Measurements_livestockpreds_LUR3[,i])==TRUE){
    modeltry<-lm(ecoli~Measurements_livestockpreds_LUR3[,i])                            
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(Measurements_livestockpreds_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
models[[modeln]]$results

#  this are the candidates models with the highest R2, not a negative beta for the new, nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)
subset(models[[modeln]]$resultspos)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(Measurements_livestockpreds_LUR3)[models[[1]]$indexbestmodel])
models[[modeln]]$namesbestmodel

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(ecoli~Measurements_livestockpreds_LUR3[,models[[1]]$indexbestmodel]) 
models[[modeln]]$bestmodel

summary(models[[modeln]]$bestmodel)

#  The first model includes the predictor: nPigMultipFarmWghtDist.3000m.sum.Tr.1P9 - meaning the number of multiplier pig farms weighted to distance in a 3000m buffer

#  2 #  

#  Add 2nd variable (the only difference of the above part is that now modeln=2 the model statement has 2 variables)
#  and the cAll for the list of variable names in the model changed slightly

modeln<-2

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(Measurements_livestockpreds_LUR3[,i])==TRUE){
    modeltry<-lm(ecoli~Measurements_livestockpreds_LUR3[,models[[1]]$indexbestmodel]+ Measurements_livestockpreds_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(Measurements_livestockpreds_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  these are the candidate models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(Measurements_livestockpreds_LUR3)[models[[1]]$indexbestmodel], names(Measurements_livestockpreds_LUR3)[models[[2]]$indexbestmodel] )
models[[modeln]]$namesbestmodel

# this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

# this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(ecoli~Measurements_livestockpreds_LUR3[,models[[1]]$indexbestmodel]+Measurements_livestockpreds_LUR3[,models[[2]]$indexbestmodel]) 
models[[modeln]]$bestmodel

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel

models[[1]]$namesbestmodel
models[[2]]$namesbestmodel

models[[1]]$R2bestmodel
models[[2]]$R2bestmodel

#  at this point I always check whether the next model (with 2 variables) is more than 1% better than the one before and if not I end here
#  R2 of the second model is higher than the 1st model, so 2nd is better  


#  3 #  
#  add third variable (the only difference of the above part is that now modeln=3 the model statement has 3 variables)
#  and the cAll for the list of variable names in the model changed slightly

modeln<-3

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(Measurements_livestockpreds_LUR3[,i])==TRUE){  
    modeltry<-lm(ecoli~Measurements_livestockpreds_LUR3[,models[[1]]$indexbestmodel]+Measurements_livestockpreds_LUR3[,models[[2]]$indexbestmodel]+ Measurements_livestockpreds_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(Measurements_livestockpreds_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(Measurements_livestockpreds_LUR3)[models[[1]]$indexbestmodel], names(Measurements_livestockpreds_LUR3)[models[[2]]$indexbestmodel] , names(Measurements_livestockpreds_LUR3)[models[[3]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(ecoli~Measurements_livestockpreds_LUR3[,models[[1]]$indexbestmodel]+Measurements_livestockpreds_LUR3[,models[[2]]$indexbestmodel]+Measurements_livestockpreds_LUR3[,models[[3]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel

models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel

models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel


#  at this point I always check whether the next model is more than 1% better than the one before and if not I end here
#  Yes model 3 is >1% better than model 2 therefore I continue
#  last step is to exclude any variables with p-value>0.1
#  No variables have p>0.1 in this model so not needed

#  4 #  

#  add forth variable (the only difference of the above part is that now model n=4 the model statement more variables)
#  and the cAll for the list of variable names in the model changed slightly
modeln<-4

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1


for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(Measurements_livestockpreds_LUR3[,i])==TRUE){
    modeltry<-lm(ecoli~Measurements_livestockpreds_LUR3[,models[[1]]$indexbestmodel]+Measurements_livestockpreds_LUR3[,models[[2]]$indexbestmodel]+Measurements_livestockpreds_LUR3[,models[[3]]$indexbestmodel]+Measurements_livestockpreds_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    #  the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(Measurements_livestockpreds_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(Measurements_livestockpreds_LUR3)[models[[1]]$indexbestmodel], names(Measurements_livestockpreds_LUR3)[models[[2]]$indexbestmodel] , names(Measurements_livestockpreds_LUR3)[models[[3]]$indexbestmodel], names(Measurements_livestockpreds_LUR3)[models[[4]]$indexbestmodel])

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(ecoli~Measurements_livestockpreds_LUR3[,models[[1]]$indexbestmodel]+Measurements_livestockpreds_LUR3[,models[[2]]$indexbestmodel]+Measurements_livestockpreds_LUR3[,models[[3]]$indexbestmodel]+ Measurements_livestockpreds_LUR3[,models[[4]]$indexbestmodel]) 


models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel

#  at this point I always check whether the next model is more than 1% better than the one before and if not I end here
#  Yes model 4 is 5.57252% better than model 3 therefore I continue


#  5 #  
#  add fifth variable (the only difference of the above part is that now modeln=5 the model statement more variables)
#  and the cAll for the list of variable names in the model changed slightly
modeln<-5

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(Measurements_livestockpreds_LUR3[,i])==TRUE){
    modeltry<-lm(ecoli~Measurements_livestockpreds_LUR3[,models[[1]]$indexbestmodel]+Measurements_livestockpreds_LUR3[,models[[2]]$indexbestmodel]+Measurements_livestockpreds_LUR3[,models[[3]]$indexbestmodel]+Measurements_livestockpreds_LUR3[,models[[4]]$indexbestmodel]+ Measurements_livestockpreds_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(Measurements_livestockpreds_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(Measurements_livestockpreds_LUR3)[models[[1]]$indexbestmodel], names(Measurements_livestockpreds_LUR3)[models[[2]]$indexbestmodel] , names(Measurements_livestockpreds_LUR3)[models[[3]]$indexbestmodel], names(Measurements_livestockpreds_LUR3)[models[[4]]$indexbestmodel], names(Measurements_livestockpreds_LUR3)[models[[5]]$indexbestmodel])


#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(ecoli~Measurements_livestockpreds_LUR3[,models[[1]]$indexbestmodel]+Measurements_livestockpreds_LUR3[,models[[2]]$indexbestmodel]+Measurements_livestockpreds_LUR3[,models[[3]]$indexbestmodel]+ Measurements_livestockpreds_LUR3[,models[[4]]$indexbestmodel]+ Measurements_livestockpreds_LUR3[,models[[5]]$indexbestmodel]) 


models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel

#  at this point I always check whether the next model is more than 1% better than the one before and if not I end here
#  Yes model 5 is 4.7128% better than model 4 therefore I continue

#   6 #  
#  add sixth variable (the only difference of the above part is that now modeln=6 the modelstatement more variables)
#  and the cAll for the list of variable names in the model changed slightly

modeln<-6

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){
  if (is.numeric(Measurements_livestockpreds_LUR3[,i])==TRUE){
    modeltry<-lm(ecoli~Measurements_livestockpreds_LUR3[,models[[1]]$indexbestmodel]+Measurements_livestockpreds_LUR3[,models[[2]]$indexbestmodel]+Measurements_livestockpreds_LUR3[,models[[3]]$indexbestmodel]+Measurements_livestockpreds_LUR3[,models[[4]]$indexbestmodel]+Measurements_livestockpreds_LUR3[,models[[5]]$indexbestmodel]+ Measurements_livestockpreds_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(All)[i]
    addedvar<-rbind(addedvar,names(Measurements_livestockpreds_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(Measurements_livestockpreds_LUR3)[models[[1]]$indexbestmodel], names(Measurements_livestockpreds_LUR3)[models[[2]]$indexbestmodel] , names(Measurements_livestockpreds_LUR3)[models[[3]]$indexbestmodel], names(Measurements_livestockpreds_LUR3)[models[[4]]$indexbestmodel], names(Measurements_livestockpreds_LUR3)[models[[5]]$indexbestmodel], names(Measurements_livestockpreds_LUR3)[models[[6]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(ecoli~Measurements_livestockpreds_LUR3[,models[[1]]$indexbestmodel]+Measurements_livestockpreds_LUR3[,models[[2]]$indexbestmodel]+Measurements_livestockpreds_LUR3[,models[[3]]$indexbestmodel]+ Measurements_livestockpreds_LUR3[,models[[4]]$indexbestmodel]+ Measurements_livestockpreds_LUR3[,models[[5]]$indexbestmodel]+ Measurements_livestockpreds_LUR3[,models[[6]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel

#  at this point I always check whether the next model is more than 1% better than the one before and if not I end here
#  Yes R^2 increases by just over 1% from model 5 to model 6
#  Therefore I will continue and add another variable! 


#   7 #  
#  add seventh variable (the only difference of the above part is that now modeln=7 the modelstatement more variables)
#  and the cAll for the list of variable names in the model changed slightly

modeln<-7

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){
  if (is.numeric(Measurements_livestockpreds_LUR3[,i])==TRUE){
    modeltry<-lm(ecoli~Measurements_livestockpreds_LUR3[,models[[1]]$indexbestmodel]+Measurements_livestockpreds_LUR3[,models[[2]]$indexbestmodel]+Measurements_livestockpreds_LUR3[,models[[3]]$indexbestmodel]+Measurements_livestockpreds_LUR3[,models[[4]]$indexbestmodel]+Measurements_livestockpreds_LUR3[,models[[5]]$indexbestmodel]+Measurements_livestockpreds_LUR3[,models[[6]]$indexbestmodel]+ Measurements_livestockpreds_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(Measurements_livestockpreds_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(Measurements_livestockpreds_LUR3)[models[[1]]$indexbestmodel], names(Measurements_livestockpreds_LUR3)[models[[2]]$indexbestmodel] , names(Measurements_livestockpreds_LUR3)[models[[3]]$indexbestmodel], names(Measurements_livestockpreds_LUR3)[models[[4]]$indexbestmodel], names(Measurements_livestockpreds_LUR3)[models[[5]]$indexbestmodel], names(Measurements_livestockpreds_LUR3)[models[[6]]$indexbestmodel],
names(Measurements_livestockpreds_LUR3)[models[[7]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(ecoli~Measurements_livestockpreds_LUR3[,models[[1]]$indexbestmodel]+Measurements_livestockpreds_LUR3[,models[[2]]$indexbestmodel]+Measurements_livestockpreds_LUR3[,models[[3]]$indexbestmodel]+ Measurements_livestockpreds_LUR3[,models[[4]]$indexbestmodel]+ Measurements_livestockpreds_LUR3[,models[[5]]$indexbestmodel]+ Measurements_livestockpreds_LUR3[,models[[6]]$indexbestmodel]+
Measurements_livestockpreds_LUR3[,models[[7]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel


#   CODE FOR PICKING OUT THE BEST MODEL #   
temp <- 0
besti <- 0
for (i in 1:10){ #  think this runs the loop 10 times - not fully sure thought - but not to do with the number of models I don't think - as when I change to 3, I still get the model with 4 variables as best model
  print(models[[i]]$R2bestmodel)
  #       print(models[[i]]$summarybestmodel$coefficients=-1,4])
  #       if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
  #         temp <- models[[i]]$R2bestmodel
  #         besti <- i
  #         }
  if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
    temp <- models[[i]]$R2bestmodel
    besti <- i
  }else{
    finalBestModel <- models[[besti]]$bestmodel
    finalBestModelNames <- models[[besti]]$namesbestmodel
    Sites <- 1:dim(Measurements_livestockpreds_LUR3)[1] # full original model
    #  CVaR2<-escCV_ecoli_LUR3(Sites)[2] # Cross Validation
    maxCD<-max(cooks.distance(finalBestModel))
    if(length(finalBestModelNames)<2){ # vif fn doesnot work when only 1 variable...       # 
      maxVIF<-"NA"
    }else{
      maxVIF<-max(vif(finalBestModel))
    }
    print(paste("This is the best ecoli model: ",besti,
                "(AdjR2: ",format(models[[besti]]$R2bestmodel,digits=3), "; MaxCD: ",format(maxCD,digits=3),"; MaxVIF: ",
                format(maxVIF,digits=3),")", sep=''))
    print(finalBestModelNames)
    break
  }
}

#  the final best model includes the predictors: nPigMultipFarmWghtDist.3000m.sum.95Win.10to90scaled+ npoultry.3000m.95Win.10to90scaled+ npigletsWghtDist.1000m.sum.95Win.10to90scaled+ notherpoultryanim.3000m.95Win.10to90scaled+ HorseFarm.3000m.95Win.10to90scaled

#  Overview of the final best model using the algorithm selection process (taking into account VIF, R^2, and p-values)
finalBestModel 
finalBestModelNames 
models[[besti]]$summarybestmodel
models[[besti]]$R2bestmodel

#  Same model written out with variables in name 
ecoli_LUR3_algorithmmethod <- lm(ecoli~nPigMultipFarmWghtDist.3000m.sum.95Win.10to90scaled+ npoultry.3000m.95Win.10to90scaled+ npigletsWghtDist.1000m.sum.95Win.10to90scaled+ notherpoultryanim.3000m.95Win.10to90scaled+ HorseFarm.3000m.95Win.10to90scaled, data= Measurements_livestockpreds_LUR3) 
summary(ecoli_LUR3_algorithmmethod)

# compute RMSE
ecoli_LUR3_preds <- predict(ecoli_LUR3_algorithmmethod, Measurements_livestockpreds_LUR3)
RMSE_ecoli_LUR3 <- sqrt(mean((Measurements_livestockpreds_LUR3$ecoli_copiespm3.ln.diffmeth.mean - ecoli_LUR3_preds)^2))
RMSE_ecoli_LUR3

#  Save these predicted concentrations along with the measured concentrations as an excel file 
#  Create a dataframe 
ecoli_LUR3_preds_observed <- data.frame(Measurements_livestockpreds_LUR3$Loc_ID,Measurements_livestockpreds_LUR3$ecoli_copiespm3.ln.diffmeth.mean, ecoli_LUR3_preds)
print(ecoli_LUR3_preds_observed)

#  Save as xls file 
write_xlsx(ecoli_LUR3_preds_observed,"Output_files//ecoli_LUR3_preds_observed.xlsx")

#  MODEL CHECKING:
#  1)Check normality of residuals 
#  2)Check residuals for linearity, independence and homoscedasticity
#  3)Check multicollinearity (VIF)
#  4)Check influential points (Cook's Distance)

#  1) Normality of residuals
boxplot(residuals(ecoli_LUR3_algorithmmethod),main="boxplot of residuals - ecoli LUR model 3",xlab="LUR model 3 residuals")
qqnorm(residuals(ecoli_LUR3_algorithmmethod),main="QQ-plot of residuals - ecoli LUR model 3",xlab="LUR model 3 residuals")

#  2)Check residuals for linearity, independence and homoscedasticity
plot(fitted(ecoli_LUR3_algorithmmethod),residuals(ecoli_LUR3_algorithmmethod))

#  3)Check multicollinearity (VIF)
maxvif_ecoli_LUR3 <- max(vif(ecoli_LUR3_algorithmmethod))
maxvif_ecoli_LUR3

#  4)Check influential points (Cook's Distance)
ols_plot_cooksd_bar(ecoli_LUR2_algorithmmethod, print_plot = TRUE)
maxCD_ecoli_LUR3<-max(cooks.distance(ecoli_LUR3_algorithmmethod))
maxCD_ecoli_LUR3

#  4)Check influential points (Cook's Distance)
ols_plot_cooksd_bar(ecoli_LUR3_algorithmmethod, print_plot = TRUE)
#  won't remove any outliers - none with cook's d > 1 

#  Make a scatterplot of predicted vs observed values
#  Use training model to predict E. coli concentrations
Ecoli_modelpreds <- predict(ecoli_LUR3_algorithmmethod,newdata=Measurements_livestockpreds_LUR3)
Ecoli_LUR3_training_R2 <- lm(Measurements_livestockpreds_LUR3$ecoli_copiespm3.ln.diffmeth.mean~Ecoli_modelpreds)
summary(Ecoli_LUR3_training_R2)
#  Overall comparison of predicted vs observed
plot(Ecoli_modelpreds, Measurements_livestockpreds_LUR3$ecoli_copiespm3.ln.diffmeth.mean, xlab="Training model LUR3-predicted E. coli DNA concentration (ln copies/m^3)", ylab="Observed E. coli DNA concentration (ln copies/m^3)", cex.lab=0.85)
abline(lm(Measurements_livestockpreds_LUR3$ecoli_copiespm3.ln.diffmeth.mean ~ Ecoli_modelpreds))
```
# E. coli LUR3 model - LOOCV
```{r}
#  LOOCV - LUR model 3 for E. coli
#  Leave one out cross validation - the goal of cross validation is to get a generalized score of the model. The reason for this generalization is to, hopefully, improve the model’s effectiveness in predicting on future data inputs.
#  It is a type of 'internal' cross validation
Measurements_livestockpreds_LUR3_LOOCV <- Measurements_livestockpreds_LUR3

set.seed(123)
Measurements_livestockpreds_LUR3_LOOCV$ecoli_LUR3_LOOCV_PRED <- unlist(lapply(1:nrow(Measurements_livestockpreds_LUR3_LOOCV),function(inx){
  train <- Measurements_livestockpreds_LUR3_LOOCV[-inx,,drop=FALSE]
  test <- Measurements_livestockpreds_LUR3_LOOCV[inx,,drop=FALSE]
  cvm <- lm(ecoli_copiespm3.ln.diffmeth.mean ~nPigMultipFarmWghtDist.3000m.sum.95Win.10to90scaled+ npoultry.3000m.95Win.10to90scaled+ npigletsWghtDist.1000m.sum.95Win.10to90scaled+ notherpoultryanim.3000m.95Win.10to90scaled+ HorseFarm.3000m.95Win.10to90scaled, data=train)
  pred <- predict(cvm,newdata=test)
  return(pred)
}))

predicted_ecoli_LUR3_LOOCV <- Measurements_livestockpreds_LUR3_LOOCV$ecoli_LUR3_LOOCV_PRED

#  Save these predicted concentrations along with the measured concentrations as an excel file 
#  Create a dataframe 
ecoli_LUR3_LOOCV_preds_observed <- data.frame(Measurements_livestockpreds_LUR3_LOOCV$Loc_ID,Measurements_livestockpreds_LUR3_LOOCV$ecoli_copiespm3.ln.diffmeth.mean, Measurements_livestockpreds_LUR3_LOOCV$ecoli_LUR3_LOOCV_PRED)
print(ecoli_LUR3_LOOCV_preds_observed)

#  Save as xls file 
write_xlsx(ecoli_LUR3_LOOCV_preds_observed,"Output_files//ecoli_LUR3_LOOCV_preds_observed.xlsx")

# Compute the LOOCV model R2
ecoli_LUR3_LOOCV_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean ~ ecoli_LUR3_LOOCV_PRED, data=Measurements_livestockpreds_LUR3_LOOCV)
summary(ecoli_LUR3_LOOCV_lm)
#  E. coli LUR3 model LOOCV multiple R^2 = 0.584

# Calculate RMSE
preds_ecoli_LUR3_LOOCV <- predict(ecoli_LUR3_LOOCV_lm, Measurements_livestockpreds_LUR3_LOOCV)
RMSE_ecoli_LUR3_LOOCV <- sqrt(mean((Measurements_livestockpreds_LUR3_LOOCV$ecoli_copiespm3.ln.diffmeth.mean - preds_ecoli_LUR3_LOOCV)^2))
RMSE_ecoli_LUR3_LOOCV

#  Plot LOOCV estimations vs. observed concentrations
plot(Measurements_livestockpreds_LUR2_LOOCV$ecoli_LUR2_LOOCV_PRED, Measurements_livestockpreds_LUR2_LOOCV$ecoli_copiespm3.ln.diffmeth.mean)
abline(lm(Measurements_livestockpreds_LUR2_LOOCV$ecoli_copiespm3.ln.diffmeth.mean ~ Measurements_livestockpreds_LUR2_LOOCV$ecoli_LUR2_LOOCV_PRED))
```
# E. coli LUR3 model - 10-fold CV
```{r}
options(stringsAsFactors = FALSE) # so that dataframes are not opened in new tabs

# This is the required dataset
Measurements_livestockpreds_LUR3

#  10-fold hold-out validation is done to assess model robustness. This is done using a random selection of 90% of the measurement sites. 
#  Part 1. Each measurement site gets randomly allocated number out of range 1-10
#  Completely randomly pulling sites
ecoli_HV_LUR3_df <- Measurements_livestockpreds_LUR3[c(1,2,6:138)] #  new df created with only ecoli values 
#  Create valID variable 
ecoli_HV_LUR3_df$valID <- 0
#  Draw 10 samples, thus on average 6 sites per test set (i.e 6 sites are removed from each model and then the model is tested on these 6 sites )
set.seed(123)
VGOB1_FINAL_ecoli_LUR3 <- c()
for (s in 1:1){
  if (s==1) set <- ecoli_HV_LUR3_df
  draws <- c(1:nrow(set))
  chosen <- c()
  tempdraws <- draws
  for (d in 1:10){
    list <- sample(tempdraws, length(tempdraws)/(11-d), FALSE)
    set[list,]$valID <- d
    chosen <- c(chosen, list)
    tempdraws <- draws[-chosen]
  }

#  Combine datasets to 1
VGOB1_FINAL_ecoli_LUR3 <- set
}

summary(set)
rm(set)

#  View the df created
str(VGOB1_FINAL_ecoli_LUR3, list.len=ncol(VGOB1_FINAL_ecoli_LUR3))
names(VGOB1_FINAL_ecoli_LUR3)
summary(VGOB1_FINAL_ecoli_LUR3)

#  Part 2: Make 10 subsets of dataset based on randomly allocated number (so these are the training datasets) 
#  Then create 10 subsets, each excluding 1 set of 10 sites
VGOB1_subsetA_ecoli_LUR3 <- subset(VGOB1_FINAL_ecoli_LUR3, valID != 1)
VGOB1_subsetB_ecoli_LUR3 <- subset(VGOB1_FINAL_ecoli_LUR3, valID != 2)  
VGOB1_subsetC_ecoli_LUR3 <- subset(VGOB1_FINAL_ecoli_LUR3, valID != 3)
VGOB1_subsetD_ecoli_LUR3 <- subset(VGOB1_FINAL_ecoli_LUR3, valID != 4)
VGOB1_subsetE_ecoli_LUR3 <- subset(VGOB1_FINAL_ecoli_LUR3, valID != 5)
VGOB1_subsetF_ecoli_LUR3 <- subset(VGOB1_FINAL_ecoli_LUR3, valID != 6)
VGOB1_subsetG_ecoli_LUR3 <- subset(VGOB1_FINAL_ecoli_LUR3, valID != 7)
VGOB1_subsetH_ecoli_LUR3 <- subset(VGOB1_FINAL_ecoli_LUR3, valID != 8)
VGOB1_subsetI_ecoli_LUR3 <- subset(VGOB1_FINAL_ecoli_LUR3, valID != 9)
VGOB1_subsetJ_ecoli_LUR3 <- subset(VGOB1_FINAL_ecoli_LUR3, valID != 10)

#  Part 3: Build for each subset a LUR model (i.e. go through the whole LUR model script for each subset (so each training set). Start with subset A, until final LUR model. Then subset B, until final LUR model etc.) 

#### A ####
# LUR model building process for subset A
#  This is the dataframe with the relevant predictor vars for LUR3 models for subset A (55 sites)
VGOB1_subsetA_ecoli_LUR3 # n.b. this dataframe only includes microbial marker concentrations for ecoli unlike the dataframe Measurements_livestockpreds_LUR3 as previously used for the model building. 

#  Now set the values of some variables that will be needed
nfirstvar_LUR_3 <- 3  
nlastvar_LUR_3 <- 135

# Function building to run the models 
# 1 #  

models<-list()
modeln<-1
models[[modeln]]<-list()

R2<-1
betaaddedvar<-1
addedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetA_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetA_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetA_ecoli_LUR3[,i])                            
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetA_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
models[[modeln]]$results

#  this are the candidates models with the highest R2, not a negative beta for the new, nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)
subset(models[[modeln]]$resultspos)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetA_ecoli_LUR3)[models[[1]]$indexbestmodel])
models[[modeln]]$namesbestmodel

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetA_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetA_ecoli_LUR3[,models[[1]]$indexbestmodel]) 
models[[modeln]]$bestmodel

summary(models[[modeln]]$bestmodel)

#  The first model includes the predictor: nPigMultipFarmWghtDist.3000m.sum.Tr.1P9 - meaning the number of multiplier pig farms weighted to distance in a 3000m buffer

# 2 #  
# Add 2nd variable (the only difference of the above part is that now modeln=2 the model statement has 2 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-2

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetA_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetA_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetA_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetA_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  these are the candidate models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetA_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR3)[models[[2]]$indexbestmodel] )
models[[modeln]]$namesbestmodel

# this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

# this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetA_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~                               VGOB1_subsetA_ecoli_LUR3[,models[[1]]$indexbestmodel]+                           VGOB1_subsetA_ecoli_LUR3[,models[[2]]$indexbestmodel]) 

models[[modeln]]$bestmodel

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel


# 3 #  
# add third variable (the only difference of the above part is that now modeln=3 the model statement has 3 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-3

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetA_ecoli_LUR3[,i])==TRUE){  
    modeltry<-lm(VGOB1_subsetA_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetA_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR3[,models[[2]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetA_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetA_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR3)[models[[2]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR3)[models[[3]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetA_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetA_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,models[[2]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,models[[3]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel


# 4 #  
#  add forth variable (the only difference of the above part is that now model n=4 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly
modeln<-4

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1


for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetA_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetA_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetA_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    #  the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetA_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetA_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR3)[models[[2]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR3)[models[[4]]$indexbestmodel])

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetA_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetA_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,models[[4]]$indexbestmodel]) 


models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel


# 5 #  
# add fifth variable (the only difference of the above part is that now modeln=5 the model statement more variables)
# and the call for the list of variable names in the model changed slightly
modeln<-5

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetA_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetA_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetA_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,models[[2]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,i]) 
  
R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetA_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetA_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR3)[models[[2]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR3)[models[[5]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetA_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetA_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,models[[5]]$indexbestmodel]) 
models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel

# 6 #  
# add sixth variable (the only difference of the above part is that now model n=6 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-6

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetA_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetA_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetA_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR3[,models[[4]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(All)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetA_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetA_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetA_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR3)[models[[6]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetA_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetA_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,models[[6]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel


# 7 #  
# add seventh variable (the only difference of the above part is that now model n=7 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-7

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetA_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetA_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetA_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR3[,models[[4]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR3[,models[[5]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetA_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetA_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetA_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR3)[models[[6]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR3)[models[[7]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetA_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetA_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,models[[7]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel

# 8 #  
# add eighth variable (the only difference of the above part is that now modeln=7 the model statement more variables)
# and the call for the list of variable names in the model changed slightly

modeln<-8

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetA_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetA_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetA_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR3[,models[[4]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR3[,models[[5]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetA_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetA_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetA_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR3)[models[[6]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR3)[models[[7]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR3)[models[[8]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetA_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetA_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,models[[8]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel

# 9 #  
# add ninth variable (the only difference of the above part is that now modeln=9 the model statement more variables)
# and the call for the list of variable names in the model changed slightly

modeln<-9

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetA_ecoli_LUR3[,i])==TRUE){
      modeltry<-lm(VGOB1_subsetA_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetA_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR3[,models[[4]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR3[,models[[5]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,models[[8]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,i]) 
        R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetA_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetA_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetA_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR3)[models[[6]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR3)[models[[7]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR3)[models[[8]]$indexbestmodel],  names(VGOB1_subsetA_ecoli_LUR3)[models[[9]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetA_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetA_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,models[[8]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,models[[9]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[9]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[9]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel
models[[9]]$R2bestmodel

# 10 #  
#  add tenth variable (the only difference of the above part is that now model n=10 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-10

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){if (is.numeric(VGOB1_subsetA_ecoli_LUR3[,i])==TRUE){ modeltry<-lm(VGOB1_subsetA_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetA_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR3[,models[[2]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetA_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,models[[8]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,models[[9]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,i]) 

R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetA_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c( names(VGOB1_subsetA_ecoli_LUR3)[models[[1]]$indexbestmodel],                   names(VGOB1_subsetA_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetA_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR3)[models[[6]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR3)[models[[7]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR3)[models[[8]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR3)[models[[9]]$indexbestmodel], names(VGOB1_subsetA_ecoli_LUR3)[models[[10]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetA_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~                                VGOB1_subsetA_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,models[[2]]$indexbestmodel]+                           VGOB1_subsetA_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,models[[8]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,models[[9]]$indexbestmodel]+ VGOB1_subsetA_ecoli_LUR3[,models[[10]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[9]]$summarybestmodel
models[[10]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[9]]$namesbestmodel
models[[10]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel
models[[9]]$R2bestmodel
models[[10]]$R2bestmodel

#  at this point I always check whether the next model is more than 1% better than the one before and if not I end here

#   CODE FOR PICKING OUT THE BEST MODEL #   
temp <- 0
besti <- 0
for (i in 1:10){ #  think this runs the loop 10 times - not fully sure thought - but not to do with the number of models I don't think - as when I change to 3, I still get the model with 4 variables as best model
  print(models[[i]]$R2bestmodel)
  #       print(models[[i]]$summarybestmodel$coefficients=-1,4])
  #       if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
  #         temp <- models[[i]]$R2bestmodel
  #         besti <- i
  #         }
  if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
    temp <- models[[i]]$R2bestmodel
    besti <- i
  }else{
    finalBestModel_ecoli_LUR3_subsetA <- models[[besti]]$bestmodel
    finalBestModelNames_ecoli_LUR3_subsetA <- models[[besti]]$namesbestmodel
    Sites <- 1:dim(VGOB1_subsetA_ecoli_LUR3)[1] # full original model
    #  CVaR2<-escCV_ecoli_LUR3(Sites)[2] # Cross Validation
    maxCD<-max(cooks.distance(finalBestModel_ecoli_LUR3_subsetA))
    if(length(finalBestModelNames_ecoli_LUR3_subsetA)<2){ # vif fn doesnot work when only 1 variable...       # 
      maxVIF<-"NA"
    }else{
      maxVIF<-max(vif(finalBestModel_ecoli_LUR3_subsetA))
    }
    print(paste("This is the best ecoli model for subset A: ",besti,
                "(AdjR2: ",format(models[[besti]]$R2bestmodel,digits=3), "; MaxCD: ",format(maxCD,digits=3),"; MaxVIF: ",
                format(maxVIF,digits=3),")", sep=''))
    print(finalBestModelNames_ecoli_LUR3_subsetA)
    break
  }
}

#  Overview of the final best model using the algorithm selection process (taking into account VIF, R^2, and p-values)
finalBestModel_ecoli_LUR3_subsetA 
finalBestModelNames_ecoli_LUR3_subsetA
models[[besti]]$summarybestmodel
models[[besti]]$R2bestmodel

#### B ####
# LUR model building process for subset B
# This is the dataframe with the relevant predictor vars for LUR3 models for subset B (55 sites)
VGOB1_subsetB_ecoli_LUR3 # n.b. this dataframe only includes microbial marker concentrations for ecoli unlike the dataframe Measurements_livestockpreds_LUR3 as previously used for the model building. 

#  Now set the values of some variables that will be needed
nfirstvar_LUR_3 <- 3  
nlastvar_LUR_3 <- 135

# Function building to run the models 
# 1 #  

models<-list()
modeln<-1
models[[modeln]]<-list()

R2<-1
betaaddedvar<-1
addedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetB_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetB_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetB_ecoli_LUR3[,i])                            
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetB_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
models[[modeln]]$results

#  this are the candidates models with the highest R2, not a negative beta for the new, nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)
subset(models[[modeln]]$resultspos)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetB_ecoli_LUR3)[models[[1]]$indexbestmodel])
models[[modeln]]$namesbestmodel

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetB_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetB_ecoli_LUR3[,models[[1]]$indexbestmodel]) 
models[[modeln]]$bestmodel

summary(models[[modeln]]$bestmodel)

#  The first model includes the predictor: nPigMultipFarmWghtDist.3000m.sum.Tr.1P9 - meaning the number of multiplier pig farms weighted to distance in a 3000m buffer

# 2 #  
# Add 2nd variable (the only difference of the above part is that now modeln=2 the model statement has 2 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-2

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetB_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetB_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetB_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetB_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  these are the candidate models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetB_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR3)[models[[2]]$indexbestmodel] )
models[[modeln]]$namesbestmodel

# this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

# this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetB_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~                               VGOB1_subsetB_ecoli_LUR3[,models[[1]]$indexbestmodel]+                           VGOB1_subsetB_ecoli_LUR3[,models[[2]]$indexbestmodel]) 

models[[modeln]]$bestmodel

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel


# 3 #  
# add third variable (the only difference of the above part is that now modeln=3 the model statement has 3 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-3

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetB_ecoli_LUR3[,i])==TRUE){  
    modeltry<-lm(VGOB1_subsetB_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetB_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetB_ecoli_LUR3[,models[[2]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetB_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetB_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR3)[models[[2]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR3)[models[[3]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetB_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetB_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[2]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[3]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel


# 4 #  
#  add forth variable (the only difference of the above part is that now model n=4 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly
modeln<-4

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1


for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetB_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetB_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetB_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetB_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetB_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetB_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    #  the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetB_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetB_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR3)[models[[2]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR3)[models[[4]]$indexbestmodel])

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetB_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetB_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[2]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[4]]$indexbestmodel]) 


models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel


# 5 #  
# add fifth variable (the only difference of the above part is that now modeln=5 the model statement more variables)
# and the call for the list of variable names in the model changed slightly
modeln<-5

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetB_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetB_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetB_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[2]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,i]) 
  
R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetB_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetB_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR3)[models[[2]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR3)[models[[5]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetB_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetB_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetB_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetB_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[5]]$indexbestmodel]) 
models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel

# 6 #  
# add sixth variable (the only difference of the above part is that now model n=6 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-6

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetB_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetB_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetB_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetB_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetB_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetB_ecoli_LUR3[,models[[4]]$indexbestmodel]+VGOB1_subsetB_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(All)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetB_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetB_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetB_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR3)[models[[6]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetB_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetB_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[2]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[6]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel


# 7 #  
# add seventh variable (the only difference of the above part is that now model n=7 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-7

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetB_ecoli_LUR3[,i])==TRUE){
    modeltry<- lm(VGOB1_subsetB_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetB_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[2]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetB_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetB_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetB_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR3)[models[[6]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR3)[models[[7]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetB_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetB_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[2]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[7]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel

# 8 #  
# add eighth variable (the only difference of the above part is that now modeln=7 the model statement more variables)
# and the call for the list of variable names in the model changed slightly

modeln<-8

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetB_ecoli_LUR3[,i])==TRUE){
    modeltry<- lm(VGOB1_subsetB_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetB_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[2]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetB_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetB_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetB_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR3)[models[[6]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR3)[models[[7]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR3)[models[[8]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetB_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetB_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[2]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[8]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel

# 9 #  
# add ninth variable (the only difference of the above part is that now modeln=9 the model statement more variables)
# and the call for the list of variable names in the model changed slightly

modeln<-9

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetB_ecoli_LUR3[,i])==TRUE){
      modeltry<-lm(VGOB1_subsetB_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetB_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[2]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[8]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,i]) 
        R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetB_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetB_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetB_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR3)[models[[6]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR3)[models[[7]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR3)[models[[8]]$indexbestmodel],  names(VGOB1_subsetB_ecoli_LUR3)[models[[9]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetB_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetB_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[2]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[8]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[9]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[9]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[9]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel
models[[9]]$R2bestmodel

# 10 #  
#  add tenth variable (the only difference of the above part is that now model n=10 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-10

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){if (is.numeric(VGOB1_subsetB_ecoli_LUR3[,i])==TRUE){ modeltry<-lm(VGOB1_subsetB_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetB_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[2]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[8]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[9]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,i]) 

R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetB_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetB_ecoli_LUR3)[models[[1]]$indexbestmodel],    names(VGOB1_subsetB_ecoli_LUR3)[models[[2]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR3)[models[[6]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR3)[models[[7]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR3)[models[[8]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR3)[models[[9]]$indexbestmodel], names(VGOB1_subsetB_ecoli_LUR3)[models[[10]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetB_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~        VGOB1_subsetB_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[2]]$indexbestmodel]+  VGOB1_subsetB_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[8]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[9]]$indexbestmodel]+ VGOB1_subsetB_ecoli_LUR3[,models[[10]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[9]]$summarybestmodel
models[[10]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[9]]$namesbestmodel
models[[10]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel
models[[9]]$R2bestmodel
models[[10]]$R2bestmodel

#  at this point I always check whether the next model is more than 1% better than the one before and if not I end here

#   CODE FOR PICKING OUT THE BEST MODEL #   
temp <- 0
besti <- 0
for (i in 1:10){ #  think this runs the loop 10 times - not fully sure thought - but not to do with the number of models I don't think - as when I change to 3, I still get the model with 4 variables as best model
  print(models[[i]]$R2bestmodel)
  #       print(models[[i]]$summarybestmodel$coefficients=-1,4])
  #       if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
  #         temp <- models[[i]]$R2bestmodel
  #         besti <- i
  #         }
  if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
    temp <- models[[i]]$R2bestmodel
    besti <- i
  }else{
    finalBestModel_ecoli_LUR3_subsetB <- models[[besti]]$bestmodel
    finalBestModelNames_ecoli_LUR3_subsetB <- models[[besti]]$namesbestmodel
    Sites <- 1:dim(VGOB1_subsetB_ecoli_LUR3)[1] # full original model
    #  CVaR2<-escCV_ecoli_LUR3(Sites)[2] # Cross Validation
    maxCD<-max(cooks.distance(finalBestModel_ecoli_LUR3_subsetB))
    if(length(finalBestModelNames_ecoli_LUR3_subsetB)<2){ # vif fn doesnot work when only 1 variable...       # 
      maxVIF<-"NA"
    }else{
      maxVIF<-max(vif(finalBestModel_ecoli_LUR3_subsetB))
    }
    print(paste("This is the best ecoli model for subset B of 10-fold CV: ",besti,
                "(AdjR2: ",format(models[[besti]]$R2bestmodel,digits=3), "; MaxCD: ",format(maxCD,digits=3),"; MaxVIF: ",
                format(maxVIF,digits=3),")", sep=''))
    print(finalBestModelNames_ecoli_LUR3_subsetB)
    break
  }
}

#  Overview of the final best model using the algorithm selection process (taking into account VIF, R^2, and p-values)
finalBestModel_ecoli_LUR3_subsetB 
finalBestModelNames_ecoli_LUR3_subsetB 
models[[besti]]$summarybestmodel
models[[besti]]$R2bestmodel

#### C ####
# LUR model building process for subset C
#  This is the dataframe with the relevant predictor vars for LUR3 models for subset C (55 sites)
VGOB1_subsetC_ecoli_LUR3 # n.b. this dataframe only includes microbial marker concentrations for ecoli unlike the dataframe Measurements_livestockpreds_LUR3 as previously used for the model building. 

#  Now set the values of some variables that will be needed
nfirstvar_LUR_3 <- 3  
nlastvar_LUR_3 <- 135

# Function building to run the models 
# 1 #  

models<-list()
modeln<-1
models[[modeln]]<-list()

R2<-1
betaaddedvar<-1
addedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetC_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetC_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetC_ecoli_LUR3[,i])                            
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetC_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
models[[modeln]]$results

#  this are the candidates models with the highest R2, not a negative beta for the new, nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)
subset(models[[modeln]]$resultspos)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetC_ecoli_LUR3)[models[[1]]$indexbestmodel])
models[[modeln]]$namesbestmodel

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetC_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetC_ecoli_LUR3[,models[[1]]$indexbestmodel]) 
models[[modeln]]$bestmodel

summary(models[[modeln]]$bestmodel)

#  The first model includes the predictor: nPigMultipFarmWghtDist.3000m.sum.Tr.1P9 - meaning the number of multiplier pig farms weighted to distance in a 3000m buffer

# 2 #  
# Add 2nd variable (the only difference of the above part is that now modeln=2 the model statement has 2 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-2

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetC_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetC_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetC_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetC_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  these are the candidate models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetC_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR3)[models[[2]]$indexbestmodel] )
models[[modeln]]$namesbestmodel

# this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

# this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetC_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~                               VGOB1_subsetC_ecoli_LUR3[,models[[1]]$indexbestmodel]+                           VGOB1_subsetC_ecoli_LUR3[,models[[2]]$indexbestmodel]) 

models[[modeln]]$bestmodel

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel


# 3 #  
# add third variable (the only difference of the above part is that now modeln=3 the model statement has 3 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-3

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetC_ecoli_LUR3[,i])==TRUE){  
    modeltry<-lm(VGOB1_subsetC_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetC_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR3[,models[[2]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetC_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetC_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR3)[models[[2]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR3)[models[[3]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetC_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetC_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,models[[2]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,models[[3]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel


# 4 #  
#  add forth variable (the only difference of the above part is that now model n=4 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly
modeln<-4

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1


for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetC_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetC_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetC_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    #  the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetC_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetC_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR3)[models[[2]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR3)[models[[4]]$indexbestmodel])

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetC_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetC_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,models[[4]]$indexbestmodel]) 


models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel


# 5 #  
# add fifth variable (the only difference of the above part is that now modeln=5 the model statement more variables)
# and the call for the list of variable names in the model changed slightly
modeln<-5

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetC_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetC_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetC_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,models[[2]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,i]) 
  
R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetC_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetC_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR3)[models[[2]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR3)[models[[5]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetC_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetC_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,models[[5]]$indexbestmodel]) 
models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel

# 6 #  
# add sixth variable (the only difference of the above part is that now model n=6 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-6

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetC_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetC_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetC_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR3[,models[[4]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(All)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetC_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetC_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetC_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR3)[models[[6]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetC_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetC_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,models[[6]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel


# 7 #  
# add seventh variable (the only difference of the above part is that now model n=7 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-7

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetC_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetC_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetC_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR3[,models[[4]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR3[,models[[5]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetC_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetC_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetC_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR3)[models[[6]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR3)[models[[7]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetC_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetC_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,models[[7]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel

# 8 #  
# add eighth variable (the only difference of the above part is that now modeln=7 the model statement more variables)
# and the call for the list of variable names in the model changed slightly

modeln<-8

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetC_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetC_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetC_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR3[,models[[4]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR3[,models[[5]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetC_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetC_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetC_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR3)[models[[6]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR3)[models[[7]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR3)[models[[8]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetC_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetC_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,models[[8]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel

# 9 #  
# add ninth variable (the only difference of the above part is that now modeln=9 the model statement more variables)
# and the call for the list of variable names in the model changed slightly

modeln<-9

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetC_ecoli_LUR3[,i])==TRUE){
      modeltry<-lm(VGOB1_subsetC_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetC_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR3[,models[[4]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR3[,models[[5]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,models[[8]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,i]) 
        R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetC_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetC_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetC_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR3)[models[[6]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR3)[models[[7]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR3)[models[[8]]$indexbestmodel],  names(VGOB1_subsetC_ecoli_LUR3)[models[[9]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetC_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetC_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,models[[8]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,models[[9]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[9]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[9]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel
models[[9]]$R2bestmodel

# 10 #  
#  add tenth variable (the only difference of the above part is that now model n=10 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-10

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){if (is.numeric(VGOB1_subsetC_ecoli_LUR3[,i])==TRUE){ modeltry<-lm(VGOB1_subsetC_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetC_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR3[,models[[2]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetC_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,models[[8]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,models[[9]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,i]) 

R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetC_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c( names(VGOB1_subsetC_ecoli_LUR3)[models[[1]]$indexbestmodel],                   names(VGOB1_subsetC_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetC_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR3)[models[[6]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR3)[models[[7]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR3)[models[[8]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR3)[models[[9]]$indexbestmodel], names(VGOB1_subsetC_ecoli_LUR3)[models[[10]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetC_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~                                VGOB1_subsetC_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,models[[2]]$indexbestmodel]+                           VGOB1_subsetC_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,models[[8]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,models[[9]]$indexbestmodel]+ VGOB1_subsetC_ecoli_LUR3[,models[[10]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[9]]$summarybestmodel
models[[10]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[9]]$namesbestmodel
models[[10]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel
models[[9]]$R2bestmodel
models[[10]]$R2bestmodel

#  at this point I always check whether the next model is more than 1% better than the one before and if not I end here

#   CODE FOR PICKING OUT THE BEST MODEL #   
temp <- 0
besti <- 0
for (i in 1:10){ #  think this runs the loop 10 times - not fully sure thought - but not to do with the number of models I don't think - as when I change to 3, I still get the model with 4 variables as best model
  print(models[[i]]$R2bestmodel)
  #       print(models[[i]]$summarybestmodel$coefficients=-1,4])
  #       if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
  #         temp <- models[[i]]$R2bestmodel
  #         besti <- i
  #         }
  if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
    temp <- models[[i]]$R2bestmodel
    besti <- i
  }else{
    finalBestModel_ecoli_LUR3_subsetC <- models[[besti]]$bestmodel
    finalBestModelNames_ecoli_LUR3_subsetC <- models[[besti]]$namesbestmodel
    Sites <- 1:dim(VGOB1_subsetC_ecoli_LUR3)[1] # full original model
    #  CVaR2<-escCV_ecoli_LUR3(Sites)[2] # Cross Validation
    maxCD<-max(cooks.distance(finalBestModel_ecoli_LUR3_subsetC))
    if(length(finalBestModelNames_ecoli_LUR3_subsetC)<2){ # vif fn doesnot work when only 1 variable...       # 
      maxVIF<-"NA"
    }else{
      maxVIF<-max(vif(finalBestModel_ecoli_LUR3_subsetC))
    }
    print(paste("This is the best ecoli model for subset C: ",besti,
                "(AdjR2: ",format(models[[besti]]$R2bestmodel,digits=3), "; MaxCD: ",format(maxCD,digits=3),"; MaxVIF: ",
                format(maxVIF,digits=3),")", sep=''))
    print(finalBestModelNames_ecoli_LUR3_subsetC)
    break
  }
}

#  Overview of the final best model using the algorithm selection process (taking into account VIF, R^2, and p-values)
finalBestModel_ecoli_LUR3_subsetC
finalBestModelNames_ecoli_LUR3_subsetC
models[[besti]]$summarybestmodel
models[[besti]]$R2bestmodel

#### D ####
# LUR model building process for subset D
#  This is the dataframe with the relevant predictor vars for LUR3 models for subset D (55 sites)
VGOB1_subsetD_ecoli_LUR3 # n.b. this dataframe only includes microbial marker concentrations for ecoli unlike the dataframe Measurements_livestockpreds_LUR3 as previously used for the model building. 

#  Now set the values of some variables that will be needed
nfirstvar_LUR_3 <- 3  
nlastvar_LUR_3 <- 135

# Function building to run the models 
# 1 #  

models<-list()
modeln<-1
models[[modeln]]<-list()

R2<-1
betaaddedvar<-1
addedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetD_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetD_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetD_ecoli_LUR3[,i])                            
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetD_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
models[[modeln]]$results

#  this are the candidates models with the highest R2, not a negative beta for the new, nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)
subset(models[[modeln]]$resultspos)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetD_ecoli_LUR3)[models[[1]]$indexbestmodel])
models[[modeln]]$namesbestmodel

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetD_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetD_ecoli_LUR3[,models[[1]]$indexbestmodel]) 
models[[modeln]]$bestmodel

summary(models[[modeln]]$bestmodel)

#  The first model includes the predictor: nPigMultipFarmWghtDist.3000m.sum.Tr.1P9 - meaning the number of multiplier pig farms weighted to distance in a 3000m buffer

# 2 #  
# Add 2nd variable (the only difference of the above part is that now modeln=2 the model statement has 2 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-2

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetD_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetD_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetD_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetD_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  these are the candidate models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetD_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR3)[models[[2]]$indexbestmodel] )
models[[modeln]]$namesbestmodel

# this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

# this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetD_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~                               VGOB1_subsetD_ecoli_LUR3[,models[[1]]$indexbestmodel]+                           VGOB1_subsetD_ecoli_LUR3[,models[[2]]$indexbestmodel]) 

models[[modeln]]$bestmodel

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel


# 3 #  
# add third variable (the only difference of the above part is that now modeln=3 the model statement has 3 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-3

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetD_ecoli_LUR3[,i])==TRUE){  
    modeltry<-lm(VGOB1_subsetD_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetD_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR3[,models[[2]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetD_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetD_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR3)[models[[2]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR3)[models[[3]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetD_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetD_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,models[[2]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,models[[3]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel


# 4 #  
#  add forth variable (the only difference of the above part is that now model n=4 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly
modeln<-4

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1


for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetD_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetD_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetD_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    #  the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetD_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetD_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR3)[models[[2]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR3)[models[[4]]$indexbestmodel])

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetD_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetD_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,models[[4]]$indexbestmodel]) 


models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel


# 5 #  
# add fifth variable (the only difference of the above part is that now modeln=5 the model statement more variables)
# and the call for the list of variable names in the model changed slightly
modeln<-5

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetD_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetD_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetD_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,models[[2]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,i]) 
  
R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetD_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetD_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR3)[models[[2]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR3)[models[[5]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetD_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetD_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,models[[5]]$indexbestmodel]) 
models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel

# 6 #  
# add sixth variable (the only difference of the above part is that now model n=6 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-6

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetD_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetD_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetD_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR3[,models[[4]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(All)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetD_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetD_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetD_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR3)[models[[6]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetD_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetD_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,models[[6]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel


# 7 #  
# add seventh variable (the only difference of the above part is that now model n=7 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-7

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetD_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetD_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetD_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR3[,models[[4]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR3[,models[[5]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetD_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetD_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetD_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR3)[models[[6]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR3)[models[[7]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetD_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetD_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,models[[7]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel

# 8 #  
# add eighth variable (the only difference of the above part is that now modeln=7 the model statement more variables)
# and the call for the list of variable names in the model changed slightly

modeln<-8

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetD_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetD_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetD_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR3[,models[[4]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR3[,models[[5]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetD_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetD_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetD_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR3)[models[[6]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR3)[models[[7]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR3)[models[[8]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetD_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetD_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,models[[8]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel

# 9 #  
# add ninth variable (the only difference of the above part is that now modeln=9 the model statement more variables)
# and the call for the list of variable names in the model changed slightly

modeln<-9

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetD_ecoli_LUR3[,i])==TRUE){
      modeltry<-lm(VGOB1_subsetD_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetD_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR3[,models[[4]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR3[,models[[5]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,models[[8]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,i]) 
        R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetD_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetD_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetD_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR3)[models[[6]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR3)[models[[7]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR3)[models[[8]]$indexbestmodel],  names(VGOB1_subsetD_ecoli_LUR3)[models[[9]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetD_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetD_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,models[[8]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,models[[9]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[9]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[9]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel
models[[9]]$R2bestmodel

# 10 #  
#  add tenth variable (the only difference of the above part is that now model n=10 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-10

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){if (is.numeric(VGOB1_subsetD_ecoli_LUR3[,i])==TRUE){ modeltry<-lm(VGOB1_subsetD_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetD_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR3[,models[[2]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetD_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,models[[8]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,models[[9]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,i]) 

R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetD_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c( names(VGOB1_subsetD_ecoli_LUR3)[models[[1]]$indexbestmodel],                   names(VGOB1_subsetD_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetD_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR3)[models[[6]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR3)[models[[7]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR3)[models[[8]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR3)[models[[9]]$indexbestmodel], names(VGOB1_subsetD_ecoli_LUR3)[models[[10]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetD_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~                                VGOB1_subsetD_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,models[[2]]$indexbestmodel]+                           VGOB1_subsetD_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,models[[8]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,models[[9]]$indexbestmodel]+ VGOB1_subsetD_ecoli_LUR3[,models[[10]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[9]]$summarybestmodel
models[[10]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[9]]$namesbestmodel
models[[10]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel
models[[9]]$R2bestmodel
models[[10]]$R2bestmodel

#  at this point I always check whether the next model is more than 1% better than the one before and if not I end here

#   CODE FOR PICKING OUT THE BEST MODEL #   
temp <- 0
besti <- 0
for (i in 1:10){ #  think this runs the loop 10 times - not fully sure thought - but not to do with the number of models I don't think - as when I change to 3, I still get the model with 4 variables as best model
  print(models[[i]]$R2bestmodel)
  #       print(models[[i]]$summarybestmodel$coefficients=-1,4])
  #       if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
  #         temp <- models[[i]]$R2bestmodel
  #         besti <- i
  #         }
  if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
    temp <- models[[i]]$R2bestmodel
    besti <- i
  }else{
    finalBestModel_ecoli_LUR3_subsetD <- models[[besti]]$bestmodel
    finalBestModelNames_ecoli_LUR3_subsetD <- models[[besti]]$namesbestmodel
    Sites <- 1:dim(VGOB1_subsetD_ecoli_LUR3)[1] # full original model
    #  CVaR2<-escCV_ecoli_LUR3(Sites)[2] # Cross Validation
    maxCD<-max(cooks.distance(finalBestModel_ecoli_LUR3_subsetD))
    if(length(finalBestModelNames_ecoli_LUR3_subsetD)<2){ # vif fn doesnot work when only 1 variable...       # 
      maxVIF<-"NA"
    }else{
      maxVIF<-max(vif(finalBestModel_ecoli_LUR3_subsetD))
    }
    print(paste("This is the best ecoli model for subset D: ",besti,
                "(AdjR2: ",format(models[[besti]]$R2bestmodel,digits=3), "; MaxCD: ",format(maxCD,digits=3),"; MaxVIF: ",
                format(maxVIF,digits=3),")", sep=''))
    print(finalBestModelNames_ecoli_LUR3_subsetD)
    break
  }
}

#  Overview of the final best model using the algorithm selection process (taking into account VIF, R^2, and p-values)
finalBestModel_ecoli_LUR3_subsetD
finalBestModelNames_ecoli_LUR3_subsetD
models[[besti]]$summarybestmodel
models[[besti]]$R2bestmodel


#### E ####
# LUR model building process for subset E
#  This is the dataframe with the relevant predictor vars for LUR3 models for subset E (55 sites)
VGOB1_subsetE_ecoli_LUR3 # n.b. this dataframe only includes microbial marker concentrations for ecoli unlike the dataframe Measurements_livestockpreds_LUR3 as previously used for the model building. 

#  Now set the values of some variables that will be needed
nfirstvar_LUR_3 <- 3  
nlastvar_LUR_3 <- 135

# Function building to run the models 
# 1 #  

models<-list()
modeln<-1
models[[modeln]]<-list()

R2<-1
betaaddedvar<-1
addedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetE_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetE_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetE_ecoli_LUR3[,i])                            
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetE_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
models[[modeln]]$results

#  this are the candidates models with the highest R2, not a negative beta for the new, nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)
subset(models[[modeln]]$resultspos)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetE_ecoli_LUR3)[models[[1]]$indexbestmodel])
models[[modeln]]$namesbestmodel

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetE_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetE_ecoli_LUR3[,models[[1]]$indexbestmodel]) 
models[[modeln]]$bestmodel

summary(models[[modeln]]$bestmodel)

#  The first model includes the predictor: nPigMultipFarmWghtDist.3000m.sum.Tr.1P9 - meaning the number of multiplier pig farms weighted to distance in a 3000m buffer

# 2 #  
# Add 2nd variable (the only difference of the above part is that now modeln=2 the model statement has 2 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-2

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetE_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetE_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetE_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetE_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  these are the candidate models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetE_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR3)[models[[2]]$indexbestmodel] )
models[[modeln]]$namesbestmodel

# this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

# this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetE_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~                               VGOB1_subsetE_ecoli_LUR3[,models[[1]]$indexbestmodel]+                           VGOB1_subsetE_ecoli_LUR3[,models[[2]]$indexbestmodel]) 

models[[modeln]]$bestmodel

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel


# 3 #  
# add third variable (the only difference of the above part is that now modeln=3 the model statement has 3 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-3

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetE_ecoli_LUR3[,i])==TRUE){  
    modeltry<-lm(VGOB1_subsetE_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetE_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR3[,models[[2]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetE_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetE_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR3)[models[[2]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR3)[models[[3]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetE_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetE_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,models[[2]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,models[[3]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel


# 4 #  
#  add forth variable (the only difference of the above part is that now model n=4 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly
modeln<-4

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1


for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetE_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetE_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetE_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    #  the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetE_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetE_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR3)[models[[2]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR3)[models[[4]]$indexbestmodel])

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetE_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetE_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,models[[4]]$indexbestmodel]) 


models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel


# 5 #  
# add fifth variable (the only difference of the above part is that now modeln=5 the model statement more variables)
# and the call for the list of variable names in the model changed slightly
modeln<-5

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetE_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetE_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetE_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,models[[2]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,i]) 
  
R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetE_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetE_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR3)[models[[2]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR3)[models[[5]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetE_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetE_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,models[[5]]$indexbestmodel]) 
models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel

# 6 #  
# add sixth variable (the only difference of the above part is that now model n=6 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-6

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetE_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetE_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetE_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR3[,models[[4]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(All)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetE_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetE_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetE_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR3)[models[[6]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetE_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetE_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,models[[6]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel


# 7 #  
# add seventh variable (the only difference of the above part is that now model n=7 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-7

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetE_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetE_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetE_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR3[,models[[4]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR3[,models[[5]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetE_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetE_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetE_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR3)[models[[6]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR3)[models[[7]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetE_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetE_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,models[[7]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel

# 8 #  
# add eighth variable (the only difference of the above part is that now modeln=7 the model statement more variables)
# and the call for the list of variable names in the model changed slightly

modeln<-8

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetE_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetE_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetE_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR3[,models[[4]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR3[,models[[5]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetE_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetE_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetE_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR3)[models[[6]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR3)[models[[7]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR3)[models[[8]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetE_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetE_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,models[[8]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel

# 9 #  
# add ninth variable (the only difference of the above part is that now modeln=9 the model statement more variables)
# and the call for the list of variable names in the model changed slightly

modeln<-9

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetE_ecoli_LUR3[,i])==TRUE){
      modeltry<-lm(VGOB1_subsetE_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetE_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR3[,models[[4]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR3[,models[[5]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,models[[8]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,i]) 
        R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetE_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetE_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetE_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR3)[models[[6]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR3)[models[[7]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR3)[models[[8]]$indexbestmodel],  names(VGOB1_subsetE_ecoli_LUR3)[models[[9]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetE_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetE_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,models[[8]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,models[[9]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[9]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[9]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel
models[[9]]$R2bestmodel

# 10 #  
#  add tenth variable (the only difference of the above part is that now model n=10 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-10

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){if (is.numeric(VGOB1_subsetE_ecoli_LUR3[,i])==TRUE){ modeltry<-lm(VGOB1_subsetE_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetE_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR3[,models[[2]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetE_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,models[[8]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,models[[9]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,i]) 

R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetE_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c( names(VGOB1_subsetE_ecoli_LUR3)[models[[1]]$indexbestmodel],                   names(VGOB1_subsetE_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetE_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR3)[models[[6]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR3)[models[[7]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR3)[models[[8]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR3)[models[[9]]$indexbestmodel], names(VGOB1_subsetE_ecoli_LUR3)[models[[10]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetE_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~                                VGOB1_subsetE_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,models[[2]]$indexbestmodel]+                           VGOB1_subsetE_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,models[[8]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,models[[9]]$indexbestmodel]+ VGOB1_subsetE_ecoli_LUR3[,models[[10]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[9]]$summarybestmodel
models[[10]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[9]]$namesbestmodel
models[[10]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel
models[[9]]$R2bestmodel
models[[10]]$R2bestmodel

#  at this point I always check whether the next model is more than 1% better than the one before and if not I end here

#   CODE FOR PICKING OUT THE BEST MODEL #   
temp <- 0
besti <- 0
for (i in 1:10){ #  think this runs the loop 10 times - not fully sure thought - but not to do with the number of models I don't think - as when I change to 3, I still get the model with 4 variables as best model
  print(models[[i]]$R2bestmodel)
  #       print(models[[i]]$summarybestmodel$coefficients=-1,4])
  #       if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
  #         temp <- models[[i]]$R2bestmodel
  #         besti <- i
  #         }
  if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
    temp <- models[[i]]$R2bestmodel
    besti <- i
  }else{
    finalBestModel_ecoli_LUR3_subsetE <- models[[besti]]$bestmodel
    finalBestModelNames_ecoli_LUR3_subsetE <- models[[besti]]$namesbestmodel
    Sites <- 1:dim(VGOB1_subsetE_ecoli_LUR3)[1] # full original model
    #  CVaR2<-escCV_ecoli_LUR3(Sites)[2] # Cross Validation
    maxCD<-max(cooks.distance(finalBestModel_ecoli_LUR3_subsetE))
    if(length(finalBestModelNames_ecoli_LUR3_subsetE)<2){ # vif fn doesnot work when only 1 variable...       # 
      maxVIF<-"NA"
    }else{
      maxVIF<-max(vif(finalBestModel_ecoli_LUR3_subsetE))
    }
    print(paste("This is the best ecoli model for subset E: ",besti,
                "(AdjR2: ",format(models[[besti]]$R2bestmodel,digits=3), "; MaxCD: ",format(maxCD,digits=3),"; MaxVIF: ",
                format(maxVIF,digits=3),")", sep=''))
    print(finalBestModelNames_ecoli_LUR3_subsetE)
    break
  }
}

#  Overview of the final best model using the algorithm selection process (taking into account VIF, R^2, and p-values)
finalBestModel_ecoli_LUR3_subsetE
finalBestModelNames_ecoli_LUR3_subsetE
models[[besti]]$summarybestmodel
models[[besti]]$R2bestmodel

#### F ####
# LUR model building process for subset F
#  This is the dataframe with the relevant predictor vars for LUR3 models for subset F (55 sites)
VGOB1_subsetF_ecoli_LUR3 # n.b. this dataframe only includes microbial marker concentrations for ecoli unlike the dataframe Measurements_livestockpreds_LUR3 as previously used for the model building. 

#  Now set the values of some variables that will be needed
nfirstvar_LUR_3 <- 3  
nlastvar_LUR_3 <- 135

# Function building to run the models 
# 1 #  

models<-list()
modeln<-1
models[[modeln]]<-list()

R2<-1
betaaddedvar<-1
addedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetF_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetF_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetF_ecoli_LUR3[,i])                            
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetF_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
models[[modeln]]$results

#  this are the candidates models with the highest R2, not a negative beta for the new, nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)
subset(models[[modeln]]$resultspos)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetF_ecoli_LUR3)[models[[1]]$indexbestmodel])
models[[modeln]]$namesbestmodel

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetF_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetF_ecoli_LUR3[,models[[1]]$indexbestmodel]) 
models[[modeln]]$bestmodel

summary(models[[modeln]]$bestmodel)

#  The first model includes the predictor: nPigMultipFarmWghtDist.3000m.sum.Tr.1P9 - meaning the number of multiplier pig farms weighted to distance in a 3000m buffer

# 2 #  
# Add 2nd variable (the only difference of the above part is that now modeln=2 the model statement has 2 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-2

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetF_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetF_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetF_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetF_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  these are the candidate models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetF_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR3)[models[[2]]$indexbestmodel] )
models[[modeln]]$namesbestmodel

# this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

# this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetF_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~                               VGOB1_subsetF_ecoli_LUR3[,models[[1]]$indexbestmodel]+                           VGOB1_subsetF_ecoli_LUR3[,models[[2]]$indexbestmodel]) 

models[[modeln]]$bestmodel

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel


# 3 #  
# add third variable (the only difference of the above part is that now modeln=3 the model statement has 3 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-3

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetF_ecoli_LUR3[,i])==TRUE){  
    modeltry<-lm(VGOB1_subsetF_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetF_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR3[,models[[2]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetF_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetF_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR3)[models[[2]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR3)[models[[3]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetF_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetF_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,models[[2]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,models[[3]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel


# 4 #  
#  add forth variable (the only difference of the above part is that now model n=4 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly
modeln<-4

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1


for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetF_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetF_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetF_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    #  the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetF_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetF_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR3)[models[[2]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR3)[models[[4]]$indexbestmodel])

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetF_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetF_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,models[[4]]$indexbestmodel]) 


models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel


# 5 #  
# add fifth variable (the only difference of the above part is that now modeln=5 the model statement more variables)
# and the call for the list of variable names in the model changed slightly
modeln<-5

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetF_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetF_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetF_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,models[[2]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,i]) 
  
R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetF_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetF_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR3)[models[[2]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR3)[models[[5]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetF_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetF_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,models[[5]]$indexbestmodel]) 
models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel

# 6 #  
# add sixth variable (the only difference of the above part is that now model n=6 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-6

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetF_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetF_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetF_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR3[,models[[4]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(All)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetF_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetF_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetF_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR3)[models[[6]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetF_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetF_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,models[[6]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel


# 7 #  
# add seventh variable (the only difference of the above part is that now model n=7 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-7

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetF_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetF_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetF_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR3[,models[[4]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR3[,models[[5]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetF_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetF_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetF_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR3)[models[[6]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR3)[models[[7]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetF_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetF_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,models[[7]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel

# 8 #  
# add eighth variable (the only difference of the above part is that now modeln=7 the model statement more variables)
# and the call for the list of variable names in the model changed slightly

modeln<-8

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetF_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetF_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetF_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR3[,models[[4]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR3[,models[[5]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetF_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetF_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetF_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR3)[models[[6]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR3)[models[[7]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR3)[models[[8]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetF_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetF_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,models[[8]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel

# 9 #  
# add ninth variable (the only difference of the above part is that now modeln=9 the model statement more variables)
# and the call for the list of variable names in the model changed slightly

modeln<-9

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetF_ecoli_LUR3[,i])==TRUE){
      modeltry<-lm(VGOB1_subsetF_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetF_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR3[,models[[4]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR3[,models[[5]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,models[[8]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,i]) 
        R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetF_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetF_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetF_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR3)[models[[6]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR3)[models[[7]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR3)[models[[8]]$indexbestmodel],  names(VGOB1_subsetF_ecoli_LUR3)[models[[9]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetF_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetF_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,models[[8]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,models[[9]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[9]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[9]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel
models[[9]]$R2bestmodel

# 10 #  
#  add tenth variable (the only difference of the above part is that now model n=10 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-10

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){if (is.numeric(VGOB1_subsetF_ecoli_LUR3[,i])==TRUE){ modeltry<-lm(VGOB1_subsetF_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetF_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR3[,models[[2]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetF_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,models[[8]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,models[[9]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,i]) 

R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetF_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c( names(VGOB1_subsetF_ecoli_LUR3)[models[[1]]$indexbestmodel],                   names(VGOB1_subsetF_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetF_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR3)[models[[6]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR3)[models[[7]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR3)[models[[8]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR3)[models[[9]]$indexbestmodel], names(VGOB1_subsetF_ecoli_LUR3)[models[[10]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetF_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~                                VGOB1_subsetF_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,models[[2]]$indexbestmodel]+                           VGOB1_subsetF_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,models[[8]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,models[[9]]$indexbestmodel]+ VGOB1_subsetF_ecoli_LUR3[,models[[10]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[9]]$summarybestmodel
models[[10]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[9]]$namesbestmodel
models[[10]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel
models[[9]]$R2bestmodel
models[[10]]$R2bestmodel

#  at this point I always check whether the next model is more than 1% better than the one before and if not I end here

#   CODE FOR PICKING OUT THE BEST MODEL #   
temp <- 0
besti <- 0
for (i in 1:10){ #  think this runs the loop 10 times - not fully sure thought - but not to do with the number of models I don't think - as when I change to 3, I still get the model with 4 variables as best model
  print(models[[i]]$R2bestmodel)
  #       print(models[[i]]$summarybestmodel$coefficients=-1,4])
  #       if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
  #         temp <- models[[i]]$R2bestmodel
  #         besti <- i
  #         }
  if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
    temp <- models[[i]]$R2bestmodel
    besti <- i
  }else{
    finalBestModel_ecoli_LUR3_subsetF <- models[[besti]]$bestmodel
    finalBestModelNames_ecoli_LUR3_subsetF <- models[[besti]]$namesbestmodel
    Sites <- 1:dim(VGOB1_subsetF_ecoli_LUR3)[1] # full original model
    #  CVaR2<-escCV_ecoli_LUR3(Sites)[2] # Cross Validation
    maxCD<-max(cooks.distance(finalBestModel_ecoli_LUR3_subsetF))
    if(length(finalBestModelNames_ecoli_LUR3_subsetF)<2){ # vif fn doesnot work when only 1 variable...       # 
      maxVIF<-"NA"
    }else{
      maxVIF<-max(vif(finalBestModel_ecoli_LUR3_subsetF))
    }
    print(paste("This is the best ecoli model for subset F: ",besti,
                "(AdjR2: ",format(models[[besti]]$R2bestmodel,digits=3), "; MaxCD: ",format(maxCD,digits=3),"; MaxVIF: ",
                format(maxVIF,digits=3),")", sep=''))
    print(finalBestModelNames_ecoli_LUR3_subsetF)
    break
  }
}

#  Overview of the final best model using the algorithm selection process (taking into account VIF, R^2, and p-values)
finalBestModel_ecoli_LUR3_subsetF
finalBestModelNames_ecoli_LUR3_subsetF
models[[besti]]$summarybestmodel
models[[besti]]$R2bestmodel

#### G ####
# LUR model building process for subset G
#  This is the dataframe with the relevant predictor vars for LUR3 models for subset G (55 sites)
VGOB1_subsetG_ecoli_LUR3 # n.b. this dataframe only includes microbial marker concentrations for ecoli unlike the dataframe Measurements_livestockpreds_LUR3 as previously used for the model building. 

#  Now set the values of some variables that will be needed
nfirstvar_LUR_3 <- 3  
nlastvar_LUR_3 <- 135

# Function building to run the models 
# 1 #  

models<-list()
modeln<-1
models[[modeln]]<-list()

R2<-1
betaaddedvar<-1
addedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetG_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetG_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetG_ecoli_LUR3[,i])                            
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetG_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
models[[modeln]]$results

#  this are the candidates models with the highest R2, not a negative beta for the new, nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)
subset(models[[modeln]]$resultspos)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetG_ecoli_LUR3)[models[[1]]$indexbestmodel])
models[[modeln]]$namesbestmodel

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetG_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetG_ecoli_LUR3[,models[[1]]$indexbestmodel]) 
models[[modeln]]$bestmodel

summary(models[[modeln]]$bestmodel)

#  The first model includes the predictor: nPigMultipFarmWghtDist.3000m.sum.Tr.1P9 - meaning the number of multiplier pig farms weighted to distance in a 3000m buffer

# 2 #  
# Add 2nd variable (the only difference of the above part is that now modeln=2 the model statement has 2 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-2

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetG_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetG_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetG_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetG_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  these are the candidate models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetG_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR3)[models[[2]]$indexbestmodel] )
models[[modeln]]$namesbestmodel

# this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

# this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetG_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~                               VGOB1_subsetG_ecoli_LUR3[,models[[1]]$indexbestmodel]+                           VGOB1_subsetG_ecoli_LUR3[,models[[2]]$indexbestmodel]) 

models[[modeln]]$bestmodel

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel


# 3 #  
# add third variable (the only difference of the above part is that now modeln=3 the model statement has 3 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-3

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetG_ecoli_LUR3[,i])==TRUE){  
    modeltry<-lm(VGOB1_subsetG_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetG_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR3[,models[[2]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetG_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetG_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR3)[models[[2]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR3)[models[[3]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetG_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetG_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,models[[2]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,models[[3]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel


# 4 #  
#  add forth variable (the only difference of the above part is that now model n=4 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly
modeln<-4

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1


for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetG_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetG_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetG_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    #  the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetG_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetG_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR3)[models[[2]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR3)[models[[4]]$indexbestmodel])

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetG_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetG_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,models[[4]]$indexbestmodel]) 


models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel


# 5 #  
# add fifth variable (the only difference of the above part is that now modeln=5 the model statement more variables)
# and the call for the list of variable names in the model changed slightly
modeln<-5

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetG_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetG_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetG_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,models[[2]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,i]) 
  
R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetG_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetG_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR3)[models[[2]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR3)[models[[5]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetG_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetG_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,models[[5]]$indexbestmodel]) 
models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel

# 6 #  
# add sixth variable (the only difference of the above part is that now model n=6 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-6

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetG_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetG_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetG_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR3[,models[[4]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(All)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetG_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetG_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetG_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR3)[models[[6]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetG_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetG_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,models[[6]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel


# 7 #  
# add seventh variable (the only difference of the above part is that now model n=7 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-7

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetG_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetG_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetG_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR3[,models[[4]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR3[,models[[5]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetG_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetG_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetG_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR3)[models[[6]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR3)[models[[7]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetG_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetG_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,models[[7]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel

# 8 #  
# add eighth variable (the only difference of the above part is that now modeln=7 the model statement more variables)
# and the call for the list of variable names in the model changed slightly

modeln<-8

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetG_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetG_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetG_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR3[,models[[4]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR3[,models[[5]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetG_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetG_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetG_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR3)[models[[6]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR3)[models[[7]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR3)[models[[8]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetG_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetG_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,models[[8]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel

# 9 #  
# add ninth variable (the only difference of the above part is that now modeln=9 the model statement more variables)
# and the call for the list of variable names in the model changed slightly

modeln<-9

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetG_ecoli_LUR3[,i])==TRUE){
      modeltry<-lm(VGOB1_subsetG_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetG_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR3[,models[[4]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR3[,models[[5]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,models[[8]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,i]) 
        R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetG_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetG_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetG_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR3)[models[[6]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR3)[models[[7]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR3)[models[[8]]$indexbestmodel],  names(VGOB1_subsetG_ecoli_LUR3)[models[[9]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetG_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetG_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,models[[8]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,models[[9]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[9]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[9]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel
models[[9]]$R2bestmodel

# 10 #  
#  add tenth variable (the only difference of the above part is that now model n=10 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-10

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){if (is.numeric(VGOB1_subsetG_ecoli_LUR3[,i])==TRUE){ modeltry<-lm(VGOB1_subsetG_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetG_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR3[,models[[2]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetG_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,models[[8]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,models[[9]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,i]) 

R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetG_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c( names(VGOB1_subsetG_ecoli_LUR3)[models[[1]]$indexbestmodel],                   names(VGOB1_subsetG_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetG_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR3)[models[[6]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR3)[models[[7]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR3)[models[[8]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR3)[models[[9]]$indexbestmodel], names(VGOB1_subsetG_ecoli_LUR3)[models[[10]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetG_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~                                VGOB1_subsetG_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,models[[2]]$indexbestmodel]+                           VGOB1_subsetG_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,models[[8]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,models[[9]]$indexbestmodel]+ VGOB1_subsetG_ecoli_LUR3[,models[[10]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[9]]$summarybestmodel
models[[10]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[9]]$namesbestmodel
models[[10]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel
models[[9]]$R2bestmodel
models[[10]]$R2bestmodel

#  at this point I always check whether the next model is more than 1% better than the one before and if not I end here

#   CODE FOR PICKING OUT THE BEST MODEL #   
temp <- 0
besti <- 0
for (i in 1:10){ #  think this runs the loop 10 times - not fully sure thought - but not to do with the number of models I don't think - as when I change to 3, I still get the model with 4 variables as best model
  print(models[[i]]$R2bestmodel)
  #       print(models[[i]]$summarybestmodel$coefficients=-1,4])
  #       if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
  #         temp <- models[[i]]$R2bestmodel
  #         besti <- i
  #         }
  if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
    temp <- models[[i]]$R2bestmodel
    besti <- i
  }else{
    finalBestModel_ecoli_LUR3_subsetG <- models[[besti]]$bestmodel
    finalBestModelNames_ecoli_LUR3_subsetG <- models[[besti]]$namesbestmodel
    Sites <- 1:dim(VGOB1_subsetG_ecoli_LUR3)[1] # full original model
    #  CVaR2<-escCV_ecoli_LUR3(Sites)[2] # Cross Validation
    maxCD<-max(cooks.distance(finalBestModel_ecoli_LUR3_subsetG))
    if(length(finalBestModelNames_ecoli_LUR3_subsetG)<2){ # vif fn doesnot work when only 1 variable...       # 
      maxVIF<-"NA"
    }else{
      maxVIF<-max(vif(finalBestModel_ecoli_LUR3_subsetG))
    }
    print(paste("This is the best ecoli model for subset G: ",besti,
                "(AdjR2: ",format(models[[besti]]$R2bestmodel,digits=3), "; MaxCD: ",format(maxCD,digits=3),"; MaxVIF: ",
                format(maxVIF,digits=3),")", sep=''))
    print(finalBestModelNames_ecoli_LUR3_subsetG)
    break
  }
}

#  Overview of the final best model using the algorithm selection process (taking into account VIF, R^2, and p-values)
finalBestModel_ecoli_LUR3_subsetG
finalBestModelNames_ecoli_LUR3_subsetG
models[[besti]]$summarybestmodel
models[[besti]]$R2bestmodel

#### H ####
# LUR model building process for subset H
#  This is the dataframe with the relevant predictor vars for LUR3 models for subset H (55 sites)
VGOB1_subsetH_ecoli_LUR3 # n.b. this dataframe only includes microbial marker concentrations for ecoli unlike the dataframe Measurements_livestockpreds_LUR3 as previously used for the model building. 

#  Now set the values of some variables that will be needed
nfirstvar_LUR_3 <- 3  
nlastvar_LUR_3 <- 135

# Function building to run the models 
# 1 #  

models<-list()
modeln<-1
models[[modeln]]<-list()

R2<-1
betaaddedvar<-1
addedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetH_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetH_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetH_ecoli_LUR3[,i])                            
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetH_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
models[[modeln]]$results

#  this are the candidates models with the highest R2, not a negative beta for the new, nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)
subset(models[[modeln]]$resultspos)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetH_ecoli_LUR3)[models[[1]]$indexbestmodel])
models[[modeln]]$namesbestmodel

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetH_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetH_ecoli_LUR3[,models[[1]]$indexbestmodel]) 
models[[modeln]]$bestmodel

summary(models[[modeln]]$bestmodel)

#  The first model includes the predictor: nPigMultipFarmWghtDist.3000m.sum.Tr.1P9 - meaning the number of multiplier pig farms weighted to distance in a 3000m buffer

# 2 #  
# Add 2nd variable (the only difference of the above part is that now modeln=2 the model statement has 2 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-2

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetH_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetH_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetH_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetH_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  these are the candidate models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetH_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR3)[models[[2]]$indexbestmodel] )
models[[modeln]]$namesbestmodel

# this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

# this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetH_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~                               VGOB1_subsetH_ecoli_LUR3[,models[[1]]$indexbestmodel]+                           VGOB1_subsetH_ecoli_LUR3[,models[[2]]$indexbestmodel]) 

models[[modeln]]$bestmodel

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel


# 3 #  
# add third variable (the only difference of the above part is that now modeln=3 the model statement has 3 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-3

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetH_ecoli_LUR3[,i])==TRUE){  
    modeltry<-lm(VGOB1_subsetH_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetH_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR3[,models[[2]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetH_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetH_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR3)[models[[2]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR3)[models[[3]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetH_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetH_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,models[[2]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,models[[3]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel


# 4 #  
#  add forth variable (the only difference of the above part is that now model n=4 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly
modeln<-4

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1


for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetH_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetH_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetH_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    #  the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetH_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetH_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR3)[models[[2]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR3)[models[[4]]$indexbestmodel])

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetH_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetH_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,models[[4]]$indexbestmodel]) 


models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel


# 5 #  
# add fifth variable (the only difference of the above part is that now modeln=5 the model statement more variables)
# and the call for the list of variable names in the model changed slightly
modeln<-5

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetH_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetH_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetH_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,models[[2]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,i]) 
  
R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetH_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetH_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR3)[models[[2]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR3)[models[[5]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetH_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetH_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,models[[5]]$indexbestmodel]) 
models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel

# 6 #  
# add sixth variable (the only difference of the above part is that now model n=6 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-6

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetH_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetH_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetH_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR3[,models[[4]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(All)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetH_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetH_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetH_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR3)[models[[6]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetH_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetH_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,models[[6]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel


# 7 #  
# add seventh variable (the only difference of the above part is that now model n=7 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-7

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetH_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetH_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetH_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR3[,models[[4]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR3[,models[[5]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetH_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetH_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetH_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR3)[models[[6]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR3)[models[[7]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetH_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetH_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,models[[7]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel

# 8 #  
# add eighth variable (the only difference of the above part is that now modeln=7 the model statement more variables)
# and the call for the list of variable names in the model changed slightly

modeln<-8

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetH_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetH_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetH_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR3[,models[[4]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR3[,models[[5]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetH_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetH_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetH_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR3)[models[[6]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR3)[models[[7]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR3)[models[[8]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetH_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetH_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,models[[8]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel

# 9 #  
# add ninth variable (the only difference of the above part is that now modeln=9 the model statement more variables)
# and the call for the list of variable names in the model changed slightly

modeln<-9

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetH_ecoli_LUR3[,i])==TRUE){
      modeltry<-lm(VGOB1_subsetH_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetH_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR3[,models[[4]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR3[,models[[5]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,models[[8]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,i]) 
        R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetH_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetH_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetH_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR3)[models[[6]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR3)[models[[7]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR3)[models[[8]]$indexbestmodel],  names(VGOB1_subsetH_ecoli_LUR3)[models[[9]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetH_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetH_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,models[[8]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,models[[9]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[9]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[9]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel
models[[9]]$R2bestmodel

# 10 #  
#  add tenth variable (the only difference of the above part is that now model n=10 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-10

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){if (is.numeric(VGOB1_subsetH_ecoli_LUR3[,i])==TRUE){ modeltry<-lm(VGOB1_subsetH_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetH_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR3[,models[[2]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetH_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,models[[8]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,models[[9]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,i]) 

R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetH_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c( names(VGOB1_subsetH_ecoli_LUR3)[models[[1]]$indexbestmodel],                   names(VGOB1_subsetH_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetH_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR3)[models[[6]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR3)[models[[7]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR3)[models[[8]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR3)[models[[9]]$indexbestmodel], names(VGOB1_subsetH_ecoli_LUR3)[models[[10]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetH_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~                                VGOB1_subsetH_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,models[[2]]$indexbestmodel]+                           VGOB1_subsetH_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,models[[8]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,models[[9]]$indexbestmodel]+ VGOB1_subsetH_ecoli_LUR3[,models[[10]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[9]]$summarybestmodel
models[[10]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[9]]$namesbestmodel
models[[10]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel
models[[9]]$R2bestmodel
models[[10]]$R2bestmodel

#  at this point I always check whether the next model is more than 1% better than the one before and if not I end here

#   CODE FOR PICKING OUT THE BEST MODEL #   
temp <- 0
besti <- 0
for (i in 1:10){ #  think this runs the loop 10 times - not fully sure thought - but not to do with the number of models I don't think - as when I change to 3, I still get the model with 4 variables as best model
  print(models[[i]]$R2bestmodel)
  #       print(models[[i]]$summarybestmodel$coefficients=-1,4])
  #       if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
  #         temp <- models[[i]]$R2bestmodel
  #         besti <- i
  #         }
  if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
    temp <- models[[i]]$R2bestmodel
    besti <- i
  }else{
    finalBestModel_ecoli_LUR3_subsetH <- models[[besti]]$bestmodel
    finalBestModelNames_ecoli_LUR3_subsetH <- models[[besti]]$namesbestmodel
    Sites <- 1:dim(VGOB1_subsetH_ecoli_LUR3)[1] # full original model
    #  CVaR2<-escCV_ecoli_LUR3(Sites)[2] # Cross Validation
    maxCD<-max(cooks.distance(finalBestModel_ecoli_LUR3_subsetH))
    if(length(finalBestModelNames_ecoli_LUR3_subsetH)<2){ # vif fn doesnot work when only 1 variable...       # 
      maxVIF<-"NA"
    }else{
      maxVIF<-max(vif(finalBestModel_ecoli_LUR3_subsetH))
    }
    print(paste("This is the best ecoli model for subset H: ",besti,
                "(AdjR2: ",format(models[[besti]]$R2bestmodel,digits=3), "; MaxCD: ",format(maxCD,digits=3),"; MaxVIF: ",
                format(maxVIF,digits=3),")", sep=''))
    print(finalBestModelNames_ecoli_LUR3_subsetH)
    break
  }
}

#  Overview of the final best model using the algorithm selection process (taking into account VIF, R^2, and p-values)
finalBestModel_ecoli_LUR3_subsetH
finalBestModelNames_ecoli_LUR3_subsetH
models[[besti]]$summarybestmodel
models[[besti]]$R2bestmodel


#### I ####
# LUR model building process for subset I
#  This is the dataframe with the relevant predictor vars for LUR3 models for subset I (55 sites)
VGOB1_subsetI_ecoli_LUR3 # n.b. this dataframe only includes microbial marker concentrations for ecoli unlike the dataframe Measurements_livestockpreds_LUR3 as previously used for the model building. 

#  Now set the values of some variables that will be needed
nfirstvar_LUR_3 <- 3  
nlastvar_LUR_3 <- 135

# Function building to run the models 
# 1 #  

models<-list()
modeln<-1
models[[modeln]]<-list()

R2<-1
betaaddedvar<-1
addedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetI_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetI_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetI_ecoli_LUR3[,i])                            
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetI_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
models[[modeln]]$results

#  this are the candidates models with the highest R2, not a negative beta for the new, nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)
subset(models[[modeln]]$resultspos)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetI_ecoli_LUR3)[models[[1]]$indexbestmodel])
models[[modeln]]$namesbestmodel

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetI_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetI_ecoli_LUR3[,models[[1]]$indexbestmodel]) 
models[[modeln]]$bestmodel

summary(models[[modeln]]$bestmodel)

#  The first model includes the predictor: nPigMultipFarmWghtDist.3000m.sum.Tr.1P9 - meaning the number of multiplier pig farms weighted to distance in a 3000m buffer

# 2 #  
# Add 2nd variable (the only difference of the above part is that now modeln=2 the model statement has 2 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-2

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetI_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetI_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetI_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetI_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  these are the candidate models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetI_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR3)[models[[2]]$indexbestmodel] )
models[[modeln]]$namesbestmodel

# this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

# this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetI_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~                               VGOB1_subsetI_ecoli_LUR3[,models[[1]]$indexbestmodel]+                           VGOB1_subsetI_ecoli_LUR3[,models[[2]]$indexbestmodel]) 

models[[modeln]]$bestmodel

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel


# 3 #  
# add third variable (the only difference of the above part is that now modeln=3 the model statement has 3 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-3

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetI_ecoli_LUR3[,i])==TRUE){  
    modeltry<-lm(VGOB1_subsetI_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetI_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR3[,models[[2]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetI_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetI_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR3)[models[[2]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR3)[models[[3]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetI_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetI_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,models[[2]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,models[[3]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel


# 4 #  
#  add forth variable (the only difference of the above part is that now model n=4 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly
modeln<-4

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1


for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetI_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetI_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetI_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    #  the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetI_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetI_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR3)[models[[2]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR3)[models[[4]]$indexbestmodel])

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetI_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetI_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,models[[4]]$indexbestmodel]) 


models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel


# 5 #  
# add fifth variable (the only difference of the above part is that now modeln=5 the model statement more variables)
# and the call for the list of variable names in the model changed slightly
modeln<-5

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetI_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetI_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetI_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,models[[2]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,i]) 
  
R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetI_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetI_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR3)[models[[2]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR3)[models[[5]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetI_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetI_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,models[[5]]$indexbestmodel]) 
models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel

# 6 #  
# add sixth variable (the only difference of the above part is that now model n=6 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-6

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetI_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetI_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetI_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR3[,models[[4]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(All)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetI_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetI_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetI_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR3)[models[[6]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetI_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetI_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,models[[6]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel


# 7 #  
# add seventh variable (the only difference of the above part is that now model n=7 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-7

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetI_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetI_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetI_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR3[,models[[4]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR3[,models[[5]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetI_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetI_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetI_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR3)[models[[6]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR3)[models[[7]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetI_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetI_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,models[[7]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel

# 8 #  
# add eighth variable (the only difference of the above part is that now modeln=7 the model statement more variables)
# and the call for the list of variable names in the model changed slightly

modeln<-8

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetI_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetI_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetI_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR3[,models[[4]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR3[,models[[5]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetI_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetI_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetI_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR3)[models[[6]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR3)[models[[7]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR3)[models[[8]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetI_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetI_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,models[[8]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel

# 9 #  
# add ninth variable (the only difference of the above part is that now modeln=9 the model statement more variables)
# and the call for the list of variable names in the model changed slightly

modeln<-9

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetI_ecoli_LUR3[,i])==TRUE){
      modeltry<-lm(VGOB1_subsetI_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetI_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR3[,models[[4]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR3[,models[[5]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,models[[8]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,i]) 
        R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetI_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetI_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetI_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR3)[models[[6]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR3)[models[[7]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR3)[models[[8]]$indexbestmodel],  names(VGOB1_subsetI_ecoli_LUR3)[models[[9]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetI_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetI_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,models[[8]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,models[[9]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[9]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[9]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel
models[[9]]$R2bestmodel

# 10 #  
#  add tenth variable (the only difference of the above part is that now model n=10 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-10

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){if (is.numeric(VGOB1_subsetI_ecoli_LUR3[,i])==TRUE){ modeltry<-lm(VGOB1_subsetI_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetI_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR3[,models[[2]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetI_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,models[[8]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,models[[9]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,i]) 

R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetI_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c( names(VGOB1_subsetI_ecoli_LUR3)[models[[1]]$indexbestmodel],                   names(VGOB1_subsetI_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetI_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR3)[models[[6]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR3)[models[[7]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR3)[models[[8]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR3)[models[[9]]$indexbestmodel], names(VGOB1_subsetI_ecoli_LUR3)[models[[10]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetI_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~                                VGOB1_subsetI_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,models[[2]]$indexbestmodel]+                           VGOB1_subsetI_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,models[[8]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,models[[9]]$indexbestmodel]+ VGOB1_subsetI_ecoli_LUR3[,models[[10]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[9]]$summarybestmodel
models[[10]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[9]]$namesbestmodel
models[[10]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel
models[[9]]$R2bestmodel
models[[10]]$R2bestmodel

#  at this point I always check whether the next model is more than 1% better than the one before and if not I end here

#   CODE FOR PICKING OUT THE BEST MODEL #   
temp <- 0
besti <- 0
for (i in 1:10){ #  think this runs the loop 10 times - not fully sure thought - but not to do with the number of models I don't think - as when I change to 3, I still get the model with 4 variables as best model
  print(models[[i]]$R2bestmodel)
  #       print(models[[i]]$summarybestmodel$coefficients=-1,4])
  #       if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
  #         temp <- models[[i]]$R2bestmodel
  #         besti <- i
  #         }
  if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
    temp <- models[[i]]$R2bestmodel
    besti <- i
  }else{
    finalBestModel_ecoli_LUR3_subsetI <- models[[besti]]$bestmodel
    finalBestModelNames_ecoli_LUR3_subsetI <- models[[besti]]$namesbestmodel
    Sites <- 1:dim(VGOB1_subsetI_ecoli_LUR3)[1] # full original model
    #  CVaR2<-escCV_ecoli_LUR3(Sites)[2] # Cross Validation
    maxCD<-max(cooks.distance(finalBestModel_ecoli_LUR3_subsetI))
    if(length(finalBestModelNames_ecoli_LUR3_subsetI)<2){ # vif fn doesnot work when only 1 variable...       # 
      maxVIF<-"NA"
    }else{
      maxVIF<-max(vif(finalBestModel_ecoli_LUR3_subsetI))
    }
    print(paste("This is the best ecoli model for subset I: ",besti,
                "(AdjR2: ",format(models[[besti]]$R2bestmodel,digits=3), "; MaxCD: ",format(maxCD,digits=3),"; MaxVIF: ",
                format(maxVIF,digits=3),")", sep=''))
    print(finalBestModelNames_ecoli_LUR3_subsetI)
    break
  }
}

#  Overview of the final best model using the algorithm selection process (taking into account VIF, R^2, and p-values)
finalBestModel_ecoli_LUR3_subsetI
finalBestModelNames_ecoli_LUR3_subsetI
models[[besti]]$summarybestmodel
models[[besti]]$R2bestmodel

#### J ####
# LUR model building process for subset J
#  This is the dataframe with the relevant predictor vars for LUR3 models for subset J (55 sites)
VGOB1_subsetJ_ecoli_LUR3 # n.b. this dataframe only includes microbial marker concentrations for ecoli unlike the dataframe Measurements_livestockpreds_LUR3 as previously used for the model building. 

#  Now set the values of some variables that will be needed
nfirstvar_LUR_3 <- 3  
nlastvar_LUR_3 <- 135

# Function building to run the models 
# 1 #  

models<-list()
modeln<-1
models[[modeln]]<-list()

R2<-1
betaaddedvar<-1
addedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetJ_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetJ_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetJ_ecoli_LUR3[,i])                            
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetJ_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)
models[[modeln]]$results

#  this are the candidates models with the highest R2, not a negative beta for the new, nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)
subset(models[[modeln]]$resultspos)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetJ_ecoli_LUR3)[models[[1]]$indexbestmodel])
models[[modeln]]$namesbestmodel

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetJ_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetJ_ecoli_LUR3[,models[[1]]$indexbestmodel]) 
models[[modeln]]$bestmodel

summary(models[[modeln]]$bestmodel)

#  The first model includes the predictor: nPigMultipFarmWghtDist.3000m.sum.Tr.1P9 - meaning the number of multiplier pig farms weighted to distance in a 3000m buffer

# 2 #  
# Add 2nd variable (the only difference of the above part is that now modeln=2 the model statement has 2 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-2

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetJ_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetJ_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetJ_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetJ_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  these are the candidate models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)
models[[modeln]]$resultspos

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))
models[[modeln]]$resultspos

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j
models[[modeln]]$indexbestmodel

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]
models[[modeln]]$summarybestmodel

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetJ_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR3)[models[[2]]$indexbestmodel] )
models[[modeln]]$namesbestmodel

# this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2
models[[modeln]]$R2bestmodel

# this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetJ_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~                               VGOB1_subsetJ_ecoli_LUR3[,models[[1]]$indexbestmodel]+                           VGOB1_subsetJ_ecoli_LUR3[,models[[2]]$indexbestmodel]) 

models[[modeln]]$bestmodel

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel


# 3 #  
# add third variable (the only difference of the above part is that now modeln=3 the model statement has 3 variables)
# and the call for the list of variable names in the model changed slightly

modeln<-3

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetJ_ecoli_LUR3[,i])==TRUE){  
    modeltry<-lm(VGOB1_subsetJ_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetJ_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR3[,models[[2]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetJ_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

#  rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetJ_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR3)[models[[2]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR3)[models[[3]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetJ_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetJ_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,models[[2]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,models[[3]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel


# 4 #  
#  add forth variable (the only difference of the above part is that now model n=4 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly
modeln<-4

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1


for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetJ_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetJ_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetJ_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    #  the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    #  All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetJ_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

#  here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetJ_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR3)[models[[2]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR3)[models[[4]]$indexbestmodel])

#  this is the r2 of that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetJ_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetJ_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,models[[4]]$indexbestmodel]) 


models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel


# 5 #  
# add fifth variable (the only difference of the above part is that now modeln=5 the model statement more variables)
# and the call for the list of variable names in the model changed slightly
modeln<-5

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3:nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetJ_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetJ_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~ VGOB1_subsetJ_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,models[[2]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,i]) 
  
R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetJ_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

#  this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetJ_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR3)[models[[2]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR3)[models[[5]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetJ_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetJ_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,models[[5]]$indexbestmodel]) 
models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel

# 6 #  
# add sixth variable (the only difference of the above part is that now model n=6 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-6

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetJ_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetJ_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetJ_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR3[,models[[4]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # All[,i] is the row that's being tried out now. the name of that row can be found in  names(All)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetJ_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetJ_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetJ_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR3)[models[[6]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetJ_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetJ_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,models[[6]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel


# 7 #  
# add seventh variable (the only difference of the above part is that now model n=7 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-7

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetJ_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetJ_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetJ_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR3[,models[[4]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR3[,models[[5]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetJ_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetJ_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetJ_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR3)[models[[6]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR3)[models[[7]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetJ_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetJ_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,models[[7]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel

# 8 #  
# add eighth variable (the only difference of the above part is that now modeln=7 the model statement more variables)
# and the call for the list of variable names in the model changed slightly

modeln<-8

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetJ_ecoli_LUR3[,i])==TRUE){
    modeltry<-lm(VGOB1_subsetJ_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetJ_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR3[,models[[4]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR3[,models[[5]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,i]) 
    R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetJ_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetJ_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetJ_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR3)[models[[6]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR3)[models[[7]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR3)[models[[8]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetJ_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetJ_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,models[[8]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel

# 9 #  
# add ninth variable (the only difference of the above part is that now modeln=9 the model statement more variables)
# and the call for the list of variable names in the model changed slightly

modeln<-9

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){
  if (is.numeric(VGOB1_subsetJ_ecoli_LUR3[,i])==TRUE){
      modeltry<-lm(VGOB1_subsetJ_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetJ_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR3[,models[[4]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR3[,models[[5]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,models[[8]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,i]) 
        R2<-rbind(R2,summary(modeltry)$adj.r.squared)
    # the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetJ_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c(names(VGOB1_subsetJ_ecoli_LUR3)[models[[1]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetJ_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR3)[models[[6]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR3)[models[[7]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR3)[models[[8]]$indexbestmodel],  names(VGOB1_subsetJ_ecoli_LUR3)[models[[9]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetJ_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetJ_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR3[,models[[2]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,models[[8]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,models[[9]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[9]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[9]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel
models[[9]]$R2bestmodel

# 10 #  
#  add tenth variable (the only difference of the above part is that now model n=10 the model statement more variables)
#  and the call for the list of variable names in the model changed slightly

modeln<-10

models[[modeln]]<-list()

R2<-1
addedvar<-1
betaaddedvar<-1
minbetas<-1
j<-1

for (i in nfirstvar_LUR_3 :nlastvar_LUR_3){if (is.numeric(VGOB1_subsetJ_ecoli_LUR3[,i])==TRUE){ modeltry<-lm(VGOB1_subsetJ_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~VGOB1_subsetJ_ecoli_LUR3[,models[[1]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR3[,models[[2]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,models[[3]]$indexbestmodel]+VGOB1_subsetJ_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,models[[8]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,models[[9]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,i]) 

R2<-rbind(R2,summary(modeltry)$adj.r.squared)
# the new covariate is supposed to be in the last row, therefore I can select the row based on the model number +1
    betaaddedvar<-rbind(betaaddedvar, modeltry$coefficients[(modeln+1)])# 
    #  find out if there is a negative beta at All. The intercept does not count [-1]!
    minbetas<-rbind(minbetas, min(modeltry$coefficients[-1]))
    # Measurements_livestockpreds_LUR3[,i] is the row that's being tried out now. the name of that row can be found in  names(Measurements_livestockpreds_LUR3)[i]
    addedvar<-rbind(addedvar,names(VGOB1_subsetJ_ecoli_LUR3)[i])
    j<-rbind(j, i)
    models[[modeln]][[i]]<-summary(modeltry)
  }
}

models[[modeln]]$results<-data.frame(addedvar=addedvar[-1],R2=R2[-1]*1, j=j[-1], betaaddedvar=betaaddedvar[-1]*1,minbetas=minbetas[-1]*1)

#  this are the candidates models with the highest R2, not a negative beta for the new nor for any other covariate
models[[modeln]]$resultspos<-subset(models[[modeln]]$results, minbetas>0)

# rank the R2's of these models
models[[modeln]]$resultspos<-(data.frame(models[[modeln]]$resultspos, rank=rank(-models[[modeln]]$resultspos$R2, ties.method = "first")))

#  this is the index of the row with the highest R2 and  no negative betas in this subset
models[[modeln]]$indexbestmodel<-subset(models[[modeln]]$resultspos, rank==1)$j

subset(models[[modeln]]$resultspos, rank==1)

# this is the model
models[[modeln]]$summarybestmodel<-models[[modeln]][[models[[modeln]]$indexbestmodel]]

# here are the names
models[[modeln]]$namesbestmodel<-c( names(VGOB1_subsetJ_ecoli_LUR3)[models[[1]]$indexbestmodel],                   names(VGOB1_subsetJ_ecoli_LUR3)[models[[2]]$indexbestmodel] , names(VGOB1_subsetJ_ecoli_LUR3)[models[[3]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR3)[models[[4]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR3)[models[[5]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR3)[models[[6]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR3)[models[[7]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR3)[models[[8]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR3)[models[[9]]$indexbestmodel], names(VGOB1_subsetJ_ecoli_LUR3)[models[[10]]$indexbestmodel])

#  this is the r2 or that model
models[[modeln]]$R2bestmodel<-subset(models[[modeln]]$resultspos, rank==1)$R2

#  this is the model object of the best model (can be used in Cook's D in car.infIndexPlot())
models[[modeln]]$bestmodel <- lm(VGOB1_subsetJ_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean~                                VGOB1_subsetJ_ecoli_LUR3[,models[[1]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,models[[2]]$indexbestmodel]+                           VGOB1_subsetJ_ecoli_LUR3[,models[[3]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,models[[4]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,models[[5]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,models[[6]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,models[[7]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,models[[8]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,models[[9]]$indexbestmodel]+ VGOB1_subsetJ_ecoli_LUR3[,models[[10]]$indexbestmodel]) 

models[[1]]$summarybestmodel
models[[2]]$summarybestmodel
models[[3]]$summarybestmodel
models[[4]]$summarybestmodel
models[[5]]$summarybestmodel
models[[6]]$summarybestmodel
models[[7]]$summarybestmodel
models[[8]]$summarybestmodel
models[[9]]$summarybestmodel
models[[10]]$summarybestmodel
models[[1]]$namesbestmodel
models[[2]]$namesbestmodel
models[[3]]$namesbestmodel
models[[4]]$namesbestmodel
models[[5]]$namesbestmodel
models[[6]]$namesbestmodel
models[[7]]$namesbestmodel
models[[8]]$namesbestmodel
models[[9]]$namesbestmodel
models[[10]]$namesbestmodel
models[[1]]$R2bestmodel
models[[2]]$R2bestmodel
models[[3]]$R2bestmodel
models[[4]]$R2bestmodel
models[[5]]$R2bestmodel
models[[6]]$R2bestmodel
models[[7]]$R2bestmodel
models[[8]]$R2bestmodel
models[[9]]$R2bestmodel
models[[10]]$R2bestmodel

#  at this point I always check whether the next model is more than 1% better than the one before and if not I end here

#   CODE FOR PICKING OUT THE BEST MODEL #   
temp <- 0
besti <- 0
for (i in 1:10){ #  think this runs the loop 10 times - not fully sure thought - but not to do with the number of models I don't think - as when I change to 3, I still get the model with 4 variables as best model
  print(models[[i]]$R2bestmodel)
  #       print(models[[i]]$summarybestmodel$coefficients=-1,4])
  #       if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
  #         temp <- models[[i]]$R2bestmodel
  #         besti <- i
  #         }
  if((models[[i]]$R2bestmodel-temp > 0.0) && (all(models[[i]]$summarybestmodel$coefficients[-1,4]<0.1))){
    temp <- models[[i]]$R2bestmodel
    besti <- i
  }else{
    finalBestModel_ecoli_LUR3_subsetJ <- models[[besti]]$bestmodel
    finalBestModelNames_ecoli_LUR3_subsetJ <- models[[besti]]$namesbestmodel
    Sites <- 1:dim(VGOB1_subsetJ_ecoli_LUR3)[1] # full original model
    #  CVaR2<-escCV_ecoli_LUR3(Sites)[2] # Cross Validation
    maxCD<-max(cooks.distance(finalBestModel_ecoli_LUR3_subsetJ))
    if(length(finalBestModelNames_ecoli_LUR3_subsetJ)<2){ # vif fn doesnot work when only 1 variable...       # 
      maxVIF<-"NA"
    }else{
      maxVIF<-max(vif(finalBestModel_ecoli_LUR3_subsetJ))
    }
    print(paste("This is the best ecoli model for subset J: ",besti,
                "(AdjR2: ",format(models[[besti]]$R2bestmodel,digits=3), "; MaxCD: ",format(maxCD,digits=3),"; MaxVIF: ",
                format(maxVIF,digits=3),")", sep=''))
    print(finalBestModelNames_ecoli_LUR3_subsetJ)
    break
  }
}

#  Overview of the final best model using the algorithm selection process (taking into account VIF, R^2, and p-values)
finalBestModel_ecoli_LUR3_subsetJ
finalBestModelNames_ecoli_LUR3_subsetJ
models[[besti]]$summarybestmodel
models[[besti]]$R2bestmodel

#### Predicting hold out sites ####
# These are the models from the 10 subsets: 
finalBestModel_ecoli_LUR3_subsetA
finalBestModel_ecoli_LUR3_subsetB
finalBestModel_ecoli_LUR3_subsetC
finalBestModel_ecoli_LUR3_subsetD
finalBestModel_ecoli_LUR3_subsetE
finalBestModel_ecoli_LUR3_subsetF
finalBestModel_ecoli_LUR3_subsetG
finalBestModel_ecoli_LUR3_subsetH
finalBestModel_ecoli_LUR3_subsetI
finalBestModel_ecoli_LUR3_subsetJ

#  Selecting of test sets
#  valID 1 to 10
VGOB1_subsetvalID1_ecoli_LUR3 <- subset(VGOB1_FINAL_ecoli_LUR3, valID == 1)
VGOB1_subsetvalID2_ecoli_LUR3 <- subset(VGOB1_FINAL_ecoli_LUR3, valID == 2)
VGOB1_subsetvalID3_ecoli_LUR3 <- subset(VGOB1_FINAL_ecoli_LUR3, valID == 3)
VGOB1_subsetvalID4_ecoli_LUR3 <- subset(VGOB1_FINAL_ecoli_LUR3, valID == 4)
VGOB1_subsetvalID5_ecoli_LUR3 <- subset(VGOB1_FINAL_ecoli_LUR3, valID == 5)
VGOB1_subsetvalID6_ecoli_LUR3 <- subset(VGOB1_FINAL_ecoli_LUR3, valID == 6)
VGOB1_subsetvalID7_ecoli_LUR3 <- subset(VGOB1_FINAL_ecoli_LUR3, valID == 7)
VGOB1_subsetvalID8_ecoli_LUR3 <- subset(VGOB1_FINAL_ecoli_LUR3, valID == 8)
VGOB1_subsetvalID9_ecoli_LUR3 <- subset(VGOB1_FINAL_ecoli_LUR3, valID == 9)
VGOB1_subsetvalID10_ecoli_LUR3 <- subset(VGOB1_FINAL_ecoli_LUR3, valID == 10)

#  For every subset predict (based on LUR model for that subset, so the training sites) the concentrations at the sites left out (test sites) to enable comparisons observed vs predicted 

#  Set 1
finalBestModel_ecoli_LUR3_subsetA
finalBestModelNames_ecoli_LUR3_subsetA
summary(finalBestModel_ecoli_LUR3_subsetA)
maxVIF_ecoli_LUR3_subsetA <- max(vif(finalBestModel_ecoli_LUR3_subsetA)) 
maxCD_ecoli_LUR3_subsetA <- max(cooks.distance(finalBestModel_ecoli_LUR3_subsetA))
# write the model out
finalBestModel_ecoli_LUR3_subsetA_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~nPigMultipFarmWghtDist.3000m.sum.95Win.10to90scaled + npoultry.3000m.95Win.10to90scaled+ npigletsWghtDist.1000m.sum.95Win.10to90scaled + notherpoultryanim.3000m.95Win.10to90scaled + MindistCows5.INV.95Win.10to90scaled, data = VGOB1_subsetA_ecoli_LUR3)
VGOB1_subsetvalID1_ecoli_LUR3$ecoli_PRED_HV <- predict(finalBestModel_ecoli_LUR3_subsetA_lm,VGOB1_subsetvalID1_ecoli_LUR3)
summary(VGOB1_subsetvalID1_ecoli_LUR3$ecoli_PRED_HV)
plot(VGOB1_subsetvalID1_ecoli_LUR3$ecoli_PRED_HV, VGOB1_subsetvalID1_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean, xlab="ecoli predicted (HV)", ylab="ecoli concentration observed")
VGOB1_subsetvalID1_ecoli_LUR3_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~ecoli_PRED_HV, data=VGOB1_subsetvalID1_ecoli_LUR3 )
summary(VGOB1_subsetvalID1_ecoli_LUR3_lm)

#  Set 2
finalBestModel_ecoli_LUR3_subsetB
finalBestModelNames_ecoli_LUR3_subsetB
summary(finalBestModel_ecoli_LUR3_subsetB)
maxVIF_ecoli_LUR3_subsetB <- max(vif(finalBestModel_ecoli_LUR3_subsetB))
maxCD_ecoli_LUR3_subsetB <- max(cooks.distance(finalBestModel_ecoli_LUR3_subsetB))
# write the model out
finalBestModel_ecoli_LUR3_subsetB_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~npigsWghtDist.3000m.sum.95Win.10to90scaled + npoultry.1000m.95Win.10to90scaled , data = VGOB1_subsetB_ecoli_LUR3)
VGOB1_subsetvalID2_ecoli_LUR3$ecoli_PRED_HV <- predict(finalBestModel_ecoli_LUR3_subsetB_lm,VGOB1_subsetvalID2_ecoli_LUR3)
summary(VGOB1_subsetvalID2_ecoli_LUR3$ecoli_PRED_HV)
plot(VGOB1_subsetvalID2_ecoli_LUR3$ecoli_PRED_HV, VGOB1_subsetvalID2_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean, xlab="ecoli predicted (HV)", ylab="ecoli concentration observed")
VGOB1_subsetvalID2_ecoli_LUR3_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~ecoli_PRED_HV, data=VGOB1_subsetvalID2_ecoli_LUR3)
summary(VGOB1_subsetvalID2_ecoli_LUR3_lm)

#  Set 3
finalBestModel_ecoli_LUR3_subsetC
finalBestModelNames_ecoli_LUR3_subsetC
summary(finalBestModel_ecoli_LUR3_subsetC)
maxVIF_ecoli_LUR3_subsetC <-max(vif(finalBestModel_ecoli_LUR3_subsetC))
maxCD_ecoli_LUR3_subsetC <- max(cooks.distance(finalBestModel_ecoli_LUR3_subsetC))
# write the model out
finalBestModel_ecoli_LUR3_subsetC_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~npigsWghtDist.3000m.sum.95Win.10to90scaled + npoultry.3000m.95Win.10to90scaled , data = VGOB1_subsetC_ecoli_LUR3)
VGOB1_subsetvalID3_ecoli_LUR3$ecoli_PRED_HV <- predict(finalBestModel_ecoli_LUR3_subsetC_lm,VGOB1_subsetvalID3_ecoli_LUR3)
summary(VGOB1_subsetvalID3_ecoli_LUR3$ecoli_PRED_HV)
plot(VGOB1_subsetvalID3_ecoli_LUR3$ecoli_PRED_HV, VGOB1_subsetvalID3_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean, xlab="ecoli predicted (HV)", ylab="ecoli concentration observed")
VGOB1_subsetvalID3_ecoli_LUR3_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~ecoli_PRED_HV, data=VGOB1_subsetvalID3_ecoli_LUR3 )
summary(VGOB1_subsetvalID3_ecoli_LUR3_lm)

#  Set 4
finalBestModel_ecoli_LUR3_subsetD
finalBestModelNames_ecoli_LUR3_subsetD
summary(finalBestModel_ecoli_LUR3_subsetD)
maxVIF_ecoli_LUR3_subsetD <- max(vif(finalBestModel_ecoli_LUR3_subsetD))
maxCD_ecoli_LUR3_subsetD <- max(cooks.distance(finalBestModel_ecoli_LUR3_subsetD))
# write the model out
finalBestModel_ecoli_LUR3_subsetD_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~npigsWghtDist.3000m.sum.95Win.10to90scaled +  nhorses.3000m.95Win.10to90scaled + npoultry.3000m.95Win.10to90scaled + notherpoultryanim.3000m.95Win.10to90scaled + nsowsWghtDist.1000m.sum.95Win.10to90scaled, data = VGOB1_subsetD_ecoli_LUR3)
VGOB1_subsetvalID4_ecoli_LUR3$ecoli_PRED_HV <- predict(finalBestModel_ecoli_LUR3_subsetD_lm,VGOB1_subsetvalID4_ecoli_LUR3)
summary(VGOB1_subsetvalID4_ecoli_LUR3$ecoli_PRED_HV)
plot(VGOB1_subsetvalID4_ecoli_LUR3$ecoli_PRED_HV, VGOB1_subsetvalID4_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean, xlab="ecoli predicted (HV)", ylab="ecoli concentration observed")
VGOB1_subsetvalID4_ecoli_LUR3_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~ecoli_PRED_HV, data=VGOB1_subsetvalID4_ecoli_LUR3 )
summary(VGOB1_subsetvalID4_ecoli_LUR3_lm)

#  Set 5
finalBestModel_ecoli_LUR3_subsetE
finalBestModelNames_ecoli_LUR3_subsetE
summary(finalBestModel_ecoli_LUR3_subsetE)
maxVIF_ecoli_LUR3_subsetE <- max(vif(finalBestModel_ecoli_LUR3_subsetE))
maxCD_ecoli_LUR3_subsetE <- max(cooks.distance(finalBestModel_ecoli_LUR3_subsetE))
# write the model out
finalBestModel_ecoli_LUR3_subsetE_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~nPigMultipFarmWghtDist.3000m.sum.95Win.10to90scaled+npoultry.3000m.95Win.10to90scaled + npigs.500m.95Win.10to90scaled+ nhorses.3000m.95Win.10to90scaled + notherpoultryanim.3000m.95Win.10to90scaled, data = VGOB1_subsetE_ecoli_LUR3)
VGOB1_subsetvalID5_ecoli_LUR3$ecoli_PRED_HV <- predict(finalBestModel_ecoli_LUR3_subsetE_lm,VGOB1_subsetvalID5_ecoli_LUR3)
summary(VGOB1_subsetvalID5_ecoli_LUR3$ecoli_PRED_HV)
plot(VGOB1_subsetvalID5_ecoli_LUR3$ecoli_PRED_HV, VGOB1_subsetvalID5_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean, xlab="ecoli predicted (HV)", ylab="ecoli concentration observed")
VGOB1_subsetvalID5_ecoli_LUR3_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~ecoli_PRED_HV, data=VGOB1_subsetvalID5_ecoli_LUR3)
summary(VGOB1_subsetvalID5_ecoli_LUR3_lm)

#  Set 6
finalBestModel_ecoli_LUR3_subsetF
finalBestModelNames_ecoli_LUR3_subsetF
summary(finalBestModel_ecoli_LUR3_subsetF)
maxVIF_ecoli_LUR3_subsetF <- max(vif(finalBestModel_ecoli_LUR3_subsetF))
maxCD_ecoli_LUR3_subsetF <- max(cooks.distance(finalBestModel_ecoli_LUR3_subsetF))
# write the model out
finalBestModel_ecoli_LUR3_subsetF_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~nPigMultipFarmWghtDist.3000m.sum.95Win.10to90scaled+npoultry.3000m.95Win.10to90scaled+npigletsWghtDist.1000m.sum.95Win.10to90scaled+nhorses.3000m.95Win.10to90scaled+notherpoultryanim.3000m.95Win.10to90scaled , data = VGOB1_subsetF_ecoli_LUR3)
VGOB1_subsetvalID6_ecoli_LUR3$ecoli_PRED_HV <- predict(finalBestModel_ecoli_LUR3_subsetF_lm,VGOB1_subsetvalID1_ecoli_LUR3)
summary(VGOB1_subsetvalID6_ecoli_LUR3$ecoli_PRED_HV)
plot(VGOB1_subsetvalID6_ecoli_LUR3$ecoli_PRED_HV, VGOB1_subsetvalID6_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean, xlab="ecoli predicted (HV)", ylab="ecoli concentration observed")
VGOB1_subsetvalID6_ecoli_LUR3_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~ecoli_PRED_HV, data=VGOB1_subsetvalID6_ecoli_LUR3 )
summary(VGOB1_subsetvalID6_ecoli_LUR3_lm)

#  Set 7
finalBestModel_ecoli_LUR3_subsetG
finalBestModelNames_ecoli_LUR3_subsetG
summary(finalBestModel_ecoli_LUR3_subsetG)
maxVIF_ecoli_LUR3_subsetG <- max(vif(finalBestModel_ecoli_LUR3_subsetG))
maxCD_ecoli_LUR3_subsetG <- max(cooks.distance(finalBestModel_ecoli_LUR3_subsetG))
# write the model out
finalBestModel_ecoli_LUR3_subsetG_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~nPigMultipFarmWghtDist.3000m.sum.95Win.10to90scaled+npoultry.3000m.95Win.10to90scaled+npigletsWghtDist.1000m.sum.95Win.10to90scaled+notherpoultryanimWghtDist.3000m.sum.95Win.10to90scaled + nhorses.3000m.95Win.10to90scaled, data = VGOB1_subsetG_ecoli_LUR3)
VGOB1_subsetvalID7_ecoli_LUR3$ecoli_PRED_HV <- predict(finalBestModel_ecoli_LUR3_subsetG_lm,VGOB1_subsetvalID7_ecoli_LUR3)
summary(VGOB1_subsetvalID7_ecoli_LUR3$ecoli_PRED_HV)
plot(VGOB1_subsetvalID7_ecoli_LUR3$ecoli_PRED_HV, VGOB1_subsetvalID7_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean, xlab="ecoli predicted (HV)", ylab="ecoli concentration observed")
VGOB1_subsetvalID7_ecoli_LUR3_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~ecoli_PRED_HV, data=VGOB1_subsetvalID7_ecoli_LUR3)
summary(VGOB1_subsetvalID7_ecoli_LUR3_lm)

#  Set 8
finalBestModel_ecoli_LUR3_subsetH
finalBestModelNames_ecoli_LUR3_subsetH
summary(finalBestModel_ecoli_LUR3_subsetH)
maxVIF_ecoli_LUR3_subsetH <- max(vif(finalBestModel_ecoli_LUR3_subsetH))
maxCD_ecoli_LUR3_subsetH <- max(cooks.distance(finalBestModel_ecoli_LUR3_subsetH))
# write the model out
finalBestModel_ecoli_LUR3_subsetH_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~nPigMultipFarmWghtDist.3000m.sum.95Win.10to90scaled+ npoultry.3000m.95Win.10to90scaled + npigletsWghtDist.1000m.sum.95Win.10to90scaled+ notherpoultryanimWghtDist.3000m.sum.95Win.10to90scaled, data = VGOB1_subsetH_ecoli_LUR3)
VGOB1_subsetvalID8_ecoli_LUR3$ecoli_PRED_HV <- predict(finalBestModel_ecoli_LUR3_subsetH_lm,VGOB1_subsetvalID8_ecoli_LUR3)
summary(VGOB1_subsetvalID8_ecoli_LUR3$ecoli_PRED_HV)
plot(VGOB1_subsetvalID8_ecoli_LUR3$ecoli_PRED_HV, VGOB1_subsetvalID8_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean, xlab="ecoli predicted (HV)", ylab="ecoli concentration observed")
VGOB1_subsetvalID8_ecoli_LUR3_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~ecoli_PRED_HV, data=VGOB1_subsetvalID8_ecoli_LUR3)
summary(VGOB1_subsetvalID8_ecoli_LUR3_lm)

#  Set 9
finalBestModel_ecoli_LUR3_subsetI
finalBestModelNames_ecoli_LUR3_subsetI
summary(finalBestModel_ecoli_LUR3_subsetI)
maxVIF_ecoli_LUR3_subsetI <- max(vif(finalBestModel_ecoli_LUR3_subsetI))
maxCD_ecoli_LUR3_subsetI <- max(cooks.distance(finalBestModel_ecoli_LUR3_subsetI))
# write the model out
finalBestModel_ecoli_LUR3_subsetI_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~npigsWghtDist.3000m.sum.95Win.10to90scaled+ npoultry.3000m.95Win.10to90scaled , data = VGOB1_subsetI_ecoli_LUR3)
VGOB1_subsetvalID9_ecoli_LUR3$ecoli_PRED_HV <- predict(finalBestModel_ecoli_LUR3_subsetI_lm,VGOB1_subsetvalID9_ecoli_LUR3)
summary(VGOB1_subsetvalID9_ecoli_LUR3$ecoli_PRED_HV)
plot(VGOB1_subsetvalID9_ecoli_LUR3$ecoli_PRED_HV, VGOB1_subsetvalID9_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean, xlab="ecoli predicted (HV)", ylab="ecoli concentration observed")
VGOB1_subsetvalID9_ecoli_LUR3_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~ecoli_PRED_HV, data=VGOB1_subsetvalID9_ecoli_LUR3 )
summary(VGOB1_subsetvalID9_ecoli_LUR3_lm)

#  Set 10
finalBestModel_ecoli_LUR3_subsetJ
finalBestModelNames_ecoli_LUR3_subsetJ
summary(finalBestModel_ecoli_LUR3_subsetJ)
maxVIF_ecoli_LUR3_subsetJ <- max(vif(finalBestModel_ecoli_LUR3_subsetJ))
maxCD_ecoli_LUR3_subsetJ <- max(cooks.distance(finalBestModel_ecoli_LUR3_subsetJ))
# write the model out
finalBestModel_ecoli_LUR3_subsetJ_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~npigletsWghtDist.3000m.sum.95Win.10to90scaled + npoultryWghtDist.3000m.sum.95Win.10to90scaled , data = VGOB1_subsetJ_ecoli_LUR3)
VGOB1_subsetvalID10_ecoli_LUR3$ecoli_PRED_HV <- predict(finalBestModel_ecoli_LUR3_subsetJ_lm,VGOB1_subsetvalID10_ecoli_LUR3)
summary(VGOB1_subsetvalID10_ecoli_LUR3$ecoli_PRED_HV)
plot(VGOB1_subsetvalID10_ecoli_LUR3$ecoli_PRED_HV, VGOB1_subsetvalID10_ecoli_LUR3$ecoli_copiespm3.ln.diffmeth.mean, xlab="ecoli predicted (HV)", ylab="ecoli concentration observed")
VGOB1_subsetvalID10_ecoli_LUR3_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean~ecoli_PRED_HV, data=VGOB1_subsetvalID10_ecoli_LUR3)
summary(VGOB1_subsetvalID10_ecoli_LUR3_lm)

# compute the residuals from each of the 10 models of the CV for later normality testing (model assumption)
VGOB1_subsetvalID1_ecoli_LUR3$residuals <- VGOB1_subsetvalID1_ecoli_LUR3_lm$residuals
VGOB1_subsetvalID2_ecoli_LUR3$residuals <- VGOB1_subsetvalID2_ecoli_LUR3_lm$residuals
VGOB1_subsetvalID3_ecoli_LUR3$residuals <- VGOB1_subsetvalID3_ecoli_LUR3_lm$residuals
VGOB1_subsetvalID4_ecoli_LUR3$residuals <- VGOB1_subsetvalID4_ecoli_LUR3_lm$residuals
VGOB1_subsetvalID5_ecoli_LUR3$residuals <- VGOB1_subsetvalID5_ecoli_LUR3_lm$residuals
VGOB1_subsetvalID6_ecoli_LUR3$residuals <- VGOB1_subsetvalID6_ecoli_LUR3_lm$residuals
VGOB1_subsetvalID7_ecoli_LUR3$residuals <- VGOB1_subsetvalID7_ecoli_LUR3_lm$residuals
VGOB1_subsetvalID8_ecoli_LUR3$residuals <- VGOB1_subsetvalID8_ecoli_LUR3_lm$residuals
VGOB1_subsetvalID9_ecoli_LUR3$residuals <- VGOB1_subsetvalID9_ecoli_LUR3_lm$residuals
VGOB1_subsetvalID10_ecoli_LUR3$residuals <- VGOB1_subsetvalID10_ecoli_LUR3_lm$residuals


#  Merging of all test sets to make overall comparisons of predicted vs observed
VGOB1_subsetvalID1to10_ecoli_LUR3_10foldCV <- rbind(VGOB1_subsetvalID1_ecoli_LUR3, VGOB1_subsetvalID2_ecoli_LUR3, VGOB1_subsetvalID3_ecoli_LUR3, VGOB1_subsetvalID4_ecoli_LUR3, VGOB1_subsetvalID5_ecoli_LUR3, VGOB1_subsetvalID6_ecoli_LUR3, VGOB1_subsetvalID7_ecoli_LUR3, VGOB1_subsetvalID8_ecoli_LUR3, VGOB1_subsetvalID9_ecoli_LUR3, VGOB1_subsetvalID10_ecoli_LUR3)

#  Overall comparison of predicted vs observed
plot(VGOB1_subsetvalID1to10_ecoli_LUR3_10foldCV$ecoli_PRED_HV, VGOB1_subsetvalID1to10_ecoli_LUR3_10foldCV$ecoli_copiespm3.ln.diffmeth.mean, xlab="LUR3-predicted ecoli DNA concentration (ln copies/m^3)", ylab="Observed ecoli DNA concentration (ln copies/m^3)", cex.lab=0.85)
abline(lm(VGOB1_subsetvalID1to10_ecoli_LUR3_10foldCV$ecoli_copiespm3.ln.diffmeth.mean ~ VGOB1_subsetvalID1to10_ecoli_LUR3_10foldCV$ecoli_PRED_HV))

VGOB1_subsetvalID1to10_ecoli_LUR3_10foldCV_lm <- lm(ecoli_copiespm3.ln.diffmeth.mean ~ ecoli_PRED_HV, data=VGOB1_subsetvalID1to10_ecoli_LUR3_10foldCV)
summary(VGOB1_subsetvalID1to10_ecoli_LUR3_10foldCV_lm)

# 10-fold CV multiple R2 for E. coli LUR3 = 0.2102

#  Calculate RMSE
RMSE_ecoli_LUR3_10foldCV <- sqrt(mean((VGOB1_subsetvalID1to10_ecoli_LUR3_10foldCV$ecoli_copiespm3.ln.diffmeth.mean - VGOB1_subsetvalID1to10_ecoli_LUR3_10foldCV$ecoli_PRED_HV)^2))
RMSE_ecoli_LUR3_10foldCV

#  Save these predicted concentrations as an excel file along with the actual measured concentrations of ecoli at each of the measurement sites 
#  These are the predicted concentrations for the sites that were left out of the model training procedure in 10-fold cross validation 
ecoli_LUR3_10foldCV_preds <- VGOB1_subsetvalID1to10_ecoli_LUR3_10foldCV$ecoli_PRED_HV 
#  These are the actual measured concentrations at the 61 measurement sites - these are in the same order as the above sites in order to match the predicted concentrations (i.e. not in order 1-61)
VGOB1_subsetvalID1to10_ecoli_LUR3_10foldCV$ecoli_copiespm3.ln.diffmeth.mean

VGOB1_subsetvalID1to10_ecoli_LUR3_10foldCV$Loc_ID

#  Create a dataframe 
ecoli_SLR_10foldCVpreds_observed <- data.frame(VGOB1_subsetvalID1to10_ecoli_LUR3_10foldCV$Loc_ID,VGOB1_subsetvalID1to10_ecoli_LUR3_10foldCV$ecoli_copiespm3.ln.diffmeth.mean, VGOB1_subsetvalID1to10_ecoli_LUR3_10foldCV$ecoli_PRED_HV)
print(ecoli_SLR_10foldCVpreds_observed)

#  Save as xls file 
write_xlsx(ecoli_SLR_10foldCVpreds_observed,"Output_files\\ecoli_LUR3_10foldCV_observed_predicted.xlsx")

#   MODEL CHECKING #  
#  1)Check normality of residuals 
#  2)Check residuals for linearity, independence and homoscedasticity
#  3)Check multicollinearity (VIF)
#  4)Check influential points (Cook's Distance)

#  1) Normality of residuals
boxplot(residuals(VGOB1_subsetvalID1to10_ecoli_LUR3_10foldCV),main="boxplot of residuals - E. coli LUR3 (ln-transformed concentrations)",xlab="residuals")
qqnorm(residuals(VGOB1_subsetvalID1to10_ecoli_LUR3_10foldCV),main="QQ-plot of residuals - E. coli LUR3 (ln-transformed concentrations)",xlab="residuals")
hist(residuals(VGOB1_subsetvalID1to10_ecoli_LUR3_10foldCV),main="boxplot of residuals - E. coli LUR3 (ln-transformed concentrations)",xlab="residuals")

#  2)Check residuals for linearity, independence and homoscedasticity
plot(VGOB1_subsetvalID1to10_ecoli_LUR3_10foldCV$ecoli_PRED_HV,VGOB1_subsetvalID1to10_ecoli_LUR3_10foldCV$residuals)

#  3)Check multicollinearity (VIF)
ecoli_LUR3_maxVIF_subsetvalID1to10 <- c(maxVIF_ecoli_LUR3_subsetA, maxVIF_ecoli_LUR3_subsetB, maxVIF_ecoli_LUR3_subsetC, maxVIF_ecoli_LUR3_subsetD, maxVIF_ecoli_LUR3_subsetE, maxVIF_ecoli_LUR3_subsetF, maxVIF_ecoli_LUR3_subsetG, maxVIF_ecoli_LUR3_subsetH, maxVIF_ecoli_LUR3_subsetI, maxVIF_ecoli_LUR3_subsetJ)
max(ecoli_LUR3_maxVIF_subsetvalID1to10)

#  4)Check influential points (Cook's Distance)
ecoli_LUR3_maxCD_subsetvalID1to10 <- c(maxCD_ecoli_LUR3_subsetA, maxCD_ecoli_LUR3_subsetB, maxCD_ecoli_LUR3_subsetC, maxCD_ecoli_LUR3_subsetD, maxCD_ecoli_LUR3_subsetE, maxCD_ecoli_LUR3_subsetF, maxCD_ecoli_LUR3_subsetG, maxCD_ecoli_LUR3_subsetH, maxCD_ecoli_LUR3_subsetI, maxCD_ecoli_LUR3_subsetJ)
max(ecoli_LUR3_maxCD_subsetvalID1to10)
```
# Summarise performance (R2 and RMSE) of the E. coli models in a table 
```{r}
# E. coli 
# R-squared values
# Training models
ecoli_LUR1_trainingmodel_rsq <- summary(ecoli_LUR1_algorithmmethod)$r.squared
ecoli_LUR2_trainingmodel_rsq <- summary(ecoli_LUR2_algorithmmethod)$r.squared
ecoli_LUR3_trainingmodel_rsq <- summary(ecoli_LUR3_algorithmmethod)$r.squared

# LOOCV models 
ecoli_LUR1_LOOCVmodel_rsq <- summary(ecoli_LUR1_LOOCV_lm)$r.squared
ecoli_LUR2_LOOCVmodel_rsq <- summary(ecoli_LUR2_LOOCV_lm)$r.squared
ecoli_LUR3_LOOCVmodel_rsq <- summary(ecoli_LUR3_LOOCV_lm)$r.squared

# 10-fold CV models
ecoli_LUR1_10foldCVmodel_rsq <- summary(VGOB1_subsetvalID1to10_ecoli_LUR1_10foldCV_lm)$r.squared
ecoli_LUR2_10foldCVmodel_rsq <- summary(VGOB1_subsetvalID1to10_ecoli_LUR2_10foldCV_lm)$r.squared
ecoli_LUR3_10foldCVmodel_rsq <- summary(VGOB1_subsetvalID1to10_ecoli_LUR3_10foldCV_lm)$r.squared

# RMSE
# Training models
RMSE_ecoli_LUR1
RMSE_ecoli_LUR2
RMSE_ecoli_LUR3
# LOOCV models
RMSE_ecoli_LUR1_LOOCV
RMSE_ecoli_LUR2_LOOCV
RMSE_ecoli_LUR3_LOOCV
# 10-fold CV models 
RMSE_ecoli_LUR1_10foldCV
RMSE_ecoli_LUR2_10foldCV
RMSE_ecoli_LUR3_10foldCV

# Create dataframes
# Training models 
ecoli_trainingmodels_rsq <- c(ecoli_LUR1_trainingmodel_rsq,ecoli_LUR2_trainingmodel_rsq, ecoli_LUR3_trainingmodel_rsq)

ecoli_trainingmodels_RMSE <- c(RMSE_ecoli_LUR1,RMSE_ecoli_LUR2, RMSE_ecoli_LUR3)

# LOOCV models 
ecoli_LOOCVmodels_rsq <- c(ecoli_LUR1_LOOCVmodel_rsq,ecoli_LUR2_LOOCVmodel_rsq, ecoli_LUR3_LOOCVmodel_rsq)

ecoli_LOOCVmodels_RMSE <- c(RMSE_ecoli_LUR1_LOOCV,RMSE_ecoli_LUR2_LOOCV, RMSE_ecoli_LUR3_LOOCV)

# 10-fold CV models 
ecoli_10foldCVmodels_rsq <- c(ecoli_LUR1_10foldCVmodel_rsq,ecoli_LUR2_10foldCVmodel_rsq, ecoli_LUR3_10foldCVmodel_rsq)

ecoli_10foldCVmodels_RMSE <- c(RMSE_ecoli_LUR1_10foldCV,RMSE_ecoli_LUR2_10foldCV, RMSE_ecoli_LUR3_10foldCV)


# dataframe of all rsq and RMSE values from the training, LOOCV and 10-folds models (LUR1,2,3)
ecoli_allmodels_Rsq_RMSE <- data.frame(ecoli_trainingmodels_rsq, ecoli_trainingmodels_RMSE, ecoli_LOOCVmodels_rsq, ecoli_LOOCVmodels_RMSE, ecoli_10foldCVmodels_rsq, ecoli_10foldCVmodels_RMSE)
row_names_ecolimodels <- c("LUR1", "LUR2", "LUR3")
row.names(ecoli_allmodels_Rsq_RMSE) <- row_names_ecolimodels

write.csv(ecoli_allmodels_Rsq_RMSE,"Output_files\\ecoli_allmodels_Rsq_RMSE.csv")
```

